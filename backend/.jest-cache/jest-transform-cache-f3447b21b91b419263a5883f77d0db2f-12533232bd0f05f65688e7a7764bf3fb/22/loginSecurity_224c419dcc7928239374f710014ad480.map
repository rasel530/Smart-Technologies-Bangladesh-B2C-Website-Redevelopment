{"version":3,"names":["loginSecurityService","require","loggerService","LoginSecurityMiddleware","constructor","logger","enforce","req","res","next","identifier","password","body","ip","userAgent","get","process","env","DISABLE_LOGIN_SECURITY","userLockout","isUserLockedOut","isLocked","logSecurity","lockoutReason","reason","lockedAt","expiresAt","remainingTime","status","json","error","message","messageBn","lockoutDetails","Math","ceil","ipBlock","isIPBlocked","isBlocked","blockReason","blockedAt","blockDetails","suspiciousCheck","checkSuspiciousPatterns","isSuspicious","reasons","riskScore","captchaRequired","isCaptchaRequired","riskFactors","attempts","getAttemptCount","suspiciousPatterns","delay","calculateProgressiveDelay","Promise","resolve","setTimeout","addSecurityHeaders","userLocked","ipBlocked","suspiciousActivity","progressiveDelay","securityContext","deviceFingerprint","generateDeviceFingerprint","stats","getLoginAttemptStats","userAttempts","ipAttempts","set","toString","Date","toISOString","recordSuccessfulLogin","user","clearFailedAttempts","id","userId","timestamp","recordFailedLogin","authError","recordFailedAttempt","loginRateLimit","options","config","windowMs","max","skipSuccessfulRequests","key","now","windowStart","redis","pipeline","zRemRangeByScore","zAdd","score","value","random","zCard","expire","results","exec","currentCount","reply","count","limit","path","originalUrl","retryAfter","rateLimitDetails","resetTime","validateSecurity","validationErrors","push","violationCount","length","violations","loginSecurityMiddleware","module","exports"],"sources":["loginSecurity.js"],"sourcesContent":["const { loginSecurityService } = require('../services/loginSecurityService');\r\nconst { loggerService } = require('../services/logger');\r\n\r\nclass LoginSecurityMiddleware {\r\n  constructor() {\r\n    this.loginSecurityService = loginSecurityService;\r\n    this.logger = loggerService;\r\n  }\r\n\r\n  // Main login security middleware\r\n  enforce() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const { identifier, password } = req.body;\r\n        const ip = req.ip;\r\n        const userAgent = req.get('User-Agent');\r\n\r\n        // Skip security checks for testing mode if configured\r\n        if (process.env.DISABLE_LOGIN_SECURITY === 'true') {\r\n          return next();\r\n        }\r\n\r\n        // Check if user is locked out\r\n        const userLockout = await this.loginSecurityService.isUserLockedOut(identifier);\r\n        if (userLockout.isLocked) {\r\n          this.logger.logSecurity('Blocked Login Attempt - User Locked Out', null, {\r\n            identifier,\r\n            ip,\r\n            userAgent,\r\n            lockoutReason: userLockout.reason,\r\n            lockedAt: userLockout.lockedAt,\r\n            expiresAt: userLockout.expiresAt,\r\n            remainingTime: userLockout.remainingTime\r\n          });\r\n\r\n          return res.status(423).json({\r\n            error: 'Account locked',\r\n            message: 'Your account has been temporarily locked due to too many failed login attempts',\r\n            messageBn: 'অত্যাধিক লগইন চেষ্টার কারণে আপনার অ্যাকাউন্ট সাময়কি করা হয়েছে',\r\n            lockoutDetails: {\r\n              reason: userLockout.reason,\r\n              lockedAt: userLockout.lockedAt,\r\n              expiresAt: userLockout.expiresAt,\r\n              remainingTime: Math.ceil(userLockout.remainingTime / 1000 / 60) // minutes\r\n            }\r\n          });\r\n        }\r\n\r\n        // Check if IP is blocked\r\n        const ipBlock = await this.loginSecurityService.isIPBlocked(ip);\r\n        if (ipBlock.isBlocked) {\r\n          this.logger.logSecurity('Blocked Login Attempt - IP Blocked', null, {\r\n            identifier,\r\n            ip,\r\n            userAgent,\r\n            blockReason: ipBlock.reason,\r\n            blockedAt: ipBlock.blockedAt,\r\n            expiresAt: ipBlock.expiresAt,\r\n            remainingTime: ipBlock.remainingTime\r\n          });\r\n\r\n          return res.status(423).json({\r\n            error: 'IP blocked',\r\n            message: 'Your IP address has been temporarily blocked due to suspicious activity',\r\n            messageBn: 'সন্দেহিত কার্যকলার কারণে আপনার IP ঠিকানা সাময়কি করা হয়েছে',\r\n            blockDetails: {\r\n              reason: ipBlock.reason,\r\n              blockedAt: ipBlock.blockedAt,\r\n              expiresAt: ipBlock.expiresAt,\r\n              remainingTime: Math.ceil(ipBlock.remainingTime / 1000 / 60) // minutes\r\n            }\r\n          });\r\n        }\r\n\r\n        // Check for suspicious patterns\r\n        const suspiciousCheck = await this.loginSecurityService.checkSuspiciousPatterns(identifier, ip, userAgent);\r\n        if (suspiciousCheck.isSuspicious) {\r\n          this.logger.logSecurity('Suspicious Login Pattern Detected', null, {\r\n            identifier,\r\n            ip,\r\n            userAgent,\r\n            reasons: suspiciousCheck.reasons,\r\n            riskScore: suspiciousCheck.riskScore\r\n          });\r\n        }\r\n\r\n        // Check if captcha is required\r\n        const captchaRequired = await this.loginSecurityService.isCaptchaRequired(identifier, ip);\r\n        if (captchaRequired) {\r\n          return res.status(429).json({\r\n            error: 'Captcha required',\r\n            message: 'Please complete the captcha verification to continue',\r\n            messageBn: 'অবির্চ করতে চালিয় করতে অনুগ্রহ করুন',\r\n            captchaRequired: true,\r\n            riskFactors: {\r\n              attempts: await this.getAttemptCount(identifier, ip),\r\n              suspiciousPatterns: suspiciousCheck.reasons\r\n            }\r\n          });\r\n        }\r\n\r\n        // Calculate progressive delay\r\n        const delay = await this.loginSecurityService.calculateProgressiveDelay(identifier, ip);\r\n        if (delay > 0) {\r\n          this.logger.logSecurity('Progressive Delay Applied', null, {\r\n            identifier,\r\n            ip,\r\n            delay,\r\n            userAgent\r\n          });\r\n\r\n          // Apply delay before proceeding\r\n          await new Promise(resolve => setTimeout(resolve, delay));\r\n        }\r\n\r\n        // Add security headers to response\r\n        this.addSecurityHeaders(res, {\r\n          userLocked: userLockout.isLocked,\r\n          ipBlocked: ipBlock.isBlocked,\r\n          captchaRequired,\r\n          suspiciousActivity: suspiciousCheck.isSuspicious,\r\n          progressiveDelay: delay\r\n        });\r\n\r\n        // Attach security context to request for use in login route\r\n        req.securityContext = {\r\n          userLockout,\r\n          ipBlock,\r\n          suspiciousCheck,\r\n          captchaRequired,\r\n          progressiveDelay: delay,\r\n          deviceFingerprint: this.loginSecurityService.generateDeviceFingerprint(req)\r\n        };\r\n\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Login security middleware error', error.message, {\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent'),\r\n          identifier: req.body.identifier\r\n        });\r\n\r\n        // Fail open - allow request but log error\r\n        next();\r\n      }\r\n    };\r\n  }\r\n\r\n  // Get attempt count for response\r\n  async getAttemptCount(identifier, ip) {\r\n    try {\r\n      const stats = await this.loginSecurityService.getLoginAttemptStats(identifier, ip);\r\n      return {\r\n        userAttempts: stats.userAttempts,\r\n        ipAttempts: stats.ipAttempts\r\n      };\r\n    } catch (error) {\r\n      return { userAttempts: 0, ipAttempts: 0 };\r\n    }\r\n  }\r\n\r\n  // Add security headers to response\r\n  addSecurityHeaders(res, securityContext) {\r\n    // Add security-related headers\r\n    res.set({\r\n      'X-Login-Security-Enabled': 'true',\r\n      'X-User-Locked': securityContext.userLocked.toString(),\r\n      'X-IP-Blocked': securityContext.ipBlocked.toString(),\r\n      'X-Captcha-Required': securityContext.captchaRequired.toString(),\r\n      'X-Suspicious-Activity': securityContext.suspiciousActivity.toString(),\r\n      'X-Progressive-Delay': securityContext.progressiveDelay.toString(),\r\n      'X-Security-Timestamp': new Date().toISOString()\r\n    });\r\n  }\r\n\r\n  // Record successful login (clears failed attempts)\r\n  recordSuccessfulLogin(req, user) {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const { identifier } = req.body;\r\n        const ip = req.ip;\r\n        const userAgent = req.get('User-Agent');\r\n\r\n        // Clear failed attempts after successful login\r\n        await this.loginSecurityService.clearFailedAttempts(identifier, ip);\r\n\r\n        this.logger.logSecurity('Successful Login', user.id, {\r\n          identifier,\r\n          ip,\r\n          userAgent,\r\n          userId: user.id,\r\n          timestamp: new Date().toISOString()\r\n        });\r\n\r\n        // Add success headers\r\n        res.set({\r\n          'X-Login-Status': 'success',\r\n          'X-Security-Cleared': 'true',\r\n          'X-Login-Timestamp': new Date().toISOString()\r\n        });\r\n\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Error recording successful login', error.message);\r\n        next();\r\n      }\r\n    };\r\n  }\r\n\r\n  // Record failed login attempt\r\n  recordFailedLogin() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const { identifier } = req.body;\r\n        const ip = req.ip;\r\n        const userAgent = req.get('User-Agent');\r\n\r\n        // Record failed attempt with reason\r\n        const reason = req.authError || 'invalid_credentials';\r\n        await this.loginSecurityService.recordFailedAttempt(identifier, ip, userAgent, reason);\r\n\r\n        // Add failure headers\r\n        res.set({\r\n          'X-Login-Status': 'failed',\r\n          'X-Failure-Reason': reason,\r\n          'X-Login-Timestamp': new Date().toISOString()\r\n        });\r\n\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Error recording failed login', error.message);\r\n        next();\r\n      }\r\n    };\r\n  }\r\n\r\n  // Rate limiting middleware specifically for login endpoints\r\n  loginRateLimit(options = {}) {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const config = {\r\n          windowMs: options.windowMs || 15 * 60 * 1000, // 15 minutes\r\n          max: options.max || 10, // 10 login attempts per window\r\n          message: options.message || 'Too many login attempts, please try again later.',\r\n          skipSuccessfulRequests: options.skipSuccessfulRequests !== false\r\n        };\r\n\r\n        const ip = req.ip;\r\n        const key = `login_rate_limit:${ip}`;\r\n        const now = Date.now();\r\n        const windowStart = now - config.windowMs;\r\n\r\n        if (this.loginSecurityService.redis) {\r\n          // Use Redis for distributed rate limiting\r\n          const pipeline = this.loginSecurityService.redis.pipeline();\r\n          \r\n          // Remove old entries\r\n          pipeline.zRemRangeByScore(key, 0, windowStart);\r\n          \r\n          // Add current request\r\n          pipeline.zAdd(key, [{ score: now, value: `${now}-${Math.random()}` }]);\r\n          \r\n          // Get current count\r\n          pipeline.zCard(key);\r\n          \r\n          // Set expiration\r\n          pipeline.expire(key, Math.ceil(config.windowMs / 1000));\r\n          \r\n          const results = await pipeline.exec();\r\n          const currentCount = results[2].reply;\r\n\r\n          if (currentCount > config.max) {\r\n            this.logger.logSecurity('Login Rate Limit Exceeded', null, {\r\n              ip,\r\n              userAgent: req.get('User-Agent'),\r\n              count: currentCount,\r\n              limit: config.max,\r\n              windowMs: config.windowMs,\r\n              path: req.originalUrl\r\n            });\r\n\r\n            return res.status(429).json({\r\n              error: 'Too many login attempts',\r\n              message: config.message,\r\n              messageBn: 'অত্যাধিক লগইন চেষ্টা, অনুগ্রহ পরে চেষ্টা করুন',\r\n              retryAfter: Math.ceil(config.windowMs / 1000),\r\n              rateLimitDetails: {\r\n                currentCount,\r\n                limit: config.max,\r\n                windowMs: config.windowMs,\r\n                resetTime: new Date(now + config.windowMs).toISOString()\r\n              }\r\n            });\r\n          }\r\n\r\n          // Add rate limit headers\r\n          res.set({\r\n            'X-Login-RateLimit-Limit': config.max,\r\n            'X-Login-RateLimit-Remaining': Math.max(0, config.max - currentCount),\r\n            'X-Login-RateLimit-Reset': new Date(now + config.windowMs).toISOString()\r\n          });\r\n        }\r\n\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Login rate limiting error', error.message);\r\n        next(); // Fail open\r\n      }\r\n    };\r\n  }\r\n\r\n  // Enhanced security validation middleware\r\n  validateSecurity() {\r\n    return (req, res, next) => {\r\n      try {\r\n        const securityContext = req.securityContext;\r\n        \r\n        if (!securityContext) {\r\n          return next();\r\n        }\r\n\r\n        // Additional validation based on security context\r\n        const validationErrors = [];\r\n\r\n        // Check for high-risk patterns\r\n        if (securityContext.suspiciousCheck.riskScore >= 5) {\r\n          validationErrors.push('High risk activity detected');\r\n        }\r\n\r\n        // Check for multiple security violations\r\n        let violationCount = 0;\r\n        if (securityContext.userLocked.isLocked) { violationCount++; }\r\n        if (securityContext.ipBlock.isBlocked) { violationCount++; }\r\n        if (securityContext.captchaRequired) { violationCount++; }\r\n        if (securityContext.suspiciousCheck.isSuspicious) { violationCount++; }\r\n\r\n        if (violationCount >= 2) {\r\n          validationErrors.push('Multiple security violations detected');\r\n        }\r\n\r\n        if (validationErrors.length > 0) {\r\n          this.logger.logSecurity('Security Validation Failed', null, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            identifier: req.body.identifier,\r\n            validationErrors,\r\n            securityContext\r\n          });\r\n\r\n          return res.status(403).json({\r\n            error: 'Security validation failed',\r\n            message: 'Your request has been blocked due to security concerns',\r\n            messageBn: 'নিরাপত্তিগিয় উদ্বেগ আপনার অনুরোধ ব্লক করা হয়েছে',\r\n            validationErrors,\r\n            securityContext: {\r\n              riskScore: securityContext.suspiciousCheck.riskScore,\r\n              violations: violationCount\r\n            }\r\n          });\r\n        }\r\n\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Security validation error', error.message);\r\n        next();\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst loginSecurityMiddleware = new LoginSecurityMiddleware();\r\n\r\nmodule.exports = {\r\n  LoginSecurityMiddleware,\r\n  loginSecurityMiddleware\r\n};"],"mappings":"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","ignoreList":[]}