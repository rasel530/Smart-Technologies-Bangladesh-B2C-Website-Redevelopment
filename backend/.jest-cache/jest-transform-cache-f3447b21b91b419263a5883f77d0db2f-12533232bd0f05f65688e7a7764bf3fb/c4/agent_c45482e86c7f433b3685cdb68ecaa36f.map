{"version":3,"names":["agent","Agent","require","methods","http","http2","_","Test","TestAgent","app","options","Object","assign","_options","Error","createServer","setPrototypeOf","prototype","originalQuery","query","host","_host","forEach","method","url","fn","req","toUpperCase","set","on","_saveCookies","bind","_attachCookies","_setDefaults","del","delete","module","exports"],"sources":["agent.js"],"sourcesContent":["'use strict';\n\n/**\n * Module dependencies.\n */\n\nconst { agent: Agent } = require('superagent');\nconst methods = require('methods');\nconst http = require('http');\nlet http2;\ntry {\n  http2 = require('http2'); // eslint-disable-line global-require\n} catch (_) {\n  // eslint-disable-line no-empty\n}\nconst Test = require('./test.js');\n\n/**\n * Initialize a new `TestAgent`.\n *\n * @param {Function|Server} app\n * @param {Object} options\n * @api public\n */\n\nfunction TestAgent(app, options = {}) {\n  if (!(this instanceof TestAgent)) return new TestAgent(app, options);\n\n  const agent = new Agent(options);\n  Object.assign(this, agent);\n\n  this._options = options;\n\n  if (typeof app === 'function') {\n    if (options.http2) {\n      if (!http2) {\n        throw new Error(\n          'supertest: this version of Node.js does not support http2'\n        );\n      }\n      app = http2.createServer(app); // eslint-disable-line no-param-reassign\n    } else {\n      app = http.createServer(app); // eslint-disable-line no-param-reassign\n    }\n  }\n  this.app = app;\n}\n\n/**\n * Inherits from `Agent.prototype`.\n */\n\nObject.setPrototypeOf(TestAgent.prototype, Agent.prototype);\n\n// Preserve the original query method before overriding HTTP methods\nconst originalQuery = Agent.prototype.query;\n\n// set a host name\nTestAgent.prototype.host = function(host) {\n  this._host = host;\n  return this;\n};\n\n// override HTTP verb methods\nmethods.forEach(function(method) {\n  // Skip 'query' method to prevent overwriting superagent's query functionality\n  if (method === 'query') {\n    return;\n  }\n\n  TestAgent.prototype[method] = function(url, fn) { // eslint-disable-line no-unused-vars\n    const req = new Test(this.app, method.toUpperCase(), url);\n    if (this._options.http2) {\n      req.http2();\n    }\n\n    if (this._host) {\n      req.set('host', this._host);\n    }\n\n    req.on('response', this._saveCookies.bind(this));\n    req.on('redirect', this._saveCookies.bind(this));\n    req.on('redirect', this._attachCookies.bind(this, req));\n    this._setDefaults(req);\n    this._attachCookies(req);\n\n    return req;\n  };\n});\n\n// Restore the original query method\nTestAgent.prototype.query = originalQuery;\n\nTestAgent.prototype.del = TestAgent.prototype.delete;\n\n/**\n * Expose `Agent`.\n */\n\nmodule.exports = TestAgent;\n"],"mappings":"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","ignoreList":[]}