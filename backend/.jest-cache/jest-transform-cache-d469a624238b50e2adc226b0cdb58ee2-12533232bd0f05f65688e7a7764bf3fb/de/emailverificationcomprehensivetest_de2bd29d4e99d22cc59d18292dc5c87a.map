{"version":3,"names":["_getJestObj","mock","emailService","sendVerificationEmail","jest","fn","mockResolvedValue","success","messageId","sendWelcomeEmail","sendPasswordResetEmail","validateEmail","email","emailRegex","test","isDisposableEmail","disposableDomains","domain","split","toLowerCase","includes","generateVerificationToken","Math","random","toString","substr","isAvailable","loggerService","info","warn","error","debug","logAuth","logSecurity","logPerformance","configService","get","key","defaults","getJWTConfig","secret","algorithm","issuer","expiresIn","getEmailConfig","host","port","secure","user","pass","from","require","request","express","PrismaClient","jwt","authRoutes","emailVerificationMiddleware","app","use","json","prisma","describe","beforeEach","emailVerificationToken","deleteMany","where","contains","clearAllMocks","afterAll","$disconnect","userData","password","firstName","lastName","response","post","send","expect","body","message","toContain","status","toBe","requiresEmailVerification","toHaveBeenCalled","create","data","role","token","expiresAt","Date","now","userId","id","emailVerified","toBeTruthy","toHaveBeenCalledWith","any","String","createdAt","token1","token2","not","sign","set","middleware","requireEmailVerification","mockReq","ip","originalUrl","mockRes","mockReturnThis","mockNext","longEmail","repeat","response1","response2","Promise","all","successCount","filter","length","failCount","registerResponse","findUnique","include","emailVerificationTokens","toHaveLength","verificationToken","verifyResponse","loginResponse","toHaveBeenCalledTimes"],"sources":["email-verification-comprehensive.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst express = require('express');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst jwt = require('jsonwebtoken');\r\n\r\n// Import the modules we need to test\r\nconst authRoutes = require('../routes/auth');\r\nconst { emailVerificationMiddleware } = require('../middleware/emailVerification');\r\n\r\nconst app = express();\r\napp.use(express.json());\r\napp.use('/api/auth', authRoutes);\r\n\r\n// Mock modules within the test file to avoid setup issues\r\njest.mock('../services/emailService', () => ({\r\n  emailService: {\r\n    sendVerificationEmail: jest.fn().mockResolvedValue({\r\n      success: true,\r\n      messageId: 'test-message-id'\r\n    }),\r\n    sendWelcomeEmail: jest.fn().mockResolvedValue({\r\n      success: true,\r\n      messageId: 'welcome-message-id'\r\n    }),\r\n    sendPasswordResetEmail: jest.fn().mockResolvedValue({\r\n      success: true,\r\n      messageId: 'reset-message-id'\r\n    }),\r\n    validateEmail: jest.fn((email) => {\r\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n      return emailRegex.test(email);\r\n    }),\r\n    isDisposableEmail: jest.fn((email) => {\r\n      const disposableDomains = [\r\n        '10minutemail.com',\r\n        'tempmail.org',\r\n        'guerrillamail.com',\r\n        'mailinator.com',\r\n        'yopmail.com',\r\n        'throwaway.email'\r\n      ];\r\n      const domain = email.split('@')[1]?.toLowerCase();\r\n      return disposableDomains.includes(domain);\r\n    }),\r\n    generateVerificationToken: jest.fn(() => 'test-verification-token-' + Math.random().toString(36).substr(2, 9)),\r\n    isAvailable: jest.fn(() => true)\r\n  }\r\n}));\r\n\r\njest.mock('../services/logger', () => ({\r\n  loggerService: {\r\n    info: jest.fn(),\r\n    warn: jest.fn(),\r\n    error: jest.fn(),\r\n    debug: jest.fn(),\r\n    logAuth: jest.fn(),\r\n    logSecurity: jest.fn(),\r\n    logPerformance: jest.fn()\r\n  }\r\n}));\r\n\r\njest.mock('../services/config', () => ({\r\n  configService: {\r\n    get: jest.fn((key) => {\r\n      const defaults = {\r\n        'JWT_SECRET': 'test-jwt-secret-key',\r\n        'DATABASE_URL': 'postgresql://test:test@localhost:5432/test_db',\r\n        'REDIS_URL': 'redis://localhost:6379',\r\n        'NODE_ENV': 'test'\r\n      };\r\n      return defaults[key] || null;\r\n    }),\r\n    getJWTConfig: jest.fn(() => ({\r\n      secret: 'test-jwt-secret-key',\r\n      algorithm: 'HS256',\r\n      issuer: 'smart-technologies-bd',\r\n      expiresIn: '1h'\r\n    })),\r\n    getEmailConfig: jest.fn(() => ({\r\n      host: 'smtp.test.com',\r\n      port: 587,\r\n      secure: false,\r\n      user: 'test@test.com',\r\n      pass: 'test-password',\r\n      from: 'test@test.com'\r\n    }))\r\n  }\r\n}));\r\n\r\nconst prisma = new PrismaClient();\r\n\r\ndescribe('Comprehensive Email Verification System Tests', () => {\r\n  beforeEach(async () => {\r\n    // Clean up database before each test\r\n    await prisma.emailVerificationToken.deleteMany();\r\n    await prisma.user.deleteMany({\r\n      where: { email: { contains: 'test' } }\r\n    });\r\n    \r\n    // Clear all mocks\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  afterAll(async () => {\r\n    await prisma.$disconnect();\r\n  });\r\n\r\n  describe('Email Registration Flow', () => {\r\n    /**\r\n     * Test successful user registration with email verification\r\n     */\r\n    test('should register user with PENDING status and send verification email', async () => {\r\n      const userData = {\r\n        email: 'test@example.com',\r\n        password: 'Password123!',\r\n        firstName: 'Test',\r\n        lastName: 'User'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(201);\r\n\r\n      expect(response.body.message).toContain('Please check your email to verify your account');\r\n      expect(response.body.user.status).toBe('PENDING');\r\n      expect(response.body.requiresEmailVerification).toBe(true);\r\n      \r\n      // Verify email service was called\r\n      const { emailService } = require('../services/emailService');\r\n      expect(emailService.sendVerificationEmail).toHaveBeenCalled();\r\n    });\r\n\r\n    /**\r\n     * Test registration with disposable email rejection\r\n     */\r\n    test('should reject disposable email addresses', async () => {\r\n      const userData = {\r\n        email: 'test@10minutemail.com',\r\n        password: 'Password123!',\r\n        firstName: 'Test',\r\n        lastName: 'User'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Disposable email not allowed');\r\n    });\r\n\r\n    /**\r\n     * Test registration with invalid email format\r\n     */\r\n    test('should reject invalid email format', async () => {\r\n      const userData = {\r\n        email: 'invalid-email',\r\n        password: 'Password123!',\r\n        firstName: 'Test',\r\n        lastName: 'User'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Invalid email format');\r\n    });\r\n\r\n    /**\r\n     * Test registration with weak password\r\n     */\r\n    test('should reject weak password', async () => {\r\n      const userData = {\r\n        email: 'test@example.com',\r\n        password: '123',\r\n        firstName: 'Test',\r\n        lastName: 'User'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Password does not meet requirements');\r\n    });\r\n\r\n    /**\r\n     * Test registration with missing required fields\r\n     */\r\n    test('should reject registration with missing required fields', async () => {\r\n      const userData = {\r\n        email: 'test@example.com',\r\n        // Missing password, firstName, lastName\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Validation failed');\r\n    });\r\n  });\r\n\r\n  describe('Email Verification Process', () => {\r\n    /**\r\n     * Test successful email verification\r\n     */\r\n    test('should verify email with valid token', async () => {\r\n      // Create a user with PENDING status\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'test@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Test',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'PENDING'\r\n        }\r\n      });\r\n\r\n      // Create verification token\r\n      const token = 'valid-verification-token';\r\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);\r\n      \r\n      await prisma.emailVerificationToken.create({\r\n        data: {\r\n          userId: user.id,\r\n          token,\r\n          expiresAt\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/verify-email')\r\n        .send({ token })\r\n        .expect(200);\r\n\r\n      expect(response.body.message).toBe('Email verified successfully');\r\n      expect(response.body.user.status).toBe('ACTIVE');\r\n      expect(response.body.user.emailVerified).toBeTruthy();\r\n      \r\n      // Verify welcome email was sent\r\n      const { emailService } = require('../services/emailService');\r\n      expect(emailService.sendWelcomeEmail).toHaveBeenCalled();\r\n    });\r\n\r\n    /**\r\n     * Test verification with expired token\r\n     */\r\n    test('should reject expired token', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'test@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Test',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'PENDING'\r\n        }\r\n      });\r\n\r\n      const token = 'expired-token';\r\n      const expiresAt = new Date(Date.now() - 60 * 60 * 1000); // 1 hour ago\r\n      \r\n      await prisma.emailVerificationToken.create({\r\n        data: {\r\n          userId: user.id,\r\n          token,\r\n          expiresAt\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/verify-email')\r\n        .send({ token })\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Token expired');\r\n    });\r\n\r\n    /**\r\n     * Test verification with invalid token\r\n     */\r\n    test('should reject invalid token', async () => {\r\n      const response = await request(app)\r\n        .post('/api/auth/verify-email')\r\n        .send({ token: 'invalid-token' })\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Invalid token');\r\n    });\r\n\r\n    /**\r\n     * Test verification with missing token\r\n     */\r\n    test('should reject verification with missing token', async () => {\r\n      const response = await request(app)\r\n        .post('/api/auth/verify-email')\r\n        .send({})\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Token required');\r\n    });\r\n\r\n    /**\r\n     * Test verification of already verified user\r\n     */\r\n    test('should reject verification of already verified user', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'test@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Test',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'ACTIVE',\r\n          emailVerified: new Date()\r\n        }\r\n      });\r\n\r\n      const token = 'valid-verification-token';\r\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);\r\n      \r\n      await prisma.emailVerificationToken.create({\r\n        data: {\r\n          userId: user.id,\r\n          token,\r\n          expiresAt\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/verify-email')\r\n        .send({ token })\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Already verified');\r\n    });\r\n  });\r\n\r\n  describe('Resend Verification Email', () => {\r\n    /**\r\n     * Test successful resend of verification email\r\n     */\r\n    test('should resend verification email for unverified user', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'test@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Test',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'PENDING'\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/resend-verification')\r\n        .send({ email: user.email })\r\n        .expect(200);\r\n\r\n      expect(response.body.message).toBe('Verification email sent successfully');\r\n      \r\n      const { emailService } = require('../services/emailService');\r\n      expect(emailService.sendVerificationEmail).toHaveBeenCalledWith(\r\n        user.email,\r\n        `${user.firstName} ${user.lastName}`,\r\n        expect.any(String)\r\n      );\r\n    });\r\n\r\n    /**\r\n     * Test resend for already verified user\r\n     */\r\n    test('should reject already verified user', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'verified@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Verified',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'ACTIVE',\r\n          emailVerified: new Date()\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/resend-verification')\r\n        .send({ email: user.email })\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Already verified');\r\n    });\r\n\r\n    /**\r\n     * Test resend for non-existent user\r\n     */\r\n    test('should handle non-existent user gracefully', async () => {\r\n      const response = await request(app)\r\n        .post('/api/auth/resend-verification')\r\n        .send({ email: 'nonexistent@example.com' })\r\n        .expect(404);\r\n\r\n      expect(response.body.error).toBe('User not found');\r\n    });\r\n\r\n    /**\r\n     * Test rate limiting for resend requests\r\n     */\r\n    test('should implement rate limiting for resend requests', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'test@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Test',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'PENDING'\r\n        }\r\n      });\r\n\r\n      // Create recent verification token\r\n      const token = 'recent-token';\r\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);\r\n      \r\n      await prisma.emailVerificationToken.create({\r\n        data: {\r\n          userId: user.id,\r\n          token,\r\n          expiresAt,\r\n          createdAt: new Date(Date.now() - 2 * 60 * 1000) // 2 minutes ago\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/resend-verification')\r\n        .send({ email: user.email })\r\n        .expect(429);\r\n\r\n      expect(response.body.error).toBe('Too many requests');\r\n      expect(response.body.message).toContain('Please wait before requesting');\r\n    });\r\n  });\r\n\r\n  describe('Login with Email Verification', () => {\r\n    /**\r\n     * Test login rejection for unverified user\r\n     */\r\n    test('should reject login for unverified user', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'test@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Test',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'PENDING'\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/login')\r\n        .send({\r\n          email: user.email,\r\n          password: 'password123'\r\n        })\r\n        .expect(403);\r\n\r\n      expect(response.body.error).toBe('Email not verified');\r\n      expect(response.body.message).toContain('Please verify your email address');\r\n    });\r\n\r\n    /**\r\n     * Test successful login for verified user\r\n     */\r\n    test('should allow login for verified user', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'verified@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Verified',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'ACTIVE',\r\n          emailVerified: new Date()\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/login')\r\n        .send({\r\n          email: user.email,\r\n          password: 'password123'\r\n        })\r\n        .expect(200);\r\n\r\n      expect(response.body.message).toBe('Login successful');\r\n      expect(response.body.user.status).toBe('ACTIVE');\r\n      expect(response.body.token).toBeTruthy();\r\n    });\r\n\r\n    /**\r\n     * Test login with invalid credentials\r\n     */\r\n    test('should reject login with invalid credentials', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'verified@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Verified',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'ACTIVE',\r\n          emailVerified: new Date()\r\n        }\r\n      });\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/login')\r\n        .send({\r\n          email: user.email,\r\n          password: 'wrongpassword'\r\n        })\r\n        .expect(401);\r\n\r\n      expect(response.body.error).toBe('Invalid credentials');\r\n    });\r\n  });\r\n\r\n  describe('Email Service Validation', () => {\r\n    /**\r\n     * Test email format validation\r\n     */\r\n    test('should validate email format correctly', () => {\r\n      const { emailService } = require('../services/emailService');\r\n      \r\n      expect(emailService.validateEmail('test@example.com')).toBe(true);\r\n      expect(emailService.validateEmail('user.name@domain.co.uk')).toBe(true);\r\n      expect(emailService.validateEmail('user+tag@example.org')).toBe(true);\r\n      \r\n      expect(emailService.validateEmail('invalid-email')).toBe(false);\r\n      expect(emailService.validateEmail('test@')).toBe(false);\r\n      expect(emailService.validateEmail('@example.com')).toBe(false);\r\n      expect(emailService.validateEmail('test@.com')).toBe(false);\r\n    });\r\n\r\n    /**\r\n     * Test disposable email detection\r\n     */\r\n    test('should detect disposable emails', () => {\r\n      const { emailService } = require('../services/emailService');\r\n      \r\n      expect(emailService.isDisposableEmail('test@10minutemail.com')).toBe(true);\r\n      expect(emailService.isDisposableEmail('user@tempmail.org')).toBe(true);\r\n      expect(emailService.isDisposableEmail('demo@guerrillamail.com')).toBe(true);\r\n      expect(emailService.isDisposableEmail('sample@mailinator.com')).toBe(true);\r\n      \r\n      expect(emailService.isDisposableEmail('user@gmail.com')).toBe(false);\r\n      expect(emailService.isDisposableEmail('test@yahoo.com')).toBe(false);\r\n      expect(emailService.isDisposableEmail('user@outlook.com')).toBe(false);\r\n    });\r\n\r\n    /**\r\n     * Test verification token generation\r\n     */\r\n    test('should generate secure verification tokens', () => {\r\n      const { emailService } = require('../services/emailService');\r\n      \r\n      const token1 = emailService.generateVerificationToken();\r\n      const token2 = emailService.generateVerificationToken();\r\n      \r\n      expect(token1).toBeTruthy();\r\n      expect(token2).toBeTruthy();\r\n      expect(token1).not.toBe(token2);\r\n      expect(typeof token1).toBe('string');\r\n      expect(typeof token2).toBe('string');\r\n    });\r\n  });\r\n\r\n  describe('Email Verification Middleware', () => {\r\n    /**\r\n     * Test middleware allows access for verified user\r\n     */\r\n    test('should allow access for verified user', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'verified@example.com',\r\n          password: 'hashedpassword',\r\n          firstName: 'Verified',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'ACTIVE',\r\n          emailVerified: new Date()\r\n        }\r\n      });\r\n\r\n      const token = jwt.sign(\r\n        { userId: user.id, email: user.email, role: user.role },\r\n        'test-jwt-secret-key',\r\n        { expiresIn: '1h' }\r\n      );\r\n\r\n      const response = await request(app)\r\n        .get('/api/auth/profile')\r\n        .set('Authorization', `Bearer ${token}`)\r\n        .expect(200);\r\n\r\n      // This would test the middleware if it were applied to a protected route\r\n      expect(response.status).not.toBe(403);\r\n    });\r\n\r\n    /**\r\n     * Test middleware blocks unverified user\r\n     */\r\n    test('should block access for unverified user', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'unverified@example.com',\r\n          password: 'hashedpassword',\r\n          firstName: 'Unverified',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'PENDING'\r\n        }\r\n      });\r\n\r\n      const token = jwt.sign(\r\n        { userId: user.id, email: user.email, role: user.role },\r\n        'test-jwt-secret-key',\r\n        { expiresIn: '1h' }\r\n      );\r\n\r\n      // Test middleware function directly\r\n      const middleware = emailVerificationMiddleware.requireEmailVerification();\r\n      const mockReq = {\r\n        user: { userId: user.id, role: 'CUSTOMER' },\r\n        userId: user.id,\r\n        ip: '127.0.0.1',\r\n        originalUrl: '/api/protected-route',\r\n        get: jest.fn()\r\n      };\r\n\r\n      const mockRes = {\r\n        status: jest.fn().mockReturnThis(),\r\n        json: jest.fn()\r\n      };\r\n\r\n      const mockNext = jest.fn();\r\n\r\n      await middleware(mockReq, mockRes, mockNext);\r\n\r\n      expect(mockNext).not.toHaveBeenCalled();\r\n      expect(mockRes.status).toHaveBeenCalledWith(403);\r\n      expect(mockRes.json).toHaveBeenCalledWith({\r\n        error: 'Email not verified',\r\n        message: 'Please verify your email address to access this resource',\r\n        requiresEmailVerification: true\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Security and Edge Cases', () => {\r\n    /**\r\n     * Test SQL injection attempts in email field\r\n     */\r\n    test('should handle SQL injection attempts in email field', async () => {\r\n      const userData = {\r\n        email: \"'; DROP TABLE users; --\",\r\n        password: 'Password123!',\r\n        firstName: 'Test',\r\n        lastName: 'User'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Invalid email format');\r\n    });\r\n\r\n    /**\r\n     * Test XSS attempts in email field\r\n     */\r\n    test('should handle XSS attempts in email field', async () => {\r\n      const userData = {\r\n        email: '<script>alert(\"xss\")</script>@example.com',\r\n        password: 'Password123!',\r\n        firstName: 'Test',\r\n        lastName: 'User'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Invalid email format');\r\n    });\r\n\r\n    /**\r\n     * Test very long email addresses\r\n     */\r\n    test('should handle very long email addresses', async () => {\r\n      const longEmail = 'a'.repeat(300) + '@example.com';\r\n      const userData = {\r\n        email: longEmail,\r\n        password: 'Password123!',\r\n        firstName: 'Test',\r\n        lastName: 'User'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(400);\r\n\r\n      expect(response.body.error).toBe('Invalid email format');\r\n    });\r\n\r\n    /**\r\n     * Test concurrent registration attempts\r\n     */\r\n    test('should handle concurrent registration attempts', async () => {\r\n      const userData = {\r\n        email: 'concurrent@example.com',\r\n        password: 'Password123!',\r\n        firstName: 'Test',\r\n        lastName: 'User'\r\n      };\r\n\r\n      // Send two concurrent requests\r\n      const [response1, response2] = await Promise.all([\r\n        request(app).post('/api/auth/register').send(userData),\r\n        request(app).post('/api/auth/register').send(userData)\r\n      ]);\r\n\r\n      // One should succeed, one should fail\r\n      const successCount = [response1.status, response2.status].filter(status => status === 201).length;\r\n      const failCount = [response1.status, response2.status].filter(status => status === 409).length;\r\n      \r\n      expect(successCount).toBe(1);\r\n      expect(failCount).toBe(1);\r\n    });\r\n\r\n    /**\r\n     * Test token reuse attempts\r\n     */\r\n    test('should prevent token reuse', async () => {\r\n      const user = await prisma.user.create({\r\n        data: {\r\n          email: 'test@example.com',\r\n          password: '$2a$12$hashedpassword',\r\n          firstName: 'Test',\r\n          lastName: 'User',\r\n          role: 'CUSTOMER',\r\n          status: 'PENDING'\r\n        }\r\n      });\r\n\r\n      const token = 'reusable-token';\r\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);\r\n      \r\n      await prisma.emailVerificationToken.create({\r\n        data: {\r\n          userId: user.id,\r\n          token,\r\n          expiresAt\r\n        }\r\n      });\r\n\r\n      // First verification should succeed\r\n      const response1 = await request(app)\r\n        .post('/api/auth/verify-email')\r\n        .send({ token })\r\n        .expect(200);\r\n\r\n      expect(response1.body.message).toBe('Email verified successfully');\r\n\r\n      // Second verification with same token should fail\r\n      const response2 = await request(app)\r\n        .post('/api/auth/verify-email')\r\n        .send({ token })\r\n        .expect(400);\r\n\r\n      expect(response2.body.error).toBe('Invalid token');\r\n    });\r\n  });\r\n\r\n  describe('Complete Email Verification Flow Integration', () => {\r\n    /**\r\n     * Test complete registration to verification flow\r\n     */\r\n    test('should handle complete registration to verification flow', async () => {\r\n      const userData = {\r\n        email: 'integration@example.com',\r\n        password: 'Password123!',\r\n        firstName: 'Integration',\r\n        lastName: 'Test'\r\n      };\r\n\r\n      // Step 1: Register user\r\n      const registerResponse = await request(app)\r\n        .post('/api/auth/register')\r\n        .send(userData)\r\n        .expect(201);\r\n\r\n      expect(registerResponse.body.user.status).toBe('PENDING');\r\n      expect(registerResponse.body.requiresEmailVerification).toBe(true);\r\n\r\n      // Step 2: Get verification token from database\r\n      const user = await prisma.user.findUnique({\r\n        where: { email: userData.email },\r\n        include: {\r\n          emailVerificationTokens: true\r\n        }\r\n      });\r\n\r\n      expect(user.emailVerificationTokens).toHaveLength(1);\r\n      const verificationToken = user.emailVerificationTokens[0].token;\r\n\r\n      // Step 3: Verify email\r\n      const verifyResponse = await request(app)\r\n        .post('/api/auth/verify-email')\r\n        .send({ token: verificationToken })\r\n        .expect(200);\r\n\r\n      expect(verifyResponse.body.message).toBe('Email verified successfully');\r\n      expect(verifyResponse.body.user.status).toBe('ACTIVE');\r\n\r\n      // Step 4: Login with verified account\r\n      const loginResponse = await request(app)\r\n        .post('/api/auth/login')\r\n        .send({\r\n          email: userData.email,\r\n          password: userData.password\r\n        })\r\n        .expect(200);\r\n\r\n      expect(loginResponse.body.message).toBe('Login successful');\r\n      expect(loginResponse.body.user.status).toBe('ACTIVE');\r\n      expect(loginResponse.body.token).toBeTruthy();\r\n\r\n      // Verify email service calls\r\n      const { emailService } = require('../services/emailService');\r\n      expect(emailService.sendVerificationEmail).toHaveBeenCalledTimes(1);\r\n      expect(emailService.sendWelcomeEmail).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n});"],"mappings":"AAaA;AACAA,WAAA,GAAKC,IAAI,CAAC,0BAA0B,EAAE,OAAO;EAC3CC,YAAY,EAAE;IACZC,qBAAqB,EAAEC,IAAI,CAACC,EAAE,CAAC,CAAC,CAACC,iBAAiB,CAAC;MACjDC,OAAO,EAAE,IAAI;MACbC,SAAS,EAAE;IACb,CAAC,CAAC;IACFC,gBAAgB,EAAEL,IAAI,CAACC,EAAE,CAAC,CAAC,CAACC,iBAAiB,CAAC;MAC5CC,OAAO,EAAE,IAAI;MACbC,SAAS,EAAE;IACb,CAAC,CAAC;IACFE,sBAAsB,EAAEN,IAAI,CAACC,EAAE,CAAC,CAAC,CAACC,iBAAiB,CAAC;MAClDC,OAAO,EAAE,IAAI;MACbC,SAAS,EAAE;IACb,CAAC,CAAC;IACFG,aAAa,EAAEP,IAAI,CAACC,EAAE,CAAEO,KAAK,IAAK;MAChC,MAAMC,UAAU,GAAG,4BAA4B;MAC/C,OAAOA,UAAU,CAACC,IAAI,CAACF,KAAK,CAAC;IAC/B,CAAC,CAAC;IACFG,iBAAiB,EAAEX,IAAI,CAACC,EAAE,CAAEO,KAAK,IAAK;MACpC,MAAMI,iBAAiB,GAAG,CACxB,kBAAkB,EAClB,cAAc,EACd,mBAAmB,EACnB,gBAAgB,EAChB,aAAa,EACb,iBAAiB,CAClB;MACD,MAAMC,MAAM,GAAGL,KAAK,CAACM,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAEC,WAAW,CAAC,CAAC;MACjD,OAAOH,iBAAiB,CAACI,QAAQ,CAACH,MAAM,CAAC;IAC3C,CAAC,CAAC;IACFI,yBAAyB,EAAEjB,IAAI,CAACC,EAAE,CAAC,MAAM,0BAA0B,GAAGiB,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC9GC,WAAW,EAAEtB,IAAI,CAACC,EAAE,CAAC,MAAM,IAAI;EACjC;AACF,CAAC,CAAC,CAAC;AAEHL,WAAA,GAAKC,IAAI,CAAC,oBAAoB,EAAE,OAAO;EACrC0B,aAAa,EAAE;IACbC,IAAI,EAAExB,IAAI,CAACC,EAAE,CAAC,CAAC;IACfwB,IAAI,EAAEzB,IAAI,CAACC,EAAE,CAAC,CAAC;IACfyB,KAAK,EAAE1B,IAAI,CAACC,EAAE,CAAC,CAAC;IAChB0B,KAAK,EAAE3B,IAAI,CAACC,EAAE,CAAC,CAAC;IAChB2B,OAAO,EAAE5B,IAAI,CAACC,EAAE,CAAC,CAAC;IAClB4B,WAAW,EAAE7B,IAAI,CAACC,EAAE,CAAC,CAAC;IACtB6B,cAAc,EAAE9B,IAAI,CAACC,EAAE,CAAC;EAC1B;AACF,CAAC,CAAC,CAAC;AAEHL,WAAA,GAAKC,IAAI,CAAC,oBAAoB,EAAE,OAAO;EACrCkC,aAAa,EAAE;IACbC,GAAG,EAAEhC,IAAI,CAACC,EAAE,CAAEgC,GAAG,IAAK;MACpB,MAAMC,QAAQ,GAAG;QACf,YAAY,EAAE,qBAAqB;QACnC,cAAc,EAAE,+CAA+C;QAC/D,WAAW,EAAE,wBAAwB;QACrC,UAAU,EAAE;MACd,CAAC;MACD,OAAOA,QAAQ,CAACD,GAAG,CAAC,IAAI,IAAI;IAC9B,CAAC,CAAC;IACFE,YAAY,EAAEnC,IAAI,CAACC,EAAE,CAAC,OAAO;MAC3BmC,MAAM,EAAE,qBAAqB;MAC7BC,SAAS,EAAE,OAAO;MAClBC,MAAM,EAAE,uBAAuB;MAC/BC,SAAS,EAAE;IACb,CAAC,CAAC,CAAC;IACHC,cAAc,EAAExC,IAAI,CAACC,EAAE,CAAC,OAAO;MAC7BwC,IAAI,EAAE,eAAe;MACrBC,IAAI,EAAE,GAAG;MACTC,MAAM,EAAE,KAAK;MACbC,IAAI,EAAE,eAAe;MACrBC,IAAI,EAAE,eAAe;MACrBC,IAAI,EAAE;IACR,CAAC,CAAC;EACJ;AACF,CAAC,CAAC,CAAC;AAAC,SAAAlD,YAAA;EAAA;IAAAI;EAAA,IAAA+C,OAAA;EAAAnD,WAAA,GAAAA,CAAA,KAAAI,IAAA;EAAA,OAAAA,IAAA;AAAA;AAvFJ,MAAMgD,OAAO,GAAGD,OAAO,CAAC,WAAW,CAAC;AACpC,MAAME,OAAO,GAAGF,OAAO,CAAC,SAAS,CAAC;AAClC,MAAM;EAAEG;AAAa,CAAC,GAAGH,OAAO,CAAC,gBAAgB,CAAC;AAClD,MAAMI,GAAG,GAAGJ,OAAO,CAAC,cAAc,CAAC;;AAEnC;AACA,MAAMK,UAAU,GAAGL,OAAO,CAAC,gBAAgB,CAAC;AAC5C,MAAM;EAAEM;AAA4B,CAAC,GAAGN,OAAO,CAAC,iCAAiC,CAAC;AAElF,MAAMO,GAAG,GAAGL,OAAO,CAAC,CAAC;AACrBK,GAAG,CAACC,GAAG,CAACN,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC;AACvBF,GAAG,CAACC,GAAG,CAAC,WAAW,EAAEH,UAAU,CAAC;AA8EhC,MAAMK,MAAM,GAAG,IAAIP,YAAY,CAAC,CAAC;AAEjCQ,QAAQ,CAAC,+CAA+C,EAAE,MAAM;EAC9DC,UAAU,CAAC,YAAY;IACrB;IACA,MAAMF,MAAM,CAACG,sBAAsB,CAACC,UAAU,CAAC,CAAC;IAChD,MAAMJ,MAAM,CAACb,IAAI,CAACiB,UAAU,CAAC;MAC3BC,KAAK,EAAE;QAAEtD,KAAK,EAAE;UAAEuD,QAAQ,EAAE;QAAO;MAAE;IACvC,CAAC,CAAC;;IAEF;IACA/D,IAAI,CAACgE,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFC,QAAQ,CAAC,YAAY;IACnB,MAAMR,MAAM,CAACS,WAAW,CAAC,CAAC;EAC5B,CAAC,CAAC;EAEFR,QAAQ,CAAC,yBAAyB,EAAE,MAAM;IACxC;AACJ;AACA;IACIhD,IAAI,CAAC,sEAAsE,EAAE,YAAY;MACvF,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE,kBAAkB;QACzB4D,QAAQ,EAAE,cAAc;QACxBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE;MACZ,CAAC;MAED,MAAMC,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACC,OAAO,CAAC,CAACC,SAAS,CAAC,gDAAgD,CAAC;MACzFH,MAAM,CAACH,QAAQ,CAACI,IAAI,CAAC/B,IAAI,CAACkC,MAAM,CAAC,CAACC,IAAI,CAAC,SAAS,CAAC;MACjDL,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACK,yBAAyB,CAAC,CAACD,IAAI,CAAC,IAAI,CAAC;;MAE1D;MACA,MAAM;QAAEjF;MAAa,CAAC,GAAGiD,OAAO,CAAC,0BAA0B,CAAC;MAC5D2B,MAAM,CAAC5E,YAAY,CAACC,qBAAqB,CAAC,CAACkF,gBAAgB,CAAC,CAAC;IAC/D,CAAC,CAAC;;IAEF;AACJ;AACA;IACIvE,IAAI,CAAC,0CAA0C,EAAE,YAAY;MAC3D,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE,uBAAuB;QAC9B4D,QAAQ,EAAE,cAAc;QACxBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE;MACZ,CAAC;MAED,MAAMC,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,8BAA8B,CAAC;IAClE,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,oCAAoC,EAAE,YAAY;MACrD,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE,eAAe;QACtB4D,QAAQ,EAAE,cAAc;QACxBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE;MACZ,CAAC;MAED,MAAMC,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,sBAAsB,CAAC;IAC1D,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,6BAA6B,EAAE,YAAY;MAC9C,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE,kBAAkB;QACzB4D,QAAQ,EAAE,KAAK;QACfC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE;MACZ,CAAC;MAED,MAAMC,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,qCAAqC,CAAC;IACzE,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,yDAAyD,EAAE,YAAY;MAC1E,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE;QACP;MACF,CAAC;MAED,MAAM+D,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,mBAAmB,CAAC;IACvD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFrB,QAAQ,CAAC,4BAA4B,EAAE,MAAM;IAC3C;AACJ;AACA;IACIhD,IAAI,CAAC,sCAAsC,EAAE,YAAY;MACvD;MACA,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,kBAAkB;UACzB4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,MAAM;UACjBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE;QACV;MACF,CAAC,CAAC;;MAEF;MACA,MAAMO,KAAK,GAAG,0BAA0B;MACxC,MAAMC,SAAS,GAAG,IAAIC,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;MAE5D,MAAM/B,MAAM,CAACG,sBAAsB,CAACsB,MAAM,CAAC;QACzCC,IAAI,EAAE;UACJM,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;UACfL,KAAK;UACLC;QACF;MACF,CAAC,CAAC;MAEF,MAAMf,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,wBAAwB,CAAC,CAC9BC,IAAI,CAAC;QAAEY;MAAM,CAAC,CAAC,CACfX,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACC,OAAO,CAAC,CAACG,IAAI,CAAC,6BAA6B,CAAC;MACjEL,MAAM,CAACH,QAAQ,CAACI,IAAI,CAAC/B,IAAI,CAACkC,MAAM,CAAC,CAACC,IAAI,CAAC,QAAQ,CAAC;MAChDL,MAAM,CAACH,QAAQ,CAACI,IAAI,CAAC/B,IAAI,CAAC+C,aAAa,CAAC,CAACC,UAAU,CAAC,CAAC;;MAErD;MACA,MAAM;QAAE9F;MAAa,CAAC,GAAGiD,OAAO,CAAC,0BAA0B,CAAC;MAC5D2B,MAAM,CAAC5E,YAAY,CAACO,gBAAgB,CAAC,CAAC4E,gBAAgB,CAAC,CAAC;IAC1D,CAAC,CAAC;;IAEF;AACJ;AACA;IACIvE,IAAI,CAAC,6BAA6B,EAAE,YAAY;MAC9C,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,kBAAkB;UACzB4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,MAAM;UACjBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE;QACV;MACF,CAAC,CAAC;MAEF,MAAMO,KAAK,GAAG,eAAe;MAC7B,MAAMC,SAAS,GAAG,IAAIC,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC;;MAEzD,MAAM/B,MAAM,CAACG,sBAAsB,CAACsB,MAAM,CAAC;QACzCC,IAAI,EAAE;UACJM,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;UACfL,KAAK;UACLC;QACF;MACF,CAAC,CAAC;MAEF,MAAMf,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,wBAAwB,CAAC,CAC9BC,IAAI,CAAC;QAAEY;MAAM,CAAC,CAAC,CACfX,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,eAAe,CAAC;IACnD,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,6BAA6B,EAAE,YAAY;MAC9C,MAAM6D,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,wBAAwB,CAAC,CAC9BC,IAAI,CAAC;QAAEY,KAAK,EAAE;MAAgB,CAAC,CAAC,CAChCX,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,eAAe,CAAC;IACnD,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,+CAA+C,EAAE,YAAY;MAChE,MAAM6D,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,wBAAwB,CAAC,CAC9BC,IAAI,CAAC,CAAC,CAAC,CAAC,CACRC,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,gBAAgB,CAAC;IACpD,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,qDAAqD,EAAE,YAAY;MACtE,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,kBAAkB;UACzB4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,MAAM;UACjBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE,QAAQ;UAChBa,aAAa,EAAE,IAAIJ,IAAI,CAAC;QAC1B;MACF,CAAC,CAAC;MAEF,MAAMF,KAAK,GAAG,0BAA0B;MACxC,MAAMC,SAAS,GAAG,IAAIC,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;MAE5D,MAAM/B,MAAM,CAACG,sBAAsB,CAACsB,MAAM,CAAC;QACzCC,IAAI,EAAE;UACJM,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;UACfL,KAAK;UACLC;QACF;MACF,CAAC,CAAC;MAEF,MAAMf,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,wBAAwB,CAAC,CAC9BC,IAAI,CAAC;QAAEY;MAAM,CAAC,CAAC,CACfX,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,kBAAkB,CAAC;IACtD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFrB,QAAQ,CAAC,2BAA2B,EAAE,MAAM;IAC1C;AACJ;AACA;IACIhD,IAAI,CAAC,sDAAsD,EAAE,YAAY;MACvE,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,kBAAkB;UACzB4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,MAAM;UACjBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE;QACV;MACF,CAAC,CAAC;MAEF,MAAMP,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,+BAA+B,CAAC,CACrCC,IAAI,CAAC;QAAEjE,KAAK,EAAEoC,IAAI,CAACpC;MAAM,CAAC,CAAC,CAC3BkE,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACC,OAAO,CAAC,CAACG,IAAI,CAAC,sCAAsC,CAAC;MAE1E,MAAM;QAAEjF;MAAa,CAAC,GAAGiD,OAAO,CAAC,0BAA0B,CAAC;MAC5D2B,MAAM,CAAC5E,YAAY,CAACC,qBAAqB,CAAC,CAAC8F,oBAAoB,CAC7DjD,IAAI,CAACpC,KAAK,EACV,GAAGoC,IAAI,CAACyB,SAAS,IAAIzB,IAAI,CAAC0B,QAAQ,EAAE,EACpCI,MAAM,CAACoB,GAAG,CAACC,MAAM,CACnB,CAAC;IACH,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrF,IAAI,CAAC,qCAAqC,EAAE,YAAY;MACtD,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,sBAAsB;UAC7B4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,UAAU;UACrBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE,QAAQ;UAChBa,aAAa,EAAE,IAAIJ,IAAI,CAAC;QAC1B;MACF,CAAC,CAAC;MAEF,MAAMhB,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,+BAA+B,CAAC,CACrCC,IAAI,CAAC;QAAEjE,KAAK,EAAEoC,IAAI,CAACpC;MAAM,CAAC,CAAC,CAC3BkE,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,kBAAkB,CAAC;IACtD,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,4CAA4C,EAAE,YAAY;MAC7D,MAAM6D,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,+BAA+B,CAAC,CACrCC,IAAI,CAAC;QAAEjE,KAAK,EAAE;MAA0B,CAAC,CAAC,CAC1CkE,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,gBAAgB,CAAC;IACpD,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,oDAAoD,EAAE,YAAY;MACrE,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,kBAAkB;UACzB4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,MAAM;UACjBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE;QACV;MACF,CAAC,CAAC;;MAEF;MACA,MAAMO,KAAK,GAAG,cAAc;MAC5B,MAAMC,SAAS,GAAG,IAAIC,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;MAE5D,MAAM/B,MAAM,CAACG,sBAAsB,CAACsB,MAAM,CAAC;QACzCC,IAAI,EAAE;UACJM,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;UACfL,KAAK;UACLC,SAAS;UACTU,SAAS,EAAE,IAAIT,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;QAClD;MACF,CAAC,CAAC;MAEF,MAAMjB,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,+BAA+B,CAAC,CACrCC,IAAI,CAAC;QAAEjE,KAAK,EAAEoC,IAAI,CAACpC;MAAM,CAAC,CAAC,CAC3BkE,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,mBAAmB,CAAC;MACrDL,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACC,OAAO,CAAC,CAACC,SAAS,CAAC,+BAA+B,CAAC;IAC1E,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFnB,QAAQ,CAAC,+BAA+B,EAAE,MAAM;IAC9C;AACJ;AACA;IACIhD,IAAI,CAAC,yCAAyC,EAAE,YAAY;MAC1D,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,kBAAkB;UACzB4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,MAAM;UACjBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE;QACV;MACF,CAAC,CAAC;MAEF,MAAMP,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,iBAAiB,CAAC,CACvBC,IAAI,CAAC;QACJjE,KAAK,EAAEoC,IAAI,CAACpC,KAAK;QACjB4D,QAAQ,EAAE;MACZ,CAAC,CAAC,CACDM,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,oBAAoB,CAAC;MACtDL,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACC,OAAO,CAAC,CAACC,SAAS,CAAC,kCAAkC,CAAC;IAC7E,CAAC,CAAC;;IAEF;AACJ;AACA;IACInE,IAAI,CAAC,sCAAsC,EAAE,YAAY;MACvD,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,sBAAsB;UAC7B4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,UAAU;UACrBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE,QAAQ;UAChBa,aAAa,EAAE,IAAIJ,IAAI,CAAC;QAC1B;MACF,CAAC,CAAC;MAEF,MAAMhB,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,iBAAiB,CAAC,CACvBC,IAAI,CAAC;QACJjE,KAAK,EAAEoC,IAAI,CAACpC,KAAK;QACjB4D,QAAQ,EAAE;MACZ,CAAC,CAAC,CACDM,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACC,OAAO,CAAC,CAACG,IAAI,CAAC,kBAAkB,CAAC;MACtDL,MAAM,CAACH,QAAQ,CAACI,IAAI,CAAC/B,IAAI,CAACkC,MAAM,CAAC,CAACC,IAAI,CAAC,QAAQ,CAAC;MAChDL,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACU,KAAK,CAAC,CAACO,UAAU,CAAC,CAAC;IAC1C,CAAC,CAAC;;IAEF;AACJ;AACA;IACIlF,IAAI,CAAC,8CAA8C,EAAE,YAAY;MAC/D,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,sBAAsB;UAC7B4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,UAAU;UACrBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE,QAAQ;UAChBa,aAAa,EAAE,IAAIJ,IAAI,CAAC;QAC1B;MACF,CAAC,CAAC;MAEF,MAAMhB,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,iBAAiB,CAAC,CACvBC,IAAI,CAAC;QACJjE,KAAK,EAAEoC,IAAI,CAACpC,KAAK;QACjB4D,QAAQ,EAAE;MACZ,CAAC,CAAC,CACDM,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,qBAAqB,CAAC;IACzD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFrB,QAAQ,CAAC,0BAA0B,EAAE,MAAM;IACzC;AACJ;AACA;IACIhD,IAAI,CAAC,wCAAwC,EAAE,MAAM;MACnD,MAAM;QAAEZ;MAAa,CAAC,GAAGiD,OAAO,CAAC,0BAA0B,CAAC;MAE5D2B,MAAM,CAAC5E,YAAY,CAACS,aAAa,CAAC,kBAAkB,CAAC,CAAC,CAACwE,IAAI,CAAC,IAAI,CAAC;MACjEL,MAAM,CAAC5E,YAAY,CAACS,aAAa,CAAC,wBAAwB,CAAC,CAAC,CAACwE,IAAI,CAAC,IAAI,CAAC;MACvEL,MAAM,CAAC5E,YAAY,CAACS,aAAa,CAAC,sBAAsB,CAAC,CAAC,CAACwE,IAAI,CAAC,IAAI,CAAC;MAErEL,MAAM,CAAC5E,YAAY,CAACS,aAAa,CAAC,eAAe,CAAC,CAAC,CAACwE,IAAI,CAAC,KAAK,CAAC;MAC/DL,MAAM,CAAC5E,YAAY,CAACS,aAAa,CAAC,OAAO,CAAC,CAAC,CAACwE,IAAI,CAAC,KAAK,CAAC;MACvDL,MAAM,CAAC5E,YAAY,CAACS,aAAa,CAAC,cAAc,CAAC,CAAC,CAACwE,IAAI,CAAC,KAAK,CAAC;MAC9DL,MAAM,CAAC5E,YAAY,CAACS,aAAa,CAAC,WAAW,CAAC,CAAC,CAACwE,IAAI,CAAC,KAAK,CAAC;IAC7D,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,iCAAiC,EAAE,MAAM;MAC5C,MAAM;QAAEZ;MAAa,CAAC,GAAGiD,OAAO,CAAC,0BAA0B,CAAC;MAE5D2B,MAAM,CAAC5E,YAAY,CAACa,iBAAiB,CAAC,uBAAuB,CAAC,CAAC,CAACoE,IAAI,CAAC,IAAI,CAAC;MAC1EL,MAAM,CAAC5E,YAAY,CAACa,iBAAiB,CAAC,mBAAmB,CAAC,CAAC,CAACoE,IAAI,CAAC,IAAI,CAAC;MACtEL,MAAM,CAAC5E,YAAY,CAACa,iBAAiB,CAAC,wBAAwB,CAAC,CAAC,CAACoE,IAAI,CAAC,IAAI,CAAC;MAC3EL,MAAM,CAAC5E,YAAY,CAACa,iBAAiB,CAAC,uBAAuB,CAAC,CAAC,CAACoE,IAAI,CAAC,IAAI,CAAC;MAE1EL,MAAM,CAAC5E,YAAY,CAACa,iBAAiB,CAAC,gBAAgB,CAAC,CAAC,CAACoE,IAAI,CAAC,KAAK,CAAC;MACpEL,MAAM,CAAC5E,YAAY,CAACa,iBAAiB,CAAC,gBAAgB,CAAC,CAAC,CAACoE,IAAI,CAAC,KAAK,CAAC;MACpEL,MAAM,CAAC5E,YAAY,CAACa,iBAAiB,CAAC,kBAAkB,CAAC,CAAC,CAACoE,IAAI,CAAC,KAAK,CAAC;IACxE,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,4CAA4C,EAAE,MAAM;MACvD,MAAM;QAAEZ;MAAa,CAAC,GAAGiD,OAAO,CAAC,0BAA0B,CAAC;MAE5D,MAAMkD,MAAM,GAAGnG,YAAY,CAACmB,yBAAyB,CAAC,CAAC;MACvD,MAAMiF,MAAM,GAAGpG,YAAY,CAACmB,yBAAyB,CAAC,CAAC;MAEvDyD,MAAM,CAACuB,MAAM,CAAC,CAACL,UAAU,CAAC,CAAC;MAC3BlB,MAAM,CAACwB,MAAM,CAAC,CAACN,UAAU,CAAC,CAAC;MAC3BlB,MAAM,CAACuB,MAAM,CAAC,CAACE,GAAG,CAACpB,IAAI,CAACmB,MAAM,CAAC;MAC/BxB,MAAM,CAAC,OAAOuB,MAAM,CAAC,CAAClB,IAAI,CAAC,QAAQ,CAAC;MACpCL,MAAM,CAAC,OAAOwB,MAAM,CAAC,CAACnB,IAAI,CAAC,QAAQ,CAAC;IACtC,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFrB,QAAQ,CAAC,+BAA+B,EAAE,MAAM;IAC9C;AACJ;AACA;IACIhD,IAAI,CAAC,uCAAuC,EAAE,YAAY;MACxD,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,sBAAsB;UAC7B4D,QAAQ,EAAE,gBAAgB;UAC1BC,SAAS,EAAE,UAAU;UACrBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE,QAAQ;UAChBa,aAAa,EAAE,IAAIJ,IAAI,CAAC;QAC1B;MACF,CAAC,CAAC;MAEF,MAAMF,KAAK,GAAGlC,GAAG,CAACiD,IAAI,CACpB;QAAEX,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;QAAElF,KAAK,EAAEoC,IAAI,CAACpC,KAAK;QAAE4E,IAAI,EAAExC,IAAI,CAACwC;MAAK,CAAC,EACvD,qBAAqB,EACrB;QAAE7C,SAAS,EAAE;MAAK,CACpB,CAAC;MAED,MAAMgC,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCtB,GAAG,CAAC,mBAAmB,CAAC,CACxBqE,GAAG,CAAC,eAAe,EAAE,UAAUhB,KAAK,EAAE,CAAC,CACvCX,MAAM,CAAC,GAAG,CAAC;;MAEd;MACAA,MAAM,CAACH,QAAQ,CAACO,MAAM,CAAC,CAACqB,GAAG,CAACpB,IAAI,CAAC,GAAG,CAAC;IACvC,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,yCAAyC,EAAE,YAAY;MAC1D,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,wBAAwB;UAC/B4D,QAAQ,EAAE,gBAAgB;UAC1BC,SAAS,EAAE,YAAY;UACvBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE;QACV;MACF,CAAC,CAAC;MAEF,MAAMO,KAAK,GAAGlC,GAAG,CAACiD,IAAI,CACpB;QAAEX,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;QAAElF,KAAK,EAAEoC,IAAI,CAACpC,KAAK;QAAE4E,IAAI,EAAExC,IAAI,CAACwC;MAAK,CAAC,EACvD,qBAAqB,EACrB;QAAE7C,SAAS,EAAE;MAAK,CACpB,CAAC;;MAED;MACA,MAAM+D,UAAU,GAAGjD,2BAA2B,CAACkD,wBAAwB,CAAC,CAAC;MACzE,MAAMC,OAAO,GAAG;QACd5D,IAAI,EAAE;UAAE6C,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;UAAEN,IAAI,EAAE;QAAW,CAAC;QAC3CK,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;QACfe,EAAE,EAAE,WAAW;QACfC,WAAW,EAAE,sBAAsB;QACnC1E,GAAG,EAAEhC,IAAI,CAACC,EAAE,CAAC;MACf,CAAC;MAED,MAAM0G,OAAO,GAAG;QACd7B,MAAM,EAAE9E,IAAI,CAACC,EAAE,CAAC,CAAC,CAAC2G,cAAc,CAAC,CAAC;QAClCpD,IAAI,EAAExD,IAAI,CAACC,EAAE,CAAC;MAChB,CAAC;MAED,MAAM4G,QAAQ,GAAG7G,IAAI,CAACC,EAAE,CAAC,CAAC;MAE1B,MAAMqG,UAAU,CAACE,OAAO,EAAEG,OAAO,EAAEE,QAAQ,CAAC;MAE5CnC,MAAM,CAACmC,QAAQ,CAAC,CAACV,GAAG,CAAClB,gBAAgB,CAAC,CAAC;MACvCP,MAAM,CAACiC,OAAO,CAAC7B,MAAM,CAAC,CAACe,oBAAoB,CAAC,GAAG,CAAC;MAChDnB,MAAM,CAACiC,OAAO,CAACnD,IAAI,CAAC,CAACqC,oBAAoB,CAAC;QACxCnE,KAAK,EAAE,oBAAoB;QAC3BkD,OAAO,EAAE,0DAA0D;QACnEI,yBAAyB,EAAE;MAC7B,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFtB,QAAQ,CAAC,yBAAyB,EAAE,MAAM;IACxC;AACJ;AACA;IACIhD,IAAI,CAAC,qDAAqD,EAAE,YAAY;MACtE,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE,yBAAyB;QAChC4D,QAAQ,EAAE,cAAc;QACxBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE;MACZ,CAAC;MAED,MAAMC,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,sBAAsB,CAAC;IAC1D,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,2CAA2C,EAAE,YAAY;MAC5D,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE,2CAA2C;QAClD4D,QAAQ,EAAE,cAAc;QACxBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE;MACZ,CAAC;MAED,MAAMC,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,sBAAsB,CAAC;IAC1D,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,yCAAyC,EAAE,YAAY;MAC1D,MAAMoG,SAAS,GAAG,GAAG,CAACC,MAAM,CAAC,GAAG,CAAC,GAAG,cAAc;MAClD,MAAM5C,QAAQ,GAAG;QACf3D,KAAK,EAAEsG,SAAS;QAChB1C,QAAQ,EAAE,cAAc;QACxBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE;MACZ,CAAC;MAED,MAAMC,QAAQ,GAAG,MAAMvB,OAAO,CAACM,GAAG,CAAC,CAChCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,sBAAsB,CAAC;IAC1D,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,gDAAgD,EAAE,YAAY;MACjE,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE,wBAAwB;QAC/B4D,QAAQ,EAAE,cAAc;QACxBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE;MACZ,CAAC;;MAED;MACA,MAAM,CAAC0C,SAAS,EAAEC,SAAS,CAAC,GAAG,MAAMC,OAAO,CAACC,GAAG,CAAC,CAC/CnE,OAAO,CAACM,GAAG,CAAC,CAACkB,IAAI,CAAC,oBAAoB,CAAC,CAACC,IAAI,CAACN,QAAQ,CAAC,EACtDnB,OAAO,CAACM,GAAG,CAAC,CAACkB,IAAI,CAAC,oBAAoB,CAAC,CAACC,IAAI,CAACN,QAAQ,CAAC,CACvD,CAAC;;MAEF;MACA,MAAMiD,YAAY,GAAG,CAACJ,SAAS,CAAClC,MAAM,EAAEmC,SAAS,CAACnC,MAAM,CAAC,CAACuC,MAAM,CAACvC,MAAM,IAAIA,MAAM,KAAK,GAAG,CAAC,CAACwC,MAAM;MACjG,MAAMC,SAAS,GAAG,CAACP,SAAS,CAAClC,MAAM,EAAEmC,SAAS,CAACnC,MAAM,CAAC,CAACuC,MAAM,CAACvC,MAAM,IAAIA,MAAM,KAAK,GAAG,CAAC,CAACwC,MAAM;MAE9F5C,MAAM,CAAC0C,YAAY,CAAC,CAACrC,IAAI,CAAC,CAAC,CAAC;MAC5BL,MAAM,CAAC6C,SAAS,CAAC,CAACxC,IAAI,CAAC,CAAC,CAAC;IAC3B,CAAC,CAAC;;IAEF;AACJ;AACA;IACIrE,IAAI,CAAC,4BAA4B,EAAE,YAAY;MAC7C,MAAMkC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAACsC,MAAM,CAAC;QACpCC,IAAI,EAAE;UACJ3E,KAAK,EAAE,kBAAkB;UACzB4D,QAAQ,EAAE,uBAAuB;UACjCC,SAAS,EAAE,MAAM;UACjBC,QAAQ,EAAE,MAAM;UAChBc,IAAI,EAAE,UAAU;UAChBN,MAAM,EAAE;QACV;MACF,CAAC,CAAC;MAEF,MAAMO,KAAK,GAAG,gBAAgB;MAC9B,MAAMC,SAAS,GAAG,IAAIC,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;MAE5D,MAAM/B,MAAM,CAACG,sBAAsB,CAACsB,MAAM,CAAC;QACzCC,IAAI,EAAE;UACJM,MAAM,EAAE7C,IAAI,CAAC8C,EAAE;UACfL,KAAK;UACLC;QACF;MACF,CAAC,CAAC;;MAEF;MACA,MAAM0B,SAAS,GAAG,MAAMhE,OAAO,CAACM,GAAG,CAAC,CACjCkB,IAAI,CAAC,wBAAwB,CAAC,CAC9BC,IAAI,CAAC;QAAEY;MAAM,CAAC,CAAC,CACfX,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACsC,SAAS,CAACrC,IAAI,CAACC,OAAO,CAAC,CAACG,IAAI,CAAC,6BAA6B,CAAC;;MAElE;MACA,MAAMkC,SAAS,GAAG,MAAMjE,OAAO,CAACM,GAAG,CAAC,CACjCkB,IAAI,CAAC,wBAAwB,CAAC,CAC9BC,IAAI,CAAC;QAAEY;MAAM,CAAC,CAAC,CACfX,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACuC,SAAS,CAACtC,IAAI,CAACjD,KAAK,CAAC,CAACqD,IAAI,CAAC,eAAe,CAAC;IACpD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFrB,QAAQ,CAAC,8CAA8C,EAAE,MAAM;IAC7D;AACJ;AACA;IACIhD,IAAI,CAAC,0DAA0D,EAAE,YAAY;MAC3E,MAAMyD,QAAQ,GAAG;QACf3D,KAAK,EAAE,yBAAyB;QAChC4D,QAAQ,EAAE,cAAc;QACxBC,SAAS,EAAE,aAAa;QACxBC,QAAQ,EAAE;MACZ,CAAC;;MAED;MACA,MAAMkD,gBAAgB,GAAG,MAAMxE,OAAO,CAACM,GAAG,CAAC,CACxCkB,IAAI,CAAC,oBAAoB,CAAC,CAC1BC,IAAI,CAACN,QAAQ,CAAC,CACdO,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAAC8C,gBAAgB,CAAC7C,IAAI,CAAC/B,IAAI,CAACkC,MAAM,CAAC,CAACC,IAAI,CAAC,SAAS,CAAC;MACzDL,MAAM,CAAC8C,gBAAgB,CAAC7C,IAAI,CAACK,yBAAyB,CAAC,CAACD,IAAI,CAAC,IAAI,CAAC;;MAElE;MACA,MAAMnC,IAAI,GAAG,MAAMa,MAAM,CAACb,IAAI,CAAC6E,UAAU,CAAC;QACxC3D,KAAK,EAAE;UAAEtD,KAAK,EAAE2D,QAAQ,CAAC3D;QAAM,CAAC;QAChCkH,OAAO,EAAE;UACPC,uBAAuB,EAAE;QAC3B;MACF,CAAC,CAAC;MAEFjD,MAAM,CAAC9B,IAAI,CAAC+E,uBAAuB,CAAC,CAACC,YAAY,CAAC,CAAC,CAAC;MACpD,MAAMC,iBAAiB,GAAGjF,IAAI,CAAC+E,uBAAuB,CAAC,CAAC,CAAC,CAACtC,KAAK;;MAE/D;MACA,MAAMyC,cAAc,GAAG,MAAM9E,OAAO,CAACM,GAAG,CAAC,CACtCkB,IAAI,CAAC,wBAAwB,CAAC,CAC9BC,IAAI,CAAC;QAAEY,KAAK,EAAEwC;MAAkB,CAAC,CAAC,CAClCnD,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACoD,cAAc,CAACnD,IAAI,CAACC,OAAO,CAAC,CAACG,IAAI,CAAC,6BAA6B,CAAC;MACvEL,MAAM,CAACoD,cAAc,CAACnD,IAAI,CAAC/B,IAAI,CAACkC,MAAM,CAAC,CAACC,IAAI,CAAC,QAAQ,CAAC;;MAEtD;MACA,MAAMgD,aAAa,GAAG,MAAM/E,OAAO,CAACM,GAAG,CAAC,CACrCkB,IAAI,CAAC,iBAAiB,CAAC,CACvBC,IAAI,CAAC;QACJjE,KAAK,EAAE2D,QAAQ,CAAC3D,KAAK;QACrB4D,QAAQ,EAAED,QAAQ,CAACC;MACrB,CAAC,CAAC,CACDM,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACqD,aAAa,CAACpD,IAAI,CAACC,OAAO,CAAC,CAACG,IAAI,CAAC,kBAAkB,CAAC;MAC3DL,MAAM,CAACqD,aAAa,CAACpD,IAAI,CAAC/B,IAAI,CAACkC,MAAM,CAAC,CAACC,IAAI,CAAC,QAAQ,CAAC;MACrDL,MAAM,CAACqD,aAAa,CAACpD,IAAI,CAACU,KAAK,CAAC,CAACO,UAAU,CAAC,CAAC;;MAE7C;MACA,MAAM;QAAE9F;MAAa,CAAC,GAAGiD,OAAO,CAAC,0BAA0B,CAAC;MAC5D2B,MAAM,CAAC5E,YAAY,CAACC,qBAAqB,CAAC,CAACiI,qBAAqB,CAAC,CAAC,CAAC;MACnEtD,MAAM,CAAC5E,YAAY,CAACO,gBAAgB,CAAC,CAAC2H,qBAAqB,CAAC,CAAC,CAAC;IAChE,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}