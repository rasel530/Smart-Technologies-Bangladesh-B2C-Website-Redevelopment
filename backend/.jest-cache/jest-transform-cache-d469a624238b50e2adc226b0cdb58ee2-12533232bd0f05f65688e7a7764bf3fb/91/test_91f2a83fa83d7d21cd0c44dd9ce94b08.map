{"version":3,"names":["inspect","require","http","STATUS_CODES","Server","deepStrictEqual","Request","http2","_","Test","constructor","app","method","path","optHttp2","toUpperCase","createServer","redirects","buffer","_asserts","url","serverAddress","addr","address","_server","listen","port","protocol","expect","a","b","c","push","wrapAssertFn","end","_assertStatus","bind","arguments","length","_assertBody","Array","isArray","every","val","_assertStatusArray","RegExp","_assertHeader","name","value","fn","server","err","res","localAssert","assert","_handle","close","closeError","code","resError","errorObj","sysErrors","ECONNREFUSED","ECONNRESET","EPIPE","ETIMEDOUT","Error","syscall","Object","getOwnPropertyNames","indexOf","i","_assertFunction","status","call","bearer","token","set","body","isRegexp","error","text","test","header","field","actual","toLowerCase","fieldExpected","toString","statusArray","includes","expectedList","join","e","assertFn","savedStack","stack","split","slice","badStack","replace","message","concat","msg","expected","showDiff","module","exports"],"sources":["test.js"],"sourcesContent":["'use strict';\n\n/**\n * Module dependencies.\n */\n\nconst { inspect } = require('util');\nconst http = require('http');\nconst { STATUS_CODES } = require('http');\nconst { Server } = require('tls');\nconst { deepStrictEqual } = require('assert');\nconst { Request } = require('superagent');\nlet http2;\ntry {\n  http2 = require('http2'); // eslint-disable-line global-require\n} catch (_) {\n  // eslint-disable-line no-empty\n}\n\n/** @typedef {import('superagent').Response} Response */\n\nclass Test extends Request {\n  /**\n   * Initialize a new `Test` with the given `app`,\n   * request `method` and `path`.\n   *\n   * @param {Server} app\n   * @param {String} method\n   * @param {String} path\n   * @api public\n   */\n  constructor (app, method, path, optHttp2) {\n    super(method.toUpperCase(), path);\n\n    if (typeof app === 'function') {\n      if (optHttp2) {\n        app = http2.createServer(app); // eslint-disable-line no-param-reassign\n      } else {\n        app = http.createServer(app); // eslint-disable-line no-param-reassign\n      }\n    }\n\n    this.redirects(0);\n    this.buffer();\n    this.app = app;\n    this._asserts = [];\n    this.url = typeof app === 'string'\n      ? app + path\n      : this.serverAddress(app, path);\n  }\n\n  /**\n   * Returns a URL, extracted from a server.\n   *\n   * @param {Server} app\n   * @param {String} path\n   * @returns {String} URL address\n   * @api private\n   */\n  serverAddress(app, path) {\n    const addr = app.address();\n\n    if (!addr) this._server = app.listen(0);\n    // } else {\n    //   this._server = app;\n    // }\n    const port = app.address().port;\n    const protocol = app instanceof Server ? 'https' : 'http';\n    return protocol + '://127.0.0.1:' + port + path;\n  }\n\n  /**\n   * Expectations:\n   *\n   *   .expect(200)\n   *   .expect(200, fn)\n   *   .expect(200, body)\n   *   .expect('Some body')\n   *   .expect('Some body', fn)\n   *   .expect(['json array body', { key: 'val' }])\n   *   .expect('Content-Type', 'application/json')\n   *   .expect('Content-Type', 'application/json', fn)\n   *   .expect(fn)\n   *   .expect([200, 404])\n   *\n   * @return {Test}\n   * @api public\n   */\n  expect(a, b, c) {\n    // callback\n    if (typeof a === 'function') {\n      this._asserts.push(wrapAssertFn(a));\n      return this;\n    }\n    if (typeof b === 'function') this.end(b);\n    if (typeof c === 'function') this.end(c);\n\n    // status\n    if (typeof a === 'number') {\n      this._asserts.push(wrapAssertFn(this._assertStatus.bind(this, a)));\n      // body\n      if (typeof b !== 'function' && arguments.length > 1) {\n        this._asserts.push(wrapAssertFn(this._assertBody.bind(this, b)));\n      }\n      return this;\n    }\n\n    // multiple statuses\n    if (Array.isArray(a) && a.length > 0 && a.every(val => typeof val === 'number')) {\n      this._asserts.push(wrapAssertFn(this._assertStatusArray.bind(this, a)));\n      return this;\n    }\n\n    // header field\n    if (typeof b === 'string' || typeof b === 'number' || b instanceof RegExp) {\n      this._asserts.push(wrapAssertFn(this._assertHeader.bind(this, { name: '' + a, value: b })));\n      return this;\n    }\n\n    // body\n    this._asserts.push(wrapAssertFn(this._assertBody.bind(this, a)));\n\n    return this;\n  }\n\n  /**\n   * Defer invoking superagent's `.end()` until\n   * the server is listening.\n   *\n   * @param {?Function} fn\n   * @api public\n   */\n  end(fn) {\n    const server = this._server;\n\n    super.end((err, res) => {\n      const localAssert = () => {\n        this.assert(err, res, fn);\n      };\n\n      if (server && server._handle) {\n        // Handle server closing with error handling for already closed servers\n        return server.close((closeError) => {\n          // Ignore ERR_SERVER_NOT_RUNNING errors as the server is already closed\n          if (closeError && closeError.code === 'ERR_SERVER_NOT_RUNNING') {\n            return localAssert();\n          }\n          // For other errors, pass them through\n          if (closeError) {\n            return localAssert();\n          }\n          localAssert();\n        });\n      }\n\n      localAssert();\n    });\n\n    return this;\n  }\n\n  /**\n   * Perform assertions and invoke `fn(err, res)`.\n   *\n   * @param {?Error} resError\n   * @param {Response} res\n   * @param {Function} fn\n   * @api private\n   */\n  assert(resError, res, fn) {\n    let errorObj;\n\n    // check for unexpected network errors or server not running/reachable errors\n    // when there is no response and superagent sends back a System Error\n    // do not check further for other asserts, if any, in such case\n    // https://nodejs.org/api/errors.html#errors_common_system_errors\n    const sysErrors = {\n      ECONNREFUSED: 'Connection refused',\n      ECONNRESET: 'Connection reset by peer',\n      EPIPE: 'Broken pipe',\n      ETIMEDOUT: 'Operation timed out'\n    };\n\n    if (!res && resError) {\n      if (resError instanceof Error && resError.syscall === 'connect'\n        && Object.getOwnPropertyNames(sysErrors).indexOf(resError.code) >= 0) {\n        errorObj = new Error(resError.code + ': ' + sysErrors[resError.code]);\n      } else {\n        errorObj = resError;\n      }\n    }\n\n    // asserts\n    for (let i = 0; i < this._asserts.length && !errorObj; i += 1) {\n      errorObj = this._assertFunction(this._asserts[i], res);\n    }\n\n    // set unexpected superagent error if no other error has occurred.\n    if (!errorObj && resError instanceof Error && (!res || resError.status !== res.status)) {\n      errorObj = resError;\n    }\n\n    if (fn) {\n      fn.call(this, errorObj || null, res);\n    }\n  }\n\n  /*\n    * Adds a set Authorization Bearer\n    *\n    * @param {Bearer} Bearer Token\n    * Shortcut for .set('Authorization', `Bearer ${token}`)\n    */\n\n  bearer(token) {\n    this.set('Authorization', `Bearer ${token}`);\n    return this;\n  }\n\n  /*\n    * Adds a set Authorization Bearer\n    *\n    * @param {Bearer} Bearer Token\n    * Shortcut for .set('Authorization', `Bearer ${token}`)\n    */\n\n  bearer(token) {\n    this.set('Authorization', `Bearer ${token}`);\n    return this;\n  }\n\n  /**\n   * Perform assertions on a response body and return an Error upon failure.\n   *\n   * @param {Mixed} body\n   * @param {Response} res\n   * @return {?Error}\n   * @api private\n   */// eslint-disable-next-line class-methods-use-this\n  _assertBody(body, res) {\n    const isRegexp = body instanceof RegExp;\n\n    // parsed\n    if (typeof body === 'object' && !isRegexp) {\n      try {\n        deepStrictEqual(body, res.body);\n      } catch (err) {\n        const a = inspect(body);\n        const b = inspect(res.body);\n        return error('expected ' + a + ' response body, got ' + b, body, res.body);\n      }\n    } else if (body !== res.text) {\n      // string\n      const a = inspect(body);\n      const b = inspect(res.text);\n\n      // regexp\n      if (isRegexp) {\n        if (!body.test(res.text)) {\n          return error('expected body ' + b + ' to match ' + body, body, res.body);\n        }\n      } else {\n        return error('expected ' + a + ' response body, got ' + b, body, res.body);\n      }\n    }\n  }\n\n  /**\n   * Perform assertions on a response header and return an Error upon failure.\n   *\n   * @param {Object} header\n   * @param {Response} res\n   * @return {?Error}\n   * @api private\n   */// eslint-disable-next-line class-methods-use-this\n  _assertHeader(header, res) {\n    const field = header.name;\n    const actual = res.header[field.toLowerCase()];\n    const fieldExpected = header.value;\n\n    if (typeof actual === 'undefined') return new Error('expected \"' + field + '\" header field');\n    // This check handles header values that may be a String or single element Array\n    if ((Array.isArray(actual) && actual.toString() === fieldExpected)\n      || fieldExpected === actual) {\n      return;\n    }\n    if (fieldExpected instanceof RegExp) {\n      if (!fieldExpected.test(actual)) {\n        return new Error('expected \"' + field + '\" matching '\n          + fieldExpected + ', got \"' + actual + '\"');\n      }\n    } else {\n      return new Error('expected \"' + field + '\" of \"' + fieldExpected + '\", got \"' + actual + '\"');\n    }\n  }\n\n  /**\n   * Perform assertions on the response status and return an Error upon failure.\n   *\n   * @param {Number} status\n   * @param {Response} res\n   * @return {?Error}\n   * @api private\n   */// eslint-disable-next-line class-methods-use-this\n  _assertStatus(status, res) {\n    if (res.status !== status) {\n      const a = STATUS_CODES[status];\n      const b = STATUS_CODES[res.status];\n      return new Error('expected ' + status + ' \"' + a + '\", got ' + res.status + ' \"' + b + '\"');\n    }\n  }\n\n  /**\n   * Perform assertions on the response status and return an Error upon failure.\n   *\n   * @param {Array<Number>} statusArray\n   * @param {Response} res\n   * @return {?Error}\n   * @api private\n   */// eslint-disable-next-line class-methods-use-this\n  _assertStatusArray(statusArray, res) {\n    if (!statusArray.includes(res.status)) {\n      const b = STATUS_CODES[res.status];\n      const expectedList = statusArray.join(', ');\n      return new Error(\n        'expected one of \"' + expectedList + '\", got ' + res.status + ' \"' + b + '\"'\n      );\n    }\n  }\n\n  /**\n   * Performs an assertion by calling a function and return an Error upon failure.\n   *\n   * @param {Function} fn\n   * @param {Response} res\n   * @return {?Error}\n   * @api private\n   */// eslint-disable-next-line class-methods-use-this\n  _assertFunction(fn, res) {\n    let err;\n    try {\n      err = fn(res);\n    } catch (e) {\n      err = e;\n    }\n    if (err instanceof Error) return err;\n  }\n}\n\n/**\n * Wraps an assert function into another.\n * The wrapper function edit the stack trace of any assertion error, prepending a more useful stack to it.\n *\n * @param {Function} assertFn\n * @returns {Function} wrapped assert function\n */\n\nfunction wrapAssertFn(assertFn) {\n  const savedStack = new Error().stack.split('\\n').slice(3);\n\n  return function(res) {\n    let badStack;\n    let err;\n    try {\n      err = assertFn(res);\n    } catch (e) {\n      err = e;\n    }\n    if (err instanceof Error && err.stack) {\n      badStack = err.stack.replace(err.message, '').split('\\n').slice(1);\n      err.stack = [err.toString()]\n        .concat(savedStack)\n        .concat('----')\n        .concat(badStack)\n        .join('\\n');\n    }\n    return err;\n  };\n}\n\n/**\n * Return an `Error` with `msg` and results properties.\n *\n * @param {String} msg\n * @param {Mixed} expected\n * @param {Mixed} actual\n * @return {Error}\n * @api private\n */\n\nfunction error(msg, expected, actual) {\n  const err = new Error(msg);\n  err.expected = expected;\n  err.actual = actual;\n  err.showDiff = true;\n  return err;\n}\n\n/**\n * Expose `Test`.\n */\n\nmodule.exports = Test;\n"],"mappings":"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","ignoreList":[]}