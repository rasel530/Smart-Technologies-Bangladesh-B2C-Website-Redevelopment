{"version":3,"names":["zxcvbn","require","bcrypt","PrismaClient","configService","prisma","PasswordService","constructor","securityConfig","getSecurityConfig","passwordPolicy","getPasswordPolicyConfig","validatePasswordStrength","password","userInfo","result","isValid","score","feedback","warnings","strength","meetsRequirements","length","minLength","push","maxLength","zxcvbnResult","firstName","lastName","email","phone","warning","suggestions","strengthLevels","validateCustomRules","checkMinimumRequirements","minStrengthScore","lowerPassword","toLowerCase","requireUppercase","test","requireLowercase","requireNumbers","requireSpecialChars","preventSequential","hasSequentialChars","preventRepeated","hasRepeatedChars","bangladeshPatterns","bangladeshiPatterns","pattern","includes","preventPersonalInfo","split","replace","slice","i","char1","charCodeAt","char2","char3","hasMinLength","hasMaxLength","hasUppercase","hasLowercase","hasNumbers","hasSpecialChars","noSequentialChars","noRepeatedChars","hashPassword","hash","bcryptRounds","verifyPassword","compare","savePasswordToHistory","userId","passwordHash","cleanupOldPasswordHistory","passwordHistory","create","data","error","console","Error","isPasswordReused","newPassword","findMany","where","orderBy","createdAt","take","historyEntry","isMatch","allHistory","toDelete","idsToDelete","map","entry","id","deleteMany","in","generateStrongPassword","uppercase","lowercase","numbers","specialChars","allChars","Math","floor","random","sort","join","getPasswordPolicy","preventCommonPatterns","historyLimit","getLocalizedFeedback","validationResult","bengaliStrength","very_weak","weak","fair","good","strong","bengaliFeedback","msg","english","bengali","Object","entries","passwordService","module","exports"],"sources":["passwordService.js"],"sourcesContent":["const zxcvbn = require('zxcvbn');\r\nconst bcrypt = require('bcryptjs');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst { configService } = require('./config');\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nclass PasswordService {\r\n  constructor() {\r\n    this.securityConfig = configService.getSecurityConfig();\r\n    this.passwordPolicy = configService.getPasswordPolicyConfig();\r\n  }\r\n\r\n  /**\r\n   * Validate password strength using zxcvbn and custom rules\r\n   * @param {string} password - The password to validate\r\n   * @param {Object} userInfo - User information for contextual validation\r\n   * @returns {Object} Validation result with score and feedback\r\n   */\r\n  validatePasswordStrength(password, userInfo = {}) {\r\n    const result = {\r\n      isValid: false,\r\n      score: 0,\r\n      feedback: [],\r\n      warnings: [],\r\n      strength: 'very_weak',\r\n      meetsRequirements: false\r\n    };\r\n\r\n    // Basic length validation\r\n    if (password.length < this.passwordPolicy.minLength) {\r\n      result.feedback.push(`Password must be at least ${this.passwordPolicy.minLength} characters long`);\r\n    }\r\n\r\n    if (password.length > this.passwordPolicy.maxLength) {\r\n      result.feedback.push(`Password must not exceed ${this.passwordPolicy.maxLength} characters`);\r\n    }\r\n\r\n    // Use zxcvbn for comprehensive analysis\r\n    const zxcvbnResult = zxcvbn(password, [\r\n      userInfo.firstName,\r\n      userInfo.lastName,\r\n      userInfo.email,\r\n      userInfo.phone\r\n    ]);\r\n\r\n    // Extract zxcvbn feedback\r\n    result.score = zxcvbnResult.score;\r\n    result.warnings = zxcvbnResult.feedback.warning ? [zxcvbnResult.feedback.warning] : [];\r\n    result.suggestions = zxcvbnResult.feedback.suggestions || [];\r\n\r\n    // Map score to strength levels\r\n    const strengthLevels = ['very_weak', 'weak', 'fair', 'good', 'strong'];\r\n    result.strength = strengthLevels[result.score] || 'very_weak';\r\n\r\n    // Custom validation rules for Bangladesh context\r\n    this.validateCustomRules(password, userInfo, result);\r\n\r\n    // Check if meets minimum requirements\r\n    result.meetsRequirements = this.checkMinimumRequirements(password, result);\r\n\r\n    // Overall validation\r\n    result.isValid = result.meetsRequirements && result.score >= this.passwordPolicy.minStrengthScore;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Validate custom password rules\r\n   * @param {string} password - The password to validate\r\n   * @param {Object} userInfo - User information\r\n   * @param {Object} result - Validation result object to update\r\n   */\r\n  validateCustomRules(password, userInfo, result) {\r\n    const lowerPassword = password.toLowerCase();\r\n    \r\n    // Check for uppercase letters if required\r\n    if (this.passwordPolicy.requireUppercase && !/[A-Z]/.test(password)) {\r\n      result.feedback.push('Password must contain at least one uppercase letter');\r\n    }\r\n\r\n    // Check for lowercase letters if required\r\n    if (this.passwordPolicy.requireLowercase && !/[a-z]/.test(password)) {\r\n      result.feedback.push('Password must contain at least one lowercase letter');\r\n    }\r\n\r\n    // Check for numbers if required\r\n    if (this.passwordPolicy.requireNumbers && !/\\d/.test(password)) {\r\n      result.feedback.push('Password must contain at least one number');\r\n    }\r\n\r\n    // Check for special characters if required\r\n    if (this.passwordPolicy.requireSpecialChars && !/[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/.test(password)) {\r\n      result.feedback.push('Password must contain at least one special character');\r\n    }\r\n\r\n    // Check for sequential characters if prevention is enabled\r\n    if (this.passwordPolicy.preventSequential && this.hasSequentialChars(password)) {\r\n      result.feedback.push('Password cannot contain sequential characters (e.g., \"123\", \"abc\")');\r\n    }\r\n\r\n    // Check for repeated characters if prevention is enabled\r\n    if (this.passwordPolicy.preventRepeated && this.hasRepeatedChars(password)) {\r\n      result.feedback.push('Password cannot contain repeated characters (e.g., \"aaa\", \"111\")');\r\n    }\r\n\r\n    // Check for common Bangladeshi patterns if enabled\r\n    if (this.passwordPolicy.bangladeshPatterns) {\r\n      const bangladeshiPatterns = ['bangladesh', 'dhaka', 'taka', 'bdt', 'bd'];\r\n      const lowerPassword = password.toLowerCase();\r\n      for (const pattern of bangladeshiPatterns) {\r\n        if (lowerPassword.includes(pattern)) {\r\n          result.feedback.push(`Password cannot contain common Bangladeshi terms like \"${pattern}\"`);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Check for personal information if prevention is enabled\r\n    if (this.passwordPolicy.preventPersonalInfo) {\r\n      if (userInfo.firstName && lowerPassword.includes(userInfo.firstName.toLowerCase())) {\r\n        result.feedback.push('Password cannot contain your first name');\r\n      }\r\n\r\n      if (userInfo.lastName && lowerPassword.includes(userInfo.lastName.toLowerCase())) {\r\n        result.feedback.push('Password cannot contain your last name');\r\n      }\r\n\r\n      if (userInfo.email && lowerPassword.includes(userInfo.email.split('@')[0].toLowerCase())) {\r\n        result.feedback.push('Password cannot contain your email username');\r\n      }\r\n\r\n      if (userInfo.phone && lowerPassword.includes(userInfo.phone.replace(/\\D/g, '').slice(-4))) {\r\n        result.feedback.push('Password cannot contain parts of your phone number');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if password has sequential characters\r\n   * @param {string} password - The password to check\r\n   * @returns {boolean} True if sequential characters found\r\n   */\r\n  hasSequentialChars(password) {\r\n    const lowerPassword = password.toLowerCase();\r\n    \r\n    // Check for sequential numbers (123, 234, etc.)\r\n    for (let i = 0; i < lowerPassword.length - 2; i++) {\r\n      const char1 = lowerPassword.charCodeAt(i);\r\n      const char2 = lowerPassword.charCodeAt(i + 1);\r\n      const char3 = lowerPassword.charCodeAt(i + 2);\r\n      \r\n      if (char2 === char1 + 1 && char3 === char2 + 1) {\r\n        return true;\r\n      }\r\n      if (char2 === char1 - 1 && char3 === char2 - 1) {\r\n        return true;\r\n      }\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Check if password has repeated characters\r\n   * @param {string} password - The password to check\r\n   * @returns {boolean} True if repeated characters found\r\n   */\r\n  hasRepeatedChars(password) {\r\n    for (let i = 0; i < password.length - 2; i++) {\r\n      if (password[i] === password[i + 1] && password[i] === password[i + 2]) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Check if password meets minimum requirements\r\n   * @param {string} password - The password to check\r\n   * @param {Object} result - Validation result object\r\n   * @returns {boolean} True if meets requirements\r\n   */\r\n  checkMinimumRequirements(password, result) {\r\n    const hasMinLength = password.length >= this.passwordPolicy.minLength;\r\n    const hasMaxLength = password.length <= this.passwordPolicy.maxLength;\r\n    const hasUppercase = /[A-Z]/.test(password);\r\n    const hasLowercase = /[a-z]/.test(password);\r\n    const hasNumbers = /\\d/.test(password);\r\n    const hasSpecialChars = /[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/.test(password);\r\n    const noSequentialChars = !this.hasSequentialChars(password);\r\n    const noRepeatedChars = !this.hasRepeatedChars(password);\r\n\r\n    return hasMinLength && hasMaxLength && hasUppercase && hasLowercase && \r\n           hasNumbers && hasSpecialChars && noSequentialChars && noRepeatedChars;\r\n  }\r\n\r\n  /**\r\n   * Hash password using bcrypt\r\n   * @param {string} password - The password to hash\r\n   * @returns {Promise<string>} Hashed password\r\n   */\r\n  async hashPassword(password) {\r\n    return await bcrypt.hash(password, this.passwordPolicy.bcryptRounds);\r\n  }\r\n\r\n  /**\r\n   * Verify password against hash\r\n   * @param {string} password - The password to verify\r\n   * @param {string} hash - The hash to verify against\r\n   * @returns {Promise<boolean>} True if password matches\r\n   */\r\n  async verifyPassword(password, hash) {\r\n    return await bcrypt.compare(password, hash);\r\n  }\r\n\r\n  /**\r\n   * Save password to history\r\n   * @param {string} userId - User ID\r\n   * @param {string} passwordHash - Hashed password\r\n   * @returns {Promise<Object>} Created password history record\r\n   */\r\n  async savePasswordToHistory(userId, passwordHash) {\r\n    try {\r\n      // Clean up old password history (keep only last 5)\r\n      await this.cleanupOldPasswordHistory(userId);\r\n\r\n      const passwordHistory = await prisma.passwordHistory.create({\r\n        data: {\r\n          userId,\r\n          passwordHash\r\n        }\r\n      });\r\n\r\n      return passwordHistory;\r\n    } catch (error) {\r\n      console.error('Error saving password to history:', error);\r\n      throw new Error('Failed to save password to history');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if password has been used before\r\n   * @param {string} userId - User ID\r\n   * @param {string} newPassword - New password to check\r\n   * @returns {Promise<boolean>} True if password has been used before\r\n   */\r\n  async isPasswordReused(userId, newPassword) {\r\n    try {\r\n      const passwordHistory = await prisma.passwordHistory.findMany({\r\n        where: { userId },\r\n        orderBy: { createdAt: 'desc' },\r\n        take: 5 // Check last 5 passwords\r\n      });\r\n\r\n      for (const historyEntry of passwordHistory) {\r\n        const isMatch = await this.verifyPassword(newPassword, historyEntry.passwordHash);\r\n        if (isMatch) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    } catch (error) {\r\n      console.error('Error checking password reuse:', error);\r\n      throw new Error('Failed to check password reuse');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up old password history\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<void>}\r\n   */\r\n  async cleanupOldPasswordHistory(userId) {\r\n    try {\r\n      // Get all password history for user, ordered by creation date\r\n      const allHistory = await prisma.passwordHistory.findMany({\r\n        where: { userId },\r\n        orderBy: { createdAt: 'desc' }\r\n      });\r\n\r\n      // If more than 5, delete the oldest ones\r\n      if (allHistory.length > 5) {\r\n        const toDelete = allHistory.slice(5);\r\n        const idsToDelete = toDelete.map(entry => entry.id);\r\n\r\n        await prisma.passwordHistory.deleteMany({\r\n          where: {\r\n            id: { in: idsToDelete }\r\n          }\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error cleaning up password history:', error);\r\n      // Don't throw error here, as this is not critical\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate strong temporary password\r\n   * @param {number} length - Password length (default 12)\r\n   * @returns {string} Generated password\r\n   */\r\n  generateStrongPassword(length = 12) {\r\n    const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n    const lowercase = 'abcdefghijklmnopqrstuvwxyz';\r\n    const numbers = '0123456789';\r\n    const specialChars = '!@#$%^&*()_+-=[]{}|;:,.<>?';\r\n    \r\n    const allChars = uppercase + lowercase + numbers + specialChars;\r\n    let password = '';\r\n\r\n    // Ensure at least one of each type\r\n    password += uppercase[Math.floor(Math.random() * uppercase.length)];\r\n    password += lowercase[Math.floor(Math.random() * lowercase.length)];\r\n    password += numbers[Math.floor(Math.random() * numbers.length)];\r\n    password += specialChars[Math.floor(Math.random() * specialChars.length)];\r\n\r\n    // Fill the rest with random characters\r\n    for (let i = 4; i < length; i++) {\r\n      password += allChars[Math.floor(Math.random() * allChars.length)];\r\n    }\r\n\r\n    // Shuffle the password\r\n    return password.split('').sort(() => Math.random() - 0.5).join('');\r\n  }\r\n\r\n  /**\r\n   * Get password policy configuration\r\n   * @returns {Object} Password policy configuration\r\n   */\r\n  getPasswordPolicy() {\r\n    return {\r\n      minLength: this.passwordPolicy.minLength,\r\n      maxLength: this.passwordPolicy.maxLength,\r\n      requireUppercase: true,\r\n      requireLowercase: true,\r\n      requireNumbers: true,\r\n      requireSpecialChars: true,\r\n      preventSequential: true,\r\n      preventRepeated: true,\r\n      preventPersonalInfo: true,\r\n      preventCommonPatterns: true,\r\n      minStrengthScore: 2,\r\n      historyLimit: 5\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get password strength feedback in Bengali\r\n   * @param {Object} validationResult - Password validation result\r\n   * @returns {Object} Localized feedback\r\n   */\r\n  getLocalizedFeedback(validationResult) {\r\n    const bengaliStrength = {\r\n      very_weak: 'অত্যন্ত দুর্বল',\r\n      weak: 'দুর্বল',\r\n      fair: 'মোটামুটি',\r\n      good: 'ভালো',\r\n      strong: 'শক্তি'\r\n    };\r\n\r\n    const bengaliFeedback = {\r\n      'Password must be at least': 'পাসওয়ার্ড অবশ্যই',\r\n      'Password must not exceed': 'পাসওয়ার্ড',\r\n      'Password must contain at least one uppercase letter': 'পাসওয়ার্ডে অবশ্যই একটি বড় হাতের অক্ষর থাকতে হবে',\r\n      'Password must contain at least one lowercase letter': 'পাসওয়ার্ডে অবশ্যই একটি ছোট হাতের অক্ষর থাকতে হবে',\r\n      'Password must contain at least one number': 'পাসওয়ার্ডে অবশ্যই একটি সংখ্যা থাকতে হবে',\r\n      'Password must contain at least one special character': 'পাসওয়ার্ডে অবশ্যই একটি বিশেষ অক্ষর থাকতে হবে',\r\n      'Password cannot contain sequential characters': 'পাসওয়ার্ডে ক্রমিক অক্ষর থাকতে পারে না',\r\n      'Password cannot contain repeated characters': 'পাসওয়ার্ডে পুনরাবৃত্তি অক্ষর থাকতে পারে না',\r\n      'Password cannot contain your first name': 'পাসওয়ার্ডে আপনার প্রথম নাম থাকতে পারে না',\r\n      'Password cannot contain your last name': 'পাসওয়ার্ডে আপনার শেষ নাম থাকতে পারে না',\r\n      'Password cannot contain your email username': 'পাসওয়ার্ডে আপনার ইমেল ব্যবহারকারী নাম থাকতে পারে না',\r\n      'Password cannot contain parts of your phone number': 'পাসওয়ার্ডে আপনার ফোন নম্বরের অংশ থাকতে পারে না',\r\n      'Password cannot contain common Bangladeshi terms': 'পাসওয়ার্ডে সাধারণ বাংলাদেশী শব্দ থাকতে পারে না'\r\n    };\r\n\r\n    return {\r\n      ...validationResult,\r\n      strength: bengaliStrength[validationResult.strength] || validationResult.strength,\r\n      feedback: validationResult.feedback.map(msg => {\r\n        for (const [english, bengali] of Object.entries(bengaliFeedback)) {\r\n          if (msg.includes(english)) {\r\n            return msg.replace(english, bengali);\r\n          }\r\n        }\r\n        return msg;\r\n      })\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst passwordService = new PasswordService();\r\n\r\nmodule.exports = {\r\n  PasswordService,\r\n  passwordService\r\n};"],"mappings":"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","ignoreList":[]}