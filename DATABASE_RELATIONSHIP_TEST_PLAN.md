# Comprehensive Database Relationship Test Plan

## Test Plan Overview
This document provides a comprehensive and methodical test plan to rigorously validate the integrity and functionality of all entity relationships within the e-commerce database schema. The plan covers positive functional testing, negative constraint validation, referential action testing, and edge case handling.

## Test Plan Table

| Test Case ID | Entity Relationship Tested | Test Objective | Prerequisites | SQL Test Script for Setup and Execution | Expected Outcome | Verification Query |
|---|---|---|---|---|---|---|

## USER ENTITY RELATIONSHIPS (One-to-Many)

| TEST-U-001 | User → Addresses (One-to-Many) | Validate user can have multiple addresses with CASCADE delete | User record exists | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password, firstName, lastName) VALUES ('user-001', 'test@example.com', 'hashedpass', 'John', 'Doe');<br><br>-- Test: Create multiple addresses<br>BEGIN;<br>INSERT INTO addresses (id, userId, type, firstName, lastName, address, city, district, division) VALUES ('addr-001', 'user-001', 'SHIPPING', 'John', 'Doe', '123 Main St', 'Dhaka', 'Dhaka', 'DHAKA');<br>INSERT INTO addresses (id, userId, type, firstName, lastName, address, city, district, division) VALUES ('addr-002', 'user-001', 'BILLING', 'John', 'Doe', '456 Oak Ave', 'Dhaka', 'Dhaka', 'DHAKA');<br>COMMIT;<br><br>-- Test: CASCADE delete<br>BEGIN;<br>DELETE FROM users WHERE id = 'user-001';<br>COMMIT;``` | Addresses created successfully; User deletion cascades to delete all addresses | ```sql<br>-- Verify addresses created<br>SELECT COUNT(*) FROM addresses WHERE userId = 'user-001';<br>-- Verify CASCADE delete<br>SELECT COUNT(*) FROM addresses WHERE userId = 'user-001';``` |

| TEST-U-002 | User → UserSessions (One-to-Many) | Validate user sessions with CASCADE delete | User record exists | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-002', 'session@example.com', 'hashedpass');<br><br>-- Test: Create sessions<br>BEGIN;<br>INSERT INTO user_sessions (id, userId, token, expiresAt) VALUES ('sess-001', 'user-002', 'token1', NOW() + INTERVAL '1 day');<br>INSERT INTO user_sessions (id, userId, token, expiresAt) VALUES ('sess-002', 'user-002', 'token2', NOW() + INTERVAL '1 day');<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM users WHERE id = 'user-002';``` | Sessions created and deleted with user | ```sql<br>SELECT COUNT(*) FROM user_sessions WHERE userId = 'user-002';``` |

| TEST-U-003 | User → Orders (One-to-Many) | Validate user can have multiple orders with RESTRICT delete | User record exists | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-003', 'orders@example.com', 'hashedpass');<br><br>-- Test: Create orders<br>BEGIN;<br>INSERT INTO orders (id, orderNumber, userId, subtotal, totalAmount) VALUES ('order-001', 'ORD-001', 'user-003', 100.00, 110.00);<br>INSERT INTO orders (id, orderNumber, userId, subtotal, totalAmount) VALUES ('order-002', 'ORD-002', 'user-003', 200.00, 220.00);<br>COMMIT;<br><br>-- Test: RESTRICT delete (should fail)<br>BEGIN;<br>DELETE FROM users WHERE id = 'user-003';<br>ROLLBACK;``` | Orders created; User deletion should be restricted | ```sql<br>SELECT COUNT(*) FROM orders WHERE userId = 'user-003';``` |

| TEST-U-004 | User → Cart (One-to-One) | Validate user has unique cart with CASCADE delete | User record exists | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-004', 'cart@example.com', 'hashedpass');<br><br>-- Test: Create cart<br>INSERT INTO carts (id, userId) VALUES ('cart-001', 'user-004');<br><br>-- Test: CASCADE delete<br>DELETE FROM users WHERE id = 'user-004';``` | Cart created and deleted with user | ```sql<br>SELECT COUNT(*) FROM carts WHERE userId = 'user-004';``` |

| TEST-U-005 | User → Wishlist (One-to-Many) | Validate user can have multiple wishlists with CASCADE delete | User record exists | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-005', 'wishlist@example.com', 'hashedpass');<br><br>-- Test: Create wishlist<br>INSERT INTO wishlists (id, userId) VALUES ('wish-001', 'user-005');<br><br>-- Test: CASCADE delete<br>DELETE FROM users WHERE id = 'user-005';``` | Wishlist created and deleted with user | ```sql<br>SELECT COUNT(*) FROM wishlists WHERE userId = 'user-005';``` |

| TEST-U-006 | User → Reviews (One-to-Many) | Validate user can have multiple reviews with CASCADE delete | User and product records exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-006', 'review@example.com', 'hashedpass');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-001', 'Test Product', 'test-prod', 'SKU001', 100.00, 'cat-001');<br><br>-- Test: Create reviews<br>BEGIN;<br>INSERT INTO reviews (id, productId, userId, rating) VALUES ('rev-001', 'prod-001', 'user-006', 5);<br>INSERT INTO reviews (id, productId, userId, rating) VALUES ('rev-002', 'prod-001', 'user-006', 4);<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM users WHERE id = 'user-006';``` | Reviews created and deleted with user | ```sql<br>SELECT COUNT(*) FROM reviews WHERE userId = 'user-006';``` |

## CATEGORY HIERARCHY (Self-Referencing)

| TEST-C-001 | Category → Category (Self-Referencing) | Validate category hierarchy with SET NULL delete | Parent category exists | ```sql<br>-- Setup<br>INSERT INTO categories (id, name, slug) VALUES ('cat-parent', 'Parent Category', 'parent-cat');<br><br>-- Test: Create child categories<br>BEGIN;<br>INSERT INTO categories (id, name, slug, parentId) VALUES ('cat-child-1', 'Child 1', 'child-1', 'cat-parent');<br>INSERT INTO categories (id, name, slug, parentId) VALUES ('cat-child-2', 'Child 2', 'child-2', 'cat-parent');<br>COMMIT;<br><br>-- Test: Delete parent (should set children parentId to NULL)<br>UPDATE categories SET parentId = NULL WHERE id = 'cat-parent';<br>DELETE FROM categories WHERE id = 'cat-parent';``` | Child categories created; Parent deletion sets parentId to NULL | ```sql<br>SELECT COUNT(*) FROM categories WHERE parentId = 'cat-parent';<br>SELECT COUNT(*) FROM categories WHERE parentId IS NULL AND id IN ('cat-child-1', 'cat-child-2');``` |

## PRODUCT ENTITY RELATIONSHIPS (One-to-Many)

| TEST-P-001 | Product → ProductImages (One-to-Many) | Validate product images with CASCADE delete | Product record exists | ```sql<br>-- Setup<br>INSERT INTO categories (id, name, slug) VALUES ('cat-002', 'Test Cat', 'test-cat');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-002', 'Test Product', 'test-prod-2', 'SKU002', 150.00, 'cat-002');<br><br>-- Test: Create images<br>BEGIN;<br>INSERT INTO product_images (id, productId, url, sortOrder) VALUES ('img-001', 'prod-002', 'image1.jpg', 0);<br>INSERT INTO product_images (id, productId, url, sortOrder) VALUES ('img-002', 'prod-002', 'image2.jpg', 1);<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM products WHERE id = 'prod-002';``` | Images created and deleted with product | ```sql<br>SELECT COUNT(*) FROM product_images WHERE productId = 'prod-002';``` |

| TEST-P-002 | Product → ProductSpecifications (One-to-Many) | Validate product specifications with CASCADE delete | Product record exists | ```sql<br>-- Setup<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-003', 'Spec Product', 'spec-prod', 'SKU003', 200.00, 'cat-002');<br><br>-- Test: Create specifications<br>BEGIN;<br>INSERT INTO product_specifications (id, productId, name, value) VALUES ('spec-001', 'prod-003', 'Color', 'Red');<br>INSERT INTO product_specifications (id, productId, name, value) VALUES ('spec-002', 'prod-003', 'Size', 'Large');<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM products WHERE id = 'prod-003';``` | Specifications created and deleted with product | ```sql<br>SELECT COUNT(*) FROM product_specifications WHERE productId = 'prod-003';``` |

| TEST-P-003 | Product → ProductVariants (One-to-Many) | Validate product variants with CASCADE delete | Product record exists | ```sql<br>-- Setup<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-004', 'Variant Product', 'variant-prod', 'SKU004', 250.00, 'cat-002');<br><br>-- Test: Create variants<br>BEGIN;<br>INSERT INTO product_variants (id, productId, name, sku, price) VALUES ('var-001', 'prod-004', 'Small', 'SKU004-S', 230.00);<br>INSERT INTO product_variants (id, productId, name, sku, price) VALUES ('var-002', 'prod-004', 'Large', 'SKU004-L', 270.00);<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM products WHERE id = 'prod-004';``` | Variants created and deleted with product | ```sql<br>SELECT COUNT(*) FROM product_variants WHERE productId = 'prod-004';``` |

| TEST-P-004 | Product → CartItems (One-to-Many) | Validate product in cart items with CASCADE delete | Product and cart exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-007', 'cartitem@example.com', 'hashedpass');<br>INSERT INTO carts (id, userId) VALUES ('cart-002', 'user-007');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-005', 'Cart Product', 'cart-prod', 'SKU005', 300.00, 'cat-002');<br><br>-- Test: Create cart items<br>BEGIN;<br>INSERT INTO cart_items (id, cartId, productId, quantity) VALUES ('ci-001', 'cart-002', 'prod-005', 2);<br>INSERT INTO cart_items (id, cartId, productId, quantity) VALUES ('ci-002', 'cart-002', 'prod-005', 1);<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM products WHERE id = 'prod-005';``` | Cart items created and deleted with product | ```sql<br>SELECT COUNT(*) FROM cart_items WHERE productId = 'prod-005';``` |

| TEST-P-005 | Product → OrderItems (One-to-Many) | Validate product in order items with RESTRICT delete | Product and order exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-008', 'orderitem@example.com', 'hashedpass');<br>INSERT INTO orders (id, orderNumber, userId, subtotal, totalAmount) VALUES ('order-003', 'ORD-003', 'user-008', 600.00, 660.00);<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-006', 'Order Product', 'order-prod', 'SKU006', 400.00, 'cat-002');<br><br>-- Test: Create order items<br>BEGIN;<br>INSERT INTO order_items (id, orderId, productId, quantity, unitPrice, totalPrice) VALUES ('oi-001', 'order-003', 'prod-006', 1, 400.00, 400.00);<br>INSERT INTO order_items (id, orderId, productId, quantity, unitPrice, totalPrice) VALUES ('oi-002', 'order-003', 'prod-006', 1, 400.00, 400.00);<br>COMMIT;<br><br>-- Test: RESTRICT delete (should fail)<br>BEGIN;<br>DELETE FROM products WHERE id = 'prod-006';<br>ROLLBACK;``` | Order items created; Product deletion should be restricted | ```sql<br>SELECT COUNT(*) FROM order_items WHERE productId = 'prod-006';``` |

| TEST-P-006 | Product → Reviews (One-to-Many) | Validate product reviews with CASCADE delete | Product and user exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-009', 'prodreview@example.com', 'hashedpass');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-007', 'Review Product', 'review-prod', 'SKU007', 500.00, 'cat-002');<br><br>-- Test: Create reviews<br>BEGIN;<br>INSERT INTO reviews (id, productId, userId, rating) VALUES ('rev-003', 'prod-007', 'user-009', 5);<br>INSERT INTO reviews (id, productId, userId, rating) VALUES ('rev-004', 'prod-007', 'user-009', 4);<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM products WHERE id = 'prod-007';``` | Reviews created and deleted with product | ```sql<br>SELECT COUNT(*) FROM reviews WHERE productId = 'prod-007';``` |

| TEST-P-007 | Product → WishlistItems (One-to-Many) | Validate product in wishlist items with CASCADE delete | Product and wishlist exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-010', 'wishitem@example.com', 'hashedpass');<br>INSERT INTO wishlists (id, userId) VALUES ('wish-002', 'user-010');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-008', 'Wish Product', 'wish-prod', 'SKU008', 600.00, 'cat-002');<br><br>-- Test: Create wishlist items<br>BEGIN;<br>INSERT INTO wishlist_items (id, wishlistId, productId) VALUES ('wi-001', 'wish-002', 'prod-008');<br>INSERT INTO wishlist_items (id, wishlistId, productId) VALUES ('wi-002', 'wish-002', 'prod-008');<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM products WHERE id = 'prod-008';``` | Wishlist items created and deleted with product | ```sql<br>SELECT COUNT(*) FROM wishlist_items WHERE productId = 'prod-008';``` |

## CART AND WISHLIST RELATIONSHIPS

| TEST-CW-001 | Cart → CartItems (One-to-Many) | Validate cart items with CASCADE delete | Cart and product exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-011', 'carttest@example.com', 'hashedpass');<br>INSERT INTO carts (id, userId) VALUES ('cart-003', 'user-011');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-009', 'Cart Test Product', 'cart-test-prod', 'SKU009', 700.00, 'cat-002');<br><br>-- Test: Create cart items<br>BEGIN;<br>INSERT INTO cart_items (id, cartId, productId, quantity) VALUES ('ci-003', 'cart-003', 'prod-009', 3);<br>INSERT INTO cart_items (id, cartId, productId, quantity) VALUES ('ci-004', 'cart-003', 'prod-009', 2);<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM carts WHERE id = 'cart-003';``` | Cart items created and deleted with cart | ```sql<br>SELECT COUNT(*) FROM cart_items WHERE cartId = 'cart-003';``` |

| TEST-CW-002 | CartItem → ProductVariant (Many-to-One) | Validate cart item with variant CASCADE delete | Cart, product, and variant exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-012', 'variant@example.com', 'hashedpass');<br>INSERT INTO carts (id, userId) VALUES ('cart-004', 'user-012');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-010', 'Variant Test Product', 'variant-test-prod', 'SKU010', 800.00, 'cat-002');<br>INSERT INTO product_variants (id, productId, name, sku, price) VALUES ('var-003', 'prod-010', 'Medium', 'SKU010-M', 750.00);<br><br>-- Test: Create cart item with variant<br>INSERT INTO cart_items (id, cartId, productId, variantId, quantity) VALUES ('ci-005', 'cart-004', 'prod-010', 'var-003', 1);<br><br>-- Test: CASCADE delete variant<br>DELETE FROM product_variants WHERE id = 'var-003';``` | Cart item created; Variant deletion should cascade | ```sql<br>SELECT COUNT(*) FROM cart_items WHERE variantId = 'var-003';``` |

| TEST-CW-003 | Wishlist → WishlistItems (One-to-Many) | Validate wishlist items with CASCADE delete | Wishlist and product exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-013', 'wishlist@example.com', 'hashedpass');<br>INSERT INTO wishlists (id, userId) VALUES ('wish-003', 'user-013');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-011', 'Wishlist Test Product', 'wishlist-test-prod', 'SKU011', 900.00, 'cat-002');<br><br>-- Test: Create wishlist items<br>BEGIN;<br>INSERT INTO wishlist_items (id, wishlistId, productId) VALUES ('wi-003', 'wish-003', 'prod-011');<br>INSERT INTO wishlist_items (id, wishlistId, productId) VALUES ('wi-004', 'wish-003', 'prod-011');<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM wishlists WHERE id = 'wish-003';``` | Wishlist items created and deleted with wishlist | ```sql<br>SELECT COUNT(*) FROM wishlist_items WHERE wishlistId = 'wish-003';``` |

## ORDER ENTITY RELATIONSHIPS (One-to-Many)

| TEST-O-001 | Order → OrderItems (One-to-Many) | Validate order items with CASCADE delete | Order and product exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-014', 'order@example.com', 'hashedpass');<br>INSERT INTO orders (id, orderNumber, userId, subtotal, totalAmount) VALUES ('order-004', 'ORD-004', 'user-014', 1800.00, 1980.00);<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-012', 'Order Test Product', 'order-test-prod', 'SKU012', 900.00, 'cat-002');<br><br>-- Test: Create order items<br>BEGIN;<br>INSERT INTO order_items (id, orderId, productId, quantity, unitPrice, totalPrice) VALUES ('oi-003', 'order-004', 'prod-012', 1, 900.00, 900.00);<br>INSERT INTO order_items (id, orderId, productId, quantity, unitPrice, totalPrice) VALUES ('oi-004', 'order-004', 'prod-012', 1, 900.00, 900.00);<br>COMMIT;<br><br>-- Test: CASCADE delete<br>DELETE FROM orders WHERE id = 'order-004';``` | Order items created and deleted with order | ```sql<br>SELECT COUNT(*) FROM order_items WHERE orderId = 'order-004';``` |

| TEST-O-002 | OrderItem → ProductVariant (Many-to-One) | Validate order item with variant CASCADE delete | Order, product, and variant exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-015', 'ordervariant@example.com', 'hashedpass');<br>INSERT INTO orders (id, orderNumber, userId, subtotal, totalAmount) VALUES ('order-005', 'ORD-005', 'user-015', 1500.00, 1650.00);<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-013', 'Order Variant Product', 'order-variant-prod', 'SKU013', 750.00, 'cat-002');<br>INSERT INTO product_variants (id, productId, name, sku, price) VALUES ('var-004', 'prod-013', 'Small', 'SKU013-S', 700.00);<br><br>-- Test: Create order item with variant<br>INSERT INTO order_items (id, orderId, productId, variantId, quantity, unitPrice, totalPrice) VALUES ('oi-005', 'order-005', 'prod-013', 'var-004', 1, 700.00, 700.00);<br><br>-- Test: CASCADE delete variant<br>DELETE FROM product_variants WHERE id = 'var-004';``` | Order item created; Variant deletion should cascade | ```sql<br>SELECT COUNT(*) FROM order_items WHERE variantId = 'var-004';``` |

## TRANSACTION RELATIONSHIPS (One-to-One)

| TEST-T-001 | Transaction → Order (One-to-One) | Validate transaction with unique order reference | Order exists | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-016', 'transaction@example.com', 'hashedpass');<br>INSERT INTO orders (id, orderNumber, userId, subtotal, totalAmount) VALUES ('order-006', 'ORD-006', 'user-016', 1000.00, 1100.00);<br><br>-- Test: Create transaction<br>INSERT INTO transactions (id, orderId, paymentMethod, amount, status) VALUES ('trans-001', 'order-006', 'CREDIT_CARD', 1100.00, 'COMPLETED');<br><br>-- Test: Unique constraint violation (should fail)<br>BEGIN;<br>INSERT INTO transactions (id, orderId, paymentMethod, amount, status) VALUES ('trans-002', 'order-006', 'BANK_TRANSFER', 1100.00, 'PENDING');<br>ROLLBACK;``` | Transaction created; Duplicate order reference should fail | ```sql<br>SELECT COUNT(*) FROM transactions WHERE orderId = 'order-006';``` |

## REVIEW RELATIONSHIPS (Many-to-Many)

| TEST-R-001 | Review → Product/User (Many-to-Many) | Validate review relationships with CASCADE delete | Product and user exist | ```sql<br>-- Setup<br>INSERT INTO users (id, email, password) VALUES ('user-017', 'reviewmtm@example.com', 'hashedpass');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-014', 'Review MTM Product', 'review-mtm-prod', 'SKU014', 1100.00, 'cat-002');<br><br>-- Test: Create reviews<br>BEGIN;<br>INSERT INTO reviews (id, productId, userId, rating, title, comment) VALUES ('rev-005', 'prod-014', 'user-017', 5, 'Excellent', 'Great product!');<br>INSERT INTO reviews (id, productId, userId, rating, title, comment) VALUES ('rev-006', 'prod-014', 'user-017', 4, 'Good', 'Nice product');<br>COMMIT;<br><br>-- Test: CASCADE delete from product<br>DELETE FROM products WHERE id = 'prod-014';<br><br>-- Test: CASCADE delete from user<br>DELETE FROM users WHERE id = 'user-017';``` | Reviews created and deleted with both product and user | ```sql<br>SELECT COUNT(*) FROM reviews WHERE productId = 'prod-014' OR userId = 'user-017';``` |

## NEGATIVE TESTING SCENARIOS

| TEST-N-001 | NOT NULL Constraint Violation | Test NOT NULL constraints on required fields | None | ```sql<br>-- Test: Insert user with NULL required fields<br>BEGIN;<br>INSERT INTO users (id, email, password) VALUES ('user-null-1', NULL, 'hashedpass');<br>ROLLBACK;<br><br>-- Test: Insert product with NULL required fields<br>BEGIN;<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-null-1', NULL, 'slug', 'SKU', 100.00, 'cat-id');<br>ROLLBACK;``` | All NOT NULL constraint violations should fail | ```sql<br>SELECT COUNT(*) FROM users WHERE id = 'user-null-1';<br>SELECT COUNT(*) FROM products WHERE id = 'prod-null-1';``` |

| TEST-N-002 | UNIQUE Constraint Violation | Test UNIQUE constraints on unique fields | None | ```sql<br>-- Test: Duplicate email<br>BEGIN;<br>INSERT INTO users (id, email, password) VALUES ('user-unique-1', 'duplicate@example.com', 'hashedpass');<br>INSERT INTO users (id, email, password) VALUES ('user-unique-2', 'duplicate@example.com', 'hashedpass2');<br>ROLLBACK;<br><br>-- Test: Duplicate SKU<br>BEGIN;<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-unique-1', 'Product 1', 'prod-1', 'DUPLICATE-SKU', 100.00, 'cat-001');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-unique-2', 'Product 2', 'prod-2', 'DUPLICATE-SKU', 200.00, 'cat-001');<br>ROLLBACK;``` | All UNIQUE constraint violations should fail | ```sql<br>SELECT COUNT(*) FROM users WHERE email = 'duplicate@example.com';<br>SELECT COUNT(*) FROM products WHERE sku = 'DUPLICATE-SKU';``` |

| TEST-N-003 | FOREIGN KEY Constraint Violation | Test FOREIGN KEY constraints with invalid references | None | ```sql<br>-- Test: Invalid user reference<br>BEGIN;<br>INSERT INTO addresses (id, userId, type, firstName, lastName, address, city, district, division) VALUES ('addr-invalid', 'invalid-user-id', 'SHIPPING', 'Test', 'User', '123 St', 'City', 'District', 'DHAKA');<br>ROLLBACK;<br><br>-- Test: Invalid product reference<br>BEGIN;<br>INSERT INTO cart_items (id, cartId, productId, quantity) VALUES ('ci-invalid', 'cart-id', 'invalid-product-id', 1);<br>ROLLBACK;``` | All FOREIGN KEY constraint violations should fail | ```sql<br>SELECT COUNT(*) FROM addresses WHERE userId = 'invalid-user-id';<br>SELECT COUNT(*) FROM cart_items WHERE productId = 'invalid-product-id';``` |

| TEST-N-004 | CHECK Constraint Violation | Test CHECK constraints on enum fields | None | ```sql<br>-- Test: Invalid user role<br>BEGIN;<br>INSERT INTO users (id, email, password, role) VALUES ('user-check-1', 'check@example.com', 'hashedpass', 'INVALID_ROLE');<br>ROLLBACK;<br><br>-- Test: Invalid division<br>BEGIN;<br>INSERT INTO addresses (id, userId, type, firstName, lastName, address, city, district, division) VALUES ('addr-check-1', 'user-id', 'SHIPPING', 'Test', 'User', '123 St', 'City', 'District', 'INVALID_DIVISION');<br>ROLLBACK;``` | All CHECK constraint violations should fail | ```sql<br>SELECT COUNT(*) FROM users WHERE role = 'INVALID_ROLE';<br>SELECT COUNT(*) FROM addresses WHERE division = 'INVALID_DIVISION';``` |

## EDGE CASE TESTING

| TEST-E-001 | NULL Values in Optional Fields | Test NULL handling in optional fields | Base records exist | ```sql<br>-- Test: NULL values in optional fields<br>INSERT INTO users (id, email, password, firstName, lastName, phone, avatar) VALUES ('user-edge-1', 'edge@example.com', 'hashedpass', NULL, NULL, NULL, NULL);<br><br>INSERT INTO products (id, name, slug, sku, price, categoryId, comparePrice, costPrice, weight, dimensions) VALUES ('prod-edge-1', 'Edge Product', 'edge-prod', 'SKU-EDGE', 100.00, 'cat-001', NULL, NULL, NULL, NULL);``` | NULL values should be accepted in optional fields | ```sql<br>SELECT * FROM users WHERE id = 'user-edge-1';<br>SELECT * FROM products WHERE id = 'prod-edge-1';``` |

| TEST-E-002 | Empty Strings | Test empty string handling | Base records exist | ```sql<br>-- Test: Empty strings in text fields<br>INSERT INTO users (id, email, password, firstName, lastName) VALUES ('user-empty-1', 'empty@example.com', 'hashedpass', '', '');<br><br>INSERT INTO products (id, name, slug, sku, price, categoryId, description, shortDesc) VALUES ('prod-empty-1', '', 'empty-prod', 'SKU-EMPTY', 100.00, 'cat-001', '', '');``` | Empty strings should be handled appropriately | ```sql<br>SELECT * FROM users WHERE id = 'user-empty-1';<br>SELECT * FROM products WHERE id = 'prod-empty-1';``` |

| TEST-E-003 | Transaction Rollback | Test transaction rollback scenarios | Base records exist | ```sql<br>-- Test: Transaction rollback<br>BEGIN;<br>INSERT INTO users (id, email, password) VALUES ('user-trans-1', 'trans@example.com', 'hashedpass');<br>INSERT INTO addresses (id, userId, type, firstName, lastName, address, city, district, division) VALUES ('addr-trans-1', 'user-trans-1', 'SHIPPING', 'Test', 'User', '123 St', 'City', 'District', 'DHAKA');<br>-- Intentional error to trigger rollback<br>INSERT INTO addresses (id, userId, type, firstName, lastName, address, city, district, division) VALUES ('addr-trans-2', 'invalid-user', 'SHIPPING', 'Test', 'User', '456 St', 'City', 'District', 'DHAKA');<br>ROLLBACK;``` | Transaction should rollback completely, no orphaned data | ```sql<br>SELECT COUNT(*) FROM users WHERE id = 'user-trans-1';<br>SELECT COUNT(*) FROM addresses WHERE userId = 'user-trans-1';``` |

| TEST-E-004 | Cascade Delete with Deep Hierarchy | Test cascade delete through multiple levels | Complete hierarchy exists | ```sql<br>-- Setup: Create complete hierarchy<br>INSERT INTO users (id, email, password) VALUES ('user-deep-1', 'deep@example.com', 'hashedpass');<br>INSERT INTO carts (id, userId) VALUES ('cart-deep-1', 'user-deep-1');<br>INSERT INTO products (id, name, slug, sku, price, categoryId) VALUES ('prod-deep-1', 'Deep Product', 'deep-prod', 'SKU-DEEP', 100.00, 'cat-001');<br>INSERT INTO product_variants (id, productId, name, sku, price) VALUES ('var-deep-1', 'prod-deep-1', 'Variant', 'SKU-DEEP-V', 90.00);<br>INSERT INTO cart_items (id, cartId, productId, variantId, quantity) VALUES ('ci-deep-1', 'cart-deep-1', 'prod-deep-1', 'var-deep-1', 1);<br><br>-- Test: Delete user (should cascade through all levels)<br>DELETE FROM users WHERE id = 'user-deep-1';``` | All related records should be deleted through cascade | ```sql<br>SELECT COUNT(*) FROM users WHERE id = 'user-deep-1';<br>SELECT COUNT(*) FROM carts WHERE userId = 'user-deep-1';<br>SELECT COUNT(*) FROM cart_items WHERE cartId = 'cart-deep-1';``` |

| TEST-E-005 | Concurrent Operations | Test concurrent access scenarios | Base records exist | ```sql<br>-- Test: Simulate concurrent operations (conceptual)<br>-- Session 1:<br>BEGIN;<br>INSERT INTO cart_items (id, cartId, productId, quantity) VALUES ('ci-concurrent-1', 'cart-id', 'prod-id', 1);<br>-- Session 2 (simulated):<br>BEGIN;<br>UPDATE cart_items SET quantity = quantity + 1 WHERE id = 'ci-concurrent-1';<br>-- Session 1:<br>COMMIT;<br>-- Session 2:<br>COMMIT;``` | Concurrent operations should handle correctly | ```sql<br>SELECT quantity FROM cart_items WHERE id = 'ci-concurrent-1';``` |

## PERFORMANCE TESTING

| TEST-PF-001 | Large Dataset Operations | Test performance with large datasets | Large dataset prepared | ```sql<br>-- Test: Bulk insert operations<br>BEGIN;<br>INSERT INTO users (id, email, password) SELECT 'user-bulk-' || generate_series, 'user' || generate_series || '@example.com', 'hashedpass' FROM generate_series(1, 1000);<br>INSERT INTO products (id, name, slug, sku, price, categoryId) SELECT 'prod-bulk-' || generate_series, 'Product ' || generate_series, 'prod-' || generate_series, 'SKU-BULK-' || generate_series, 100.00 + generate_series, 'cat-001' FROM generate_series(1, 1000);<br>COMMIT;<br><br>-- Test: Bulk delete with cascade<br>DELETE FROM users WHERE email LIKE 'user-bulk-%';<br>DELETE FROM products WHERE slug LIKE 'prod-bulk-%';``` | Operations should complete within acceptable time limits | ```sql<br>SELECT COUNT(*) FROM users WHERE email LIKE 'user-bulk-%';<br>SELECT COUNT(*) FROM products WHERE slug LIKE 'prod-bulk-%';``` |

## Test Execution Guidelines

### Prerequisites for All Tests
1. Database is properly initialized with all tables and constraints
2. Foreign key constraints are properly defined
3. All indexes are created as per schema
4. Test data cleanup procedures are in place

### Test Execution Order
1. Execute setup scripts for each test case
2. Verify prerequisites are met
3. Execute test operations
4. Verify expected outcomes
5. Clean up test data

### Success Criteria
- All positive tests complete successfully
- All negative tests fail as expected
- No orphaned data remains after cascade operations
- Transaction rollbacks work correctly
- Performance tests meet acceptable thresholds

### Cleanup Procedures
After each test execution, run cleanup scripts to remove test data:
```sql
-- Generic cleanup template
DELETE FROM table_name WHERE id LIKE 'test-%' OR id LIKE '%-test%';
DELETE FROM related_table WHERE foreign_key LIKE 'test-%' OR foreign_key LIKE '%-test%';
```

This comprehensive test plan ensures absolute confidence in the database's relational integrity by systematically validating all constraints, relationships, and edge cases.