{"version":3,"names":["cov_1khus7b7l8","actualCoverage","PrismaClient","s","require","configService","loggerService","PhoneVerificationMiddleware","constructor","f","config","logger","prisma","requirePhoneVerification","req","res","next","b","user","userId","findUnique","where","id","select","phone","phoneVerified","status","json","error","message","logSecurity","ip","userAgent","get","path","originalUrl","requiresPhoneVerification","requirePhoneVerificationFor","routes","currentPath","requiresVerification","some","route","includes","match","RegExp","requiredRoutes","requirePhoneVerificationOrAdmin","userRole","role","requireAnyVerification","email","emailVerified","requiresEmailVerification","isPhoneVerified","getUserVerificationStatus","createdAt","verified","phoneVerificationMiddleware","module","exports"],"sources":["phoneVerification.js"],"sourcesContent":["const { PrismaClient } = require('@prisma/client');\r\nconst configService = require('../services/config');\r\nconst loggerService = require('../services/logger');\r\n\r\nclass PhoneVerificationMiddleware {\r\n  constructor() {\r\n    this.config = configService;\r\n    this.logger = loggerService;\r\n    this.prisma = new PrismaClient();\r\n  }\r\n\r\n  // Middleware to check if user's phone is verified\r\n  requirePhoneVerification() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        // If no user is attached (not authenticated), skip verification\r\n        if (!req.user || !req.userId) {\r\n          return next();\r\n        }\r\n\r\n        // Get user from database to check phone verification status\r\n        const user = await this.prisma.user.findUnique({\r\n          where: { id: req.userId },\r\n          select: {\r\n            id: true,\r\n            phone: true,\r\n            phoneVerified: true,\r\n            status: true\r\n          }\r\n        });\r\n\r\n        if (!user) {\r\n          return res.status(401).json({\r\n            error: 'User not found',\r\n            message: 'Authenticated user not found in database'\r\n          });\r\n        }\r\n\r\n        // Check if phone is verified\r\n        if (!user.phoneVerified || user.status === 'PENDING') {\r\n          this.logger.logSecurity('Unverified Phone Access Attempt', req.userId, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl,\r\n            phone: user.phone\r\n          });\r\n\r\n          return res.status(403).json({\r\n            error: 'Phone not verified',\r\n            message: 'Please verify your phone number to access this resource',\r\n            requiresPhoneVerification: true\r\n          });\r\n        }\r\n\r\n        // User is verified, proceed\r\n        req.phoneVerified = true;\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Phone verification middleware error', error.message, {\r\n          userId: req.userId,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Verification check failed',\r\n          message: 'Unable to verify phone status'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Middleware to check phone verification for specific routes\r\n  requirePhoneVerificationFor(routes = []) {\r\n    return async (req, res, next) => {\r\n      try {\r\n        // Check if current path requires phone verification\r\n        const currentPath = req.originalUrl;\r\n        const requiresVerification = routes.some(route => \r\n          currentPath.includes(route) || currentPath.match(new RegExp(route))\r\n        );\r\n\r\n        if (!requiresVerification) {\r\n          return next();\r\n        }\r\n\r\n        // If no user is attached (not authenticated), skip verification\r\n        if (!req.user || !req.userId) {\r\n          return next();\r\n        }\r\n\r\n        // Get user from database\r\n        const user = await this.prisma.user.findUnique({\r\n          where: { id: req.userId },\r\n          select: {\r\n            id: true,\r\n            phone: true,\r\n            phoneVerified: true,\r\n            status: true\r\n          }\r\n        });\r\n\r\n        if (!user) {\r\n          return res.status(401).json({\r\n            error: 'User not found',\r\n            message: 'Authenticated user not found in database'\r\n          });\r\n        }\r\n\r\n        // Check if phone is verified\r\n        if (!user.phoneVerified || user.status === 'PENDING') {\r\n          this.logger.logSecurity('Protected Route Access - Unverified Phone', req.userId, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: currentPath,\r\n            phone: user.phone,\r\n            requiredRoutes: routes\r\n          });\r\n\r\n          return res.status(403).json({\r\n            error: 'Phone verification required',\r\n            message: 'Please verify your phone number to access this resource',\r\n            requiresPhoneVerification: true,\r\n            route: currentPath\r\n          });\r\n        }\r\n\r\n        // User is verified, proceed\r\n        req.phoneVerified = true;\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Phone verification middleware error', error.message, {\r\n          userId: req.userId,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Verification check failed',\r\n          message: 'Unable to verify phone status'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Middleware to check phone verification with optional bypass for admin users\r\n  requirePhoneVerificationOrAdmin() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        // If no user is attached (not authenticated), skip verification\r\n        if (!req.user || !req.userId) {\r\n          return next();\r\n        }\r\n\r\n        // Admin users can bypass phone verification\r\n        if (req.userRole === 'ADMIN') {\r\n          req.phoneVerified = true;\r\n          return next();\r\n        }\r\n\r\n        // Get user from database\r\n        const user = await this.prisma.user.findUnique({\r\n          where: { id: req.userId },\r\n          select: {\r\n            id: true,\r\n            phone: true,\r\n            phoneVerified: true,\r\n            status: true,\r\n            role: true\r\n          }\r\n        });\r\n\r\n        if (!user) {\r\n          return res.status(401).json({\r\n            error: 'User not found',\r\n            message: 'Authenticated user not found in database'\r\n          });\r\n        }\r\n\r\n        // Check if phone is verified for non-admin users\r\n        if (!user.phoneVerified || user.status === 'PENDING') {\r\n          this.logger.logSecurity('Admin Bypass Attempt - Unverified Phone', req.userId, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl,\r\n            phone: user.phone,\r\n            userRole: user.role\r\n          });\r\n\r\n          return res.status(403).json({\r\n            error: 'Phone not verified',\r\n            message: 'Please verify your phone number to access this resource',\r\n            requiresPhoneVerification: true\r\n          });\r\n        }\r\n\r\n        // User is verified, proceed\r\n        req.phoneVerified = true;\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Phone verification middleware error', error.message, {\r\n          userId: req.userId,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Verification check failed',\r\n          message: 'Unable to verify phone status'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Middleware to check either email or phone verification\r\n  requireAnyVerification() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        // If no user is attached (not authenticated), skip verification\r\n        if (!req.user || !req.userId) {\r\n          return next();\r\n        }\r\n\r\n        // Get user from database\r\n        const user = await this.prisma.user.findUnique({\r\n          where: { id: req.userId },\r\n          select: {\r\n            id: true,\r\n            email: true,\r\n            phone: true,\r\n            emailVerified: true,\r\n            phoneVerified: true,\r\n            status: true\r\n          }\r\n        });\r\n\r\n        if (!user) {\r\n          return res.status(401).json({\r\n            error: 'User not found',\r\n            message: 'Authenticated user not found in database'\r\n          });\r\n        }\r\n\r\n        // Check if either email or phone is verified\r\n        const emailVerified = user.emailVerified && user.status !== 'PENDING';\r\n        const phoneVerified = user.phoneVerified && user.status !== 'PENDING';\r\n\r\n        if (!emailVerified && !phoneVerified) {\r\n          this.logger.logSecurity('Unverified User Access Attempt', req.userId, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl,\r\n            email: user.email,\r\n            phone: user.phone\r\n          });\r\n\r\n          return res.status(403).json({\r\n            error: 'Account not verified',\r\n            message: 'Please verify your email or phone number to access this resource',\r\n            requiresEmailVerification: !emailVerified,\r\n            requiresPhoneVerification: !phoneVerified\r\n          });\r\n        }\r\n\r\n        // User is verified, proceed\r\n        req.emailVerified = emailVerified;\r\n        req.phoneVerified = phoneVerified;\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Verification middleware error', error.message, {\r\n          userId: req.userId,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Verification check failed',\r\n          message: 'Unable to verify account status'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Helper method to check if user phone is verified\r\n  async isPhoneVerified(userId) {\r\n    try {\r\n      const user = await this.prisma.user.findUnique({\r\n        where: { id: userId },\r\n        select: {\r\n          id: true,\r\n          phoneVerified: true,\r\n          status: true\r\n        }\r\n      });\r\n\r\n      return user && user.phoneVerified && user.status !== 'PENDING';\r\n    } catch (error) {\r\n      this.logger.error('Error checking phone verification status', error.message, {\r\n        userId\r\n      });\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Helper method to get user verification status\r\n  async getUserVerificationStatus(userId) {\r\n    try {\r\n      const user = await this.prisma.user.findUnique({\r\n        where: { id: userId },\r\n        select: {\r\n          id: true,\r\n          email: true,\r\n          phone: true,\r\n          emailVerified: true,\r\n          phoneVerified: true,\r\n          status: true,\r\n          createdAt: true\r\n        }\r\n      });\r\n\r\n      if (!user) {\r\n        return {\r\n          verified: false,\r\n          status: 'NOT_FOUND',\r\n          message: 'User not found'\r\n        };\r\n      }\r\n\r\n      const emailVerified = !!user.emailVerified && user.status !== 'PENDING';\r\n      const phoneVerified = !!user.phoneVerified && user.status !== 'PENDING';\r\n\r\n      return {\r\n        verified: emailVerified || phoneVerified,\r\n        status: user.status,\r\n        emailVerified: user.emailVerified,\r\n        phoneVerified: user.phoneVerified,\r\n        email: user.email,\r\n        phone: user.phone,\r\n        createdAt: user.createdAt\r\n      };\r\n\r\n    } catch (error) {\r\n      this.logger.error('Error getting user verification status', error.message, {\r\n        userId\r\n      });\r\n      return {\r\n        verified: false,\r\n        status: 'ERROR',\r\n        message: 'Unable to check verification status'\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst phoneVerificationMiddleware = new PhoneVerificationMiddleware();\r\n\r\nmodule.exports = {\r\n  PhoneVerificationMiddleware,\r\n  phoneVerificationMiddleware\r\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,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","ignoreList":[]}