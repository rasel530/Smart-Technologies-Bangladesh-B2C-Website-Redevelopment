a6664cb750b119a51587368f0abc0355
const express = require('express');
const {
  body,
  param,
  validationResult
} = require('express-validator');
const {
  PrismaClient
} = require('@prisma/client');
const {
  authMiddleware
} = require('../middleware/auth');
const router = express.Router();
const prisma = new PrismaClient();

// Validation middleware
const handleValidationErrors = (req, res, next) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({
      error: 'Validation failed',
      details: errors.array()
    });
  }
  next();
};

// Get user's wishlists
router.get('/user/:userId', [param('userId').isUUID()], handleValidationErrors, authMiddleware.selfOrAdmin(req.params.userId), async (req, res) => {
  try {
    const {
      userId
    } = req.params;
    const wishlists = await prisma.wishlist.findMany({
      where: {
        userId
      },
      include: {
        _count: {
          items: true
        },
        items: {
          take: 5,
          include: {
            product: {
              include: {
                images: {
                  where: {
                    sortOrder: 0
                  },
                  take: 1,
                  select: {
                    id: true,
                    url: true,
                    alt: true
                  }
                }
              }
            }
          },
          orderBy: {
            addedAt: 'desc'
          }
        }
      },
      orderBy: {
        createdAt: 'desc'
      }
    });
    res.json({
      wishlists
    });
  } catch (error) {
    console.error('Get wishlists error:', error);
    res.status(500).json({
      error: 'Failed to fetch wishlists',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Get wishlist by ID
router.get('/:id', [param('id').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  // Get wishlist first to check ownership
  const wishlist = await prisma.wishlist.findUnique({
    where: {
      id: req.params.id
    },
    select: {
      userId: true
    }
  });
  if (!wishlist) {
    return res.status(404).json({
      error: 'Wishlist not found'
    });
  }

  // Check if user is admin or wishlist owner
  if (req.userRole !== 'ADMIN' && wishlist.userId !== req.userId) {
    return res.status(403).json({
      error: 'Access denied',
      message: 'You can only access your own wishlists'
    });
  }
  try {
    const {
      id
    } = req.params;
    const wishlist = await prisma.wishlist.findUnique({
      where: {
        id
      },
      include: {
        user: {
          select: {
            id: true,
            firstName: true,
            lastName: true
          }
        },
        items: {
          include: {
            product: {
              include: {
                images: {
                  where: {
                    sortOrder: 0
                  },
                  take: 1,
                  select: {
                    id: true,
                    url: true,
                    alt: true
                  }
                }
              }
            }
          },
          orderBy: {
            addedAt: 'desc'
          }
        },
        _count: {
          items: true
        }
      }
    });
    if (!wishlist) {
      return res.status(404).json({
        error: 'Wishlist not found'
      });
    }
    res.json({
      wishlist
    });
  } catch (error) {
    console.error('Get wishlist error:', error);
    res.status(500).json({
      error: 'Failed to fetch wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Create wishlist
router.post('/', [body('name').optional().isString().trim(), body('isPrivate').optional().isBoolean()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  // Use authenticated user's ID
  req.body.userId = req.userId;
  try {
    const {
      userId,
      name,
      isPrivate
    } = req.body;

    // Validate user exists
    const user = await prisma.user.findUnique({
      where: {
        id: userId
      }
    });
    if (!user) {
      return res.status(404).json({
        error: 'User not found'
      });
    }
    const wishlist = await prisma.wishlist.create({
      data: {
        userId,
        name: name || 'My Wishlist',
        isPrivate: isPrivate !== undefined ? isPrivate : false
      }
    });
    res.status(201).json({
      message: 'Wishlist created successfully',
      wishlist
    });
  } catch (error) {
    console.error('Create wishlist error:', error);
    res.status(500).json({
      error: 'Failed to create wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Add item to wishlist
router.post('/:id/items', [param('id').isUUID(), body('productId').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      id
    } = req.params;
    const {
      productId
    } = req.body;

    // Validate wishlist exists
    const wishlist = await prisma.wishlist.findUnique({
      where: {
        id
      }
    });
    if (!wishlist) {
      return res.status(404).json({
        error: 'Wishlist not found'
      });
    }

    // Validate product exists
    const product = await prisma.product.findUnique({
      where: {
        id: productId
      }
    });
    if (!product) {
      return res.status(404).json({
        error: 'Product not found'
      });
    }

    // Check if item already exists
    const existingItem = await prisma.wishlistItem.findFirst({
      where: {
        wishlistId: id,
        productId
      }
    });
    if (existingItem) {
      return res.status(409).json({
        error: 'Product already in wishlist'
      });
    }
    const wishlistItem = await prisma.wishlistItem.create({
      data: {
        wishlistId: id,
        productId
      },
      include: {
        product: true
      }
    });
    res.status(201).json({
      message: 'Item added to wishlist',
      item: wishlistItem
    });
  } catch (error) {
    console.error('Add to wishlist error:', error);
    res.status(500).json({
      error: 'Failed to add item to wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Remove item from wishlist
router.delete('/:wishlistId/items/:itemId', [param('wishlistId').isUUID(), param('itemId').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      wishlistId,
      itemId
    } = req.params;

    // Check if item exists
    const wishlistItem = await prisma.wishlistItem.findFirst({
      where: {
        id: itemId,
        wishlistId
      }
    });
    if (!wishlistItem) {
      return res.status(404).json({
        error: 'Wishlist item not found'
      });
    }
    await prisma.wishlistItem.delete({
      where: {
        id: itemId
      }
    });
    res.json({
      message: 'Item removed from wishlist'
    });
  } catch (error) {
    console.error('Remove wishlist item error:', error);
    res.status(500).json({
      error: 'Failed to remove item from wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Delete wishlist
router.delete('/:id', [param('id').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      id
    } = req.params;

    // Check if wishlist exists
    const wishlist = await prisma.wishlist.findUnique({
      where: {
        id
      }
    });
    if (!wishlist) {
      return res.status(404).json({
        error: 'Wishlist not found'
      });
    }
    await prisma.wishlist.delete({
      where: {
        id
      }
    });
    res.json({
      message: 'Wishlist deleted successfully'
    });
  } catch (error) {
    console.error('Delete wishlist error:', error);
    res.status(500).json({
      error: 'Failed to delete wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImJvZHkiLCJwYXJhbSIsInZhbGlkYXRpb25SZXN1bHQiLCJQcmlzbWFDbGllbnQiLCJhdXRoTWlkZGxld2FyZSIsInJvdXRlciIsIlJvdXRlciIsInByaXNtYSIsImhhbmRsZVZhbGlkYXRpb25FcnJvcnMiLCJyZXEiLCJyZXMiLCJuZXh0IiwiZXJyb3JzIiwiaXNFbXB0eSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImRldGFpbHMiLCJhcnJheSIsImdldCIsImlzVVVJRCIsInNlbGZPckFkbWluIiwicGFyYW1zIiwidXNlcklkIiwid2lzaGxpc3RzIiwid2lzaGxpc3QiLCJmaW5kTWFueSIsIndoZXJlIiwiaW5jbHVkZSIsIl9jb3VudCIsIml0ZW1zIiwidGFrZSIsInByb2R1Y3QiLCJpbWFnZXMiLCJzb3J0T3JkZXIiLCJzZWxlY3QiLCJpZCIsInVybCIsImFsdCIsIm9yZGVyQnkiLCJhZGRlZEF0IiwiY3JlYXRlZEF0IiwiY29uc29sZSIsIm1lc3NhZ2UiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJhdXRoZW50aWNhdGUiLCJmaW5kVW5pcXVlIiwidXNlclJvbGUiLCJ1c2VyIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJwb3N0Iiwib3B0aW9uYWwiLCJpc1N0cmluZyIsInRyaW0iLCJpc0Jvb2xlYW4iLCJuYW1lIiwiaXNQcml2YXRlIiwiY3JlYXRlIiwiZGF0YSIsInVuZGVmaW5lZCIsInByb2R1Y3RJZCIsImV4aXN0aW5nSXRlbSIsIndpc2hsaXN0SXRlbSIsImZpbmRGaXJzdCIsIndpc2hsaXN0SWQiLCJpdGVtIiwiZGVsZXRlIiwiaXRlbUlkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIndpc2hsaXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHsgYm9keSwgcGFyYW0sIHZhbGlkYXRpb25SZXN1bHQgfSA9IHJlcXVpcmUoJ2V4cHJlc3MtdmFsaWRhdG9yJyk7XHJcbmNvbnN0IHsgUHJpc21hQ2xpZW50IH0gPSByZXF1aXJlKCdAcHJpc21hL2NsaWVudCcpO1xyXG5jb25zdCB7IGF1dGhNaWRkbGV3YXJlIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcclxuXHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcclxuXHJcbi8vIFZhbGlkYXRpb24gbWlkZGxld2FyZVxyXG5jb25zdCBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xyXG4gIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXHJcbiAgICAgIGRldGFpbHM6IGVycm9ycy5hcnJheSgpXHJcbiAgICB9KTtcclxuICB9XHJcbiAgbmV4dCgpO1xyXG59O1xyXG5cclxuLy8gR2V0IHVzZXIncyB3aXNobGlzdHNcclxucm91dGVyLmdldCgnL3VzZXIvOnVzZXJJZCcsIFtcclxuICBwYXJhbSgndXNlcklkJykuaXNVVUlEKClcclxuXSwgaGFuZGxlVmFsaWRhdGlvbkVycm9ycywgYXV0aE1pZGRsZXdhcmUuc2VsZk9yQWRtaW4ocmVxLnBhcmFtcy51c2VySWQpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB1c2VySWQgfSA9IHJlcS5wYXJhbXM7XHJcblxyXG4gICAgY29uc3Qgd2lzaGxpc3RzID0gYXdhaXQgcHJpc21hLndpc2hsaXN0LmZpbmRNYW55KHtcclxuICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBfY291bnQ6IHtcclxuICAgICAgICAgIGl0ZW1zOiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpdGVtczoge1xyXG4gICAgICAgICAgdGFrZTogNSxcclxuICAgICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgICAgcHJvZHVjdDoge1xyXG4gICAgICAgICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgICAgICAgIGltYWdlczoge1xyXG4gICAgICAgICAgICAgICAgICB3aGVyZTogeyBzb3J0T3JkZXI6IDAgfSxcclxuICAgICAgICAgICAgICAgICAgdGFrZTogMSxcclxuICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCB1cmw6IHRydWUsIGFsdDogdHJ1ZSB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgb3JkZXJCeTogeyBhZGRlZEF0OiAnZGVzYycgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXMuanNvbih7IHdpc2hsaXN0cyB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCB3aXNobGlzdHMgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCB3aXNobGlzdHMnLFxyXG4gICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIEdldCB3aXNobGlzdCBieSBJRFxyXG5yb3V0ZXIuZ2V0KCcvOmlkJywgW1xyXG4gIHBhcmFtKCdpZCcpLmlzVVVJRCgpXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAvLyBHZXQgd2lzaGxpc3QgZmlyc3QgdG8gY2hlY2sgb3duZXJzaGlwXHJcbiAgY29uc3Qgd2lzaGxpc3QgPSBhd2FpdCBwcmlzbWEud2lzaGxpc3QuZmluZFVuaXF1ZSh7XHJcbiAgICB3aGVyZTogeyBpZDogcmVxLnBhcmFtcy5pZCB9LFxyXG4gICAgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9XHJcbiAgfSk7XHJcbiAgXHJcbiAgaWYgKCF3aXNobGlzdCkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdXaXNobGlzdCBub3QgZm91bmQnXHJcbiAgICB9KTtcclxuICB9XHJcbiAgXHJcbiAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhZG1pbiBvciB3aXNobGlzdCBvd25lclxyXG4gIGlmIChyZXEudXNlclJvbGUgIT09ICdBRE1JTicgJiYgd2lzaGxpc3QudXNlcklkICE9PSByZXEudXNlcklkKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0FjY2VzcyBkZW5pZWQnLFxyXG4gICAgICBtZXNzYWdlOiAnWW91IGNhbiBvbmx5IGFjY2VzcyB5b3VyIG93biB3aXNobGlzdHMnXHJcbiAgICB9KTtcclxuICB9XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcblxyXG4gICAgY29uc3Qgd2lzaGxpc3QgPSBhd2FpdCBwcmlzbWEud2lzaGxpc3QuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIGZpcnN0TmFtZTogdHJ1ZSwgbGFzdE5hbWU6IHRydWUgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXRlbXM6IHtcclxuICAgICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgICAgcHJvZHVjdDoge1xyXG4gICAgICAgICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgICAgICAgIGltYWdlczoge1xyXG4gICAgICAgICAgICAgICAgICB3aGVyZTogeyBzb3J0T3JkZXI6IDAgfSxcclxuICAgICAgICAgICAgICAgICAgdGFrZTogMSxcclxuICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCB1cmw6IHRydWUsIGFsdDogdHJ1ZSB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgb3JkZXJCeTogeyBhZGRlZEF0OiAnZGVzYycgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgX2NvdW50OiB7XHJcbiAgICAgICAgICBpdGVtczogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCF3aXNobGlzdCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnV2lzaGxpc3Qgbm90IGZvdW5kJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXMuanNvbih7IHdpc2hsaXN0IH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignR2V0IHdpc2hsaXN0IGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggd2lzaGxpc3QnLFxyXG4gICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIENyZWF0ZSB3aXNobGlzdFxyXG5yb3V0ZXIucG9zdCgnLycsIFtcclxuICBib2R5KCduYW1lJykub3B0aW9uYWwoKS5pc1N0cmluZygpLnRyaW0oKSxcclxuICBib2R5KCdpc1ByaXZhdGUnKS5vcHRpb25hbCgpLmlzQm9vbGVhbigpXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAvLyBVc2UgYXV0aGVudGljYXRlZCB1c2VyJ3MgSURcclxuICByZXEuYm9keS51c2VySWQgPSByZXEudXNlcklkO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHVzZXJJZCwgbmFtZSwgaXNQcml2YXRlIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSB1c2VyIGV4aXN0c1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnVXNlciBub3QgZm91bmQnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHdpc2hsaXN0ID0gYXdhaXQgcHJpc21hLndpc2hsaXN0LmNyZWF0ZSh7XHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgbmFtZTogbmFtZSB8fCAnTXkgV2lzaGxpc3QnLFxyXG4gICAgICAgIGlzUHJpdmF0ZTogaXNQcml2YXRlICE9PSB1bmRlZmluZWQgPyBpc1ByaXZhdGUgOiBmYWxzZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgIG1lc3NhZ2U6ICdXaXNobGlzdCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXHJcbiAgICAgIHdpc2hsaXN0XHJcbiAgICB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0NyZWF0ZSB3aXNobGlzdCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSB3aXNobGlzdCcsXHJcbiAgICAgIG1lc3NhZ2U6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyb3IubWVzc2FnZSA6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gQWRkIGl0ZW0gdG8gd2lzaGxpc3Rcclxucm91dGVyLnBvc3QoJy86aWQvaXRlbXMnLCBbXHJcbiAgcGFyYW0oJ2lkJykuaXNVVUlEKCksXHJcbiAgYm9keSgncHJvZHVjdElkJykuaXNVVUlEKClcclxuXSwgaGFuZGxlVmFsaWRhdGlvbkVycm9ycywgYXV0aE1pZGRsZXdhcmUuYXV0aGVudGljYXRlKCksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgY29uc3QgeyBwcm9kdWN0SWQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIHdpc2hsaXN0IGV4aXN0c1xyXG4gICAgY29uc3Qgd2lzaGxpc3QgPSBhd2FpdCBwcmlzbWEud2lzaGxpc3QuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghd2lzaGxpc3QpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ1dpc2hsaXN0IG5vdCBmb3VuZCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgcHJvZHVjdCBleGlzdHNcclxuICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBwcmlzbWEucHJvZHVjdC5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IHByb2R1Y3RJZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXByb2R1Y3QpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ1Byb2R1Y3Qgbm90IGZvdW5kJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBpZiBpdGVtIGFscmVhZHkgZXhpc3RzXHJcbiAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSBhd2FpdCBwcmlzbWEud2lzaGxpc3RJdGVtLmZpbmRGaXJzdCh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgd2lzaGxpc3RJZDogaWQsXHJcbiAgICAgICAgcHJvZHVjdElkXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChleGlzdGluZ0l0ZW0pIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA5KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ1Byb2R1Y3QgYWxyZWFkeSBpbiB3aXNobGlzdCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgd2lzaGxpc3RJdGVtID0gYXdhaXQgcHJpc21hLndpc2hsaXN0SXRlbS5jcmVhdGUoe1xyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgd2lzaGxpc3RJZDogaWQsXHJcbiAgICAgICAgcHJvZHVjdElkXHJcbiAgICAgIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBwcm9kdWN0OiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgbWVzc2FnZTogJ0l0ZW0gYWRkZWQgdG8gd2lzaGxpc3QnLFxyXG4gICAgICBpdGVtOiB3aXNobGlzdEl0ZW1cclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignQWRkIHRvIHdpc2hsaXN0IGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gYWRkIGl0ZW0gdG8gd2lzaGxpc3QnLFxyXG4gICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIFJlbW92ZSBpdGVtIGZyb20gd2lzaGxpc3Rcclxucm91dGVyLmRlbGV0ZSgnLzp3aXNobGlzdElkL2l0ZW1zLzppdGVtSWQnLCBbXHJcbiAgcGFyYW0oJ3dpc2hsaXN0SWQnKS5pc1VVSUQoKSxcclxuICBwYXJhbSgnaXRlbUlkJykuaXNVVUlEKClcclxuXSwgaGFuZGxlVmFsaWRhdGlvbkVycm9ycywgYXV0aE1pZGRsZXdhcmUuYXV0aGVudGljYXRlKCksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHdpc2hsaXN0SWQsIGl0ZW1JZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICAvLyBDaGVjayBpZiBpdGVtIGV4aXN0c1xyXG4gICAgY29uc3Qgd2lzaGxpc3RJdGVtID0gYXdhaXQgcHJpc21hLndpc2hsaXN0SXRlbS5maW5kRmlyc3Qoe1xyXG4gICAgICB3aGVyZTogeyBpZDogaXRlbUlkLCB3aXNobGlzdElkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghd2lzaGxpc3RJdGVtKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgZXJyb3I6ICdXaXNobGlzdCBpdGVtIG5vdCBmb3VuZCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgcHJpc21hLndpc2hsaXN0SXRlbS5kZWxldGUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogaXRlbUlkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJlcy5qc29uKHtcclxuICAgICAgbWVzc2FnZTogJ0l0ZW0gcmVtb3ZlZCBmcm9tIHdpc2hsaXN0J1xyXG4gICAgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdSZW1vdmUgd2lzaGxpc3QgaXRlbSBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHJlbW92ZSBpdGVtIGZyb20gd2lzaGxpc3QnLFxyXG4gICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIERlbGV0ZSB3aXNobGlzdFxyXG5yb3V0ZXIuZGVsZXRlKCcvOmlkJywgW1xyXG4gIHBhcmFtKCdpZCcpLmlzVVVJRCgpXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICAvLyBDaGVjayBpZiB3aXNobGlzdCBleGlzdHNcclxuICAgIGNvbnN0IHdpc2hsaXN0ID0gYXdhaXQgcHJpc21hLndpc2hsaXN0LmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXdpc2hsaXN0KSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgZXJyb3I6ICdXaXNobGlzdCBub3QgZm91bmQnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHByaXNtYS53aXNobGlzdC5kZWxldGUoe1xyXG4gICAgICB3aGVyZTogeyBpZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXMuanNvbih7XHJcbiAgICAgIG1lc3NhZ2U6ICdXaXNobGlzdCBkZWxldGVkIHN1Y2Nlc3NmdWxseSdcclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRGVsZXRlIHdpc2hsaXN0IGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZGVsZXRlIHdpc2hsaXN0JyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNO0VBQUVDLElBQUk7RUFBRUMsS0FBSztFQUFFQztBQUFpQixDQUFDLEdBQUdILE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUN0RSxNQUFNO0VBQUVJO0FBQWEsQ0FBQyxHQUFHSixPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDbEQsTUFBTTtFQUFFSztBQUFlLENBQUMsR0FBR0wsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBRXhELE1BQU1NLE1BQU0sR0FBR1AsT0FBTyxDQUFDUSxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNQyxNQUFNLEdBQUcsSUFBSUosWUFBWSxDQUFDLENBQUM7O0FBRWpDO0FBQ0EsTUFBTUssc0JBQXNCLEdBQUdBLENBQUNDLEdBQUcs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