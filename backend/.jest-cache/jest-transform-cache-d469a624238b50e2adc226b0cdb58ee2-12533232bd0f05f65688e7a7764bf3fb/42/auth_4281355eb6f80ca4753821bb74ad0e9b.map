{"version":3,"names":["cov_aafv8wr8h","actualCoverage","jwt","s","require","crypto","configService","loggerService","AuthMiddleware","constructor","f","config","logger","redis","initializeRedis","Redis","createClient","url","get","retry_delay_on_failover","max_retries_per_request","on","err","error","message","info","connect","Error","authenticate","req","res","next","authHeader","headers","authorization","b","status","json","token","replace","isBlacklisted","isTokenBlacklisted","logSecurity","ip","userAgent","path","originalUrl","jwtConfig","getJWTConfig","decoded","verify","secret","algorithms","algorithm","issuer","clockTolerance","userId","role","iat","exp","now","Math","floor","Date","ipReputation","checkIPReputation","isSuspicious","reputation","user","userRole","logAuth","errorType","name","errorMessage","statusCode","rotateToken","refreshToken","body","newAccessToken","sign","email","tokenType","rotatedAt","toISOString","expiresIn","newRefreshToken","blacklistToken","oldTokenExpiry","newAccessTokenExpiry","accessToken","validateAndRotateToken","expirationBuffer","timeUntilExpiry","currentExpiry","authorize","roles","hasRequiredRole","some","requiredRole","join","adminOnly","managerOrAdmin","customerOrAdmin","selfOrAdmin","isOwner","isAdmin","targetUserId","optional","warn","rateLimit","options","windowMs","max","isProduction","standardHeaders","key","windowStart","pipeline","multi","zRemRangeByScore","zAdd","score","value","random","zCard","expire","ceil","results","exec","currentCount","reply","count","limit","retryAfter","set","reason","decode","ttl","createHash","update","digest","setEx","JSON","stringify","blacklistedAt","originalExp","result","data","hGetAll","Object","keys","length","failedAttempts","parseInt","lastAttempt","recordFailedAttempt","hIncrBy","hSet","toString","requestId","id","generateRequestId","setHeader","substr","validateApiKey","apiKeys","apiKey","validKey","find","isApiKeyValid","substring","expiresAt","warningThreshold","keyId","keyObject","createdAt","revokedAt","validateSession","sessionId","sessionKey","sessionData","session","parse","del","originalIp","currentIp","lastActivity","cors","getCORSConfig","header","origin","methods","allowedHeaders","exposedHeaders","credentials","method","end","errorLogger","timestamp","authMiddleware","module","exports"],"sources":["auth.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\r\nconst crypto = require('crypto');\r\nconst configService = require('../services/config');\r\nconst loggerService = require('../services/logger');\r\n\r\nclass AuthMiddleware {\r\n  constructor() {\r\n    this.config = configService;\r\n    this.logger = loggerService;\r\n    this.redis = null;\r\n    this.initializeRedis();\r\n  }\r\n\r\n  async initializeRedis() {\r\n    try {\r\n      const Redis = require('redis');\r\n      this.redis = Redis.createClient({\r\n        url: this.config.get('REDIS_URL'),\r\n        retry_delay_on_failover: 100,\r\n        max_retries_per_request: 3\r\n      });\r\n      \r\n      this.redis.on('error', (err) => {\r\n        this.logger.error('Redis connection error', err.message);\r\n      });\r\n      \r\n      this.redis.on('connect', () => {\r\n        this.logger.info('Redis connected successfully');\r\n      });\r\n      \r\n      await this.redis.connect();\r\n    } catch (error) {\r\n      this.logger.error('Failed to initialize Redis', error.message);\r\n      throw new Error('Redis initialization failed - security features unavailable');\r\n    }\r\n  }\r\n\r\n  // Enhanced JWT authentication middleware with proper security\r\n  authenticate() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const authHeader = req.headers.authorization;\r\n        \r\n        if (!authHeader) {\r\n          return res.status(401).json({\r\n            error: 'Access token required',\r\n            message: 'Authorization header is missing'\r\n          });\r\n        }\r\n\r\n        const token = authHeader.replace('Bearer ', '');\r\n        \r\n        if (!token) {\r\n          return res.status(401).json({\r\n            error: 'Invalid token format',\r\n            message: 'Authorization header must be in format \"Bearer <token>\"'\r\n          });\r\n        }\r\n\r\n        // Check if token is blacklisted\r\n        const isBlacklisted = await this.isTokenBlacklisted(token);\r\n        if (isBlacklisted) {\r\n          this.logger.logSecurity('Blacklisted Token Access Attempt', null, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl\r\n          });\r\n          \r\n          return res.status(401).json({\r\n            error: 'Token revoked',\r\n            message: 'This token has been revoked and cannot be used'\r\n          });\r\n        }\r\n\r\n        // Enhanced JWT verification with proper algorithm validation\r\n        const jwtConfig = this.config.getJWTConfig();\r\n        const decoded = jwt.verify(token, jwtConfig.secret, {\r\n          algorithms: [jwtConfig.algorithm],\r\n          issuer: jwtConfig.issuer,\r\n          clockTolerance: 30 // 30 seconds clock skew tolerance\r\n        });\r\n        \r\n        if (!decoded) {\r\n          return res.status(401).json({\r\n            error: 'Invalid token',\r\n            message: 'Token is expired or invalid'\r\n          });\r\n        }\r\n\r\n        // Validate token structure and required fields\r\n        if (!decoded.userId || !decoded.role || !decoded.iat || !decoded.exp) {\r\n          return res.status(401).json({\r\n            error: 'Invalid token structure',\r\n            message: 'Token is missing required claims'\r\n          });\r\n        }\r\n\r\n        // Check token expiration with additional buffer\r\n        const now = Math.floor(Date.now() / 1000);\r\n        if (decoded.exp <= now) {\r\n          return res.status(401).json({\r\n            error: 'Token expired',\r\n            message: 'Authentication token has expired'\r\n          });\r\n        }\r\n\r\n        // Check for suspicious activity from this IP\r\n        const ipReputation = await this.checkIPReputation(req.ip);\r\n        if (ipReputation.isSuspicious) {\r\n          this.logger.logSecurity('Suspicious IP Access Attempt', decoded.userId, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            reputation: ipReputation,\r\n            path: req.originalUrl\r\n          });\r\n          \r\n          return res.status(403).json({\r\n            error: 'Access denied',\r\n            message: 'Suspicious activity detected from your IP address'\r\n          });\r\n        }\r\n\r\n        // Attach user info to request\r\n        req.user = decoded;\r\n        req.userId = decoded.userId;\r\n        req.userRole = decoded.role;\r\n        req.token = token;\r\n\r\n        this.logger.logAuth('Token Verified', decoded.userId, {\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent')\r\n        });\r\n\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Authentication Error', error.message, {\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent'),\r\n          errorType: error.name\r\n        });\r\n\r\n        // Enhanced error handling for different JWT errors\r\n        let errorMessage = 'Authentication failed';\r\n        let statusCode = 401;\r\n\r\n        if (error.name === 'TokenExpiredError') {\r\n          errorMessage = 'Token has expired';\r\n        } else if (error.name === 'JsonWebTokenError') {\r\n          errorMessage = 'Invalid token format or signature';\r\n        } else if (error.name === 'NotBeforeError') {\r\n          errorMessage = 'Token not yet active';\r\n        }\r\n\r\n        return res.status(statusCode).json({\r\n          error: 'Authentication failed',\r\n          message: errorMessage\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // JWT token rotation and refresh mechanism\r\n  async rotateToken(req, res) {\r\n    try {\r\n      const { refreshToken } = req.body;\r\n      \r\n      if (!refreshToken) {\r\n        return res.status(400).json({\r\n          error: 'Refresh token required',\r\n          message: 'Refresh token is required for token rotation'\r\n        });\r\n      }\r\n\r\n      // Verify refresh token\r\n      const jwtConfig = this.config.getJWTConfig();\r\n      const decoded = jwt.verify(refreshToken, jwtConfig.secret, {\r\n        algorithms: [jwtConfig.algorithm],\r\n        issuer: jwtConfig.issuer\r\n      });\r\n\r\n      // Generate new access token with shorter expiration\r\n      const newAccessToken = jwt.sign(\r\n        {\r\n          userId: decoded.userId,\r\n          email: decoded.email,\r\n          role: decoded.role,\r\n          tokenType: 'access',\r\n          rotatedAt: new Date().toISOString()\r\n        },\r\n        jwtConfig.secret,\r\n        { expiresIn: '15m' } // Shorter expiration for access tokens\r\n      );\r\n\r\n      // Generate new refresh token with longer expiration\r\n      const newRefreshToken = jwt.sign(\r\n        {\r\n          userId: decoded.userId,\r\n          email: decoded.email,\r\n          role: decoded.role,\r\n          tokenType: 'refresh',\r\n          rotatedAt: new Date().toISOString()\r\n        },\r\n        jwtConfig.secret,\r\n        { expiresIn: '7d' } // Longer expiration for refresh tokens\r\n      );\r\n\r\n      // Blacklist old refresh token\r\n      await this.blacklistToken(refreshToken, 'Token rotation');\r\n\r\n      this.logger.logSecurity('Token Rotation Completed', decoded.userId, {\r\n        oldTokenExpiry: new Date(decoded.exp * 1000).toISOString(),\r\n        newAccessTokenExpiry: new Date(Date.now() + 15 * 60 * 1000).toISOString(),\r\n        ip: req.ip,\r\n        userAgent: req.get('User-Agent'),\r\n        path: req.originalUrl\r\n      });\r\n\r\n      return res.status(200).json({\r\n        message: 'Token rotated successfully',\r\n        accessToken: newAccessToken,\r\n        refreshToken: newRefreshToken,\r\n        tokenType: 'rotated'\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.error('Token rotation error', error.message, {\r\n        userId: decoded?.userId || 'unknown',\r\n        ip: req.ip,\r\n        userAgent: req.get('User-Agent'),\r\n        path: req.originalUrl\r\n      });\r\n\r\n      return res.status(401).json({\r\n        error: 'Token rotation failed',\r\n        message: 'Failed to rotate authentication token'\r\n      });\r\n    }\r\n  }\r\n\r\n  // Enhanced token validation with rotation check\r\n  async validateAndRotateToken(req, res, next) {\r\n    const authHeader = req.headers.authorization;\r\n    \r\n    if (!authHeader) {\r\n      return res.status(401).json({\r\n        error: 'Access token required',\r\n        message: 'Authorization header is missing'\r\n      });\r\n    }\r\n\r\n    const token = authHeader.replace('Bearer ', '');\r\n    \r\n    if (!token) {\r\n      return res.status(401).json({\r\n        error: 'Invalid token format',\r\n        message: 'Authorization header must be in format \"Bearer <token>\"'\r\n      });\r\n    }\r\n\r\n    // Check if token is blacklisted\r\n    const isBlacklisted = await this.isTokenBlacklisted(token);\r\n    if (isBlacklisted) {\r\n      this.logger.logSecurity('Blacklisted Token Access Attempt', null, {\r\n        ip: req.ip,\r\n        userAgent: req.get('User-Agent'),\r\n        path: req.originalUrl\r\n      });\r\n      \r\n      return res.status(401).json({\r\n        error: 'Token revoked',\r\n        message: 'This token has been revoked and cannot be used'\r\n      });\r\n    }\r\n\r\n    // Enhanced JWT verification with proper algorithm validation\r\n    const jwtConfig = this.config.getJWTConfig();\r\n    const decoded = jwt.verify(token, jwtConfig.secret, {\r\n      algorithms: [jwtConfig.algorithm],\r\n      issuer: jwtConfig.issuer,\r\n      clockTolerance: 30 // 30 seconds clock skew tolerance\r\n    });\r\n    \r\n    if (!decoded) {\r\n      return res.status(401).json({\r\n        error: 'Invalid token',\r\n        message: 'Token is expired or invalid'\r\n      });\r\n    }\r\n\r\n    // Validate token structure and required fields\r\n    if (!decoded.userId || !decoded.role || !decoded.iat || !decoded.exp) {\r\n      return res.status(401).json({\r\n        error: 'Invalid token structure',\r\n        message: 'Token is missing required claims'\r\n      });\r\n    }\r\n\r\n    // Check token expiration with additional buffer and rotation check\r\n    const now = Math.floor(Date.now() / 1000);\r\n    const expirationBuffer = 300; // 5 minutes buffer before expiration\r\n    const timeUntilExpiry = decoded.exp - now;\r\n    \r\n    if (decoded.exp <= now) {\r\n      return res.status(401).json({\r\n        error: 'Token expired',\r\n        message: 'Authentication token has expired'\r\n      });\r\n    }\r\n\r\n    // Check if token is close to expiration and needs rotation\r\n    if (timeUntilExpiry <= expirationBuffer) {\r\n      this.logger.logSecurity('Token Rotation Required', decoded.userId, {\r\n        timeUntilExpiry,\r\n        ip: req.ip,\r\n        userAgent: req.get('User-Agent'),\r\n        path: req.originalUrl,\r\n        currentExpiry: new Date(decoded.exp * 1000).toISOString()\r\n      });\r\n      \r\n      // Attempt automatic token rotation\r\n      return await this.rotateToken(req, res);\r\n    }\r\n\r\n    // Attach user info to request\r\n    req.user = decoded;\r\n    req.userId = decoded.userId;\r\n    req.userRole = decoded.role;\r\n    req.token = token;\r\n\r\n    this.logger.logAuth('Token Verified', decoded.userId, {\r\n      ip: req.ip,\r\n      userAgent: req.get('User-Agent')\r\n    });\r\n\r\n    next();\r\n  }\r\n\r\n  // Role-based authorization middleware\r\n  authorize(roles) {\r\n    return (req, res, next) => {\r\n      if (!req.user) {\r\n        return res.status(401).json({\r\n          error: 'Authentication required',\r\n          message: 'You must be authenticated to access this resource'\r\n        });\r\n      }\r\n\r\n      const userRole = req.userRole;\r\n      const hasRequiredRole = roles.some(role => userRole === role);\r\n\r\n      if (!hasRequiredRole) {\r\n        this.logger.logSecurity('Unauthorized Access Attempt', req.userId, {\r\n          requiredRole: roles,\r\n          userRole,\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent'),\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(403).json({\r\n          error: 'Insufficient permissions',\r\n          message: `Access denied. Required roles: ${roles.join(', ')}`\r\n        });\r\n      }\r\n\r\n      this.logger.logAuth('Access Granted', req.userId, {\r\n        requiredRole: roles,\r\n        userRole,\r\n        ip: req.ip,\r\n        userAgent: req.get('User-Agent'),\r\n        path: req.originalUrl\r\n        });\r\n\r\n      next();\r\n    };\r\n  }\r\n\r\n  // Admin only middleware\r\n  adminOnly() {\r\n    return this.authorize(['ADMIN']);\r\n  }\r\n\r\n  // Manager or Admin middleware\r\n  managerOrAdmin() {\r\n    return this.authorize(['MANAGER', 'ADMIN']);\r\n  }\r\n\r\n  // Customer or Admin middleware\r\n  customerOrAdmin() {\r\n    return this.authorize(['CUSTOMER', 'ADMIN']);\r\n  }\r\n\r\n  // Self or Admin middleware (users can access their own resources)\r\n  selfOrAdmin(userId) {\r\n    return (req, res, next) => {\r\n      if (!req.user) {\r\n        return res.status(401).json({\r\n          error: 'Authentication required',\r\n          message: 'You must be authenticated to access this resource'\r\n        });\r\n      }\r\n\r\n      // Allow access if user is admin or accessing their own resource\r\n      const isOwner = req.userId === userId;\r\n      const isAdmin = req.userRole === 'ADMIN';\r\n\r\n      if (!isOwner && !isAdmin) {\r\n        this.logger.logSecurity('Unauthorized Access Attempt', req.userId, {\r\n          targetUserId: userId,\r\n          userRole: req.userRole,\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent'),\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(403).json({\r\n          error: 'Access denied',\r\n          message: 'You can only access your own resources or need admin privileges'\r\n        });\r\n      }\r\n\r\n      this.logger.logAuth('Access Granted', req.userId, {\r\n        targetUserId: userId,\r\n        userRole: req.userRole,\r\n        isOwner,\r\n        ip: req.ip,\r\n        userAgent: req.get('User-Agent'),\r\n        path: req.originalUrl\r\n        });\r\n\r\n      next();\r\n    };\r\n  }\r\n\r\n  // Optional authentication (guest access allowed)\r\n  optional() {\r\n    return async (req, res, next) => {\r\n      const authHeader = req.headers.authorization;\r\n      \r\n      if (!authHeader) {\r\n        // No authentication provided, continue as guest\r\n        req.user = null;\r\n        req.userId = null;\r\n        req.userRole = null;\r\n        return next();\r\n      }\r\n\r\n      try {\r\n        const token = authHeader.replace('Bearer ', '');\r\n        \r\n        // Check if token is blacklisted\r\n        const isBlacklisted = await this.isTokenBlacklisted(token);\r\n        if (isBlacklisted) {\r\n          req.user = null;\r\n          req.userId = null;\r\n          req.userRole = null;\r\n          return next();\r\n        }\r\n\r\n        const jwtConfig = this.config.getJWTConfig();\r\n        const decoded = jwt.verify(token, jwtConfig.secret, {\r\n          algorithms: [jwtConfig.algorithm],\r\n          issuer: jwtConfig.issuer\r\n        });\r\n        \r\n        // Attach user info if token is valid\r\n        req.user = decoded;\r\n        req.userId = decoded.userId;\r\n        req.userRole = decoded.role;\r\n\r\n        this.logger.logAuth('Optional Authentication', decoded.userId, {\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent')\r\n        });\r\n\r\n      } catch (error) {\r\n        // Invalid token, continue as guest\r\n        req.user = null;\r\n        req.userId = null;\r\n        req.userRole = null;\r\n        \r\n        this.logger.warn('Invalid Optional Token', error.message, {\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent')\r\n        });\r\n      }\r\n\r\n      next();\r\n    };\r\n  }\r\n\r\n  // Redis-based rate limiting middleware\r\n  rateLimit(options = {}) {\r\n    return async (req, res, next) => {\r\n      try {\r\n        if (!this.redis) {\r\n          throw new Error('Redis not available for rate limiting');\r\n        }\r\n\r\n        const config = {\r\n          windowMs: options.windowMs || 15 * 60 * 1000, // 15 minutes\r\n          max: options.max || this.config.isProduction() ? 100 : 1000,\r\n          message: options.message || 'Too many requests from this IP, please try again later.',\r\n          standardHeaders: true\r\n        };\r\n\r\n        const key = `rate_limit:${req.ip}`;\r\n        const now = Date.now();\r\n        const windowStart = now - config.windowMs;\r\n        \r\n        // Use Redis pipeline for atomic operations\r\n        const pipeline = this.redis.multi();\r\n        \r\n        // Remove old entries\r\n        pipeline.zRemRangeByScore(key, 0, windowStart);\r\n        \r\n        // Add current request\r\n        pipeline.zAdd(key, [{ score: now, value: `${now}-${Math.random()}` }]);\r\n        \r\n        // Get current count\r\n        pipeline.zCard(key);\r\n        \r\n        // Set expiration\r\n        pipeline.expire(key, Math.ceil(config.windowMs / 1000));\r\n        \r\n        const results = await pipeline.exec();\r\n        const currentCount = results[2].reply;\r\n\r\n        if (currentCount > config.max) {\r\n          this.logger.logSecurity('Rate Limit Exceeded', null, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl,\r\n            count: currentCount,\r\n            limit: config.max,\r\n            windowMs: config.windowMs\r\n          });\r\n\r\n          return res.status(429).json({\r\n            error: 'Too many requests',\r\n            message: config.message,\r\n            retryAfter: Math.ceil(config.windowMs / 1000)\r\n          });\r\n        }\r\n\r\n        // Add rate limit headers\r\n        res.set({\r\n          'X-RateLimit-Limit': config.max,\r\n          'X-RateLimit-Remaining': Math.max(0, config.max - currentCount),\r\n          'X-RateLimit-Reset': new Date(now + config.windowMs).toISOString()\r\n        });\r\n\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Rate limiting error', error.message, {\r\n          ip: req.ip,\r\n          path: req.originalUrl\r\n        });\r\n        \r\n        // Fail open - allow request but log error\r\n        next();\r\n      }\r\n    };\r\n  }\r\n\r\n  // Token blacklist management\r\n  async blacklistToken(token, reason = 'User logout') {\r\n    try {\r\n      if (!this.redis) {\r\n        throw new Error('Redis not available for token blacklisting');\r\n      }\r\n\r\n      // Decode token to get expiration\r\n      const decoded = jwt.decode(token);\r\n      if (!decoded || !decoded.exp) {\r\n        throw new Error('Invalid token for blacklisting');\r\n      }\r\n\r\n      const ttl = decoded.exp - Math.floor(Date.now() / 1000);\r\n      if (ttl <= 0) {\r\n        return; // Token already expired\r\n      }\r\n\r\n      const key = `blacklist:${crypto.createHash('sha256').update(token).digest('hex')}`;\r\n      await this.redis.setEx(key, ttl, JSON.stringify({\r\n        reason,\r\n        blacklistedAt: new Date().toISOString(),\r\n        originalExp: new Date(decoded.exp * 1000).toISOString()\r\n      }));\r\n\r\n      this.logger.info('Token blacklisted successfully', {\r\n        reason,\r\n        ttl,\r\n        userId: decoded.userId\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to blacklist token', error.message);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async isTokenBlacklisted(token) {\r\n    try {\r\n      if (!this.redis) {\r\n        return false;\r\n      }\r\n\r\n      const key = `blacklist:${crypto.createHash('sha256').update(token).digest('hex')}`;\r\n      const result = await this.redis.get(key);\r\n      return result !== null;\r\n    } catch (error) {\r\n      this.logger.error('Error checking token blacklist', error.message);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // IP reputation checking\r\n  async checkIPReputation(ip) {\r\n    try {\r\n      if (!this.redis) {\r\n        return { isSuspicious: false, score: 0 };\r\n      }\r\n\r\n      const key = `ip_reputation:${ip}`;\r\n      const data = await this.redis.hGetAll(key);\r\n      \r\n      if (!data || Object.keys(data).length === 0) {\r\n        return { isSuspicious: false, score: 0 };\r\n      }\r\n\r\n      const failedAttempts = parseInt(data.failedAttempts || '0');\r\n      const lastAttempt = parseInt(data.lastAttempt || '0');\r\n      const now = Date.now();\r\n      \r\n      // Calculate reputation score\r\n      let score = 0;\r\n      if (failedAttempts > 10) score += 3;\r\n      if (failedAttempts > 5) score += 2;\r\n      if (now - lastAttempt < 60000) score += 1; // Recent activity\r\n\r\n      return {\r\n        isSuspicious: score >= 3,\r\n        score,\r\n        failedAttempts,\r\n        lastAttempt: new Date(lastAttempt).toISOString()\r\n      };\r\n\r\n    } catch (error) {\r\n      this.logger.error('Error checking IP reputation', error.message);\r\n      return { isSuspicious: false, score: 0 };\r\n    }\r\n  }\r\n\r\n  async recordFailedAttempt(ip, reason = 'authentication') {\r\n    try {\r\n      if (!this.redis) {\r\n        return;\r\n      }\r\n\r\n      const key = `ip_reputation:${ip}`;\r\n      const now = Date.now();\r\n      \r\n      await this.redis.hIncrBy(key, 'failedAttempts', 1);\r\n      await this.redis.hSet(key, 'lastAttempt', now.toString());\r\n      await this.redis.expire(key, 24 * 60 * 60); // 24 hours\r\n\r\n    } catch (error) {\r\n      this.logger.error('Error recording failed attempt', error.message);\r\n    }\r\n  }\r\n\r\n  // Request ID middleware\r\n  requestId() {\r\n    return (req, res, next) => {\r\n      req.id = this.generateRequestId();\r\n      res.setHeader('X-Request-ID', req.id);\r\n      next();\r\n    };\r\n  }\r\n\r\n  // Generate unique request ID\r\n  generateRequestId() {\r\n    return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  // Enhanced API key validation with rotation support\r\n  validateApiKey(apiKeys = []) {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const apiKey = req.headers['x-api-key'];\r\n        \r\n        if (!apiKey) {\r\n          return res.status(401).json({\r\n            error: 'API key required',\r\n            message: 'X-API-Key header is required'\r\n          });\r\n        }\r\n\r\n        // Check if API key is in valid list\r\n        const validKey = apiKeys.find(key => {\r\n          if (typeof key === 'string') {\r\n            return key === apiKey;\r\n          } else if (typeof key === 'object') {\r\n            return key.key === apiKey && this.isApiKeyValid(key);\r\n          }\r\n          return false;\r\n        });\r\n\r\n        if (!validKey) {\r\n          await this.recordFailedAttempt(req.ip, 'api_key');\r\n          \r\n          this.logger.logSecurity('Invalid API Key', null, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl,\r\n            apiKey: apiKey.substring(0, 8) + '...'\r\n          });\r\n\r\n          return res.status(401).json({\r\n            error: 'Invalid API key',\r\n            message: 'The provided API key is not valid'\r\n          });\r\n        }\r\n\r\n        // Check for API key rotation if it's an object with expiration\r\n        if (typeof validKey === 'object' && validKey.expiresAt) {\r\n          const now = Date.now();\r\n          if (now > validKey.expiresAt) {\r\n            return res.status(401).json({\r\n              error: 'API key expired',\r\n              message: 'The provided API key has expired and needs rotation'\r\n            });\r\n          }\r\n\r\n          // Add warning if key is close to expiration\r\n          const timeUntilExpiry = validKey.expiresAt - now;\r\n          const warningThreshold = 7 * 24 * 60 * 60 * 1000; // 7 days\r\n          \r\n          if (timeUntilExpiry < warningThreshold) {\r\n            res.set('X-API-Key-Expires-Soon', 'true');\r\n            res.set('X-API-Key-Expiry-Date', new Date(validKey.expiresAt).toISOString());\r\n          }\r\n        }\r\n\r\n        this.logger.logSecurity('API Key Validated', null, {\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent'),\r\n          path: req.originalUrl,\r\n          keyId: typeof validKey === 'object' ? validKey.id : 'unknown'\r\n          });\r\n\r\n        req.apiKey = validKey;\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('API key validation error', error.message, {\r\n          ip: req.ip,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Internal server error',\r\n          message: 'API key validation failed'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  isApiKeyValid(keyObject) {\r\n    if (!keyObject.key || !keyObject.createdAt) {\r\n      return false;\r\n    }\r\n\r\n    const now = Date.now();\r\n    \r\n    // Check if key has expired\r\n    if (keyObject.expiresAt && now > keyObject.expiresAt) {\r\n      return false;\r\n    }\r\n\r\n    // Check if key has been revoked\r\n    if (keyObject.revokedAt && now > keyObject.revokedAt) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  // Enhanced session validation with proper expiration\r\n  validateSession() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const sessionId = req.headers['x-session-id'];\r\n        \r\n        if (!sessionId) {\r\n          return res.status(401).json({\r\n            error: 'Session required',\r\n            message: 'X-Session-ID header is required'\r\n          });\r\n        }\r\n\r\n        if (!this.redis) {\r\n          throw new Error('Redis not available for session validation');\r\n        }\r\n\r\n        const sessionKey = `session:${sessionId}`;\r\n        const sessionData = await this.redis.get(sessionKey);\r\n\r\n        if (!sessionData) {\r\n          this.logger.logSecurity('Invalid Session', null, {\r\n            sessionId,\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl\r\n          });\r\n\r\n          return res.status(401).json({\r\n            error: 'Invalid session',\r\n            message: 'Session not found or has expired'\r\n          });\r\n        }\r\n\r\n        const session = JSON.parse(sessionData);\r\n        \r\n        // Check session expiration\r\n        const now = Date.now();\r\n        if (session.expiresAt && now > session.expiresAt) {\r\n          await this.redis.del(sessionKey);\r\n          \r\n          return res.status(401).json({\r\n            error: 'Session expired',\r\n            message: 'Your session has expired, please login again'\r\n          });\r\n        }\r\n\r\n        // Check if session is for the same IP (optional security measure)\r\n        if (session.ip && session.ip !== req.ip) {\r\n          this.logger.logSecurity('Session IP Mismatch', session.userId, {\r\n            sessionId,\r\n            originalIp: session.ip,\r\n            currentIp: req.ip,\r\n            userAgent: req.get('User-Agent')\r\n          });\r\n\r\n          return res.status(401).json({\r\n            error: 'Session invalid',\r\n            message: 'Session IP address mismatch detected'\r\n          });\r\n        }\r\n\r\n        // Update last activity\r\n        session.lastActivity = now;\r\n        await this.redis.setEx(sessionKey, \r\n          Math.ceil((session.expiresAt - now) / 1000), \r\n          JSON.stringify(session)\r\n        );\r\n\r\n        req.sessionId = sessionId;\r\n        req.session = session;\r\n\r\n        this.logger.logAuth('Session Validated', session.userId, {\r\n          sessionId,\r\n          ip: req.ip,\r\n          userAgent: req.get('User-Agent'),\r\n          path: req.originalUrl\r\n        });\r\n\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Session validation error', error.message, {\r\n          ip: req.ip,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Internal server error',\r\n          message: 'Session validation failed'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // CORS middleware\r\n  cors(options = {}) {\r\n    return (req, res, next) => {\r\n      const config = this.config.getCORSConfig();\r\n      \r\n      // Set CORS headers\r\n      res.header('Access-Control-Allow-Origin', options.origin || config.origin);\r\n      res.header('Access-Control-Allow-Methods', config.methods.join(', '));\r\n      res.header('Access-Control-Allow-Headers', config.allowedHeaders.join(', '));\r\n      res.header('Access-Control-Expose-Headers', config.exposedHeaders.join(', '));\r\n      \r\n      if (config.credentials) {\r\n        res.header('Access-Control-Allow-Credentials', 'true');\r\n      }\r\n\r\n      // Handle preflight requests\r\n      if (req.method === 'OPTIONS') {\r\n        res.status(200).end();\r\n        return;\r\n      }\r\n\r\n      next();\r\n    };\r\n  }\r\n}\r\n\r\n// Error logging middleware\r\nfunction errorLogger() {\r\n  return (req, res, next) => {\r\n    loggerService.error('Request Error', {\r\n      method: req.method,\r\n      url: req.originalUrl,\r\n      ip: req.ip,\r\n      userAgent: req.get('User-Agent'),\r\n      error: req.error || 'Unknown error',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n    \r\n    res.status(500).json({\r\n      error: 'Internal server error',\r\n      message: 'An unexpected error occurred',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  };\r\n}\r\n\r\n// Singleton instance\r\nconst authMiddleware = new AuthMiddleware();\r\n\r\nmodule.exports = {\r\n  AuthMiddleware,\r\n  authMiddleware,\r\n  errorLogger\r\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}