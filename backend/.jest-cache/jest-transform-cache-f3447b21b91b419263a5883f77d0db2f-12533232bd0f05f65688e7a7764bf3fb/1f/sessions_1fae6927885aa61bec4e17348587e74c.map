{"version":3,"names":["express","require","body","validationResult","sessionService","sessionMiddleware","authMiddleware","loggerService","router","Router","handleValidationErrors","req","res","next","errors","isEmpty","status","json","error","details","array","post","notEmpty","isUUID","optional","isIn","isBoolean","isInt","min","max","userId","loginType","rememberMe","maxAge","sessionResult","createSession","sessionId","message","setSessionCookie","sessionHeaders","Object","keys","forEach","key","set","expiresAt","process","env","NODE_ENV","get","required","valid","session","createdAt","lastActivity","securityLevel","refreshResult","refreshSession","success","reason","authenticate","allDevices","result","destroyAllUserSessions","clearSessionCookie","destroyedCount","targetSessionId","destroySession","getUserSessions","sessionsWithCurrent","sessions","map","isCurrent","totalSessions","length","activeSessions","filter","s","isActive","authorize","getSessionStats","stats","timestamp","Date","toISOString","cleanupExpiredSessions","cleanedCount","getSessionId","hasSession","validation","validateSession","module","exports"],"sources":["sessions.js"],"sourcesContent":["const express = require('express');\r\nconst { body, validationResult } = require('express-validator');\r\nconst { sessionService } = require('../services/sessionService');\r\nconst { sessionMiddleware } = require('../middleware/session');\r\nconst { authMiddleware } = require('../middleware/auth');\r\nconst { loggerService } = require('../services/logger');\r\n\r\nconst router = express.Router();\r\n\r\n// Validation middleware\r\nconst handleValidationErrors = (req, res, next) => {\r\n  const errors = validationResult(req);\r\n  if (!errors.isEmpty()) {\r\n    return res.status(400).json({\r\n      error: 'Validation failed',\r\n      details: errors.array()\r\n    });\r\n  }\r\n  next();\r\n};\r\n\r\n// Create new session (login)\r\nrouter.post('/create', [\r\n  body('userId').notEmpty().isUUID(),\r\n  body('loginType').optional().isIn(['password', 'social', 'otp']),\r\n  body('rememberMe').optional().isBoolean(),\r\n  body('maxAge').optional().isInt({ min: 300000, max: 30 * 24 * 60 * 60 * 1000 }) // 5 min to 30 days\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { userId, loginType, rememberMe, maxAge } = req.body;\r\n\r\n    // Create new session\r\n    const sessionResult = await sessionService.createSession(userId, req, {\r\n      loginType,\r\n      rememberMe,\r\n      maxAge\r\n    });\r\n\r\n    if (!sessionResult.sessionId) {\r\n      return res.status(500).json({\r\n        error: 'Session creation failed',\r\n        message: 'Unable to create session at this time'\r\n      });\r\n    }\r\n\r\n    // Set session cookie\r\n    sessionMiddleware.setSessionCookie(res, sessionResult.sessionId, {\r\n      maxAge: sessionResult.maxAge\r\n    });\r\n\r\n    // Add session headers\r\n    const sessionHeaders = sessionMiddleware.sessionHeaders(sessionResult);\r\n    Object.keys(sessionHeaders).forEach(key => {\r\n      res.set(key, sessionHeaders[key]);\r\n    });\r\n\r\n    res.status(201).json({\r\n      message: 'Session created successfully',\r\n      sessionId: sessionResult.sessionId,\r\n      expiresAt: sessionResult.expiresAt,\r\n      maxAge: sessionResult.maxAge,\r\n      userId\r\n    });\r\n\r\n  } catch (error) {\r\n    loggerService.error('Session creation error', error.message);\r\n    res.status(500).json({\r\n      error: 'Session creation failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\n// Validate session\r\nrouter.get('/validate', sessionMiddleware.required(), async (req, res) => {\r\n  try {\r\n    res.json({\r\n      message: 'Session is valid',\r\n      valid: true,\r\n      session: {\r\n        sessionId: req.sessionId,\r\n        userId: req.userId,\r\n        createdAt: req.session.createdAt,\r\n        lastActivity: req.session.lastActivity,\r\n        expiresAt: req.session.expiresAt,\r\n        loginType: req.session.loginType,\r\n        securityLevel: req.session.securityLevel\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    loggerService.error('Session validation error', error.message);\r\n    res.status(500).json({\r\n      error: 'Session validation failed',\r\n      message: 'Unable to validate session at this time'\r\n    });\r\n  }\r\n});\r\n\r\n// Refresh session\r\nrouter.post('/refresh', [\r\n  body('sessionId').optional().isUUID(),\r\n  body('maxAge').optional().isInt({ min: 300000, max: 30 * 24 * 60 * 60 * 1000 })\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    // Get session ID from body or current session\r\n    const sessionId = req.body.sessionId || req.sessionId;\r\n    \r\n    if (!sessionId) {\r\n      return res.status(400).json({\r\n        error: 'Session ID required',\r\n        message: 'Session ID is required to refresh session'\r\n      });\r\n    }\r\n\r\n    const refreshResult = await sessionService.refreshSession(sessionId, req, {\r\n      maxAge: req.body.maxAge\r\n    });\r\n\r\n    if (!refreshResult.success) {\r\n      return res.status(401).json({\r\n        error: 'Session refresh failed',\r\n        message: refreshResult.reason\r\n      });\r\n    }\r\n\r\n    // Update session cookie if this is current session\r\n    if (!req.body.sessionId && req.sessionId === sessionId) {\r\n      sessionMiddleware.setSessionCookie(res, sessionId, {\r\n        maxAge: refreshResult.maxAge\r\n      });\r\n    }\r\n\r\n    // Add updated session headers\r\n    const sessionHeaders = sessionMiddleware.sessionHeaders(refreshResult);\r\n    Object.keys(sessionHeaders).forEach(key => {\r\n      res.set(key, sessionHeaders[key]);\r\n    });\r\n\r\n    res.json({\r\n      message: 'Session refreshed successfully',\r\n      sessionId: refreshResult.sessionId,\r\n      expiresAt: refreshResult.expiresAt,\r\n      maxAge: refreshResult.maxAge\r\n    });\r\n\r\n  } catch (error) {\r\n    loggerService.error('Session refresh error', error.message);\r\n    res.status(500).json({\r\n      error: 'Session refresh failed',\r\n      message: 'Unable to refresh session at this time'\r\n    });\r\n  }\r\n});\r\n\r\n// Destroy session (logout)\r\nrouter.post('/destroy', [\r\n  body('sessionId').optional().isUUID(),\r\n  body('allDevices').optional().isBoolean()\r\n], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {\r\n  try {\r\n    const { sessionId, allDevices } = req.body;\r\n    const userId = req.userId;\r\n\r\n    if (allDevices) {\r\n      // Destroy all sessions for this user\r\n      const result = await sessionService.destroyAllUserSessions(userId, sessionId);\r\n      \r\n      if (!result.success) {\r\n        return res.status(500).json({\r\n          error: 'Session destruction failed',\r\n          message: result.reason\r\n        });\r\n      }\r\n\r\n      // Clear session cookie\r\n      sessionMiddleware.clearSessionCookie(res);\r\n\r\n      res.json({\r\n        message: 'All sessions destroyed successfully',\r\n        destroyedCount: result.destroyedCount,\r\n        allDevices: true\r\n      });\r\n\r\n    } else {\r\n      // Destroy specific session\r\n      const targetSessionId = sessionId || req.sessionId;\r\n      \r\n      if (!targetSessionId) {\r\n        return res.status(400).json({\r\n          error: 'Session ID required',\r\n          message: 'Session ID is required to destroy session'\r\n        });\r\n      }\r\n\r\n      const result = await sessionService.destroySession(targetSessionId, 'user_logout');\r\n      \r\n      if (!result.success) {\r\n        return res.status(500).json({\r\n          error: 'Session destruction failed',\r\n          message: result.reason\r\n        });\r\n      }\r\n\r\n      // Clear session cookie if destroying current session\r\n      if (targetSessionId === req.sessionId) {\r\n        sessionMiddleware.clearSessionCookie(res);\r\n      }\r\n\r\n      res.json({\r\n        message: 'Session destroyed successfully',\r\n        sessionId: targetSessionId,\r\n        allDevices: false\r\n      });\r\n    }\r\n\r\n  } catch (error) {\r\n    loggerService.error('Session destruction error', error.message);\r\n    res.status(500).json({\r\n      error: 'Session destruction failed',\r\n      message: 'Unable to destroy session at this time'\r\n    });\r\n  }\r\n});\r\n\r\n// Get user sessions\r\nrouter.get('/user', authMiddleware.authenticate(), async (req, res) => {\r\n  try {\r\n    const userId = req.userId;\r\n    const result = await sessionService.getUserSessions(userId);\r\n\r\n    if (!result.success) {\r\n      return res.status(500).json({\r\n        error: 'Failed to retrieve sessions',\r\n        message: result.reason\r\n      });\r\n    }\r\n\r\n    // Mark current session\r\n    const sessionsWithCurrent = result.sessions.map(session => ({\r\n      ...session,\r\n      isCurrent: session.sessionId === req.sessionId\r\n    }));\r\n\r\n    res.json({\r\n      message: 'User sessions retrieved successfully',\r\n      sessions: sessionsWithCurrent,\r\n      totalSessions: sessionsWithCurrent.length,\r\n      activeSessions: sessionsWithCurrent.filter(s => s.isActive).length\r\n    });\r\n\r\n  } catch (error) {\r\n    loggerService.error('Get user sessions error', error.message);\r\n    res.status(500).json({\r\n      error: 'Failed to retrieve sessions',\r\n      message: 'Unable to retrieve sessions at this time'\r\n    });\r\n  }\r\n});\r\n\r\n// Get session statistics\r\nrouter.get('/stats', authMiddleware.authorize(['ADMIN']), async (req, res) => {\r\n  try {\r\n    const result = await sessionService.getSessionStats();\r\n\r\n    if (!result.success) {\r\n      return res.status(500).json({\r\n        error: 'Failed to retrieve session statistics',\r\n        message: result.reason\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      message: 'Session statistics retrieved successfully',\r\n      stats: result.stats,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n\r\n  } catch (error) {\r\n    loggerService.error('Session stats error', error.message);\r\n    res.status(500).json({\r\n      error: 'Failed to retrieve session statistics',\r\n      message: 'Unable to retrieve session statistics at this time'\r\n    });\r\n  }\r\n});\r\n\r\n// Cleanup expired sessions (admin only)\r\nrouter.post('/cleanup', authMiddleware.authorize(['ADMIN']), async (req, res) => {\r\n  try {\r\n    const result = await sessionService.cleanupExpiredSessions();\r\n\r\n    if (!result.success) {\r\n      return res.status(500).json({\r\n        error: 'Session cleanup failed',\r\n        message: result.reason\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      message: 'Session cleanup completed successfully',\r\n      cleanedCount: result.cleanedCount,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n\r\n  } catch (error) {\r\n    loggerService.error('Session cleanup error', error.message);\r\n    res.status(500).json({\r\n      error: 'Session cleanup failed',\r\n      message: 'Unable to cleanup sessions at this time'\r\n    });\r\n  }\r\n});\r\n\r\n// Check session status (without authentication)\r\nrouter.get('/status', async (req, res) => {\r\n  try {\r\n    const sessionId = sessionMiddleware.getSessionId(req);\r\n    \r\n    if (!sessionId) {\r\n      return res.json({\r\n        message: 'No session found',\r\n        hasSession: false,\r\n        sessionId: null\r\n      });\r\n    }\r\n\r\n    const validation = await sessionService.validateSession(sessionId, req);\r\n    \r\n    res.json({\r\n      message: validation.valid ? 'Session is valid' : 'Session is invalid',\r\n      hasSession: validation.valid,\r\n      sessionId,\r\n      valid: validation.valid,\r\n      reason: validation.reason || null,\r\n      userId: validation.valid ? validation.userId : null\r\n    });\r\n\r\n  } catch (error) {\r\n    loggerService.error('Session status check error', error.message);\r\n    res.status(500).json({\r\n      error: 'Session status check failed',\r\n      message: 'Unable to check session status at this time'\r\n    });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}