{"version":3,"names":["jwt","require","crypto","PrismaClient","configService","loggerService","AuthMiddleware","constructor","prisma","config","logger","tokenBlacklist","Set","initializeTokenCleanup","setInterval","cleanupExpiredTokens","now","Date","expiredTokens","token","decoded","decode","exp","push","error","forEach","delete","length","info","generateToken","payload","jwtSecret","get","jwtExpiry","Error","sign","expiresIn","issuer","audience","verifyToken","has","verify","name","blacklistToken","add","substring","extractToken","req","authHeader","headers","authorization","parts","split","authenticate","res","next","status","json","message","user","findUnique","where","id","userId","select","email","phone","firstName","lastName","role","isActive","isEmailVerified","isPhoneVerified","createdAt","updatedAt","optional","debug","authorize","roles","userRole","hasRole","includes","requireOwnership","resourceType","resourceId","params","isOwner","order","cart","wishlist","review","rateLimit","options","windowMs","maxRequests","requests","Map","key","ip","windowStart","timestamps","entries","validTimestamps","filter","timestamp","set","userRequests","recentRequests","retryAfter","Math","ceil","requestId","generateRequestId","setHeader","random","toString","substr","requireEmailVerification","requirePhoneVerification","authenticateApiKey","apiKey","keyRecord","include","rateLimitPerHour","oneHourAgo","requestCount","apiRequest","count","apiKeyId","gte","create","data","endpoint","path","method","userAgent","cors","defaults","origin","process","env","NODE_ENV","credentials","methods","allowedHeaders","join","end","securityHeaders","errorLogger","err","errorId","generateErrorId","stack","url","originalUrl","toISOString","adminOnly","managerOrAdmin","authMiddleware","module","exports"],"sources":["auth.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\r\nconst crypto = require('crypto');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst { configService } = require('../services/config');\r\nconst { loggerService } = require('../services/logger');\r\n\r\nclass AuthMiddleware {\r\n  constructor() {\r\n    this.prisma = new PrismaClient();\r\n    this.config = configService;\r\n    this.logger = loggerService;\r\n    this.tokenBlacklist = new Set();\r\n    this.initializeTokenCleanup();\r\n  }\r\n\r\n  // Initialize token cleanup interval\r\n  initializeTokenCleanup() {\r\n    // Clean up expired tokens every hour\r\n    setInterval(() => {\r\n      this.cleanupExpiredTokens();\r\n    }, 60 * 60 * 1000);\r\n  }\r\n\r\n  // Clean up expired tokens from blacklist\r\n  cleanupExpiredTokens() {\r\n    const now = Date.now();\r\n    const expiredTokens = [];\r\n    \r\n    for (const token of this.tokenBlacklist) {\r\n      try {\r\n        const decoded = jwt.decode(token);\r\n        if (decoded && decoded.exp * 1000 < now) {\r\n          expiredTokens.push(token);\r\n        }\r\n      } catch (error) {\r\n        expiredTokens.push(token);\r\n      }\r\n    }\r\n    \r\n    expiredTokens.forEach(token => {\r\n      this.tokenBlacklist.delete(token);\r\n    });\r\n    \r\n    if (expiredTokens.length > 0) {\r\n      this.logger.info(`Cleaned up ${expiredTokens.length} expired tokens from blacklist`);\r\n    }\r\n  }\r\n\r\n  // Generate JWT token\r\n  generateToken(payload) {\r\n    const jwtSecret = this.config.get('JWT_SECRET');\r\n    const jwtExpiry = this.config.get('JWT_EXPIRY') || '24h';\r\n    \r\n    if (!jwtSecret) {\r\n      throw new Error('JWT_SECRET is not configured');\r\n    }\r\n    \r\n    return jwt.sign(payload, jwtSecret, { \r\n      expiresIn: jwtExpiry,\r\n      issuer: 'smart-ecommerce-api',\r\n      audience: 'smart-ecommerce-clients'\r\n    });\r\n  }\r\n\r\n  // Verify JWT token\r\n  verifyToken(token) {\r\n    try {\r\n      const jwtSecret = this.config.get('JWT_SECRET');\r\n      \r\n      if (!jwtSecret) {\r\n        throw new Error('JWT_SECRET is not configured');\r\n      }\r\n      \r\n      // Check if token is blacklisted\r\n      if (this.tokenBlacklist.has(token)) {\r\n        throw new Error('Token has been revoked');\r\n      }\r\n      \r\n      const decoded = jwt.verify(token, jwtSecret, {\r\n        issuer: 'smart-ecommerce-api',\r\n        audience: 'smart-ecommerce-clients'\r\n      });\r\n      \r\n      return decoded;\r\n      \r\n    } catch (error) {\r\n      if (error.name === 'TokenExpiredError') {\r\n        throw new Error('Token has expired');\r\n      } else if (error.name === 'JsonWebTokenError') {\r\n        throw new Error('Invalid token');\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Add token to blacklist\r\n  blacklistToken(token) {\r\n    this.tokenBlacklist.add(token);\r\n    this.logger.info('Token added to blacklist', { token: token.substring(0, 20) + '...' });\r\n  }\r\n\r\n  // Extract token from request\r\n  extractToken(req) {\r\n    const authHeader = req.headers.authorization;\r\n    \r\n    if (!authHeader) {\r\n      return null;\r\n    }\r\n    \r\n    const parts = authHeader.split(' ');\r\n    if (parts.length !== 2 || parts[0] !== 'Bearer') {\r\n      return null;\r\n    }\r\n    \r\n    return parts[1];\r\n  }\r\n\r\n  // Authentication middleware\r\n  authenticate() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const token = this.extractToken(req);\r\n        \r\n        if (!token) {\r\n          return res.status(401).json({\r\n            error: 'Authentication required',\r\n            message: 'No token provided'\r\n          });\r\n        }\r\n        \r\n        const decoded = this.verifyToken(token);\r\n        \r\n        // Fetch user from database\r\n        const user = await this.prisma.user.findUnique({\r\n          where: { id: decoded.userId },\r\n          select: {\r\n            id: true,\r\n            email: true,\r\n            phone: true,\r\n            firstName: true,\r\n            lastName: true,\r\n            role: true,\r\n            isActive: true,\r\n            isEmailVerified: true,\r\n            isPhoneVerified: true,\r\n            createdAt: true,\r\n            updatedAt: true\r\n          }\r\n        });\r\n        \r\n        if (!user) {\r\n          return res.status(401).json({\r\n            error: 'Authentication failed',\r\n            message: 'User not found'\r\n          });\r\n        }\r\n        \r\n        if (!user.isActive) {\r\n          return res.status(401).json({\r\n            error: 'Authentication failed',\r\n            message: 'Account is deactivated'\r\n          });\r\n        }\r\n        \r\n        // Attach user and token to request\r\n        req.user = user;\r\n        req.token = token;\r\n        \r\n        next();\r\n        \r\n      } catch (error) {\r\n        this.logger.error('Authentication error', error.message);\r\n        \r\n        return res.status(401).json({\r\n          error: 'Authentication failed',\r\n          message: error.message\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Optional authentication middleware\r\n  optional() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const token = this.extractToken(req);\r\n        \r\n        if (token) {\r\n          const decoded = this.verifyToken(token);\r\n          \r\n          // Fetch user from database\r\n          const user = await this.prisma.user.findUnique({\r\n            where: { id: decoded.userId },\r\n            select: {\r\n              id: true,\r\n              email: true,\r\n              phone: true,\r\n              firstName: true,\r\n              lastName: true,\r\n              role: true,\r\n              isActive: true,\r\n              isEmailVerified: true,\r\n              isPhoneVerified: true,\r\n              createdAt: true,\r\n              updatedAt: true\r\n            }\r\n          });\r\n          \r\n          if (user && user.isActive) {\r\n            req.user = user;\r\n            req.token = token;\r\n          }\r\n        }\r\n        \r\n        next();\r\n        \r\n      } catch (error) {\r\n        // For optional auth, we don't return error, just continue without user\r\n        this.logger.debug('Optional authentication failed', error.message);\r\n        next();\r\n      }\r\n    };\r\n  }\r\n\r\n  // Role-based authorization middleware\r\n  authorize(roles) {\r\n    return (req, res, next) => {\r\n      if (!req.user) {\r\n        return res.status(401).json({\r\n          error: 'Authentication required',\r\n          message: 'Please authenticate first'\r\n        });\r\n      }\r\n      \r\n      const userRole = req.user.role;\r\n      const hasRole = roles.includes(userRole);\r\n      \r\n      if (!hasRole) {\r\n        return res.status(403).json({\r\n          error: 'Authorization failed',\r\n          message: 'Insufficient permissions'\r\n        });\r\n      }\r\n      \r\n      next();\r\n    };\r\n  }\r\n\r\n  // Resource ownership middleware\r\n  requireOwnership(resourceType) {\r\n    return async (req, res, next) => {\r\n      try {\r\n        if (!req.user) {\r\n          return res.status(401).json({\r\n            error: 'Authentication required',\r\n            message: 'Please authenticate first'\r\n          });\r\n        }\r\n        \r\n        const resourceId = req.params.id;\r\n        const userId = req.user.id;\r\n        \r\n        let isOwner = false;\r\n        \r\n        switch (resourceType) {\r\n          case 'user':\r\n            isOwner = resourceId === userId;\r\n            break;\r\n            \r\n          case 'order':\r\n            const order = await this.prisma.order.findUnique({\r\n              where: { id: resourceId },\r\n              select: { userId: true }\r\n            });\r\n            isOwner = order && order.userId === userId;\r\n            break;\r\n            \r\n          case 'cart':\r\n            const cart = await this.prisma.cart.findUnique({\r\n              where: { id: resourceId },\r\n              select: { userId: true }\r\n            });\r\n            isOwner = cart && cart.userId === userId;\r\n            break;\r\n            \r\n          case 'wishlist':\r\n            const wishlist = await this.prisma.wishlist.findUnique({\r\n              where: { id: resourceId },\r\n              select: { userId: true }\r\n            });\r\n            isOwner = wishlist && wishlist.userId === userId;\r\n            break;\r\n            \r\n          case 'review':\r\n            const review = await this.prisma.review.findUnique({\r\n              where: { id: resourceId },\r\n              select: { userId: true }\r\n            });\r\n            isOwner = review && review.userId === userId;\r\n            break;\r\n            \r\n          default:\r\n            return res.status(400).json({\r\n              error: 'Invalid resource type',\r\n              message: 'Resource type not supported'\r\n            });\r\n        }\r\n        \r\n        if (!isOwner) {\r\n          return res.status(403).json({\r\n            error: 'Authorization failed',\r\n            message: 'You can only access your own resources'\r\n          });\r\n        }\r\n        \r\n        next();\r\n        \r\n      } catch (error) {\r\n        this.logger.error('Ownership check error', error.message);\r\n        \r\n        return res.status(500).json({\r\n          error: 'Authorization check failed',\r\n          message: 'Failed to verify resource ownership'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Rate limiting middleware\r\n  rateLimit(options = {}) {\r\n    const config = {\r\n      windowMs: options.windowMs || 15 * 60 * 1000, // 15 minutes\r\n      maxRequests: options.maxRequests || 100,\r\n      message: options.message || 'Too many requests, please try again later',\r\n      ...options\r\n    };\r\n    \r\n    const requests = new Map();\r\n    \r\n    return (req, res, next) => {\r\n      const key = req.ip + (req.user ? `:${req.user.id}` : '');\r\n      const now = Date.now();\r\n      const windowStart = now - config.windowMs;\r\n      \r\n      // Clean up old entries\r\n      for (const [ip, timestamps] of requests.entries()) {\r\n        const validTimestamps = timestamps.filter(timestamp => timestamp > windowStart);\r\n        if (validTimestamps.length === 0) {\r\n          requests.delete(ip);\r\n        } else {\r\n          requests.set(ip, validTimestamps);\r\n        }\r\n      }\r\n      \r\n      // Check current requests\r\n      const userRequests = requests.get(key) || [];\r\n      const recentRequests = userRequests.filter(timestamp => timestamp > windowStart);\r\n      \r\n      if (recentRequests.length >= config.maxRequests) {\r\n        return res.status(429).json({\r\n          error: 'Rate limit exceeded',\r\n          message: config.message,\r\n          retryAfter: Math.ceil(config.windowMs / 1000)\r\n        });\r\n      }\r\n      \r\n      // Add current request\r\n      recentRequests.push(now);\r\n      requests.set(key, recentRequests);\r\n      \r\n      next();\r\n    };\r\n  }\r\n\r\n  // Request ID middleware\r\n  requestId() {\r\n    return (req, res, next) => {\r\n      req.id = this.generateRequestId();\r\n      res.setHeader('X-Request-ID', req.id);\r\n      next();\r\n    };\r\n  }\r\n\r\n  // Generate unique request ID\r\n  generateRequestId() {\r\n    return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  // Validate email verification\r\n  requireEmailVerification() {\r\n    return (req, res, next) => {\r\n      if (!req.user) {\r\n        return res.status(401).json({\r\n          error: 'Authentication required',\r\n          message: 'Please authenticate first'\r\n        });\r\n      }\r\n      \r\n      if (!req.user.isEmailVerified) {\r\n        return res.status(403).json({\r\n          error: 'Email verification required',\r\n          message: 'Please verify your email address'\r\n        });\r\n      }\r\n      \r\n      next();\r\n    };\r\n  }\r\n\r\n  // Validate phone verification\r\n  requirePhoneVerification() {\r\n    return (req, res, next) => {\r\n      if (!req.user) {\r\n        return res.status(401).json({\r\n          error: 'Authentication required',\r\n          message: 'Please authenticate first'\r\n        });\r\n      }\r\n      \r\n      if (!req.user.isPhoneVerified) {\r\n        return res.status(403).json({\r\n          error: 'Phone verification required',\r\n          message: 'Please verify your phone number'\r\n        });\r\n      }\r\n      \r\n      next();\r\n    };\r\n  }\r\n\r\n  // API key authentication middleware\r\n  authenticateApiKey() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        const apiKey = req.headers['x-api-key'];\r\n        \r\n        if (!apiKey) {\r\n          return res.status(401).json({\r\n            error: 'API key required',\r\n            message: 'Please provide an API key'\r\n          });\r\n        }\r\n        \r\n        // Find API key in database\r\n        const keyRecord = await this.prisma.apiKey.findUnique({\r\n          where: { key: apiKey },\r\n          include: {\r\n            user: {\r\n              select: {\r\n                id: true,\r\n                email: true,\r\n                role: true,\r\n                isActive: true\r\n              }\r\n            }\r\n          }\r\n        });\r\n        \r\n        if (!keyRecord) {\r\n          return res.status(401).json({\r\n            error: 'Invalid API key',\r\n            message: 'The provided API key is not valid'\r\n          });\r\n        }\r\n        \r\n        if (!keyRecord.isActive) {\r\n          return res.status(401).json({\r\n            error: 'API key deactivated',\r\n            message: 'The provided API key has been deactivated'\r\n          });\r\n        }\r\n        \r\n        if (!keyRecord.user.isActive) {\r\n          return res.status(401).json({\r\n            error: 'Account deactivated',\r\n            message: 'The associated account has been deactivated'\r\n          });\r\n        }\r\n        \r\n        // Check rate limits for API key\r\n        if (keyRecord.rateLimitPerHour) {\r\n          const now = Date.now();\r\n          const oneHourAgo = now - (60 * 60 * 1000);\r\n          \r\n          const requestCount = await this.prisma.apiRequest.count({\r\n            where: {\r\n              apiKeyId: keyRecord.id,\r\n              timestamp: {\r\n                gte: new Date(oneHourAgo)\r\n              }\r\n            }\r\n          });\r\n          \r\n          if (requestCount >= keyRecord.rateLimitPerHour) {\r\n            return res.status(429).json({\r\n              error: 'API rate limit exceeded',\r\n              message: 'Too many requests with this API key'\r\n            });\r\n          }\r\n          \r\n          // Log API request\r\n          await this.prisma.apiRequest.create({\r\n            data: {\r\n              apiKeyId: keyRecord.id,\r\n              endpoint: req.path,\r\n              method: req.method,\r\n              ip: req.ip,\r\n              userAgent: req.get('User-Agent'),\r\n              timestamp: new Date()\r\n            }\r\n          });\r\n        }\r\n        \r\n        // Attach user and API key info to request\r\n        req.user = keyRecord.user;\r\n        req.apiKey = keyRecord;\r\n        \r\n        next();\r\n        \r\n      } catch (error) {\r\n        this.logger.error('API key authentication error', error.message);\r\n        \r\n        return res.status(500).json({\r\n          error: 'Authentication failed',\r\n          message: 'Failed to authenticate with API key'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // CORS middleware helper\r\n  cors(options = {}) {\r\n    const defaults = {\r\n      origin: process.env.NODE_ENV === 'production' \r\n        ? ['https://smarttechnologies-bd.com'] \r\n        : ['http://localhost:3000', 'http://localhost:3001'],\r\n      credentials: true,\r\n      methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\r\n      allowedHeaders: ['Content-Type', 'Authorization', 'X-API-Key']\r\n    };\r\n    \r\n    const config = { ...defaults, ...options };\r\n    \r\n    return (req, res, next) => {\r\n      const origin = req.headers.origin;\r\n      \r\n      if (config.origin.includes(origin) || config.origin === '*') {\r\n        res.setHeader('Access-Control-Allow-Origin', origin);\r\n      }\r\n      \r\n      res.setHeader('Access-Control-Allow-Methods', config.methods.join(', '));\r\n      res.setHeader('Access-Control-Allow-Headers', config.allowedHeaders.join(', '));\r\n      res.setHeader('Access-Control-Allow-Credentials', config.credentials);\r\n      \r\n      if (req.method === 'OPTIONS') {\r\n        return res.status(200).end();\r\n      }\r\n      \r\n      next();\r\n    };\r\n  }\r\n\r\n  // Security headers middleware\r\n  securityHeaders() {\r\n    return (req, res, next) => {\r\n      // Prevent clickjacking\r\n      res.setHeader('X-Frame-Options', 'DENY');\r\n      \r\n      // Prevent MIME type sniffing\r\n      res.setHeader('X-Content-Type-Options', 'nosniff');\r\n      \r\n      // Enable XSS protection\r\n      res.setHeader('X-XSS-Protection', '1; mode=block');\r\n      \r\n      // Force HTTPS in production\r\n      if (process.env.NODE_ENV === 'production') {\r\n        res.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');\r\n      }\r\n      \r\n      // Content Security Policy\r\n      res.setHeader('Content-Security-Policy', \"default-src 'self'\");\r\n      \r\n      next();\r\n    };\r\n  }\r\n\r\n  // Error logger middleware\r\n  errorLogger() {\r\n    return (err, req, res, next) => {\r\n      const errorId = this.generateErrorId();\r\n      \r\n      this.logger.error('Application Error', {\r\n        errorId,\r\n        message: err.message,\r\n        stack: err.stack,\r\n        method: req.method,\r\n        url: req.originalUrl,\r\n        ip: req.ip,\r\n        userAgent: req.get('User-Agent'),\r\n        requestId: req.id,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      \r\n      // Don't expose error details in production\r\n      if (process.env.NODE_ENV === 'production') {\r\n        res.status(500).json({\r\n          error: 'Internal server error',\r\n          errorId\r\n        });\r\n      } else {\r\n        next(err);\r\n      }\r\n    };\r\n  }\r\n\r\n  // Generate unique error ID\r\n  generateErrorId() {\r\n    return `err_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  // Admin-only middleware\r\n  adminOnly() {\r\n    return (req, res, next) => {\r\n      if (!req.user) {\r\n        return res.status(401).json({\r\n          error: 'Authentication required',\r\n          message: 'Please authenticate first'\r\n        });\r\n      }\r\n      \r\n      if (req.user.role !== 'ADMIN') {\r\n        return res.status(403).json({\r\n          error: 'Access denied',\r\n          message: 'Admin access required'\r\n        });\r\n      }\r\n      \r\n      next();\r\n    };\r\n  }\r\n\r\n  // Manager or Admin middleware\r\n  managerOrAdmin() {\r\n    return (req, res, next) => {\r\n      if (!req.user) {\r\n        return res.status(401).json({\r\n          error: 'Authentication required',\r\n          message: 'Please authenticate first'\r\n        });\r\n      }\r\n      \r\n      if (req.user.role !== 'ADMIN' && req.user.role !== 'MANAGER') {\r\n        return res.status(403).json({\r\n          error: 'Access denied',\r\n          message: 'Manager or Admin access required'\r\n        });\r\n      }\r\n      \r\n      next();\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst authMiddleware = new AuthMiddleware();\r\n\r\nmodule.exports = {\r\n  AuthMiddleware,\r\n  authMiddleware\r\n};"],"mappings":"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","ignoreList":[]}