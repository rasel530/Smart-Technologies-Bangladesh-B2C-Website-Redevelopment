{"version":3,"names":["cov_1tp4860vs2","actualCoverage","PrismaClient","s","require","configService","loggerService","EmailVerificationMiddleware","constructor","f","config","logger","prisma","requireEmailVerification","req","res","next","b","user","userId","findUnique","where","id","select","email","emailVerified","status","json","error","message","logSecurity","ip","userAgent","get","path","originalUrl","requiresEmailVerification","requireEmailVerificationFor","routes","currentPath","requiresVerification","some","route","includes","match","RegExp","requiredRoutes","requireEmailVerificationOrAdmin","userRole","role","isEmailVerified","getUserVerificationStatus","createdAt","verified","emailVerificationMiddleware","module","exports"],"sources":["emailVerification.js"],"sourcesContent":["const { PrismaClient } = require('@prisma/client');\r\nconst configService = require('../services/config');\r\nconst loggerService = require('../services/logger');\r\n\r\nclass EmailVerificationMiddleware {\r\n  constructor() {\r\n    this.config = configService;\r\n    this.logger = loggerService;\r\n    this.prisma = new PrismaClient();\r\n  }\r\n\r\n  // Middleware to check if user's email is verified\r\n  requireEmailVerification() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        // If no user is attached (not authenticated), skip verification\r\n        if (!req.user || !req.userId) {\r\n          return next();\r\n        }\r\n\r\n        // Get user from database to check email verification status\r\n        const user = await this.prisma.user.findUnique({\r\n          where: { id: req.userId },\r\n          select: {\r\n            id: true,\r\n            email: true,\r\n            emailVerified: true,\r\n            status: true\r\n          }\r\n        });\r\n\r\n        if (!user) {\r\n          return res.status(401).json({\r\n            error: 'User not found',\r\n            message: 'Authenticated user not found in database'\r\n          });\r\n        }\r\n\r\n        // Check if email is verified\r\n        if (!user.emailVerified || user.status === 'PENDING') {\r\n          this.logger.logSecurity('Unverified Email Access Attempt', req.userId, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl,\r\n            email: user.email\r\n          });\r\n\r\n          return res.status(403).json({\r\n            error: 'Email not verified',\r\n            message: 'Please verify your email address to access this resource',\r\n            requiresEmailVerification: true\r\n          });\r\n        }\r\n\r\n        // User is verified, proceed\r\n        req.emailVerified = true;\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Email verification middleware error', error.message, {\r\n          userId: req.userId,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Verification check failed',\r\n          message: 'Unable to verify email status'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Middleware to check email verification for specific routes\r\n  requireEmailVerificationFor(routes = []) {\r\n    return async (req, res, next) => {\r\n      try {\r\n        // Check if current path requires email verification\r\n        const currentPath = req.originalUrl;\r\n        const requiresVerification = routes.some(route => \r\n          currentPath.includes(route) || currentPath.match(new RegExp(route))\r\n        );\r\n\r\n        if (!requiresVerification) {\r\n          return next();\r\n        }\r\n\r\n        // If no user is attached (not authenticated), skip verification\r\n        if (!req.user || !req.userId) {\r\n          return next();\r\n        }\r\n\r\n        // Get user from database\r\n        const user = await this.prisma.user.findUnique({\r\n          where: { id: req.userId },\r\n          select: {\r\n            id: true,\r\n            email: true,\r\n            emailVerified: true,\r\n            status: true\r\n          }\r\n        });\r\n\r\n        if (!user) {\r\n          return res.status(401).json({\r\n            error: 'User not found',\r\n            message: 'Authenticated user not found in database'\r\n          });\r\n        }\r\n\r\n        // Check if email is verified\r\n        if (!user.emailVerified || user.status === 'PENDING') {\r\n          this.logger.logSecurity('Protected Route Access - Unverified Email', req.userId, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: currentPath,\r\n            email: user.email,\r\n            requiredRoutes: routes\r\n          });\r\n\r\n          return res.status(403).json({\r\n            error: 'Email verification required',\r\n            message: 'Please verify your email address to access this resource',\r\n            requiresEmailVerification: true,\r\n            route: currentPath\r\n          });\r\n        }\r\n\r\n        // User is verified, proceed\r\n        req.emailVerified = true;\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Email verification middleware error', error.message, {\r\n          userId: req.userId,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Verification check failed',\r\n          message: 'Unable to verify email status'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Middleware to check email verification with optional bypass for admin users\r\n  requireEmailVerificationOrAdmin() {\r\n    return async (req, res, next) => {\r\n      try {\r\n        // If no user is attached (not authenticated), skip verification\r\n        if (!req.user || !req.userId) {\r\n          return next();\r\n        }\r\n\r\n        // Admin users can bypass email verification\r\n        if (req.userRole === 'ADMIN') {\r\n          req.emailVerified = true;\r\n          return next();\r\n        }\r\n\r\n        // Get user from database\r\n        const user = await this.prisma.user.findUnique({\r\n          where: { id: req.userId },\r\n          select: {\r\n            id: true,\r\n            email: true,\r\n            emailVerified: true,\r\n            status: true,\r\n            role: true\r\n          }\r\n        });\r\n\r\n        if (!user) {\r\n          return res.status(401).json({\r\n            error: 'User not found',\r\n            message: 'Authenticated user not found in database'\r\n          });\r\n        }\r\n\r\n        // Check if email is verified for non-admin users\r\n        if (!user.emailVerified || user.status === 'PENDING') {\r\n          this.logger.logSecurity('Admin Bypass Attempt - Unverified Email', req.userId, {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            path: req.originalUrl,\r\n            email: user.email,\r\n            userRole: user.role\r\n          });\r\n\r\n          return res.status(403).json({\r\n            error: 'Email not verified',\r\n            message: 'Please verify your email address to access this resource',\r\n            requiresEmailVerification: true\r\n          });\r\n        }\r\n\r\n        // User is verified, proceed\r\n        req.emailVerified = true;\r\n        next();\r\n\r\n      } catch (error) {\r\n        this.logger.error('Email verification middleware error', error.message, {\r\n          userId: req.userId,\r\n          path: req.originalUrl\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Verification check failed',\r\n          message: 'Unable to verify email status'\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  // Helper method to check if user email is verified\r\n  async isEmailVerified(userId) {\r\n    try {\r\n      const user = await this.prisma.user.findUnique({\r\n        where: { id: userId },\r\n        select: {\r\n          id: true,\r\n          emailVerified: true,\r\n          status: true\r\n        }\r\n      });\r\n\r\n      return user && user.emailVerified && user.status !== 'PENDING';\r\n    } catch (error) {\r\n      this.logger.error('Error checking email verification status', error.message, {\r\n        userId\r\n      });\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Helper method to get user verification status\r\n  async getUserVerificationStatus(userId) {\r\n    try {\r\n      const user = await this.prisma.user.findUnique({\r\n        where: { id: userId },\r\n        select: {\r\n          id: true,\r\n          email: true,\r\n          emailVerified: true,\r\n          status: true,\r\n          createdAt: true\r\n        }\r\n      });\r\n\r\n      if (!user) {\r\n        return {\r\n          verified: false,\r\n          status: 'NOT_FOUND',\r\n          message: 'User not found'\r\n        };\r\n      }\r\n\r\n      return {\r\n        verified: !!user.emailVerified && user.status !== 'PENDING',\r\n        status: user.status,\r\n        emailVerified: user.emailVerified,\r\n        email: user.email,\r\n        createdAt: user.createdAt\r\n      };\r\n\r\n    } catch (error) {\r\n      this.logger.error('Error getting user verification status', error.message, {\r\n        userId\r\n      });\r\n      return {\r\n        verified: false,\r\n        status: 'ERROR',\r\n        message: 'Unable to check verification status'\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst emailVerificationMiddleware = new EmailVerificationMiddleware();\r\n\r\nmodule.exports = {\r\n  EmailVerificationMiddleware,\r\n  emailVerificationMiddleware\r\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ,MAAM;EAAEE;AAAa,CAAC;AAAA;AAAA,CAAAF,cAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,gBAAgB,CAAC;AAClD,MAAMC,aAAa;AAAA;AAAA,CAAAL,cAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,oBAAoB,CAAC;AACnD,MAAME,aAAa;AAAA;AAAA,CAAAN,cAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,oBAAoB,CAAC;AAEnD,MAAMG,2BAA2B,CAAC;EAChCC,WAAWA,CAAA,EAAG;IAAA;IAAAR,cAAA,GAAAS,CAAA;IAAAT,cAAA,GAAAG,CAAA;IACZ,IAAI,CAACO,MAAM,GAAGL,aAAa;IAAC;IAAAL,cAAA,GAAAG,CAAA;IAC5B,IAAI,CAACQ,MAAM,GAAGL,aAAa;IAAC;IAAAN,cAAA,GAAAG,CAAA;IAC5B,IAAI,CAACS,MAAM,GAAG,IAAIV,YAAY,CAAC,CAAC;EAClC;;EAEA;EACAW,wBAAwBA,CAAA,EAAG;IAAA;IAAAb,cAAA,GAAAS,CAAA;IAAAT,cAAA,GAAAG,CAAA;IACzB,OAAO,OAAOW,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;MAAA;MAAAhB,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAG,CAAA;MAC/B,IAAI;QAAA;QAAAH,cAAA,GAAAG,CAAA;QACF;QACA;QAAI;QAAA,CAAAH,cAAA,GAAAiB,CAAA,WAACH,GAAG,CAACI,IAAI;QAAA;QAAA,CAAAlB,cAAA,GAAAiB,CAAA,UAAI,CAACH,GAAG,CAACK,MAAM,GAAE;UAAA;UAAAnB,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UAC5B,OAAOa,IAAI,CAAC,CAAC;QACf,CAAC;QAAA;QAAA;UAAAhB,cAAA,GAAAiB,CAAA;QAAA;;QAED;QACA,MAAMC,IAAI;QAAA;QAAA,CAAAlB,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACS,MAAM,CAACM,IAAI,CAACE,UAAU,CAAC;UAC7CC,KAAK,EAAE;YAAEC,EAAE,EAAER,GAAG,CAACK;UAAO,CAAC;UACzBI,MAAM,EAAE;YACND,EAAE,EAAE,IAAI;YACRE,KAAK,EAAE,IAAI;YACXC,aAAa,EAAE,IAAI;YACnBC,MAAM,EAAE;UACV;QACF,CAAC,CAAC;QAAC;QAAA1B,cAAA,GAAAG,CAAA;QAEH,IAAI,CAACe,IAAI,EAAE;UAAA;UAAAlB,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UACT,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;YAC1BC,KAAK,EAAE,gBAAgB;YACvBC,OAAO,EAAE;UACX,CAAC,CAAC;QACJ,CAAC;QAAA;QAAA;UAAA7B,cAAA,GAAAiB,CAAA;QAAA;;QAED;QAAAjB,cAAA,GAAAG,CAAA;QACA;QAAI;QAAA,CAAAH,cAAA,GAAAiB,CAAA,WAACC,IAAI,CAACO,aAAa;QAAA;QAAA,CAAAzB,cAAA,GAAAiB,CAAA,UAAIC,IAAI,CAACQ,MAAM,KAAK,SAAS,GAAE;UAAA;UAAA1B,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UACpD,IAAI,CAACQ,MAAM,CAACmB,WAAW,CAAC,iCAAiC,EAAEhB,GAAG,CAACK,MAAM,EAAE;YACrEY,EAAE,EAAEjB,GAAG,CAACiB,EAAE;YACVC,SAAS,EAAElB,GAAG,CAACmB,GAAG,CAAC,YAAY,CAAC;YAChCC,IAAI,EAAEpB,GAAG,CAACqB,WAAW;YACrBX,KAAK,EAAEN,IAAI,CAACM;UACd,CAAC,CAAC;UAAC;UAAAxB,cAAA,GAAAG,CAAA;UAEH,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;YAC1BC,KAAK,EAAE,oBAAoB;YAC3BC,OAAO,EAAE,0DAA0D;YACnEO,yBAAyB,EAAE;UAC7B,CAAC,CAAC;QACJ,CAAC;QAAA;QAAA;UAAApC,cAAA,GAAAiB,CAAA;QAAA;;QAED;QAAAjB,cAAA,GAAAG,CAAA;QACAW,GAAG,CAACW,aAAa,GAAG,IAAI;QAAC;QAAAzB,cAAA,GAAAG,CAAA;QACzBa,IAAI,CAAC,CAAC;MAER,CAAC,CAAC,OAAOY,KAAK,EAAE;QAAA;QAAA5B,cAAA,GAAAG,CAAA;QACd,IAAI,CAACQ,MAAM,CAACiB,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAACC,OAAO,EAAE;UACtEV,MAAM,EAAEL,GAAG,CAACK,MAAM;UAClBe,IAAI,EAAEpB,GAAG,CAACqB;QACZ,CAAC,CAAC;QAAC;QAAAnC,cAAA,GAAAG,CAAA;QAEH,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,KAAK,EAAE,2BAA2B;UAClCC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;IACF,CAAC;EACH;;EAEA;EACAQ,2BAA2BA,CAACC,MAAM;EAAA;EAAA,CAAAtC,cAAA,GAAAiB,CAAA,UAAG,EAAE,GAAE;IAAA;IAAAjB,cAAA,GAAAS,CAAA;IAAAT,cAAA,GAAAG,CAAA;IACvC,OAAO,OAAOW,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;MAAA;MAAAhB,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAG,CAAA;MAC/B,IAAI;QACF;QACA,MAAMoC,WAAW;QAAA;QAAA,CAAAvC,cAAA,GAAAG,CAAA,QAAGW,GAAG,CAACqB,WAAW;QACnC,MAAMK,oBAAoB;QAAA;QAAA,CAAAxC,cAAA,GAAAG,CAAA,QAAGmC,MAAM,CAACG,IAAI,CAACC,KAAK,IAC5C;UAAA;UAAA1C,cAAA,GAAAS,CAAA;UAAAT,cAAA,GAAAG,CAAA;UAAA,kCAAAH,cAAA,GAAAiB,CAAA,UAAAsB,WAAW,CAACI,QAAQ,CAACD,KAAK,CAAC;UAAA;UAAA,CAAA1C,cAAA,GAAAiB,CAAA,UAAIsB,WAAW,CAACK,KAAK,CAAC,IAAIC,MAAM,CAACH,KAAK,CAAC,CAAC;QAAD,CACpE,CAAC;QAAC;QAAA1C,cAAA,GAAAG,CAAA;QAEF,IAAI,CAACqC,oBAAoB,EAAE;UAAA;UAAAxC,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UACzB,OAAOa,IAAI,CAAC,CAAC;QACf,CAAC;QAAA;QAAA;UAAAhB,cAAA,GAAAiB,CAAA;QAAA;;QAED;QAAAjB,cAAA,GAAAG,CAAA;QACA;QAAI;QAAA,CAAAH,cAAA,GAAAiB,CAAA,WAACH,GAAG,CAACI,IAAI;QAAA;QAAA,CAAAlB,cAAA,GAAAiB,CAAA,UAAI,CAACH,GAAG,CAACK,MAAM,GAAE;UAAA;UAAAnB,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UAC5B,OAAOa,IAAI,CAAC,CAAC;QACf,CAAC;QAAA;QAAA;UAAAhB,cAAA,GAAAiB,CAAA;QAAA;;QAED;QACA,MAAMC,IAAI;QAAA;QAAA,CAAAlB,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACS,MAAM,CAACM,IAAI,CAACE,UAAU,CAAC;UAC7CC,KAAK,EAAE;YAAEC,EAAE,EAAER,GAAG,CAACK;UAAO,CAAC;UACzBI,MAAM,EAAE;YACND,EAAE,EAAE,IAAI;YACRE,KAAK,EAAE,IAAI;YACXC,aAAa,EAAE,IAAI;YACnBC,MAAM,EAAE;UACV;QACF,CAAC,CAAC;QAAC;QAAA1B,cAAA,GAAAG,CAAA;QAEH,IAAI,CAACe,IAAI,EAAE;UAAA;UAAAlB,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UACT,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;YAC1BC,KAAK,EAAE,gBAAgB;YACvBC,OAAO,EAAE;UACX,CAAC,CAAC;QACJ,CAAC;QAAA;QAAA;UAAA7B,cAAA,GAAAiB,CAAA;QAAA;;QAED;QAAAjB,cAAA,GAAAG,CAAA;QACA;QAAI;QAAA,CAAAH,cAAA,GAAAiB,CAAA,YAACC,IAAI,CAACO,aAAa;QAAA;QAAA,CAAAzB,cAAA,GAAAiB,CAAA,WAAIC,IAAI,CAACQ,MAAM,KAAK,SAAS,GAAE;UAAA;UAAA1B,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UACpD,IAAI,CAACQ,MAAM,CAACmB,WAAW,CAAC,2CAA2C,EAAEhB,GAAG,CAACK,MAAM,EAAE;YAC/EY,EAAE,EAAEjB,GAAG,CAACiB,EAAE;YACVC,SAAS,EAAElB,GAAG,CAACmB,GAAG,CAAC,YAAY,CAAC;YAChCC,IAAI,EAAEK,WAAW;YACjBf,KAAK,EAAEN,IAAI,CAACM,KAAK;YACjBsB,cAAc,EAAER;UAClB,CAAC,CAAC;UAAC;UAAAtC,cAAA,GAAAG,CAAA;UAEH,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;YAC1BC,KAAK,EAAE,6BAA6B;YACpCC,OAAO,EAAE,0DAA0D;YACnEO,yBAAyB,EAAE,IAAI;YAC/BM,KAAK,EAAEH;UACT,CAAC,CAAC;QACJ,CAAC;QAAA;QAAA;UAAAvC,cAAA,GAAAiB,CAAA;QAAA;;QAED;QAAAjB,cAAA,GAAAG,CAAA;QACAW,GAAG,CAACW,aAAa,GAAG,IAAI;QAAC;QAAAzB,cAAA,GAAAG,CAAA;QACzBa,IAAI,CAAC,CAAC;MAER,CAAC,CAAC,OAAOY,KAAK,EAAE;QAAA;QAAA5B,cAAA,GAAAG,CAAA;QACd,IAAI,CAACQ,MAAM,CAACiB,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAACC,OAAO,EAAE;UACtEV,MAAM,EAAEL,GAAG,CAACK,MAAM;UAClBe,IAAI,EAAEpB,GAAG,CAACqB;QACZ,CAAC,CAAC;QAAC;QAAAnC,cAAA,GAAAG,CAAA;QAEH,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,KAAK,EAAE,2BAA2B;UAClCC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;IACF,CAAC;EACH;;EAEA;EACAkB,+BAA+BA,CAAA,EAAG;IAAA;IAAA/C,cAAA,GAAAS,CAAA;IAAAT,cAAA,GAAAG,CAAA;IAChC,OAAO,OAAOW,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;MAAA;MAAAhB,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAG,CAAA;MAC/B,IAAI;QAAA;QAAAH,cAAA,GAAAG,CAAA;QACF;QACA;QAAI;QAAA,CAAAH,cAAA,GAAAiB,CAAA,YAACH,GAAG,CAACI,IAAI;QAAA;QAAA,CAAAlB,cAAA,GAAAiB,CAAA,WAAI,CAACH,GAAG,CAACK,MAAM,GAAE;UAAA;UAAAnB,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UAC5B,OAAOa,IAAI,CAAC,CAAC;QACf,CAAC;QAAA;QAAA;UAAAhB,cAAA,GAAAiB,CAAA;QAAA;;QAED;QAAAjB,cAAA,GAAAG,CAAA;QACA,IAAIW,GAAG,CAACkC,QAAQ,KAAK,OAAO,EAAE;UAAA;UAAAhD,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UAC5BW,GAAG,CAACW,aAAa,GAAG,IAAI;UAAC;UAAAzB,cAAA,GAAAG,CAAA;UACzB,OAAOa,IAAI,CAAC,CAAC;QACf,CAAC;QAAA;QAAA;UAAAhB,cAAA,GAAAiB,CAAA;QAAA;;QAED;QACA,MAAMC,IAAI;QAAA;QAAA,CAAAlB,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACS,MAAM,CAACM,IAAI,CAACE,UAAU,CAAC;UAC7CC,KAAK,EAAE;YAAEC,EAAE,EAAER,GAAG,CAACK;UAAO,CAAC;UACzBI,MAAM,EAAE;YACND,EAAE,EAAE,IAAI;YACRE,KAAK,EAAE,IAAI;YACXC,aAAa,EAAE,IAAI;YACnBC,MAAM,EAAE,IAAI;YACZuB,IAAI,EAAE;UACR;QACF,CAAC,CAAC;QAAC;QAAAjD,cAAA,GAAAG,CAAA;QAEH,IAAI,CAACe,IAAI,EAAE;UAAA;UAAAlB,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UACT,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;YAC1BC,KAAK,EAAE,gBAAgB;YACvBC,OAAO,EAAE;UACX,CAAC,CAAC;QACJ,CAAC;QAAA;QAAA;UAAA7B,cAAA,GAAAiB,CAAA;QAAA;;QAED;QAAAjB,cAAA,GAAAG,CAAA;QACA;QAAI;QAAA,CAAAH,cAAA,GAAAiB,CAAA,YAACC,IAAI,CAACO,aAAa;QAAA;QAAA,CAAAzB,cAAA,GAAAiB,CAAA,WAAIC,IAAI,CAACQ,MAAM,KAAK,SAAS,GAAE;UAAA;UAAA1B,cAAA,GAAAiB,CAAA;UAAAjB,cAAA,GAAAG,CAAA;UACpD,IAAI,CAACQ,MAAM,CAACmB,WAAW,CAAC,yCAAyC,EAAEhB,GAAG,CAACK,MAAM,EAAE;YAC7EY,EAAE,EAAEjB,GAAG,CAACiB,EAAE;YACVC,SAAS,EAAElB,GAAG,CAACmB,GAAG,CAAC,YAAY,CAAC;YAChCC,IAAI,EAAEpB,GAAG,CAACqB,WAAW;YACrBX,KAAK,EAAEN,IAAI,CAACM,KAAK;YACjBwB,QAAQ,EAAE9B,IAAI,CAAC+B;UACjB,CAAC,CAAC;UAAC;UAAAjD,cAAA,GAAAG,CAAA;UAEH,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;YAC1BC,KAAK,EAAE,oBAAoB;YAC3BC,OAAO,EAAE,0DAA0D;YACnEO,yBAAyB,EAAE;UAC7B,CAAC,CAAC;QACJ,CAAC;QAAA;QAAA;UAAApC,cAAA,GAAAiB,CAAA;QAAA;;QAED;QAAAjB,cAAA,GAAAG,CAAA;QACAW,GAAG,CAACW,aAAa,GAAG,IAAI;QAAC;QAAAzB,cAAA,GAAAG,CAAA;QACzBa,IAAI,CAAC,CAAC;MAER,CAAC,CAAC,OAAOY,KAAK,EAAE;QAAA;QAAA5B,cAAA,GAAAG,CAAA;QACd,IAAI,CAACQ,MAAM,CAACiB,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAACC,OAAO,EAAE;UACtEV,MAAM,EAAEL,GAAG,CAACK,MAAM;UAClBe,IAAI,EAAEpB,GAAG,CAACqB;QACZ,CAAC,CAAC;QAAC;QAAAnC,cAAA,GAAAG,CAAA;QAEH,OAAOY,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,KAAK,EAAE,2BAA2B;UAClCC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;IACF,CAAC;EACH;;EAEA;EACA,MAAMqB,eAAeA,CAAC/B,MAAM,EAAE;IAAA;IAAAnB,cAAA,GAAAS,CAAA;IAAAT,cAAA,GAAAG,CAAA;IAC5B,IAAI;MACF,MAAMe,IAAI;MAAA;MAAA,CAAAlB,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACS,MAAM,CAACM,IAAI,CAACE,UAAU,CAAC;QAC7CC,KAAK,EAAE;UAAEC,EAAE,EAAEH;QAAO,CAAC;QACrBI,MAAM,EAAE;UACND,EAAE,EAAE,IAAI;UACRG,aAAa,EAAE,IAAI;UACnBC,MAAM,EAAE;QACV;MACF,CAAC,CAAC;MAAC;MAAA1B,cAAA,GAAAG,CAAA;MAEH,OAAO,2BAAAH,cAAA,GAAAiB,CAAA,WAAAC,IAAI;MAAA;MAAA,CAAAlB,cAAA,GAAAiB,CAAA,WAAIC,IAAI,CAACO,aAAa;MAAA;MAAA,CAAAzB,cAAA,GAAAiB,CAAA,WAAIC,IAAI,CAACQ,MAAM,KAAK,SAAS;IAChE,CAAC,CAAC,OAAOE,KAAK,EAAE;MAAA;MAAA5B,cAAA,GAAAG,CAAA;MACd,IAAI,CAACQ,MAAM,CAACiB,KAAK,CAAC,0CAA0C,EAAEA,KAAK,CAACC,OAAO,EAAE;QAC3EV;MACF,CAAC,CAAC;MAAC;MAAAnB,cAAA,GAAAG,CAAA;MACH,OAAO,KAAK;IACd;EACF;;EAEA;EACA,MAAMgD,yBAAyBA,CAAChC,MAAM,EAAE;IAAA;IAAAnB,cAAA,GAAAS,CAAA;IAAAT,cAAA,GAAAG,CAAA;IACtC,IAAI;MACF,MAAMe,IAAI;MAAA;MAAA,CAAAlB,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACS,MAAM,CAACM,IAAI,CAACE,UAAU,CAAC;QAC7CC,KAAK,EAAE;UAAEC,EAAE,EAAEH;QAAO,CAAC;QACrBI,MAAM,EAAE;UACND,EAAE,EAAE,IAAI;UACRE,KAAK,EAAE,IAAI;UACXC,aAAa,EAAE,IAAI;UACnBC,MAAM,EAAE,IAAI;UACZ0B,SAAS,EAAE;QACb;MACF,CAAC,CAAC;MAAC;MAAApD,cAAA,GAAAG,CAAA;MAEH,IAAI,CAACe,IAAI,EAAE;QAAA;QAAAlB,cAAA,GAAAiB,CAAA;QAAAjB,cAAA,GAAAG,CAAA;QACT,OAAO;UACLkD,QAAQ,EAAE,KAAK;UACf3B,MAAM,EAAE,WAAW;UACnBG,OAAO,EAAE;QACX,CAAC;MACH,CAAC;MAAA;MAAA;QAAA7B,cAAA,GAAAiB,CAAA;MAAA;MAAAjB,cAAA,GAAAG,CAAA;MAED,OAAO;QACLkD,QAAQ;QAAE;QAAA,CAAArD,cAAA,GAAAiB,CAAA,YAAC,CAACC,IAAI,CAACO,aAAa;QAAA;QAAA,CAAAzB,cAAA,GAAAiB,CAAA,WAAIC,IAAI,CAACQ,MAAM,KAAK,SAAS;QAC3DA,MAAM,EAAER,IAAI,CAACQ,MAAM;QACnBD,aAAa,EAAEP,IAAI,CAACO,aAAa;QACjCD,KAAK,EAAEN,IAAI,CAACM,KAAK;QACjB4B,SAAS,EAAElC,IAAI,CAACkC;MAClB,CAAC;IAEH,CAAC,CAAC,OAAOxB,KAAK,EAAE;MAAA;MAAA5B,cAAA,GAAAG,CAAA;MACd,IAAI,CAACQ,MAAM,CAACiB,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAACC,OAAO,EAAE;QACzEV;MACF,CAAC,CAAC;MAAC;MAAAnB,cAAA,GAAAG,CAAA;MACH,OAAO;QACLkD,QAAQ,EAAE,KAAK;QACf3B,MAAM,EAAE,OAAO;QACfG,OAAO,EAAE;MACX,CAAC;IACH;EACF;AACF;;AAEA;AACA,MAAMyB,2BAA2B;AAAA;AAAA,CAAAtD,cAAA,GAAAG,CAAA,QAAG,IAAII,2BAA2B,CAAC,CAAC;AAAC;AAAAP,cAAA,GAAAG,CAAA;AAEtEoD,MAAM,CAACC,OAAO,GAAG;EACfjD,2BAA2B;EAC3B+C;AACF,CAAC","ignoreList":[]}