{"version":3,"names":["express","require","body","validationResult","bcrypt","jwt","PrismaClient","emailService","smsService","otpService","authMiddleware","sessionMiddleware","sessionService","passwordService","phoneValidationService","configService","loggerService","loginSecurityService","loginSecurityMiddleware","router","Router","prisma","handleValidationErrors","req","res","next","errors","isEmpty","status","json","error","details","array","post","optional","isEmail","normalizeEmail","isLength","min","max","notEmpty","trim","email","password","firstName","lastName","fname","lname","phone","phoneNumber","confirmPassword","finalFirstName","finalLastName","finalPhone","message","messageBn","userInfo","passwordValidation","validatePasswordStrength","isValid","strength","score","feedback","warnings","suggestions","passwordPolicy","getPasswordPolicy","validateEmail","isDisposableEmail","phoneValidation","validateForUseCase","errorBn","code","existingUser","user","findFirst","where","OR","normalizedPhone","field","hashedPassword","hashPassword","create","data","role","select","id","createdAt","savePasswordToHistory","isTestingMode","isEmailVerificationDisabled","isPhoneVerificationDisabled","verificationToken","generateVerificationToken","expiresAt","Date","now","emailVerificationToken","userId","token","emailResult","sendVerificationEmail","success","delete","requiresEmailVerification","otpResult","generatePhoneOTP","requiresPhoneVerification","operator","operatorDetails","updatedUser","update","emailVerified","phoneVerified","testingMode","verificationSkipped","console","process","env","NODE_ENV","isBoolean","isString","enforce","identifier","rememberMe","captcha","deviceFingerprint","includes","loginType","findUnique","isValidPassword","compare","requiresVerification","verificationMessage","verificationMessageBn","verificationType","lastLoginAt","sessionResult","createSession","maxAge","sessionId","setSessionCookie","sessionHeaders","Object","keys","forEach","key","set","jwtSecretLogin","JWT_SECRET","Error","sign","expiresIn","JWT_EXPIRES_IN","recordSuccessfulLogin","securityContext","name","stack","authError","recordFailedLogin","validateCaptcha","ip","allDevices","getSessionId","validation","validateSession","valid","clearSessionCookie","sessionExpired","result","destroyAllUserSessions","destroySession","reason","destroyedCount","jwtSecretRefresh","decoded","verify","jwtSecretNew","newToken","include","sendWelcomeEmail","emailVerificationTokens","gt","recentToken","getTime","deleteMany","isVerified","isPhoneVerified","mock","otp","verifyResult","verifyPhoneOTP","verifiedAt","resendResult","resendPhoneOTP","waitTime","authenticate","currentPassword","newPassword","isCurrentPasswordValid","verifyPassword","isSameAsCurrent","isPasswordReused","hashedNewPassword","log","toISOString","timestamp","resetToken","temporaryPassword","generateStrongPassword","hashedTempPassword","sendPasswordResetEmail","get","policy","validateBangladeshPhoneNumber","operators","getSupportedOperators","validateRememberMeToken","tokenValid","refreshResult","refreshFromRememberMeToken","jwtToken","refreshedFrom","currentSessionId","clearCookie","module","exports"],"sources":["auth.js"],"sourcesContent":["const express = require('express');\r\nconst { body, validationResult } = require('express-validator');\r\nconst bcrypt = require('bcryptjs');\r\nconst jwt = require('jsonwebtoken');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst { emailService } = require('../services/emailService');\r\nconst { smsService } = require('../services/smsService');\r\nconst { otpService } = require('../services/otpService');\r\nconst { authMiddleware } = require('../middleware/auth');\r\nconst { sessionMiddleware } = require('../middleware/session');\r\nconst { sessionService } = require('../services/sessionService');\r\nconst { passwordService } = require('../services/passwordService');\r\nconst { phoneValidationService } = require('../services/phoneValidationService');\r\nconst { configService } = require('../services/config');\r\nconst { loggerService } = require('../services/logger');\r\nconst { loginSecurityService } = require('../services/loginSecurityService');\r\nconst { loginSecurityMiddleware } = require('../middleware/loginSecurity');\r\n\r\nconst router = express.Router();\r\nconst prisma = new PrismaClient();\r\n\r\n// Validation middleware\r\nconst handleValidationErrors = (req, res, next) => {\r\n  const errors = validationResult(req);\r\n  if (!errors.isEmpty()) {\r\n    return res.status(400).json({\r\n      error: 'Validation failed',\r\n      details: errors.array()\r\n    });\r\n  }\r\n  next();\r\n};\r\n\r\n// Register endpoint\r\nrouter.post('/register', [\r\n  body('email').optional().isEmail().normalizeEmail(),\r\n  body('password').isLength({ min: 8, max: 128 }),\r\n  body('firstName').optional().notEmpty().trim(),\r\n  body('lastName').optional().notEmpty().trim(),\r\n  body('fname').optional().notEmpty().trim(),\r\n  body('lname').optional().notEmpty().trim(),\r\n  body('phone').optional().notEmpty().trim(),\r\n  body('phoneNumber').optional().notEmpty().trim(),\r\n  body('confirmPassword').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n  const {\r\n    email,\r\n    password,\r\n    firstName,\r\n    lastName,\r\n    fname,\r\n    lname,\r\n    phone,\r\n    phoneNumber,\r\n    confirmPassword\r\n  } = req.body;\r\n  \r\n  // Handle property name variations\r\n  const finalFirstName = firstName || fname;\r\n  const finalLastName = lastName || lname;\r\n  const finalPhone = phone || phoneNumber;\r\n  \r\n  // Validate that at least email or phone is provided\r\n  if (!email && !finalPhone) {\r\n    return res.status(400).json({\r\n      error: 'Email or phone required',\r\n      message: 'Please provide either email or phone number for registration',\r\n      messageBn: 'অনুগ্রহ ইমেল বা ফোন নম্বর দিন'\r\n    });\r\n  }\r\n  \r\n  // Validate confirm password matches\r\n  if (password !== confirmPassword) {\r\n    return res.status(400).json({\r\n      error: 'Passwords do not match',\r\n      message: 'Password and confirm password must match',\r\n      messageBn: 'পাসওয়ার্ড এবং নিশ্চিত পাসওয়ার্ড মিলতে হবে'\r\n    });\r\n  }\r\n\r\n\r\n  // Validate password strength\r\n  const userInfo = { firstName: finalFirstName, lastName: finalLastName, email, phone: finalPhone };\r\n  const passwordValidation = passwordService.validatePasswordStrength(password, userInfo);\r\n  \r\n  if (!passwordValidation.isValid) {\r\n    return res.status(400).json({\r\n      error: 'Password does not meet requirements',\r\n      message: 'Password is too weak or does not meet security requirements',\r\n      messageBn: 'পাসওয়ার্ড খুবই বা নিরাপত্তিগিয় পূর্ব',\r\n      details: {\r\n        strength: passwordValidation.strength,\r\n        score: passwordValidation.score,\r\n        feedback: passwordValidation.feedback,\r\n        warnings: passwordValidation.warnings,\r\n        suggestions: passwordValidation.suggestions,\r\n        passwordPolicy: passwordService.getPasswordPolicy()\r\n      }\r\n    });\r\n  }\r\n\r\n    // Validate email if provided\r\n    if (email) {\r\n      if (!emailService.validateEmail(email)) {\r\n        return res.status(400).json({\r\n          error: 'Invalid email format',\r\n          message: 'Please provide a valid email address',\r\n          messageBn: 'অনুগ্রহ ইমেল ঠিকানা দিন'\r\n        });\r\n      }\r\n\r\n      if (emailService.isDisposableEmail(email)) {\r\n        return res.status(400).json({\r\n          error: 'Disposable email not allowed',\r\n          message: 'Please use a permanent email address for registration',\r\n          messageBn: 'নিবন্ধন ইমেল ব্যবহার করুন, অনুগ্রহ ইমেল ব্যবহার করুন'\r\n        });\r\n      }\r\n    }\r\n\r\n    // Validate phone if provided\r\n    let phoneValidation = null;\r\n    if (finalPhone) {\r\n      phoneValidation = phoneValidationService.validateForUseCase(finalPhone, 'registration');\r\n      if (!phoneValidation.isValid) {\r\n        return res.status(400).json({\r\n          error: 'Invalid phone format',\r\n          message: phoneValidation.error,\r\n          messageBn: phoneValidation.errorBn,\r\n          code: phoneValidation.code\r\n        });\r\n      }\r\n    }\r\n\r\n    // Check if user already exists\r\n    const existingUser = await prisma.user.findFirst({\r\n      where: {\r\n        OR: [\r\n          ...(email ? [{ email }] : []),\r\n          ...(phoneValidation?.isValid ? [{ phone: phoneValidation.normalizedPhone }] : [])\r\n        ]\r\n      }\r\n    });\r\n\r\n    if (existingUser) {\r\n      return res.status(409).json({\r\n        error: 'User already exists',\r\n        message: 'An account with this email or phone number already exists',\r\n        messageBn: 'এই ইমেল বা ফোন নম্বর দিয়ে একাউন্ট বিদ্যমান রয়েছে',\r\n        field: existingUser.email === email ? 'email' : 'phone'\r\n      });\r\n    }\r\n\r\n    // Hash password using password service\r\n    const hashedPassword = await passwordService.hashPassword(password);\r\n\r\n    // Create user with PENDING status\r\n    const user = await prisma.user.create({\r\n      data: {\r\n        email,\r\n        password: hashedPassword,\r\n        firstName: finalFirstName,\r\n        lastName: finalLastName,\r\n        phone: phoneValidation?.normalizedPhone || finalPhone,\r\n        role: 'CUSTOMER',\r\n        status: 'PENDING'\r\n      },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        firstName: true,\r\n        lastName: true,\r\n        phone: true,\r\n        role: true,\r\n        status: true,\r\n        createdAt: true\r\n      }\r\n    });\r\n\r\n    // Save password to history\r\n    await passwordService.savePasswordToHistory(user.id, hashedPassword);\r\n\r\n    // Check if testing mode is enabled\r\n    const isTestingMode = configService.isTestingMode();\r\n    const isEmailVerificationDisabled = configService.isEmailVerificationDisabled();\r\n    const isPhoneVerificationDisabled = configService.isPhoneVerificationDisabled();\r\n\r\n    // Handle verification based on what's provided and testing mode\r\n    if (email && !isEmailVerificationDisabled) {\r\n      // Email verification flow\r\n      const verificationToken = emailService.generateVerificationToken();\r\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\r\n\r\n      // Save verification token to database\r\n      await prisma.emailVerificationToken.create({\r\n        data: {\r\n          userId: user.id,\r\n          token: verificationToken,\r\n          expiresAt\r\n        }\r\n      });\r\n\r\n      // Send verification email\r\n      const emailResult = await emailService.sendVerificationEmail(\r\n        email,\r\n        `${firstName} ${lastName}`,\r\n        verificationToken\r\n      );\r\n\r\n      if (!emailResult.success) {\r\n        // If email fails, delete user and token for cleanup\r\n        await prisma.emailVerificationToken.delete({\r\n          where: { userId: user.id }\r\n        });\r\n        await prisma.user.delete({\r\n          where: { id: user.id }\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Registration failed',\r\n          message: 'Failed to send verification email. Please try again later.',\r\n          messageBn: 'যাচাই ইমেল পাঠানো ব্যর্থ হয়েছে। অনুগ্রহ চেষ্টা করুন।'\r\n        });\r\n      }\r\n\r\n      res.status(201).json({\r\n        message: 'Registration successful. Please check your email to verify your account.',\r\n        messageBn: 'নিবন্ধন সফল। আপনার অ্যাকাউন্ট যাচাই করার জন্য ইমেল চেক করুন।',\r\n        user: {\r\n          id: user.id,\r\n          email: user.email,\r\n          firstName: user.firstName,\r\n          lastName: user.lastName,\r\n          role: user.role,\r\n          status: user.status\r\n        },\r\n        requiresEmailVerification: true\r\n      });\r\n\r\n    } else if (phoneValidation?.isValid && !isPhoneVerificationDisabled) {\r\n      // Phone verification flow\r\n      const otpResult = await otpService.generatePhoneOTP(phoneValidation.normalizedPhone, user.id);\r\n\r\n      if (!otpResult.success) {\r\n        // If OTP fails, delete user for cleanup\r\n        await prisma.user.delete({\r\n          where: { id: user.id }\r\n        });\r\n\r\n        return res.status(500).json({\r\n          error: 'Registration failed',\r\n          message: otpResult.error || 'Failed to send OTP. Please try again later.',\r\n          messageBn: otpResult.errorBn || 'OTP পাঠানো ব্যর্থ হয়েছে। অনুগ্রহ চেষ্টা করুন।'\r\n        });\r\n      }\r\n\r\n      res.status(201).json({\r\n        message: 'Registration successful. Please check your phone for OTP verification.',\r\n        messageBn: 'নিবন্ধন সফল। আপনার ফোনে OTP যাচাই করার জন্য চেক করুন।',\r\n        user: {\r\n          id: user.id,\r\n          phone: user.phone,\r\n          firstName: user.firstName,\r\n          lastName: user.lastName,\r\n          role: user.role,\r\n          status: user.status\r\n        },\r\n        requiresPhoneVerification: true,\r\n        phone: phoneValidation.normalizedPhone,\r\n        operator: phoneValidation.operator,\r\n        operatorDetails: phoneValidation.operatorDetails\r\n      });\r\n\r\n    } else {\r\n      // Skip verification - activate account immediately (testing mode or verification disabled)\r\n      const updatedUser = await prisma.user.update({\r\n        where: { id: user.id },\r\n        data: {\r\n          status: 'ACTIVE',\r\n          emailVerified: email ? new Date() : null,\r\n          phoneVerified: phoneValidation?.isValid ? new Date() : null\r\n        },\r\n        select: {\r\n          id: true,\r\n          email: true,\r\n          firstName: true,\r\n          lastName: true,\r\n          phone: true,\r\n          role: true,\r\n          status: true,\r\n          emailVerified: true,\r\n          phoneVerified: true\r\n        }\r\n      });\r\n\r\n      res.status(201).json({\r\n        message: isTestingMode\r\n          ? 'Registration successful in testing mode. Account is automatically activated.'\r\n          : 'Registration successful. Account is activated without verification.',\r\n        messageBn: isTestingMode\r\n          ? 'টেস্টিং মোডে নিবন্ধন সফল। অ্যাকাউন্ট স্বয়ংক্রিয় সক্রিয় করা হয়েছে।'\r\n          : 'নিবন্ধন সফল। যাচাই ছাড়া অ্যাকাউন্ট সক্রিয় করা হয়েছে।',\r\n        user: updatedUser,\r\n        testingMode: isTestingMode,\r\n        verificationSkipped: true\r\n      });\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Registration error:', error);\r\n    res.status(500).json({\r\n      error: 'Registration failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'নিবন্ধন ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Login endpoint\r\nrouter.post('/login', [\r\n  body('identifier').notEmpty().trim(),\r\n  body('password').notEmpty().trim(),\r\n  body('rememberMe').optional().isBoolean(),\r\n  body('captcha').optional().isString(),\r\n  body('deviceFingerprint').optional().isString()\r\n], handleValidationErrors,\r\n  loginSecurityMiddleware.enforce(),\r\n  async (req, res) => {\r\n  const { identifier, password, rememberMe, captcha, deviceFingerprint } = req.body;\r\n\r\n  try {\r\n\r\n    // Determine if identifier is email or phone\r\n    const isEmail = identifier.includes('@');\r\n    let user;\r\n    let loginType;\r\n\r\n    if (isEmail) {\r\n      // Validate email format\r\n      if (!emailService.validateEmail(identifier)) {\r\n        return res.status(400).json({\r\n          error: 'Invalid email format',\r\n          message: 'Please provide a valid email address',\r\n          messageBn: 'অনুগ্রহ ইমেল ঠিকানা দিন'\r\n        });\r\n      }\r\n      \r\n      // Find user by email\r\n      user = await prisma.user.findUnique({\r\n        where: { email: identifier }\r\n      });\r\n      loginType = 'email';\r\n    } else {\r\n      // Validate phone number\r\n      const phoneValidation = phoneValidationService.validateForUseCase(identifier, 'login');\r\n      if (!phoneValidation.isValid) {\r\n        return res.status(400).json({\r\n          error: 'Invalid phone format',\r\n          message: phoneValidation.error,\r\n          messageBn: phoneValidation.errorBn,\r\n          code: phoneValidation.code\r\n        });\r\n      }\r\n      \r\n      // Find user by phone\r\n      user = await prisma.user.findUnique({\r\n        where: { phone: phoneValidation.normalizedPhone }\r\n      });\r\n      loginType = 'phone';\r\n    }\r\n\r\n    if (!user || !user.password) {\r\n      return res.status(401).json({\r\n        error: 'Invalid credentials',\r\n        message: `Invalid ${loginType} or password`,\r\n        messageBn: loginType === 'email' ? 'অবৈধ ইমেল বা পাসওয়ার্ড' : 'অবৈধ ফোন বা পাসওয়ার্ড'\r\n      });\r\n    }\r\n\r\n    // Verify password\r\n    const isValidPassword = await bcrypt.compare(password, user.password);\r\n    if (!isValidPassword) {\r\n      return res.status(401).json({\r\n        error: 'Invalid credentials',\r\n        message: `Invalid ${loginType} or password`,\r\n        messageBn: loginType === 'email' ? 'অবৈধ ইমেল বা পাসওয়ার্ড' : 'অবৈধ ফোন বা পাসওয়ার্ড'\r\n      });\r\n    }\r\n\r\n    // Check if user is verified (skip if testing mode or verification disabled)\r\n    const isTestingMode = configService.isTestingMode();\r\n    const isEmailVerificationDisabled = configService.isEmailVerificationDisabled();\r\n    const isPhoneVerificationDisabled = configService.isPhoneVerificationDisabled();\r\n    \r\n    const requiresVerification =\r\n      (loginType === 'email' && !isEmailVerificationDisabled) ||\r\n      (loginType === 'phone' && !isPhoneVerificationDisabled);\r\n    \r\n    if (user.status === 'PENDING' && requiresVerification && !isTestingMode) {\r\n      const verificationMessage = loginType === 'email'\r\n        ? 'Please verify your email address before logging in'\r\n        : 'Please verify your phone number before logging in';\r\n      const verificationMessageBn = loginType === 'email'\r\n        ? 'লগিন করার আগে ইমেল যাচাই করুন'\r\n        : 'লগিন করার আগে ফোন নম্বর যাচাই করুন';\r\n      \r\n      return res.status(403).json({\r\n        error: 'Account not verified',\r\n        message: verificationMessage,\r\n        messageBn: verificationMessageBn,\r\n        requiresVerification: true,\r\n        verificationType: loginType\r\n      });\r\n    }\r\n    \r\n    // Auto-activate pending users in testing mode or when verification is disabled\r\n    if (user.status === 'PENDING' && (isTestingMode || !requiresVerification)) {\r\n      await prisma.user.update({\r\n        where: { id: user.id },\r\n        data: {\r\n          status: 'ACTIVE',\r\n          emailVerified: loginType === 'email' ? new Date() : user.emailVerified,\r\n          phoneVerified: loginType === 'phone' ? new Date() : user.phoneVerified\r\n        }\r\n      });\r\n      \r\n      // Refresh user data after update\r\n      user = await prisma.user.findUnique({\r\n        where: { id: user.id },\r\n        select: {\r\n          id: true,\r\n          email: true,\r\n          phone: true,\r\n          firstName: true,\r\n          lastName: true,\r\n          role: true,\r\n          status: true,\r\n          emailVerified: true,\r\n          phoneVerified: true\r\n        }\r\n      });\r\n    }\r\n\r\n    // Update last login\r\n    await prisma.user.update({\r\n      where: { id: user.id },\r\n      data: { lastLoginAt: new Date() }\r\n    });\r\n\r\n    // Create secure session instead of JWT token\r\n    const sessionResult = await sessionService.createSession(user.id, req, {\r\n      loginType,\r\n      rememberMe: rememberMe || false,\r\n      maxAge: rememberMe ? 7 * 24 * 60 * 60 * 1000 : 24 * 60 * 60 * 1000 // 7 days if remember me, 24 hours default\r\n    });\r\n\r\n    if (!sessionResult.sessionId) {\r\n      return res.status(500).json({\r\n        error: 'Login failed',\r\n        message: 'Unable to create session',\r\n        messageBn: 'লগিন ব্যর্থ হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Set session cookie with remember me options\r\n    sessionMiddleware.setSessionCookie(res, sessionResult.sessionId, {\r\n      maxAge: sessionResult.maxAge,\r\n      rememberMe: rememberMe || false\r\n    });\r\n\r\n    // Add session headers\r\n    const sessionHeaders = sessionMiddleware.sessionHeaders(sessionResult);\r\n    Object.keys(sessionHeaders).forEach(key => {\r\n      res.set(key, sessionHeaders[key]);\r\n    });\r\n\r\n    // Generate JWT token for API compatibility (shorter expiry)\r\n    const jwtSecretLogin = process.env.JWT_SECRET;\r\n    if (!jwtSecretLogin) {\r\n      throw new Error('JWT_SECRET environment variable is required');\r\n    }\r\n    \r\n    const token = jwt.sign(\r\n      {\r\n        userId: user.id,\r\n        email: user.email,\r\n        phone: user.phone,\r\n        role: user.role,\r\n        sessionId: sessionResult.sessionId\r\n      },\r\n      jwtSecretLogin,\r\n      { expiresIn: process.env.JWT_EXPIRES_IN || '15m' } // Shorter expiry for JWT, session manages long-term auth\r\n    );\r\n\r\n\r\n    // Record successful login and clear failed attempts\r\n    return loginSecurityMiddleware.recordSuccessfulLogin(req, { id: user.id }, (req, res) => {\r\n      res.json({\r\n        message: 'Login successful',\r\n        messageBn: 'লগিন সফল',\r\n        user: {\r\n          id: user.id,\r\n          email: user.email,\r\n          phone: user.phone,\r\n          firstName: user.firstName,\r\n          lastName: user.lastName,\r\n          role: user.role,\r\n          status: user.status\r\n        },\r\n        token, // For API compatibility\r\n        sessionId: sessionResult.sessionId,\r\n        expiresAt: sessionResult.expiresAt,\r\n        maxAge: sessionResult.maxAge,\r\n        loginType,\r\n        rememberMe: rememberMe || false,\r\n        securityContext: req.securityContext\r\n      });\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Login error:', error);\r\n    console.error('Login error details:', {\r\n      name: error.name,\r\n      message: error.message,\r\n      stack: error.stack\r\n    });\r\n    \r\n    // Record failed attempt due to system error\r\n    req.authError = 'system_error';\r\n    return loginSecurityMiddleware.recordFailedLogin()(req, res, () => {\r\n      res.status(500).json({\r\n        error: 'Login failed',\r\n        message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n        messageBn: 'লগিন ব্যর্থ হয়েছে'\r\n      });\r\n    });\r\n  }\r\n});\r\n\r\n// Basic captcha validation function (integrate with actual captcha service)\r\nasync function validateCaptcha(captcha, ip) {\r\n  // This is a placeholder - integrate with reCAPTCHA, hCaptcha, or similar\r\n  // For now, we'll accept any captcha if security doesn't require it\r\n  return true;\r\n}\r\n\r\n// Logout endpoint\r\nrouter.post('/logout', [\r\n  body('allDevices').optional().isBoolean()\r\n], async (req, res) => {\r\n  try {\r\n    const { allDevices } = req.body;\r\n    const sessionId = sessionMiddleware.getSessionId(req);\r\n\r\n    if (!sessionId) {\r\n      return res.status(400).json({\r\n        error: 'No session found',\r\n        message: 'No active session to logout',\r\n        messageBn: 'লগআউট করার জন্য কোনো সেশন পাওয়া যায়নি'\r\n      });\r\n    }\r\n\r\n    // Validate session to get user ID\r\n    const validation = await sessionService.validateSession(sessionId, req);\r\n    \r\n    if (!validation.valid) {\r\n      // Clear session cookie anyway\r\n      sessionMiddleware.clearSessionCookie(res);\r\n      \r\n      return res.json({\r\n        message: 'Logout successful',\r\n        messageBn: 'লগআউট সফল',\r\n        sessionExpired: true\r\n      });\r\n    }\r\n\r\n    let result;\r\n    if (allDevices) {\r\n      // Destroy all sessions for this user\r\n      result = await sessionService.destroyAllUserSessions(validation.userId, sessionId);\r\n    } else {\r\n      // Destroy current session only\r\n      result = await sessionService.destroySession(sessionId, 'user_logout');\r\n    }\r\n\r\n    if (!result.success) {\r\n      return res.status(500).json({\r\n        error: 'Logout failed',\r\n        message: result.reason,\r\n        messageBn: 'লগআউট ব্যর্থ হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Clear session cookie\r\n    sessionMiddleware.clearSessionCookie(res);\r\n\r\n    res.json({\r\n      message: 'Logout successful',\r\n      messageBn: 'লগআউট সফল',\r\n      allDevices: allDevices || false,\r\n      destroyedCount: allDevices ? result.destroyedCount : 1\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Logout error:', error);\r\n    res.status(500).json({\r\n      error: 'Logout failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'লগআউট ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Refresh token endpoint\r\nrouter.post('/refresh', async (req, res) => {\r\n  try {\r\n    const { token } = req.body;\r\n\r\n    if (!token) {\r\n      return res.status(401).json({\r\n        error: 'Token required',\r\n        messageBn: 'টোকেন প্রয়োজন'\r\n      });\r\n    }\r\n\r\n    // Verify token\r\n    const jwtSecretRefresh = process.env.JWT_SECRET;\r\n    if (!jwtSecretRefresh) {\r\n      throw new Error('JWT_SECRET environment variable is required');\r\n    }\r\n    \r\n    const decoded = jwt.verify(token, jwtSecretRefresh);\r\n    \r\n    // Get user info\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: decoded.userId },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        firstName: true,\r\n        lastName: true,\r\n        role: true,\r\n        status: true\r\n      }\r\n    });\r\n\r\n    if (!user) {\r\n      return res.status(401).json({\r\n        error: 'User not found',\r\n        messageBn: 'ব্যবহার্টার পাওয়া যায়নি'\r\n      });\r\n    }\r\n\r\n    // Generate new token\r\n    const jwtSecretNew = process.env.JWT_SECRET;\r\n    if (!jwtSecretNew) {\r\n      throw new Error('JWT_SECRET environment variable is required');\r\n    }\r\n    \r\n    const newToken = jwt.sign(\r\n      { userId: user.id, email: user.email, role: user.role },\r\n      jwtSecretNew,\r\n      { expiresIn: process.env.JWT_EXPIRES_IN || '7d' }\r\n    );\r\n\r\n    res.json({\r\n      message: 'Token refreshed successfully',\r\n      messageBn: 'টোকেন সফল হয়েছে',\r\n      user,\r\n      token: newToken\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Token refresh error:', error);\r\n    res.status(401).json({\r\n      error: 'Invalid token',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Token expired or invalid',\r\n      messageBn: 'টোকেন মেয়াদীপূর্ণ বা অবৈধ'\r\n    });\r\n  }\r\n});\r\n\r\n// Email verification endpoint\r\nrouter.post('/verify-email', [\r\n  body('token').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { token } = req.body;\r\n\r\n    if (!token) {\r\n      return res.status(400).json({\r\n        error: 'Token required',\r\n        message: 'Verification token is required',\r\n        messageBn: 'যাচাই টোকেন প্রয়োজন'\r\n      });\r\n    }\r\n\r\n    // Find verification token\r\n    const verificationToken = await prisma.emailVerificationToken.findUnique({\r\n      where: { token },\r\n      include: {\r\n        user: true\r\n      }\r\n    });\r\n\r\n    if (!verificationToken) {\r\n      return res.status(400).json({\r\n        error: 'Invalid token',\r\n        message: 'Verification token is invalid or has been used',\r\n        messageBn: 'যাচাই টোকেন অবৈধ বা ব্যবহার হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Check if token has expired\r\n    if (verificationToken.expiresAt < new Date()) {\r\n      // Delete expired token\r\n      await prisma.emailVerificationToken.delete({\r\n        where: { id: verificationToken.id }\r\n      });\r\n\r\n      return res.status(400).json({\r\n        error: 'Token expired',\r\n        message: 'Verification token has expired. Please request a new one.',\r\n        messageBn: 'যাচাই টোকেন মেয়াদীপূর্ণ হয়েছে। নতুন একটি অনুরোধ করুন।'\r\n      });\r\n    }\r\n\r\n    // Check if user is already verified\r\n    if (verificationToken.user.emailVerified) {\r\n      return res.status(400).json({\r\n        error: 'Already verified',\r\n        message: 'Email has already been verified',\r\n        messageBn: 'ইমেল আগেই যাচাই হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Update user status and email verification timestamp\r\n    const updatedUser = await prisma.user.update({\r\n      where: { id: verificationToken.userId },\r\n      data: {\r\n        status: 'ACTIVE',\r\n        emailVerified: new Date()\r\n      },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        firstName: true,\r\n        lastName: true,\r\n        role: true,\r\n        status: true,\r\n        emailVerified: true\r\n      }\r\n    });\r\n\r\n    // Delete verification token\r\n    await prisma.emailVerificationToken.delete({\r\n      where: { id: verificationToken.id }\r\n    });\r\n\r\n    // Send welcome email\r\n    await emailService.sendWelcomeEmail(\r\n      verificationToken.user.email,\r\n      `${verificationToken.user.firstName} ${verificationToken.user.lastName}`\r\n    );\r\n\r\n    res.json({\r\n      message: 'Email verified successfully',\r\n      messageBn: 'ইমেল সফল যাচাই হয়েছে',\r\n      user: updatedUser\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Email verification error:', error);\r\n    res.status(500).json({\r\n      error: 'Verification failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'যাচাই ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Resend verification email endpoint\r\nrouter.post('/resend-verification', [\r\n  body('email').isEmail().normalizeEmail()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { email } = req.body;\r\n\r\n    // Find user\r\n    const user = await prisma.user.findUnique({\r\n      where: { email },\r\n      include: {\r\n        emailVerificationTokens: {\r\n          where: {\r\n            expiresAt: {\r\n              gt: new Date()\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    if (!user) {\r\n      return res.status(404).json({\r\n        error: 'User not found',\r\n        message: 'No account found with this email address',\r\n        messageBn: 'এই ইমেল ঠিকানা কোনো ব্যবহার্টার পাওয়া যায়নি'\r\n      });\r\n    }\r\n\r\n    // Check if email is already verified\r\n    if (user.emailVerified) {\r\n      return res.status(400).json({\r\n        error: 'Already verified',\r\n        message: 'Email has already been verified',\r\n        messageBn: 'ইমেল আগেই যাচাই হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Check if there's already a recent verification token (within 5 minutes)\r\n    const recentToken = user.emailVerificationTokens[0];\r\n    if (recentToken && (Date.now() - recentToken.createdAt.getTime()) < 5 * 60 * 1000) {\r\n      return res.status(429).json({\r\n        error: 'Too many requests',\r\n        message: 'Please wait before requesting another verification email',\r\n        messageBn: 'অন্য যাচাই ইমেল অনুরোধ করার জন্য অপেক্ষা করুন'\r\n      });\r\n    }\r\n\r\n    // Delete any existing tokens for this user\r\n    await prisma.emailVerificationToken.deleteMany({\r\n      where: { userId: user.id }\r\n    });\r\n\r\n    // Generate new verification token\r\n    const verificationToken = emailService.generateVerificationToken();\r\n    const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\r\n\r\n    // Save new verification token\r\n    await prisma.emailVerificationToken.create({\r\n      data: {\r\n        userId: user.id,\r\n        token: verificationToken,\r\n        expiresAt\r\n      }\r\n    });\r\n\r\n    // Send verification email\r\n    const emailResult = await emailService.sendVerificationEmail(\r\n      email,\r\n      `${user.firstName} ${user.lastName}`,\r\n      verificationToken\r\n    );\r\n\r\n    if (!emailResult.success) {\r\n      return res.status(500).json({\r\n        error: 'Failed to send email',\r\n        message: 'Unable to send verification email. Please try again later.',\r\n        messageBn: 'যাচাই ইমেল পাঠানো ব্যর্থ হয়েছে। অনুগ্রহ চেষ্টা করুন।'\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      message: 'Verification email sent successfully',\r\n      messageBn: 'যাচাই ইমেল সফল পাঠানো হয়েছে',\r\n      email: email\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Resend verification error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to resend verification',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'যাচাই পুনরায়া পাঠানো ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Send OTP endpoint\r\nrouter.post('/send-otp', [\r\n  body('phone').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { phone } = req.body;\r\n\r\n    // Validate phone number with enhanced service\r\n    const phoneValidation = phoneValidationService.validateForUseCase(phone, 'otp');\r\n    if (!phoneValidation.isValid) {\r\n      return res.status(400).json({\r\n        error: 'Invalid phone format',\r\n        message: phoneValidation.error,\r\n        messageBn: phoneValidation.errorBn,\r\n        code: phoneValidation.code\r\n      });\r\n    }\r\n\r\n    const normalizedPhone = phoneValidation.normalizedPhone;\r\n\r\n    // Check if phone is already verified\r\n    const isVerified = await otpService.isPhoneVerified(normalizedPhone);\r\n    if (isVerified) {\r\n      return res.status(400).json({\r\n        error: 'Phone already verified',\r\n        message: 'This phone number is already registered and verified',\r\n        messageBn: 'এই ফোন নম্বর আগেই নিবন্ধন ও যাচাই হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Generate and send OTP\r\n    const otpResult = await otpService.generatePhoneOTP(normalizedPhone);\r\n\r\n    if (!otpResult.success) {\r\n      return res.status(400).json({\r\n        error: 'Failed to send OTP',\r\n        message: otpResult.error,\r\n        messageBn: otpResult.errorBn,\r\n        code: otpResult.code\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      message: 'OTP sent successfully',\r\n      messageBn: 'OTP সফল পাঠানো হয়েছে',\r\n      phone: normalizedPhone,\r\n      operator: otpResult.operator,\r\n      operatorDetails: otpResult.operatorDetails,\r\n      expiresAt: otpResult.expiresAt,\r\n      mock: otpResult.mock || false\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Send OTP error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to send OTP',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'OTP পাঠানো ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Verify OTP endpoint\r\nrouter.post('/verify-otp', [\r\n  body('phone').notEmpty().trim(),\r\n  body('otp').notEmpty().trim().isLength({ min: 6, max: 6 })\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { phone, otp } = req.body;\r\n\r\n    // Validate phone number with enhanced service\r\n    const phoneValidation = phoneValidationService.validateForUseCase(phone, 'otp');\r\n    if (!phoneValidation.isValid) {\r\n      return res.status(400).json({\r\n        error: 'Invalid phone format',\r\n        message: phoneValidation.error,\r\n        messageBn: phoneValidation.errorBn,\r\n        code: phoneValidation.code\r\n      });\r\n    }\r\n\r\n    const normalizedPhone = phoneValidation.normalizedPhone;\r\n\r\n    // Verify OTP\r\n    const verifyResult = await otpService.verifyPhoneOTP(normalizedPhone, otp);\r\n\r\n    if (!verifyResult.success) {\r\n      return res.status(400).json({\r\n        error: 'OTP verification failed',\r\n        message: verifyResult.error,\r\n        messageBn: verifyResult.errorBn,\r\n        code: verifyResult.code\r\n      });\r\n    }\r\n\r\n    // If OTP was for registration, find and update user\r\n    if (verifyResult.userId) {\r\n      const user = await prisma.user.findUnique({\r\n        where: { id: verifyResult.userId },\r\n        select: {\r\n          id: true,\r\n          email: true,\r\n          firstName: true,\r\n          lastName: true,\r\n          phone: true,\r\n          role: true,\r\n          status: true,\r\n          phoneVerified: true\r\n        }\r\n      });\r\n\r\n      if (user) {\r\n        return res.json({\r\n          message: 'Phone verified successfully. Account is now active.',\r\n          messageBn: 'ফোন সফল যাচাই হয়েছে। অ্যাকাউন্ট এখন সক্রিয়।',\r\n          user,\r\n          verifiedAt: verifyResult.verifiedAt\r\n        });\r\n      }\r\n    }\r\n\r\n    res.json({\r\n      message: 'OTP verified successfully',\r\n      messageBn: 'OTP সফল যাচাই হয়েছে',\r\n      phone: normalizedPhone,\r\n      verifiedAt: verifyResult.verifiedAt\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Verify OTP error:', error);\r\n    res.status(500).json({\r\n      error: 'OTP verification failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'OTP যাচাই ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Resend OTP endpoint\r\nrouter.post('/resend-otp', [\r\n  body('phone').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { phone } = req.body;\r\n\r\n    // Validate phone number with enhanced service\r\n    const phoneValidation = phoneValidationService.validateForUseCase(phone, 'otp');\r\n    if (!phoneValidation.isValid) {\r\n      return res.status(400).json({\r\n        error: 'Invalid phone format',\r\n        message: phoneValidation.error,\r\n        messageBn: phoneValidation.errorBn,\r\n        code: phoneValidation.code\r\n      });\r\n    }\r\n\r\n    const normalizedPhone = phoneValidation.normalizedPhone;\r\n\r\n    // Resend OTP\r\n    const resendResult = await otpService.resendPhoneOTP(normalizedPhone);\r\n\r\n    if (!resendResult.success) {\r\n      return res.status(400).json({\r\n        error: 'Failed to resend OTP',\r\n        message: resendResult.error,\r\n        messageBn: resendResult.errorBn,\r\n        code: resendResult.code,\r\n        waitTime: resendResult.waitTime\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      message: 'OTP resent successfully',\r\n      messageBn: 'OTP পুনরায়া পাঠানো হয়েছে',\r\n      phone: normalizedPhone,\r\n      operator: resendResult.operator,\r\n      operatorDetails: resendResult.operatorDetails,\r\n      expiresAt: resendResult.expiresAt,\r\n      mock: resendResult.mock || false\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Resend OTP error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to resend OTP',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'OTP পুনরায়া ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Change password endpoint\r\nrouter.post('/change-password', [\r\n  authMiddleware.authenticate(),\r\n  body('currentPassword').notEmpty().trim(),\r\n  body('newPassword').isLength({ min: 8, max: 128 }),\r\n  body('confirmPassword').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { currentPassword, newPassword, confirmPassword } = req.body;\r\n    const userId = req.user.id;\r\n\r\n    // Check if new passwords match\r\n    if (newPassword !== confirmPassword) {\r\n      return res.status(400).json({\r\n        error: 'Passwords do not match',\r\n        message: 'New password and confirmation password must be same',\r\n        messageBn: 'নতুন পাসওয়ার্ড একই হবি হতে হবে'\r\n      });\r\n    }\r\n\r\n    // Get user with current password\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: userId },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        firstName: true,\r\n        lastName: true,\r\n        phone: true,\r\n        password: true\r\n      }\r\n    });\r\n\r\n    if (!user) {\r\n      return res.status(404).json({\r\n        error: 'User not found',\r\n        message: 'User account not found',\r\n        messageBn: 'ব্যবহার্টার পাওয়া যায়নি'\r\n      });\r\n    }\r\n\r\n    // Verify current password\r\n    const isCurrentPasswordValid = await passwordService.verifyPassword(currentPassword, user.password);\r\n    if (!isCurrentPasswordValid) {\r\n      return res.status(401).json({\r\n        error: 'Invalid current password',\r\n        message: 'The current password you entered is incorrect',\r\n        messageBn: 'আপনি যে পাসওয়ার্ড দিয়েছেন সেটা ভুল'\r\n      });\r\n    }\r\n\r\n    // Check if new password is same as current password\r\n    const isSameAsCurrent = await passwordService.verifyPassword(newPassword, user.password);\r\n    if (isSameAsCurrent) {\r\n      return res.status(400).json({\r\n        error: 'Same password',\r\n        message: 'New password must be different from current password',\r\n        messageBn: 'নতুন পাসওয়ার্ড বর্তমান পাসওয়ার্ড থেকে হতে হবে'\r\n      });\r\n    }\r\n\r\n    // Validate new password strength\r\n    const userInfo = {\r\n      firstName: user.firstName,\r\n      lastName: user.lastName,\r\n      email: user.email,\r\n      phone: user.phone\r\n    };\r\n    const passwordValidation = passwordService.validatePasswordStrength(newPassword, userInfo);\r\n    \r\n    if (!passwordValidation.isValid) {\r\n      return res.status(400).json({\r\n        error: 'Password does not meet requirements',\r\n        message: 'New password is too weak or does not meet security requirements',\r\n        messageBn: 'নতুন পাসওয়ার্ড খুবই বা নিরাপত্তিগিয় পূর্ব',\r\n        details: {\r\n          strength: passwordValidation.strength,\r\n          score: passwordValidation.score,\r\n          feedback: passwordValidation.feedback,\r\n          warnings: passwordValidation.warnings,\r\n          suggestions: passwordValidation.suggestions,\r\n          passwordPolicy: passwordService.getPasswordPolicy()\r\n        }\r\n      });\r\n    }\r\n\r\n    // Check if password has been used before\r\n    const isPasswordReused = await passwordService.isPasswordReused(userId, newPassword);\r\n    if (isPasswordReused) {\r\n      return res.status(400).json({\r\n        error: 'Password already used',\r\n        message: 'You cannot reuse a password that has been used in the last 5 changes',\r\n        messageBn: 'আপনি শেষ 5টি পাসওয়ার্ড পরিবর্তন ব্যবহার করা পাসওয়ার্ড ব্যবহার করতে পারেন'\r\n      });\r\n    }\r\n\r\n    // Hash new password\r\n    const hashedNewPassword = await passwordService.hashPassword(newPassword);\r\n\r\n    // Update user password\r\n    await prisma.user.update({\r\n      where: { id: userId },\r\n      data: { password: hashedNewPassword }\r\n    });\r\n\r\n    // Save new password to history\r\n    await passwordService.savePasswordToHistory(userId, hashedNewPassword);\r\n\r\n    // Log password change (you might want to add proper logging here)\r\n    console.log(`Password changed for user ${userId} at ${new Date().toISOString()}`);\r\n\r\n    res.json({\r\n      message: 'Password changed successfully',\r\n      messageBn: 'পাসওয়ার্ড সফল হয়েছে',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Change password error:', error);\r\n    res.status(500).json({\r\n      error: 'Password change failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'পাসওয়ার্ড পরিবর্তন ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Request password reset endpoint\r\nrouter.post('/forgot-password', [\r\n  body('email').isEmail().normalizeEmail()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { email } = req.body;\r\n\r\n    // Find user\r\n    const user = await prisma.user.findUnique({\r\n      where: { email }\r\n    });\r\n\r\n    if (!user) {\r\n      // Don't reveal if user exists or not for security\r\n      return res.json({\r\n        message: 'If an account with that email exists, a password reset link has been sent',\r\n        messageBn: 'যদি এই ইমেল ঠিকানা কোনো অ্যাকাউন্ট থাকলে, একটি পাসওয়ার্ড রিসেট লিঙ্ক পাঠানো হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Generate reset token (you might want to use a separate token service)\r\n    const resetToken = emailService.generateVerificationToken();\r\n    const expiresAt = new Date(Date.now() + 1 * 60 * 60 * 1000); // 1 hour\r\n\r\n    // Save reset token (using email verification token table for simplicity)\r\n    await prisma.emailVerificationToken.create({\r\n      data: {\r\n        userId: user.id,\r\n        token: resetToken,\r\n        expiresAt\r\n      }\r\n    });\r\n\r\n    // Generate temporary strong password\r\n    const temporaryPassword = passwordService.generateStrongPassword(12);\r\n    const hashedTempPassword = await passwordService.hashPassword(temporaryPassword);\r\n\r\n    // Update user with temporary password\r\n    await prisma.user.update({\r\n      where: { id: user.id },\r\n      data: { password: hashedTempPassword }\r\n    });\r\n\r\n    // Save temporary password to history\r\n    await passwordService.savePasswordToHistory(user.id, hashedTempPassword);\r\n\r\n    // Send reset email with temporary password\r\n    const emailResult = await emailService.sendPasswordResetEmail(\r\n      email,\r\n      `${user.firstName} ${user.lastName}`,\r\n      temporaryPassword,\r\n      resetToken\r\n    );\r\n\r\n    if (!emailResult.success) {\r\n      return res.status(500).json({\r\n        error: 'Failed to send reset email',\r\n        message: 'Unable to send password reset email. Please try again later.',\r\n        messageBn: 'পাসওয়ার্ড রিসেট ইমেল পাঠানো ব্যর্থ হয়েছে। অনুগ্রহ চেষ্টা করুন।'\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      message: 'Password reset email sent successfully',\r\n      messageBn: 'পাসওয়ার্ড রিসেট ইমেল সফল পাঠানো হয়েছে',\r\n      email: email\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Forgot password error:', error);\r\n    res.status(500).json({\r\n      error: 'Password reset failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'পাসওয়ার্ড রিসেট ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Reset password endpoint (with token)\r\nrouter.post('/reset-password', [\r\n  body('token').notEmpty().trim(),\r\n  body('newPassword').isLength({ min: 8, max: 128 }),\r\n  body('confirmPassword').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { token, newPassword, confirmPassword } = req.body;\r\n\r\n    // Check if new passwords match\r\n    if (newPassword !== confirmPassword) {\r\n      return res.status(400).json({\r\n        error: 'Passwords do not match',\r\n        message: 'New password and confirmation password must be same',\r\n        messageBn: 'নতুন পাসওয়ার্ড একই হবি হতে হবে'\r\n      });\r\n    }\r\n\r\n    // Find reset token\r\n    const resetToken = await prisma.emailVerificationToken.findUnique({\r\n      where: { token },\r\n      include: {\r\n        user: true\r\n      }\r\n    });\r\n\r\n    if (!resetToken) {\r\n      return res.status(400).json({\r\n        error: 'Invalid token',\r\n        message: 'Password reset token is invalid or has been used',\r\n        messageBn: 'পাসওয়ার্ড রিসেট টোকেন অবৈধ বা ব্যবহার হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Check if token has expired\r\n    if (resetToken.expiresAt < new Date()) {\r\n      // Delete expired token\r\n      await prisma.emailVerificationToken.delete({\r\n        where: { id: resetToken.id }\r\n      });\r\n\r\n      return res.status(400).json({\r\n        error: 'Token expired',\r\n        message: 'Password reset token has expired. Please request a new one.',\r\n        messageBn: 'পাসওয়ার্ড রিসেট টোকেন মেয়াদীপূর্ণ হয়েছে। নতুন একটি অনুরোধ করুন।'\r\n      });\r\n    }\r\n\r\n    // Validate new password strength\r\n    const userInfo = {\r\n      firstName: resetToken.user.firstName,\r\n      lastName: resetToken.user.lastName,\r\n      email: resetToken.user.email,\r\n      phone: resetToken.user.phone\r\n    };\r\n    const passwordValidation = passwordService.validatePasswordStrength(newPassword, userInfo);\r\n    \r\n    if (!passwordValidation.isValid) {\r\n      return res.status(400).json({\r\n        error: 'Password does not meet requirements',\r\n        message: 'New password is too weak or does not meet security requirements',\r\n        messageBn: 'নতুন পাসওয়ার্ড খুবই বা নিরাপত্তিগিয় পূর্ব',\r\n        details: {\r\n          strength: passwordValidation.strength,\r\n          score: passwordValidation.score,\r\n          feedback: passwordValidation.feedback,\r\n          warnings: passwordValidation.warnings,\r\n          suggestions: passwordValidation.suggestions,\r\n          passwordPolicy: passwordService.getPasswordPolicy()\r\n        }\r\n      });\r\n    }\r\n\r\n    // Check if password has been used before\r\n    const isPasswordReused = await passwordService.isPasswordReused(resetToken.userId, newPassword);\r\n    if (isPasswordReused) {\r\n      return res.status(400).json({\r\n        error: 'Password already used',\r\n        message: 'You cannot reuse a password that has been used in the last 5 changes',\r\n        messageBn: 'আপনি শেষ 5টি পাসওয়ার্ড পরিবর্তন ব্যবহার করা পাসওয়ার্ড ব্যবহার করতে পারেন'\r\n      });\r\n    }\r\n\r\n    // Hash new password\r\n    const hashedNewPassword = await passwordService.hashPassword(newPassword);\r\n\r\n    // Update user password\r\n    await prisma.user.update({\r\n      where: { id: resetToken.userId },\r\n      data: { password: hashedNewPassword }\r\n    });\r\n\r\n    // Save new password to history\r\n    await passwordService.savePasswordToHistory(resetToken.userId, hashedNewPassword);\r\n\r\n    // Delete reset token\r\n    await prisma.emailVerificationToken.delete({\r\n      where: { id: resetToken.id }\r\n    });\r\n\r\n    // Update user status to active if pending\r\n    if (resetToken.user.status === 'PENDING') {\r\n      await prisma.user.update({\r\n        where: { id: resetToken.userId },\r\n        data: { status: 'ACTIVE' }\r\n      });\r\n    }\r\n\r\n    // Log password reset\r\n    console.log(`Password reset for user ${resetToken.userId} at ${new Date().toISOString()}`);\r\n\r\n    res.json({\r\n      message: 'Password reset successfully',\r\n      messageBn: 'পাসওয়ার্ড সফল হয়েছে',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Reset password error:', error);\r\n    res.status(500).json({\r\n      error: 'Password reset failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'পাসওয়ার্ড রিসেট ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Get password policy endpoint\r\nrouter.get('/password-policy', async (req, res) => {\r\n  try {\r\n    const policy = passwordService.getPasswordPolicy();\r\n    \r\n    res.json({\r\n      policy,\r\n      message: 'Current password policy requirements',\r\n      messageBn: 'বর্তমান পাসওয়ার্ড নীতিমালা'\r\n    });\r\n  } catch (error) {\r\n    console.error('Get password policy error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to get password policy',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'পাসওয়ার্ড নীতিমালা পাওতে ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Get phone validation info endpoint\r\nrouter.post('/validate-phone', [\r\n  body('phone').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { phone } = req.body;\r\n\r\n    const validation = phoneValidationService.validateBangladeshPhoneNumber(phone);\r\n\r\n    res.json({\r\n      validation,\r\n      message: validation.isValid ? 'Valid phone number' : 'Invalid phone number',\r\n      messageBn: validation.isValid ? 'বৈধ ফোন নম্বর' : 'অবৈধ ফোন নম্বর'\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Phone validation error:', error);\r\n    res.status(500).json({\r\n      error: 'Validation failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'যাচাই ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Get supported operators endpoint\r\nrouter.get('/operators', async (req, res) => {\r\n  try {\r\n    const operators = phoneValidationService.getSupportedOperators();\r\n\r\n    res.json({\r\n      operators,\r\n      message: 'Supported mobile operators',\r\n      messageBn: 'সমর্থিত মোবাইল অপারেটর'\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Get operators error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to get operators',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'অপারেটর পাওতে ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Remember me token validation endpoint\r\nrouter.post('/validate-remember-me', [\r\n  body('token').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { token } = req.body;\r\n\r\n    if (!token) {\r\n      return res.status(400).json({\r\n        error: 'Token required',\r\n        message: 'Remember me token is required',\r\n        messageBn: 'রিমেম্বার মি টোকেন প্রয়োজন'\r\n      });\r\n    }\r\n\r\n    // Validate remember me token\r\n    const validation = await sessionService.validateRememberMeToken(token);\r\n    \r\n    if (!validation.valid) {\r\n      return res.status(400).json({\r\n        error: 'Invalid token',\r\n        message: validation.reason || 'Remember me token is invalid or expired',\r\n        messageBn: validation.reason || 'রিমেম্বার মি টোকেন অবৈধ বা মেয়াদীপূর্ণ'\r\n      });\r\n    }\r\n\r\n    // Get user details\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: validation.userId },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        firstName: true,\r\n        lastName: true,\r\n        phone: true,\r\n        role: true,\r\n        status: true\r\n      }\r\n    });\r\n\r\n    if (!user) {\r\n      return res.status(404).json({\r\n        error: 'User not found',\r\n        message: 'User account not found',\r\n        messageBn: 'ব্যবহার্টার পাওয়া যায়নি'\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      message: 'Remember me token is valid',\r\n      messageBn: 'রিমেম্বার মি টোকেন বৈধ',\r\n      user,\r\n      tokenValid: true,\r\n      createdAt: validation.createdAt\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Remember me token validation error:', error);\r\n    res.status(500).json({\r\n      error: 'Validation failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'যাচাই ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Refresh session using remember me token\r\nrouter.post('/refresh-from-remember-me', [\r\n  body('token').notEmpty().trim()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { token } = req.body;\r\n\r\n    if (!token) {\r\n      return res.status(400).json({\r\n        error: 'Token required',\r\n        message: 'Remember me token is required',\r\n        messageBn: 'রিমেম্বার মি টোকেন প্রয়োজন'\r\n      });\r\n    }\r\n\r\n    // Refresh session using remember me token\r\n    const refreshResult = await sessionService.refreshFromRememberMeToken(token, req);\r\n    \r\n    if (!refreshResult.success) {\r\n      return res.status(400).json({\r\n        error: 'Session refresh failed',\r\n        message: refreshResult.reason || 'Failed to refresh session from remember me token',\r\n        messageBn: refreshResult.reason || 'রিমেম্বার মি টোকেন থেকে সেশন রিফ্রেশ ব্যর্থ হয়েছে'\r\n      });\r\n    }\r\n\r\n    // Get user details\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: refreshResult.userId },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        firstName: true,\r\n        lastName: true,\r\n        phone: true,\r\n        role: true,\r\n        status: true\r\n      }\r\n    });\r\n\r\n    if (!user) {\r\n      return res.status(404).json({\r\n        error: 'User not found',\r\n        message: 'User account not found',\r\n        messageBn: 'ব্যবহার্টার পাওয়া যায়নি'\r\n      });\r\n    }\r\n\r\n    // Set session cookie\r\n    sessionMiddleware.setSessionCookie(res, refreshResult.sessionId, {\r\n      maxAge: refreshResult.maxAge,\r\n      rememberMe: true\r\n    });\r\n\r\n    // Add session headers\r\n    const sessionHeaders = sessionMiddleware.sessionHeaders(refreshResult);\r\n    Object.keys(sessionHeaders).forEach(key => {\r\n      res.set(key, sessionHeaders[key]);\r\n    });\r\n\r\n    // Generate JWT token for API compatibility\r\n    const jwtSecretLogin = process.env.JWT_SECRET;\r\n    if (!jwtSecretLogin) {\r\n      throw new Error('JWT_SECRET environment variable is required');\r\n    }\r\n    \r\n    const jwtToken = jwt.sign(\r\n      {\r\n        userId: user.id,\r\n        email: user.email,\r\n        phone: user.phone,\r\n        role: user.role,\r\n        sessionId: refreshResult.sessionId\r\n      },\r\n      jwtSecretLogin,\r\n      { expiresIn: process.env.JWT_EXPIRES_IN || '15m' }\r\n    );\r\n\r\n    res.json({\r\n      message: 'Session refreshed successfully',\r\n      messageBn: 'সেশন সফল হয়েছে',\r\n      user,\r\n      token: jwtToken,\r\n      sessionId: refreshResult.sessionId,\r\n      expiresAt: refreshResult.expiresAt,\r\n      maxAge: refreshResult.maxAge,\r\n      rememberMe: true,\r\n      refreshedFrom: 'remember_me_token'\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Remember me session refresh error:', error);\r\n    res.status(500).json({\r\n      error: 'Session refresh failed',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'সেশন রিফ্রেশ ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\n// Disable remember me functionality\r\nrouter.post('/disable-remember-me', [\r\n  authMiddleware.authenticate(),\r\n  body('allDevices').optional().isBoolean()\r\n], handleValidationErrors, async (req, res) => {\r\n  try {\r\n    const { allDevices } = req.body;\r\n    const userId = req.user.id;\r\n    const currentSessionId = req.sessionId;\r\n\r\n    if (allDevices) {\r\n      // Destroy all remember me sessions for this user\r\n      const result = await sessionService.destroyAllUserSessions(userId, currentSessionId);\r\n      \r\n      // Clear remember me cookies\r\n      res.clearCookie('rememberMe');\r\n      res.clearCookie('rememberMeEnabled');\r\n\r\n      res.json({\r\n        message: 'Remember me disabled on all devices',\r\n        messageBn: 'সব ডিভাইসে রিমেম্বার মি নিষ্ক্রিয় করা হয়েছে',\r\n        allDevices: true,\r\n        destroyedCount: result.destroyedCount\r\n      });\r\n    } else {\r\n      // Destroy current session only\r\n      const result = await sessionService.destroySession(currentSessionId, 'disable_remember_me');\r\n      \r\n      // Clear remember me cookies\r\n      res.clearCookie('rememberMe');\r\n      res.clearCookie('rememberMeEnabled');\r\n\r\n      res.json({\r\n        message: 'Remember me disabled on current device',\r\n        messageBn: 'বর্তমান ডিভাইসে রিমেম্বার মি নিষ্ক্রিয় করা হয়েছে',\r\n        allDevices: false,\r\n        destroyedCount: 1\r\n      });\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Disable remember me error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to disable remember me',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error',\r\n      messageBn: 'রিমেম্বার মি নিষ্ক্রিয় করতে ব্যর্থ হয়েছে'\r\n    });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}