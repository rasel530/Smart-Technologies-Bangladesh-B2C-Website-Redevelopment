e8fa1e08572c0e2b5ce49b9380d66d52
const express = require('express');
const {
  body,
  param,
  validationResult
} = require('express-validator');
const {
  PrismaClient
} = require('@prisma/client');
const {
  authMiddleware
} = require('../middleware/auth');
const router = express.Router();
const prisma = new PrismaClient();

// Validation middleware
const handleValidationErrors = (req, res, next) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({
      error: 'Validation failed',
      details: errors.array()
    });
  }
  next();
};

// Get cart (user or guest)
router.get('/:cartId', [param('cartId').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      cartId
    } = req.params;
    const cart = await prisma.cart.findUnique({
      where: {
        id: cartId
      },
      include: {
        items: {
          include: {
            product: {
              include: {
                images: {
                  where: {
                    sortOrder: 0
                  },
                  take: 1,
                  select: {
                    id: true,
                    url: true,
                    alt: true
                  }
                }
              }
            },
            variant: true
          }
        }
      }
    });
    if (!cart) {
      return res.status(404).json({
        error: 'Cart not found'
      });
    }

    // Calculate totals
    const subtotal = cart.items.reduce((sum, item) => sum + parseFloat(item.totalPrice), 0);
    const tax = subtotal * 0.15; // 15% tax
    const shippingCost = 100; // Fixed shipping cost
    const total = subtotal + tax + shippingCost;
    res.json({
      cart: {
        ...cart,
        subtotal,
        tax,
        shippingCost,
        total
      }
    });
  } catch (error) {
    console.error('Get cart error:', error);
    res.status(500).json({
      error: 'Failed to fetch cart',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Add item to cart
router.post('/:cartId/items', [param('cartId').isUUID(), body('productId').isUUID(), body('variantId').optional().isUUID(), body('quantity').isInt({
  min: 1
})], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      cartId
    } = req.params;
    const {
      productId,
      variantId,
      quantity
    } = req.body;

    // Validate cart exists
    const cart = await prisma.cart.findUnique({
      where: {
        id: cartId
      }
    });
    if (!cart) {
      return res.status(404).json({
        error: 'Cart not found'
      });
    }

    // Validate product exists
    const product = await prisma.product.findUnique({
      where: {
        id: productId
      }
    });
    if (!product) {
      return res.status(404).json({
        error: 'Product not found'
      });
    }

    // Check if item already exists in cart
    const existingItem = await prisma.cartItem.findFirst({
      where: {
        cartId,
        productId,
        variantId: variantId || null
      }
    });
    if (existingItem) {
      // Update quantity
      const newQuantity = existingItem.quantity + quantity;
      let unitPrice;
      if (variantId) {
        const variant = await prisma.productVariant.findUnique({
          where: {
            id: variantId
          }
        });
        unitPrice = variant.price;
      } else {
        unitPrice = parseFloat(product.regularPrice);
      }
      const updatedItem = await prisma.cartItem.update({
        where: {
          id: existingItem.id
        },
        data: {
          quantity: newQuantity,
          totalPrice: unitPrice * newQuantity
        }
      });
      return res.json({
        message: 'Cart item updated',
        item: updatedItem
      });
    }

    // Add new item
    let unitPrice;
    if (variantId) {
      const variant = await prisma.productVariant.findUnique({
        where: {
          id: variantId
        }
      });
      unitPrice = variant.price;
    } else {
      unitPrice = parseFloat(product.regularPrice);
    }
    const cartItem = await prisma.cartItem.create({
      data: {
        cartId,
        productId,
        variantId: variantId || null,
        quantity,
        unitPrice,
        totalPrice: unitPrice * quantity
      },
      include: {
        product: true,
        variant: true
      }
    });
    res.status(201).json({
      message: 'Item added to cart',
      item: cartItem
    });
  } catch (error) {
    console.error('Add to cart error:', error);
    res.status(500).json({
      error: 'Failed to add item to cart',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Update cart item
router.put('/:cartId/items/:itemId', [param('cartId').isUUID(), param('itemId').isUUID(), body('quantity').isInt({
  min: 1
})], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      cartId,
      itemId
    } = req.params;
    const {
      quantity
    } = req.body;

    // Get cart item
    const cartItem = await prisma.cartItem.findFirst({
      where: {
        id: itemId,
        cartId
      },
      include: {
        product: true,
        variant: true
      }
    });
    if (!cartItem) {
      return res.status(404).json({
        error: 'Cart item not found'
      });
    }
    let unitPrice;
    if (cartItem.variantId) {
      unitPrice = cartItem.variant.price;
    } else {
      unitPrice = parseFloat(cartItem.product.regularPrice);
    }
    const updatedItem = await prisma.cartItem.update({
      where: {
        id: itemId
      },
      data: {
        quantity,
        totalPrice: unitPrice * quantity
      }
    });
    res.json({
      message: 'Cart item updated',
      item: updatedItem
    });
  } catch (error) {
    console.error('Update cart item error:', error);
    res.status(500).json({
      error: 'Failed to update cart item',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Remove item from cart
router.delete('/:cartId/items/:itemId', [param('cartId').isUUID(), param('itemId').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      cartId,
      itemId
    } = req.params;

    // Check if item exists
    const cartItem = await prisma.cartItem.findFirst({
      where: {
        id: itemId,
        cartId
      }
    });
    if (!cartItem) {
      return res.status(404).json({
        error: 'Cart item not found'
      });
    }
    await prisma.cartItem.delete({
      where: {
        id: itemId
      }
    });
    res.json({
      message: 'Item removed from cart'
    });
  } catch (error) {
    console.error('Remove cart item error:', error);
    res.status(500).json({
      error: 'Failed to remove item from cart',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Clear cart
router.delete('/:cartId', [param('cartId').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      cartId
    } = req.params;

    // Check if cart exists
    const cart = await prisma.cart.findUnique({
      where: {
        id: cartId
      }
    });
    if (!cart) {
      return res.status(404).json({
        error: 'Cart not found'
      });
    }
    await prisma.cartItem.deleteMany({
      where: {
        cartId
      }
    });
    res.json({
      message: 'Cart cleared'
    });
  } catch (error) {
    console.error('Clear cart error:', error);
    res.status(500).json({
      error: 'Failed to clear cart',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImJvZHkiLCJwYXJhbSIsInZhbGlkYXRpb25SZXN1bHQiLCJQcmlzbWFDbGllbnQiLCJhdXRoTWlkZGxld2FyZSIsInJvdXRlciIsIlJvdXRlciIsInByaXNtYSIsImhhbmRsZVZhbGlkYXRpb25FcnJvcnMiLCJyZXEiLCJyZXMiLCJuZXh0IiwiZXJyb3JzIiwiaXNFbXB0eSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImRldGFpbHMiLCJhcnJheSIsImdldCIsImlzVVVJRCIsImF1dGhlbnRpY2F0ZSIsImNhcnRJZCIsInBhcmFtcyIsImNhcnQiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJpZCIsImluY2x1ZGUiLCJpdGVtcyIsInByb2R1Y3QiLCJpbWFnZXMiLCJzb3J0T3JkZXIiLCJ0YWtlIiwic2VsZWN0IiwidXJsIiwiYWx0IiwidmFyaWFudCIsInN1YnRvdGFsIiwicmVkdWNlIiwic3VtIiwiaXRlbSIsInBhcnNlRmxvYXQiLCJ0b3RhbFByaWNlIiwidGF4Iiwic2hpcHBpbmdDb3N0IiwidG90YWwiLCJjb25zb2xlIiwibWVzc2FnZSIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInBvc3QiLCJvcHRpb25hbCIsImlzSW50IiwibWluIiwicHJvZHVjdElkIiwidmFyaWFudElkIiwicXVhbnRpdHkiLCJleGlzdGluZ0l0ZW0iLCJjYXJ0SXRlbSIsImZpbmRGaXJzdCIsIm5ld1F1YW50aXR5IiwidW5pdFByaWNlIiwicHJvZHVjdFZhcmlhbnQiLCJwcmljZSIsInJlZ3VsYXJQcmljZSIsInVwZGF0ZWRJdGVtIiwidXBkYXRlIiwiZGF0YSIsImNyZWF0ZSIsInB1dCIsIml0ZW1JZCIsImRlbGV0ZSIsImRlbGV0ZU1hbnkiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiY2FydC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCB7IGJvZHksIHBhcmFtLCB2YWxpZGF0aW9uUmVzdWx0IH0gPSByZXF1aXJlKCdleHByZXNzLXZhbGlkYXRvcicpO1xyXG5jb25zdCB7IFByaXNtYUNsaWVudCB9ID0gcmVxdWlyZSgnQHByaXNtYS9jbGllbnQnKTtcclxuY29uc3QgeyBhdXRoTWlkZGxld2FyZSB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZS9hdXRoJyk7XHJcblxyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XHJcblxyXG4vLyBWYWxpZGF0aW9uIG1pZGRsZXdhcmVcclxuY29uc3QgaGFuZGxlVmFsaWRhdGlvbkVycm9ycyA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRpb25SZXN1bHQocmVxKTtcclxuICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBmYWlsZWQnLFxyXG4gICAgICBkZXRhaWxzOiBlcnJvcnMuYXJyYXkoKVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIG5leHQoKTtcclxufTtcclxuXHJcbi8vIEdldCBjYXJ0ICh1c2VyIG9yIGd1ZXN0KVxyXG5yb3V0ZXIuZ2V0KCcvOmNhcnRJZCcsIFtcclxuICBwYXJhbSgnY2FydElkJykuaXNVVUlEKClcclxuXSwgaGFuZGxlVmFsaWRhdGlvbkVycm9ycywgYXV0aE1pZGRsZXdhcmUuYXV0aGVudGljYXRlKCksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNhcnRJZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICBjb25zdCBjYXJ0ID0gYXdhaXQgcHJpc21hLmNhcnQuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiBjYXJ0SWQgfSxcclxuICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgIGl0ZW1zOiB7XHJcbiAgICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICAgIHByb2R1Y3Q6IHtcclxuICAgICAgICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICAgICAgICBpbWFnZXM6IHtcclxuICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgc29ydE9yZGVyOiAwIH0sXHJcbiAgICAgICAgICAgICAgICAgIHRha2U6IDEsXHJcbiAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgdXJsOiB0cnVlLCBhbHQ6IHRydWUgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdmFyaWFudDogdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFjYXJ0KSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgZXJyb3I6ICdDYXJ0IG5vdCBmb3VuZCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIHRvdGFsc1xyXG4gICAgY29uc3Qgc3VidG90YWwgPSBjYXJ0Lml0ZW1zLnJlZHVjZSgoc3VtLCBpdGVtKSA9PiBzdW0gKyBwYXJzZUZsb2F0KGl0ZW0udG90YWxQcmljZSksIDApO1xyXG4gICAgY29uc3QgdGF4ID0gc3VidG90YWwgKiAwLjE1OyAvLyAxNSUgdGF4XHJcbiAgICBjb25zdCBzaGlwcGluZ0Nvc3QgPSAxMDA7IC8vIEZpeGVkIHNoaXBwaW5nIGNvc3RcclxuICAgIGNvbnN0IHRvdGFsID0gc3VidG90YWwgKyB0YXggKyBzaGlwcGluZ0Nvc3Q7XHJcblxyXG4gICAgcmVzLmpzb24oe1xyXG4gICAgICBjYXJ0OiB7XHJcbiAgICAgICAgLi4uY2FydCxcclxuICAgICAgICBzdWJ0b3RhbCxcclxuICAgICAgICB0YXgsXHJcbiAgICAgICAgc2hpcHBpbmdDb3N0LFxyXG4gICAgICAgIHRvdGFsXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignR2V0IGNhcnQgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBjYXJ0JyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBBZGQgaXRlbSB0byBjYXJ0XHJcbnJvdXRlci5wb3N0KCcvOmNhcnRJZC9pdGVtcycsIFtcclxuICBwYXJhbSgnY2FydElkJykuaXNVVUlEKCksXHJcbiAgYm9keSgncHJvZHVjdElkJykuaXNVVUlEKCksXHJcbiAgYm9keSgndmFyaWFudElkJykub3B0aW9uYWwoKS5pc1VVSUQoKSxcclxuICBib2R5KCdxdWFudGl0eScpLmlzSW50KHsgbWluOiAxIH0pXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBjYXJ0SWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBjb25zdCB7IHByb2R1Y3RJZCwgdmFyaWFudElkLCBxdWFudGl0eSB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgY2FydCBleGlzdHNcclxuICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBwcmlzbWEuY2FydC5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IGNhcnRJZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIWNhcnQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ0NhcnQgbm90IGZvdW5kJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBwcm9kdWN0IGV4aXN0c1xyXG4gICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IHByaXNtYS5wcm9kdWN0LmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogcHJvZHVjdElkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcHJvZHVjdCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnUHJvZHVjdCBub3QgZm91bmQnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGlmIGl0ZW0gYWxyZWFkeSBleGlzdHMgaW4gY2FydFxyXG4gICAgY29uc3QgZXhpc3RpbmdJdGVtID0gYXdhaXQgcHJpc21hLmNhcnRJdGVtLmZpbmRGaXJzdCh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgY2FydElkLFxyXG4gICAgICAgIHByb2R1Y3RJZCxcclxuICAgICAgICB2YXJpYW50SWQ6IHZhcmlhbnRJZCB8fCBudWxsXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChleGlzdGluZ0l0ZW0pIHtcclxuICAgICAgLy8gVXBkYXRlIHF1YW50aXR5XHJcbiAgICAgIGNvbnN0IG5ld1F1YW50aXR5ID0gZXhpc3RpbmdJdGVtLnF1YW50aXR5ICsgcXVhbnRpdHk7XHJcbiAgICAgIGxldCB1bml0UHJpY2U7XHJcbiAgICAgIGlmICh2YXJpYW50SWQpIHtcclxuICAgICAgICBjb25zdCB2YXJpYW50ID0gYXdhaXQgcHJpc21hLnByb2R1Y3RWYXJpYW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogdmFyaWFudElkIH0gfSk7XHJcbiAgICAgICAgdW5pdFByaWNlID0gdmFyaWFudC5wcmljZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB1bml0UHJpY2UgPSBwYXJzZUZsb2F0KHByb2R1Y3QucmVndWxhclByaWNlKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uc3QgdXBkYXRlZEl0ZW0gPSBhd2FpdCBwcmlzbWEuY2FydEl0ZW0udXBkYXRlKHtcclxuICAgICAgICB3aGVyZTogeyBpZDogZXhpc3RpbmdJdGVtLmlkIH0sXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgcXVhbnRpdHk6IG5ld1F1YW50aXR5LFxyXG4gICAgICAgICAgdG90YWxQcmljZTogdW5pdFByaWNlICogbmV3UXVhbnRpdHlcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIHJlcy5qc29uKHtcclxuICAgICAgICBtZXNzYWdlOiAnQ2FydCBpdGVtIHVwZGF0ZWQnLFxyXG4gICAgICAgIGl0ZW06IHVwZGF0ZWRJdGVtXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCBuZXcgaXRlbVxyXG4gICAgbGV0IHVuaXRQcmljZTtcclxuICAgIGlmICh2YXJpYW50SWQpIHtcclxuICAgICAgY29uc3QgdmFyaWFudCA9IGF3YWl0IHByaXNtYS5wcm9kdWN0VmFyaWFudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQ6IHZhcmlhbnRJZCB9IH0pO1xyXG4gICAgICB1bml0UHJpY2UgPSB2YXJpYW50LnByaWNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdW5pdFByaWNlID0gcGFyc2VGbG9hdChwcm9kdWN0LnJlZ3VsYXJQcmljZSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IGNhcnRJdGVtID0gYXdhaXQgcHJpc21hLmNhcnRJdGVtLmNyZWF0ZSh7XHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBjYXJ0SWQsXHJcbiAgICAgICAgcHJvZHVjdElkLFxyXG4gICAgICAgIHZhcmlhbnRJZDogdmFyaWFudElkIHx8IG51bGwsXHJcbiAgICAgICAgcXVhbnRpdHksXHJcbiAgICAgICAgdW5pdFByaWNlLFxyXG4gICAgICAgIHRvdGFsUHJpY2U6IHVuaXRQcmljZSAqIHF1YW50aXR5XHJcbiAgICAgIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBwcm9kdWN0OiB0cnVlLFxyXG4gICAgICAgIHZhcmlhbnQ6IHRydWVcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xyXG4gICAgICBtZXNzYWdlOiAnSXRlbSBhZGRlZCB0byBjYXJ0JyxcclxuICAgICAgaXRlbTogY2FydEl0ZW1cclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignQWRkIHRvIGNhcnQgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBhZGQgaXRlbSB0byBjYXJ0JyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBVcGRhdGUgY2FydCBpdGVtXHJcbnJvdXRlci5wdXQoJy86Y2FydElkL2l0ZW1zLzppdGVtSWQnLCBbXHJcbiAgcGFyYW0oJ2NhcnRJZCcpLmlzVVVJRCgpLFxyXG4gIHBhcmFtKCdpdGVtSWQnKS5pc1VVSUQoKSxcclxuICBib2R5KCdxdWFudGl0eScpLmlzSW50KHsgbWluOiAxIH0pXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBjYXJ0SWQsIGl0ZW1JZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIGNvbnN0IHsgcXVhbnRpdHkgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIC8vIEdldCBjYXJ0IGl0ZW1cclxuICAgIGNvbnN0IGNhcnRJdGVtID0gYXdhaXQgcHJpc21hLmNhcnRJdGVtLmZpbmRGaXJzdCh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiBpdGVtSWQsIGNhcnRJZCB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgcHJvZHVjdDogdHJ1ZSxcclxuICAgICAgICB2YXJpYW50OiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghY2FydEl0ZW0pIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ0NhcnQgaXRlbSBub3QgZm91bmQnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCB1bml0UHJpY2U7XHJcbiAgICBpZiAoY2FydEl0ZW0udmFyaWFudElkKSB7XHJcbiAgICAgIHVuaXRQcmljZSA9IGNhcnRJdGVtLnZhcmlhbnQucHJpY2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB1bml0UHJpY2UgPSBwYXJzZUZsb2F0KGNhcnRJdGVtLnByb2R1Y3QucmVndWxhclByaWNlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1cGRhdGVkSXRlbSA9IGF3YWl0IHByaXNtYS5jYXJ0SXRlbS51cGRhdGUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogaXRlbUlkIH0sXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBxdWFudGl0eSxcclxuICAgICAgICB0b3RhbFByaWNlOiB1bml0UHJpY2UgKiBxdWFudGl0eVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXMuanNvbih7XHJcbiAgICAgIG1lc3NhZ2U6ICdDYXJ0IGl0ZW0gdXBkYXRlZCcsXHJcbiAgICAgIGl0ZW06IHVwZGF0ZWRJdGVtXHJcbiAgICB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1VwZGF0ZSBjYXJ0IGl0ZW0gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byB1cGRhdGUgY2FydCBpdGVtJyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBSZW1vdmUgaXRlbSBmcm9tIGNhcnRcclxucm91dGVyLmRlbGV0ZSgnLzpjYXJ0SWQvaXRlbXMvOml0ZW1JZCcsIFtcclxuICBwYXJhbSgnY2FydElkJykuaXNVVUlEKCksXHJcbiAgcGFyYW0oJ2l0ZW1JZCcpLmlzVVVJRCgpXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBjYXJ0SWQsIGl0ZW1JZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICAvLyBDaGVjayBpZiBpdGVtIGV4aXN0c1xyXG4gICAgY29uc3QgY2FydEl0ZW0gPSBhd2FpdCBwcmlzbWEuY2FydEl0ZW0uZmluZEZpcnN0KHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IGl0ZW1JZCwgY2FydElkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghY2FydEl0ZW0pIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ0NhcnQgaXRlbSBub3QgZm91bmQnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHByaXNtYS5jYXJ0SXRlbS5kZWxldGUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogaXRlbUlkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJlcy5qc29uKHtcclxuICAgICAgbWVzc2FnZTogJ0l0ZW0gcmVtb3ZlZCBmcm9tIGNhcnQnXHJcbiAgICB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1JlbW92ZSBjYXJ0IGl0ZW0gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byByZW1vdmUgaXRlbSBmcm9tIGNhcnQnLFxyXG4gICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIENsZWFyIGNhcnRcclxucm91dGVyLmRlbGV0ZSgnLzpjYXJ0SWQnLCBbXHJcbiAgcGFyYW0oJ2NhcnRJZCcpLmlzVVVJRCgpXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBjYXJ0SWQgfSA9IHJlcS5wYXJhbXM7XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgY2FydCBleGlzdHNcclxuICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBwcmlzbWEuY2FydC5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IGNhcnRJZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIWNhcnQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ0NhcnQgbm90IGZvdW5kJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhd2FpdCBwcmlzbWEuY2FydEl0ZW0uZGVsZXRlTWFueSh7XHJcbiAgICAgIHdoZXJlOiB7IGNhcnRJZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXMuanNvbih7XHJcbiAgICAgIG1lc3NhZ2U6ICdDYXJ0IGNsZWFyZWQnXHJcbiAgICB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0NsZWFyIGNhcnQgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjbGVhciBjYXJ0JyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNO0VBQUVDLElBQUk7RUFBRUMsS0FBSztFQUFFQztBQUFpQixDQUFDLEdBQUdILE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUN0RSxNQUFNO0VBQUVJO0FBQWEsQ0FBQyxHQUFHSixPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDbEQsTUFBTTtFQUFFSztBQUFlLENBQUMsR0FBR0wsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBRXhELE1BQU1NLE1BQU0sR0FBR1AsT0FBTyxDQUFDUSxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNQyxNQUFNLEdBQUcsSUFBSUosWUFBWSxDQUFDLENBQUM7O0FBRWpDO0FBQ0EsTUFBTUssc0JBQXNCLEdBQUdBLENBQUNDLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDakQsTUFBTUMsTUFBTSxHQUFHVixnQkFBZ0IsQ0FBQ08sR0FBRyxDQUFDO0VBQ3BDLElBQUksQ0FBQ0csTUFBTSxDQUFDQyxPQUFPLENBQUMsQ0FBQyxFQUFFO0lBQ3JCLE9BQU9ILEdBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENB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