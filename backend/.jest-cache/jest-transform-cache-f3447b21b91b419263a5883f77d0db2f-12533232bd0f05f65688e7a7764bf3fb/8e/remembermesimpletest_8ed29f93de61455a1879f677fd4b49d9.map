{"version":3,"names":["SessionService","require","describe","sessionService","beforeAll","logger","error","jest","fn","info","logSecurity","redis","prisma","userSession","create","mockResolvedValue","id","userId","token","expiresAt","Date","now","test","sessionId1","generateSessionId","sessionId2","expect","toMatch","not","toBe","toHaveLength","console","log","mockReq1","ip","get","header","headers","mockReq2","fingerprint1","generateDeviceFingerprint","fingerprint2","mockReq","setEx","zAdd","expire","result","createRememberMeToken","success","toBeDefined","toBeInstanceOf","mockTokenData","deviceFingerprint","createdAt","JSON","stringify","validateRememberMeToken","valid","rememberMeMaxAge","standardMaxAge","rememberMeExpiry","getTime","standardExpiry","toBeGreaterThan"],"sources":["remember-me-simple.test.js"],"sourcesContent":["// Simple remember me functionality test without database dependencies\r\nconst { SessionService } = require('../services/sessionService');\r\n\r\ndescribe('Remember Me Simple Functionality', () => {\r\n  let sessionService;\r\n\r\n  beforeAll(() => {\r\n    // Create session service instance with mocked dependencies\r\n    sessionService = new SessionService();\r\n    \r\n    // Mock the logger to prevent errors\r\n    sessionService.logger = {\r\n      error: jest.fn(),\r\n      info: jest.fn(),\r\n      logSecurity: jest.fn()\r\n    };\r\n    \r\n    // Mock Redis to null to use database fallback\r\n    sessionService.redis = null;\r\n    \r\n    // Mock Prisma to prevent database calls\r\n    sessionService.prisma = {\r\n      userSession: {\r\n        create: jest.fn().mockResolvedValue({\r\n          id: 'mock-session-id',\r\n          userId: 'user-123',\r\n          token: 'mock-token',\r\n          expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000)\r\n        })\r\n      }\r\n    };\r\n  });\r\n\r\n  describe('Session ID Generation', () => {\r\n    test('should generate secure session IDs', () => {\r\n      const sessionId1 = sessionService.generateSessionId();\r\n      const sessionId2 = sessionService.generateSessionId();\r\n      \r\n      expect(sessionId1).toMatch(/^[a-f0-9]{64}$/);\r\n      expect(sessionId2).toMatch(/^[a-f0-9]{64}$/);\r\n      expect(sessionId1).not.toBe(sessionId2);\r\n      expect(sessionId1).toHaveLength(64);\r\n      console.log('✅ Session ID generation test passed');\r\n    });\r\n  });\r\n\r\n  describe('Device Fingerprinting', () => {\r\n    test('should generate consistent device fingerprints', () => {\r\n      const mockReq1 = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn((header) => {\r\n          const headers = {\r\n            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',\r\n            'Accept-Language': 'en-US,en;q=0.9',\r\n            'Accept-Encoding': 'gzip, deflate, br'\r\n          };\r\n          return headers[header] || '';\r\n        })\r\n      };\r\n\r\n      const mockReq2 = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn((header) => {\r\n          const headers = {\r\n            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',\r\n            'Accept-Language': 'en-US,en;q=0.9',\r\n            'Accept-Encoding': 'gzip, deflate, br'\r\n          };\r\n          return headers[header] || '';\r\n        })\r\n      };\r\n\r\n      const fingerprint1 = sessionService.generateDeviceFingerprint(mockReq1);\r\n      const fingerprint2 = sessionService.generateDeviceFingerprint(mockReq2);\r\n\r\n      expect(fingerprint1).toMatch(/^[a-f0-9]{32}$/);\r\n      expect(fingerprint2).toMatch(/^[a-f0-9]{32}$/);\r\n      expect(fingerprint1).toBe(fingerprint2);\r\n      console.log('✅ Device fingerprinting test passed');\r\n    });\r\n  });\r\n\r\n  describe('Remember Me Token Management', () => {\r\n    test('should create remember me token successfully', async () => {\r\n      const mockReq = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn((header) => {\r\n          const headers = {\r\n            'User-Agent': 'Mozilla/5.0 (Test Browser)',\r\n            'Accept-Language': 'en-US,en;q=0.9',\r\n            'Accept-Encoding': 'gzip, deflate, br'\r\n          };\r\n          return headers[header] || '';\r\n        })\r\n      };\r\n\r\n      // Mock Redis for this test\r\n      sessionService.redis = {\r\n        setEx: jest.fn().mockResolvedValue('OK'),\r\n        zAdd: jest.fn().mockResolvedValue(1),\r\n        expire: jest.fn().mockResolvedValue('OK')\r\n      };\r\n\r\n      const result = await sessionService.createRememberMeToken('user-123', mockReq);\r\n      \r\n      expect(result.success).toBe(true);\r\n      expect(result.token).toBeDefined();\r\n      expect(result.expiresAt).toBeInstanceOf(Date);\r\n      console.log('✅ Remember me token creation test passed');\r\n    });\r\n\r\n    test('should validate remember me token successfully', async () => {\r\n      // Mock Redis for this test\r\n      const mockTokenData = {\r\n        userId: 'user-123',\r\n        deviceFingerprint: 'mock-fingerprint',\r\n        createdAt: new Date(),\r\n        expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)\r\n      };\r\n\r\n      sessionService.redis = {\r\n        get: jest.fn().mockResolvedValue(JSON.stringify(mockTokenData))\r\n      };\r\n\r\n      const result = await sessionService.validateRememberMeToken('mock-token');\r\n      \r\n      expect(result.valid).toBe(true);\r\n      expect(result.userId).toBe('user-123');\r\n      console.log('✅ Remember me token validation test passed');\r\n    });\r\n  });\r\n\r\n  describe('Session Configuration', () => {\r\n    test('should configure session with correct max age for remember me', () => {\r\n      const mockReq = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn((header) => {\r\n          const headers = {\r\n            'User-Agent': 'Mozilla/5.0 (Test Browser)',\r\n            'Accept-Language': 'en-US,en;q=0.9',\r\n            'Accept-Encoding': 'gzip, deflate, br'\r\n          };\r\n          return headers[header] || '';\r\n        })\r\n      };\r\n\r\n      // Test session configuration logic\r\n      const now = new Date();\r\n      const rememberMeMaxAge = 7 * 24 * 60 * 60 * 1000; // 7 days\r\n      const standardMaxAge = 24 * 60 * 60 * 1000; // 24 hours\r\n\r\n      const rememberMeExpiry = new Date(now.getTime() + rememberMeMaxAge);\r\n      const standardExpiry = new Date(now.getTime() + standardMaxAge);\r\n\r\n      expect(rememberMeExpiry.getTime()).toBeGreaterThan(standardExpiry.getTime());\r\n      expect(rememberMeMaxAge).toBe(604800000); // 7 days in ms\r\n      expect(standardMaxAge).toBe(86400000); // 24 hours in ms\r\n      \r\n      console.log('✅ Session configuration test passed');\r\n    });\r\n  });\r\n});"],"mappings":"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","ignoreList":[]}