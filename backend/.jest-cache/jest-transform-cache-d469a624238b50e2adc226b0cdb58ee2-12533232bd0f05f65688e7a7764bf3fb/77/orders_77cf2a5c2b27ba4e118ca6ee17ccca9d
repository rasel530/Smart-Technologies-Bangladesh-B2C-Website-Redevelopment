9a7937cde2acfa3978197f873b94fb65
const express = require('express');
const {
  body,
  param,
  query,
  validationResult
} = require('express-validator');
const {
  PrismaClient
} = require('@prisma/client');
const {
  authMiddleware
} = require('../middleware/auth');
const router = express.Router();
const prisma = new PrismaClient();

// Validation middleware
const handleValidationErrors = (req, res, next) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({
      error: 'Validation failed',
      details: errors.array()
    });
  }
  next();
};

// Get all orders (admin or user-specific)
router.get('/', [query('page').optional().isInt({
  min: 1
}), query('limit').optional().isInt({
  min: 1,
  max: 100
}), query('userId').optional().isUUID(), query('status').optional().isIn(['PENDING', 'CONFIRMED', 'SHIPPED', 'DELIVERED', 'CANCELLED'])], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  // If user is not admin, only allow access to their own orders
  if (req.userRole !== 'ADMIN') {
    req.query.userId = req.userId;
  }
  try {
    const {
      page = 1,
      limit = 20,
      userId,
      status
    } = req.query;
    const skip = (page - 1) * limit;
    const where = {};
    if (userId) where.userId = userId;
    if (status) where.status = status;
    const [orders, total] = await Promise.all([prisma.order.findMany({
      where,
      skip: parseInt(skip),
      take: parseInt(limit),
      include: {
        user: {
          select: {
            id: true,
            firstName: true,
            lastName: true,
            email: true
          }
        },
        address: true,
        items: {
          include: {
            product: {
              select: {
                id: true,
                name: true,
                sku: true
              }
            }
          }
        },
        transactions: true
      },
      orderBy: {
        createdAt: 'desc'
      }
    }), prisma.order.count({
      where
    })]);
    res.json({
      orders,
      pagination: {
        page: parseInt(page),
        limit: parseInt(limit),
        total,
        pages: Math.ceil(total / limit)
      }
    });
  } catch (error) {
    console.error('Get orders error:', error);
    res.status(500).json({
      error: 'Failed to fetch orders',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Get order by ID
router.get('/:id', [param('id').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  // Get order first to check ownership
  const order = await prisma.order.findUnique({
    where: {
      id: req.params.id
    },
    select: {
      userId: true
    }
  });
  if (!order) {
    return res.status(404).json({
      error: 'Order not found'
    });
  }

  // Check if user is admin or order owner
  if (req.userRole !== 'ADMIN' && order.userId !== req.userId) {
    return res.status(403).json({
      error: 'Access denied',
      message: 'You can only access your own orders'
    });
  }
  try {
    const {
      id
    } = req.params;
    const order = await prisma.order.findUnique({
      where: {
        id
      },
      include: {
        user: {
          select: {
            id: true,
            firstName: true,
            lastName: true,
            email: true,
            phone: true
          }
        },
        address: true,
        items: {
          include: {
            product: {
              include: {
                images: {
                  where: {
                    sortOrder: 0
                  },
                  take: 1,
                  select: {
                    id: true,
                    url: true,
                    alt: true
                  }
                }
              }
            },
            variant: true
          }
        },
        transactions: true
      }
    });
    if (!order) {
      return res.status(404).json({
        error: 'Order not found'
      });
    }
    res.json({
      order
    });
  } catch (error) {
    console.error('Get order error:', error);
    res.status(500).json({
      error: 'Failed to fetch order',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Create order
router.post('/', [body('addressId').isUUID(), body('items').isArray({
  min: 1
}), body('paymentMethod').isIn(['CREDIT_CARD', 'BANK_TRANSFER', 'CASH_ON_DELIVERY', 'BKASH', 'NAGAD', 'ROCKET']), body('notes').optional().isString()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  // Use authenticated user's ID
  req.body.userId = req.userId;
  try {
    const {
      userId,
      addressId,
      items,
      paymentMethod,
      notes
    } = req.body;

    // Validate user and address
    const [user, address] = await Promise.all([prisma.user.findUnique({
      where: {
        id: userId
      }
    }), prisma.address.findUnique({
      where: {
        id: addressId
      }
    })]);
    if (!user) {
      return res.status(404).json({
        error: 'User not found'
      });
    }
    if (!address) {
      return res.status(404).json({
        error: 'Address not found'
      });
    }

    // Validate items and calculate totals
    let subtotal = 0;
    const orderItems = [];
    for (const item of items) {
      const product = await prisma.product.findUnique({
        where: {
          id: item.productId
        }
      });
      if (!product) {
        return res.status(400).json({
          error: `Product ${item.productId} not found`
        });
      }
      if (product.stockQuantity < item.quantity) {
        return res.status(400).json({
          error: `Insufficient stock for product ${product.name}`
        });
      }
      const itemTotal = parseFloat(product.regularPrice) * item.quantity;
      subtotal += itemTotal;
      orderItems.push({
        productId: item.productId,
        variantId: item.variantId || null,
        quantity: item.quantity,
        unitPrice: parseFloat(product.regularPrice),
        totalPrice: itemTotal
      });
    }

    // Calculate totals
    const tax = subtotal * 0.15; // 15% tax
    const shippingCost = 100; // Fixed shipping cost
    const discount = 0; // Can be calculated based on coupons
    const total = subtotal + tax + shippingCost - discount;

    // Generate order number
    const orderNumber = 'ORD' + Date.now() + Math.floor(Math.random() * 1000);

    // Create order
    const order = await prisma.order.create({
      data: {
        orderNumber,
        userId,
        addressId,
        subtotal,
        tax,
        shippingCost,
        discount,
        total,
        paymentMethod,
        notes,
        status: 'PENDING',
        items: {
          create: orderItems
        }
      },
      include: {
        items: {
          include: {
            product: true
          }
        }
      }
    });

    // Update product stock
    for (const item of items) {
      await prisma.product.update({
        where: {
          id: item.productId
        },
        data: {
          stockQuantity: {
            decrement: item.quantity
          }
        }
      });
    }
    res.status(201).json({
      message: 'Order created successfully',
      order
    });
  } catch (error) {
    console.error('Create order error:', error);
    res.status(500).json({
      error: 'Failed to create order',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Update order status
router.put('/:id/status', [param('id').isUUID(), body('status').isIn(['PENDING', 'CONFIRMED', 'SHIPPED', 'DELIVERED', 'CANCELLED']), body('notes').optional().isString()], handleValidationErrors, authMiddleware.managerOrAdmin(), async (req, res) => {
  try {
    const {
      id
    } = req.params;
    const {
      status,
      notes
    } = req.body;

    // Check if order exists
    const order = await prisma.order.findUnique({
      where: {
        id
      }
    });
    if (!order) {
      return res.status(404).json({
        error: 'Order not found'
      });
    }
    const updateData = {
      status
    };

    // Add timestamp based on status
    if (status === 'CONFIRMED') updateData.confirmedAt = new Date();
    if (status === 'SHIPPED') updateData.shippedAt = new Date();
    if (status === 'DELIVERED') updateData.deliveredAt = new Date();
    if (notes) updateData.notes = notes;
    const updatedOrder = await prisma.order.update({
      where: {
        id
      },
      data: updateData
    });
    res.json({
      message: 'Order status updated successfully',
      order: updatedOrder
    });
  } catch (error) {
    console.error('Update order status error:', error);
    res.status(500).json({
      error: 'Failed to update order status',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImJvZHkiLCJwYXJhbSIsInF1ZXJ5IiwidmFsaWRhdGlvblJlc3VsdCIsIlByaXNtYUNsaWVudCIsImF1dGhNaWRkbGV3YXJlIiwicm91dGVyIiwiUm91dGVyIiwicHJpc21hIiwiaGFuZGxlVmFsaWRhdGlvbkVycm9ycyIsInJlcSIsInJlcyIsIm5leHQiLCJlcnJvcnMiLCJpc0VtcHR5Iiwic3RhdHVzIiwianNvbiIsImVycm9yIiwiZGV0YWlscyIsImFycmF5IiwiZ2V0Iiwib3B0aW9uYWwiLCJpc0ludCIsIm1pbiIsIm1heCIsImlzVVVJRCIsImlzSW4iLCJhdXRoZW50aWNhdGUiLCJ1c2VyUm9sZSIsInVzZXJJZCIsInBhZ2UiLCJsaW1pdCIsInNraXAiLCJ3aGVyZSIsIm9yZGVycyIsInRvdGFsIiwiUHJvbWlzZSIsImFsbCIsIm9yZGVyIiwiZmluZE1hbnkiLCJwYXJzZUludCIsInRha2UiLCJpbmNsdWRlIiwidXNlciIsInNlbGVjdCIsImlkIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJlbWFpbCIsImFkZHJlc3MiLCJpdGVtcyIsInByb2R1Y3QiLCJuYW1lIiwic2t1IiwidHJhbnNhY3Rpb25zIiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsImNvdW50IiwicGFnaW5hdGlvbiIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJjb25zb2xlIiwibWVzc2FnZSIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImZpbmRVbmlxdWUiLCJwYXJhbXMiLCJwaG9uZSIsImltYWdlcyIsInNvcnRPcmRlciIsInVybCIsImFsdCIsInZhcmlhbnQiLCJwb3N0IiwiaXNBcnJheSIsImlzU3RyaW5nIiwiYWRkcmVzc0lkIiwicGF5bWVudE1ldGhvZCIsIm5vdGVzIiwic3VidG90YWwiLCJvcmRlckl0ZW1zIiwiaXRlbSIsInByb2R1Y3RJZCIsInN0b2NrUXVhbnRpdHkiLCJxdWFudGl0eSIsIml0ZW1Ub3RhbCIsInBhcnNlRmxvYXQiLCJyZWd1bGFyUHJpY2UiLCJwdXNoIiwidmFyaWFudElkIiwidW5pdFByaWNlIiwidG90YWxQcmljZSIsInRheCIsInNoaXBwaW5nQ29zdCIsImRpc2NvdW50Iiwib3JkZXJOdW1iZXIiLCJEYXRlIiwibm93IiwiZmxvb3IiLCJyYW5kb20iLCJjcmVhdGUiLCJkYXRhIiwidXBkYXRlIiwiZGVjcmVtZW50IiwicHV0IiwibWFuYWdlck9yQWRtaW4iLCJ1cGRhdGVEYXRhIiwiY29uZmlybWVkQXQiLCJzaGlwcGVkQXQiLCJkZWxpdmVyZWRBdCIsInVwZGF0ZWRPcmRlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJvcmRlcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3QgeyBib2R5LCBwYXJhbSwgcXVlcnksIHZhbGlkYXRpb25SZXN1bHQgfSA9IHJlcXVpcmUoJ2V4cHJlc3MtdmFsaWRhdG9yJyk7XHJcbmNvbnN0IHsgUHJpc21hQ2xpZW50IH0gPSByZXF1aXJlKCdAcHJpc21hL2NsaWVudCcpO1xyXG5jb25zdCB7IGF1dGhNaWRkbGV3YXJlIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcclxuXHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcclxuXHJcbi8vIFZhbGlkYXRpb24gbWlkZGxld2FyZVxyXG5jb25zdCBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xyXG4gIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXHJcbiAgICAgIGRldGFpbHM6IGVycm9ycy5hcnJheSgpXHJcbiAgICB9KTtcclxuICB9XHJcbiAgbmV4dCgpO1xyXG59O1xyXG5cclxuLy8gR2V0IGFsbCBvcmRlcnMgKGFkbWluIG9yIHVzZXItc3BlY2lmaWMpXHJcbnJvdXRlci5nZXQoJy8nLCBbXHJcbiAgcXVlcnkoJ3BhZ2UnKS5vcHRpb25hbCgpLmlzSW50KHsgbWluOiAxIH0pLFxyXG4gIHF1ZXJ5KCdsaW1pdCcpLm9wdGlvbmFsKCkuaXNJbnQoeyBtaW46IDEsIG1heDogMTAwIH0pLFxyXG4gIHF1ZXJ5KCd1c2VySWQnKS5vcHRpb25hbCgpLmlzVVVJRCgpLFxyXG4gIHF1ZXJ5KCdzdGF0dXMnKS5vcHRpb25hbCgpLmlzSW4oWydQRU5ESU5HJywgJ0NPTkZJUk1FRCcsICdTSElQUEVEJywgJ0RFTElWRVJFRCcsICdDQU5DRUxMRUQnXSlcclxuXSwgaGFuZGxlVmFsaWRhdGlvbkVycm9ycywgYXV0aE1pZGRsZXdhcmUuYXV0aGVudGljYXRlKCksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIC8vIElmIHVzZXIgaXMgbm90IGFkbWluLCBvbmx5IGFsbG93IGFjY2VzcyB0byB0aGVpciBvd24gb3JkZXJzXHJcbiAgaWYgKHJlcS51c2VyUm9sZSAhPT0gJ0FETUlOJykge1xyXG4gICAgcmVxLnF1ZXJ5LnVzZXJJZCA9IHJlcS51c2VySWQ7XHJcbiAgfVxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHBhZ2UgPSAxLCBsaW1pdCA9IDIwLCB1c2VySWQsIHN0YXR1cyB9ID0gcmVxLnF1ZXJ5O1xyXG4gICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcclxuXHJcbiAgICBjb25zdCB3aGVyZSA9IHt9O1xyXG4gICAgaWYgKHVzZXJJZCkgd2hlcmUudXNlcklkID0gdXNlcklkO1xyXG4gICAgaWYgKHN0YXR1cykgd2hlcmUuc3RhdHVzID0gc3RhdHVzO1xyXG5cclxuICAgIGNvbnN0IFtvcmRlcnMsIHRvdGFsXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgcHJpc21hLm9yZGVyLmZpbmRNYW55KHtcclxuICAgICAgICB3aGVyZSxcclxuICAgICAgICBza2lwOiBwYXJzZUludChza2lwKSxcclxuICAgICAgICB0YWtlOiBwYXJzZUludChsaW1pdCksXHJcbiAgICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIGZpcnN0TmFtZTogdHJ1ZSwgbGFzdE5hbWU6IHRydWUsIGVtYWlsOiB0cnVlIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBhZGRyZXNzOiB0cnVlLFxyXG4gICAgICAgICAgaXRlbXM6IHtcclxuICAgICAgICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgICAgICAgIHByb2R1Y3Q6IHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgc2t1OiB0cnVlIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB0cmFuc2FjdGlvbnM6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfVxyXG4gICAgICB9KSxcclxuICAgICAgcHJpc21hLm9yZGVyLmNvdW50KHsgd2hlcmUgfSlcclxuICAgIF0pO1xyXG5cclxuICAgIHJlcy5qc29uKHtcclxuICAgICAgb3JkZXJzLFxyXG4gICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgcGFnZTogcGFyc2VJbnQocGFnZSksXHJcbiAgICAgICAgbGltaXQ6IHBhcnNlSW50KGxpbWl0KSxcclxuICAgICAgICB0b3RhbCxcclxuICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gbGltaXQpXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignR2V0IG9yZGVycyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIG9yZGVycycsXHJcbiAgICAgIG1lc3NhZ2U6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyb3IubWVzc2FnZSA6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gR2V0IG9yZGVyIGJ5IElEXHJcbnJvdXRlci5nZXQoJy86aWQnLCBbXHJcbiAgcGFyYW0oJ2lkJykuaXNVVUlEKClcclxuXSwgaGFuZGxlVmFsaWRhdGlvbkVycm9ycywgYXV0aE1pZGRsZXdhcmUuYXV0aGVudGljYXRlKCksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIC8vIEdldCBvcmRlciBmaXJzdCB0byBjaGVjayBvd25lcnNoaXBcclxuICBjb25zdCBvcmRlciA9IGF3YWl0IHByaXNtYS5vcmRlci5maW5kVW5pcXVlKHtcclxuICAgIHdoZXJlOiB7IGlkOiByZXEucGFyYW1zLmlkIH0sXHJcbiAgICBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH1cclxuICB9KTtcclxuICBcclxuICBpZiAoIW9yZGVyKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ09yZGVyIG5vdCBmb3VuZCdcclxuICAgIH0pO1xyXG4gIH1cclxuICBcclxuICAvLyBDaGVjayBpZiB1c2VyIGlzIGFkbWluIG9yIG9yZGVyIG93bmVyXHJcbiAgaWYgKHJlcS51c2VyUm9sZSAhPT0gJ0FETUlOJyAmJiBvcmRlci51c2VySWQgIT09IHJlcS51c2VySWQpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgIGVycm9yOiAnQWNjZXNzIGRlbmllZCcsXHJcbiAgICAgIG1lc3NhZ2U6ICdZb3UgY2FuIG9ubHkgYWNjZXNzIHlvdXIgb3duIG9yZGVycydcclxuICAgIH0pO1xyXG4gIH1cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IHByaXNtYS5vcmRlci5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQgfSxcclxuICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgZmlyc3ROYW1lOiB0cnVlLCBsYXN0TmFtZTogdHJ1ZSwgZW1haWw6IHRydWUsIHBob25lOiB0cnVlIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGFkZHJlc3M6IHRydWUsXHJcbiAgICAgICAgaXRlbXM6IHtcclxuICAgICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgICAgcHJvZHVjdDoge1xyXG4gICAgICAgICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgICAgICAgIGltYWdlczoge1xyXG4gICAgICAgICAgICAgICAgICB3aGVyZTogeyBzb3J0T3JkZXI6IDAgfSxcclxuICAgICAgICAgICAgICAgICAgdGFrZTogMSxcclxuICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCB1cmw6IHRydWUsIGFsdDogdHJ1ZSB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB2YXJpYW50OiB0cnVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0cmFuc2FjdGlvbnM6IHRydWVcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFvcmRlcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnT3JkZXIgbm90IGZvdW5kJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXMuanNvbih7IG9yZGVyIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignR2V0IG9yZGVyIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggb3JkZXInLFxyXG4gICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIENyZWF0ZSBvcmRlclxyXG5yb3V0ZXIucG9zdCgnLycsIFtcclxuICBib2R5KCdhZGRyZXNzSWQnKS5pc1VVSUQoKSxcclxuICBib2R5KCdpdGVtcycpLmlzQXJyYXkoeyBtaW46IDEgfSksXHJcbiAgYm9keSgncGF5bWVudE1ldGhvZCcpLmlzSW4oWydDUkVESVRfQ0FSRCcsICdCQU5LX1RSQU5TRkVSJywgJ0NBU0hfT05fREVMSVZFUlknLCAnQktBU0gnLCAnTkFHQUQnLCAnUk9DS0VUJ10pLFxyXG4gIGJvZHkoJ25vdGVzJykub3B0aW9uYWwoKS5pc1N0cmluZygpXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAvLyBVc2UgYXV0aGVudGljYXRlZCB1c2VyJ3MgSURcclxuICByZXEuYm9keS51c2VySWQgPSByZXEudXNlcklkO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHVzZXJJZCwgYWRkcmVzc0lkLCBpdGVtcywgcGF5bWVudE1ldGhvZCwgbm90ZXMgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIHVzZXIgYW5kIGFkZHJlc3NcclxuICAgIGNvbnN0IFt1c2VyLCBhZGRyZXNzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkOiB1c2VySWQgfSB9KSxcclxuICAgICAgcHJpc21hLmFkZHJlc3MuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkOiBhZGRyZXNzSWQgfSB9KVxyXG4gICAgXSk7XHJcblxyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgZXJyb3I6ICdVc2VyIG5vdCBmb3VuZCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFhZGRyZXNzKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgZXJyb3I6ICdBZGRyZXNzIG5vdCBmb3VuZCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaXRlbXMgYW5kIGNhbGN1bGF0ZSB0b3RhbHNcclxuICAgIGxldCBzdWJ0b3RhbCA9IDA7XHJcbiAgICBjb25zdCBvcmRlckl0ZW1zID0gW107XHJcblxyXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XHJcbiAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBwcmlzbWEucHJvZHVjdC5maW5kVW5pcXVlKHtcclxuICAgICAgICB3aGVyZTogeyBpZDogaXRlbS5wcm9kdWN0SWQgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghcHJvZHVjdCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICBlcnJvcjogYFByb2R1Y3QgJHtpdGVtLnByb2R1Y3RJZH0gbm90IGZvdW5kYFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocHJvZHVjdC5zdG9ja1F1YW50aXR5IDwgaXRlbS5xdWFudGl0eSkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICBlcnJvcjogYEluc3VmZmljaWVudCBzdG9jayBmb3IgcHJvZHVjdCAke3Byb2R1Y3QubmFtZX1gXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGl0ZW1Ub3RhbCA9IHBhcnNlRmxvYXQocHJvZHVjdC5yZWd1bGFyUHJpY2UpICogaXRlbS5xdWFudGl0eTtcclxuICAgICAgc3VidG90YWwgKz0gaXRlbVRvdGFsO1xyXG5cclxuICAgICAgb3JkZXJJdGVtcy5wdXNoKHtcclxuICAgICAgICBwcm9kdWN0SWQ6IGl0ZW0ucHJvZHVjdElkLFxyXG4gICAgICAgIHZhcmlhbnRJZDogaXRlbS52YXJpYW50SWQgfHwgbnVsbCxcclxuICAgICAgICBxdWFudGl0eTogaXRlbS5xdWFudGl0eSxcclxuICAgICAgICB1bml0UHJpY2U6IHBhcnNlRmxvYXQocHJvZHVjdC5yZWd1bGFyUHJpY2UpLFxyXG4gICAgICAgIHRvdGFsUHJpY2U6IGl0ZW1Ub3RhbFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgdG90YWxzXHJcbiAgICBjb25zdCB0YXggPSBzdWJ0b3RhbCAqIDAuMTU7IC8vIDE1JSB0YXhcclxuICAgIGNvbnN0IHNoaXBwaW5nQ29zdCA9IDEwMDsgLy8gRml4ZWQgc2hpcHBpbmcgY29zdFxyXG4gICAgY29uc3QgZGlzY291bnQgPSAwOyAvLyBDYW4gYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiBjb3Vwb25zXHJcbiAgICBjb25zdCB0b3RhbCA9IHN1YnRvdGFsICsgdGF4ICsgc2hpcHBpbmdDb3N0IC0gZGlzY291bnQ7XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgb3JkZXIgbnVtYmVyXHJcbiAgICBjb25zdCBvcmRlck51bWJlciA9ICdPUkQnICsgRGF0ZS5ub3coKSArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDApO1xyXG5cclxuICAgIC8vIENyZWF0ZSBvcmRlclxyXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBwcmlzbWEub3JkZXIuY3JlYXRlKHtcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIG9yZGVyTnVtYmVyLFxyXG4gICAgICAgIHVzZXJJZCxcclxuICAgICAgICBhZGRyZXNzSWQsXHJcbiAgICAgICAgc3VidG90YWwsXHJcbiAgICAgICAgdGF4LFxyXG4gICAgICAgIHNoaXBwaW5nQ29zdCxcclxuICAgICAgICBkaXNjb3VudCxcclxuICAgICAgICB0b3RhbCxcclxuICAgICAgICBwYXltZW50TWV0aG9kLFxyXG4gICAgICAgIG5vdGVzLFxyXG4gICAgICAgIHN0YXR1czogJ1BFTkRJTkcnLFxyXG4gICAgICAgIGl0ZW1zOiB7XHJcbiAgICAgICAgICBjcmVhdGU6IG9yZGVySXRlbXNcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBpdGVtczoge1xyXG4gICAgICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgICAgICBwcm9kdWN0OiB0cnVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBVcGRhdGUgcHJvZHVjdCBzdG9ja1xyXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XHJcbiAgICAgIGF3YWl0IHByaXNtYS5wcm9kdWN0LnVwZGF0ZSh7XHJcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGl0ZW0ucHJvZHVjdElkIH0sXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgc3RvY2tRdWFudGl0eToge1xyXG4gICAgICAgICAgICBkZWNyZW1lbnQ6IGl0ZW0ucXVhbnRpdHlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgbWVzc2FnZTogJ09yZGVyIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcclxuICAgICAgb3JkZXJcclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignQ3JlYXRlIG9yZGVyIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIG9yZGVyJyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBVcGRhdGUgb3JkZXIgc3RhdHVzXHJcbnJvdXRlci5wdXQoJy86aWQvc3RhdHVzJywgW1xyXG4gIHBhcmFtKCdpZCcpLmlzVVVJRCgpLFxyXG4gIGJvZHkoJ3N0YXR1cycpLmlzSW4oWydQRU5ESU5HJywgJ0NPTkZJUk1FRCcsICdTSElQUEVEJywgJ0RFTElWRVJFRCcsICdDQU5DRUxMRUQnXSksXHJcbiAgYm9keSgnbm90ZXMnKS5vcHRpb25hbCgpLmlzU3RyaW5nKClcclxuXSwgaGFuZGxlVmFsaWRhdGlvbkVycm9ycywgYXV0aE1pZGRsZXdhcmUubWFuYWdlck9yQWRtaW4oKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBjb25zdCB7IHN0YXR1cywgbm90ZXMgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIC8vIENoZWNrIGlmIG9yZGVyIGV4aXN0c1xyXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBwcmlzbWEub3JkZXIuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghb3JkZXIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ09yZGVyIG5vdCBmb3VuZCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXBkYXRlRGF0YSA9IHsgc3RhdHVzIH07XHJcbiAgICBcclxuICAgIC8vIEFkZCB0aW1lc3RhbXAgYmFzZWQgb24gc3RhdHVzXHJcbiAgICBpZiAoc3RhdHVzID09PSAnQ09ORklSTUVEJykgdXBkYXRlRGF0YS5jb25maXJtZWRBdCA9IG5ldyBEYXRlKCk7XHJcbiAgICBpZiAoc3RhdHVzID09PSAnU0hJUFBFRCcpIHVwZGF0ZURhdGEuc2hpcHBlZEF0ID0gbmV3IERhdGUoKTtcclxuICAgIGlmIChzdGF0dXMgPT09ICdERUxJVkVSRUQnKSB1cGRhdGVEYXRhLmRlbGl2ZXJlZEF0ID0gbmV3IERhdGUoKTtcclxuICAgIFxyXG4gICAgaWYgKG5vdGVzKSB1cGRhdGVEYXRhLm5vdGVzID0gbm90ZXM7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlZE9yZGVyID0gYXdhaXQgcHJpc21hLm9yZGVyLnVwZGF0ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkIH0sXHJcbiAgICAgIGRhdGE6IHVwZGF0ZURhdGFcclxuICAgIH0pO1xyXG5cclxuICAgIHJlcy5qc29uKHtcclxuICAgICAgbWVzc2FnZTogJ09yZGVyIHN0YXR1cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseScsXHJcbiAgICAgIG9yZGVyOiB1cGRhdGVkT3JkZXJcclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignVXBkYXRlIG9yZGVyIHN0YXR1cyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSBvcmRlciBzdGF0dXMnLFxyXG4gICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyJdLCJtYXBwaW5ncyI6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