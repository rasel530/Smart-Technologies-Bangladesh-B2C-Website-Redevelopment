{"version":3,"names":["sessionService","require","describe","test","mockReq","ip","get","jest","fn","mockReturnValue","result","createSession","rememberMe","loginType","expect","toHaveProperty","toBe","persistent","maxAge","console","log","sessionId1","generateSessionId","sessionId2","toMatch","not","toHaveLength","mockReq1","mockReq2","fingerprint1","generateDeviceFingerprint","fingerprint2","originalRedis","redis","setEx","del","zAdd","expire","createRememberMeToken","success","mockResolvedValue","JSON","stringify","userId","token","deviceFingerprint","createdAt","Date","toISOString","expiresAt","now","validateRememberMeToken","valid","sessionResult","undefined","sessionId","Math","round"],"sources":["remember-me-basic.test.js"],"sourcesContent":["// Basic remember me functionality test\r\nconst { sessionService } = require('../services/sessionService');\r\n\r\ndescribe('Remember Me Basic Functionality', () => {\r\n  describe('Session Creation', () => {\r\n    test('should create session with remember me enabled', async () => {\r\n      const mockReq = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn().mockReturnValue('Mozilla/5.0 (Test Browser)')\r\n      };\r\n\r\n      const result = await sessionService.createSession('user-123', mockReq, {\r\n        rememberMe: true,\r\n        loginType: 'password'\r\n      });\r\n\r\n      expect(result).toHaveProperty('sessionId');\r\n      expect(result).toHaveProperty('expiresAt');\r\n      expect(result).toHaveProperty('maxAge');\r\n      expect(result.rememberMe).toBe(true);\r\n      expect(result.persistent).toBe(true);\r\n      expect(result.maxAge).toBe(7 * 24 * 60 * 60 * 1000);\r\n      console.log('‚úÖ Remember me session creation test passed');\r\n    });\r\n\r\n    test('should create session without remember me', async () => {\r\n      const mockReq = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn().mockReturnValue('Mozilla/5.0 (Test Browser)')\r\n      };\r\n\r\n      const result = await sessionService.createSession('user-123', mockReq, {\r\n        rememberMe: false,\r\n        loginType: 'password'\r\n      });\r\n\r\n      expect(result.rememberMe).toBe(false);\r\n      expect(result.persistent).toBe(false);\r\n      expect(result.maxAge).toBe(24 * 60 * 60 * 1000);\r\n      console.log('‚úÖ Standard session creation test passed');\r\n    });\r\n  });\r\n\r\n  describe('Session ID Generation', () => {\r\n    test('should generate secure session IDs', () => {\r\n      const sessionId1 = sessionService.generateSessionId();\r\n      const sessionId2 = sessionService.generateSessionId();\r\n      \r\n      expect(sessionId1).toMatch(/^[a-f0-9]{32}$/);\r\n      expect(sessionId2).toMatch(/^[a-f0-9]{32}$/);\r\n      expect(sessionId1).not.toBe(sessionId2);\r\n      expect(sessionId1).toHaveLength(64);\r\n      console.log('‚úÖ Session ID generation test passed');\r\n    });\r\n  });\r\n\r\n  describe('Device Fingerprinting', () => {\r\n    test('should generate consistent device fingerprints', () => {\r\n      const mockReq1 = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn().mockReturnValue('Mozilla/5.0 (Windows NT 10.0; Win64; x64)')\r\n      };\r\n\r\n      const mockReq2 = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn().mockReturnValue('Mozilla/5.0 (Windows NT 10.0; Win64; x64)')\r\n      };\r\n\r\n      const fingerprint1 = sessionService.generateDeviceFingerprint(mockReq1);\r\n      const fingerprint2 = sessionService.generateDeviceFingerprint(mockReq2);\r\n\r\n      expect(fingerprint1).toMatch(/^[a-f0-9]{32}$/);\r\n      expect(fingerprint2).toMatch(/^[a-f0-9]{32}$/);\r\n      expect(fingerprint1).toBe(fingerprint2);\r\n      expect(fingerprint1).toHaveLength(32);\r\n      console.log('‚úÖ Device fingerprinting test passed');\r\n    });\r\n  });\r\n\r\n  describe('Remember Me Token Management', () => {\r\n    test('should create remember me token successfully', async () => {\r\n      const mockReq = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn().mockReturnValue('Mozilla/5.0 (Test Browser)')\r\n      };\r\n\r\n      // Mock Redis for this test\r\n      const originalRedis = sessionService.redis;\r\n      sessionService.redis = {\r\n        setEx: jest.fn(),\r\n        get: jest.fn(),\r\n        del: jest.fn(),\r\n        zAdd: jest.fn(),\r\n        expire: jest.fn()\r\n      };\r\n\r\n      const result = await sessionService.createRememberMeToken('user-123', mockReq);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result).toHaveProperty('token');\r\n      expect(result).toHaveProperty('expiresAt');\r\n      \r\n      // Restore original Redis\r\n      sessionService.redis = originalRedis;\r\n      \r\n      console.log('‚úÖ Remember me token creation test passed');\r\n    });\r\n\r\n    test('should validate remember me token successfully', async () => {\r\n      const mockReq = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn().mockReturnValue('Mozilla/5.0 (Test Browser)')\r\n      };\r\n\r\n      // Mock Redis for this test\r\n      const originalRedis = sessionService.redis;\r\n      sessionService.redis = {\r\n        get: jest.fn().mockResolvedValue(JSON.stringify({\r\n          userId: 'user-123',\r\n          token: 'test-token',\r\n          deviceFingerprint: 'test-fingerprint',\r\n          createdAt: new Date().toISOString(),\r\n          expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()\r\n        })),\r\n        del: jest.fn()\r\n      };\r\n\r\n      const result = await sessionService.validateRememberMeToken('test-token');\r\n\r\n      expect(result.valid).toBe(true);\r\n      expect(result.userId).toBe('user-123');\r\n      expect(result.deviceFingerprint).toBe('test-fingerprint');\r\n      \r\n      // Restore original Redis\r\n      sessionService.redis = originalRedis;\r\n      \r\n      console.log('‚úÖ Remember me token validation test passed');\r\n    });\r\n  });\r\n\r\n  describe('Integration Test', () => {\r\n    test('should demonstrate complete remember me flow', async () => {\r\n      console.log('üß™ Starting remember me integration test...');\r\n      \r\n      // Step 1: Create session with remember me\r\n      const mockReq = {\r\n        ip: '127.0.0.1',\r\n        get: jest.fn().mockReturnValue('Mozilla/5.0 (Test Browser)')\r\n      };\r\n\r\n      const sessionResult = await sessionService.createSession('user-123', mockReq, {\r\n        rememberMe: true,\r\n        loginType: 'password'\r\n      });\r\n\r\n      expect(sessionResult.success !== undefined).toBe(true);\r\n      expect(sessionResult.rememberMe).toBe(true);\r\n      expect(sessionResult.persistent).toBe(true);\r\n      expect(sessionResult.maxAge).toBe(7 * 24 * 60 * 60 * 1000);\r\n\r\n      console.log('‚úÖ Remember me integration test completed successfully');\r\n      console.log(`üìä Session ID: ${sessionResult.sessionId}`);\r\n      console.log(`‚è∞ Expires at: ${sessionResult.expiresAt.toISOString()}`);\r\n      console.log(`üìÖ Max age: ${sessionResult.maxAge}ms (${Math.round(sessionResult.maxAge / (24 * 60 * 60 * 1000))} days)`);\r\n    });\r\n  });\r\n});"],"mappings":"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","ignoreList":[]}