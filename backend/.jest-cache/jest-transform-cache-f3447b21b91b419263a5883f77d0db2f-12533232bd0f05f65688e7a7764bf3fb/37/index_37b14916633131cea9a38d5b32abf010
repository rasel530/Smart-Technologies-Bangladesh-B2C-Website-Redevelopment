4553f57f26707a7363a37740b50bdebd
const express = require('express');
const cors = require('cors');
const helmet = require('helmet');
const morgan = require('morgan');
require('dotenv').config();

// Import services
const {
  databaseService
} = require('./services/database');
const {
  configService
} = require('./services/config');
const {
  loggerService
} = require('./services/logger');
const {
  authMiddleware
} = require('./middleware/auth');
const {
  swaggerService
} = require('./swagger');

// Import routes
const authRoutes = require('./routes/auth');
const userRoutes = require('./routes/users');
const productRoutes = require('./routes/products');
const categoryRoutes = require('./routes/categories');
const brandRoutes = require('./routes/brands');
const orderRoutes = require('./routes/orders');
const cartRoutes = require('./routes/cart');
const wishlistRoutes = require('./routes/wishlist');
const reviewRoutes = require('./routes/reviews');
const couponRoutes = require('./routes/coupons');
const routeIndex = require('./routes/index');
const app = express();
const PORT = configService.get('PORT');

// Middleware
app.use(helmet());

// Enhanced CORS configuration with strict origin validation
const corsConfig = configService.getCORSConfig();
const allowedOrigins = process.env.NODE_ENV === 'production' ? ['https://smarttechnologies-bd.com', 'https://www.smarttechnologies-bd.com', 'https://admin.smarttechnologies-bd.com'] : process.env.NODE_ENV === 'staging' ? ['https://staging.smarttechnologies-bd.com', 'https://admin-staging.smarttechnologies-bd.com'] : ['http://localhost:3000', 'http://localhost:3001', 'http://127.0.0.1:3000', 'http://127.0.0.1:3001'];
app.use(cors({
  origin: function (origin, callback) {
    // Allow requests with no origin (like mobile apps or curl requests)
    if (!origin) return callback(null, true);
    if (allowedOrigins.indexOf(origin) !== -1) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: corsConfig.credentials,
  methods: corsConfig.methods,
  allowedHeaders: corsConfig.allowedHeaders,
  exposedHeaders: corsConfig.exposedHeaders,
  optionsSuccessStatus: 200
}));
app.use(morgan('combined', {
  stream: loggerService.stream()
}));
app.use(express.json());
app.use(express.urlencoded({
  extended: true
}));

// Request ID middleware
app.use(authMiddleware.requestId());

// Authentication middleware (optional)
app.use('/api/v1/auth', authMiddleware.optional());

// Rate limiting
app.use(authMiddleware.rateLimit());

// API routes
app.use('/api', routeIndex);

// Basic route
app.get('/', (req, res) => {
  res.json({
    message: 'Smart Technologies Bangladesh B2C Website Backend API',
    version: '1.0.0',
    status: 'running',
    database: 'connected',
    services: {
      database: databaseService.getClient() ? 'connected' : 'disconnected',
      config: 'loaded',
      logger: 'active'
    }
  });
});

// Health check endpoint with database connection
app.get('/health', async (req, res) => {
  try {
    const healthStatus = await databaseService.healthCheck();
    res.status(200).json({
      status: 'OK',
      timestamp: new Date().toISOString(),
      database: healthStatus.database,
      environment: configService.get('NODE_ENV')
    });
  } catch (error) {
    loggerService.error('Health check failed', error);
    res.status(503).json({
      status: 'ERROR',
      timestamp: new Date().toISOString(),
      database: 'disconnected',
      error: 'Database connection failed'
    });
  }
});

// Database status endpoint
app.get('/api/db-status', async (req, res) => {
  try {
    const stats = await databaseService.getStats();
    res.status(200).json({
      status: 'connected',
      statistics: stats,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    loggerService.error('Database status check failed', error);
    res.status(500).json({
      status: 'error',
      error: 'Failed to retrieve database statistics',
      timestamp: new Date().toISOString()
    });
  }
});

// Swagger documentation endpoint
app.get('/api-docs', (req, res) => {
  try {
    const swaggerSpec = swaggerService.generateSwaggerSpec();
    res.setHeader('Content-Type', 'application/json');
    res.send(swaggerSpec);
  } catch (error) {
    loggerService.error('Failed to generate Swagger docs', error);
    res.status(500).json({
      error: 'Failed to generate API documentation',
      timestamp: new Date().toISOString()
    });
  }
});

// Error handling middleware
const {
  errorLogger
} = require('./middleware/auth');
app.use(errorLogger());

// 404 handler
app.use((req, res) => {
  res.status(404).json({
    error: 'Route not found',
    path: req.originalUrl,
    timestamp: new Date().toISOString()
  });
});

// Graceful shutdown
process.on('SIGINT', async () => {
  loggerService.info('Server shutdown initiated', {
    signal: 'SIGINT'
  });
  await databaseService.disconnect();
  loggerService.cleanup();
  process.exit(0);
});
process.on('SIGTERM', async () => {
  loggerService.info('Server shutdown initiated', {
    signal: 'SIGTERM'
  });
  await databaseService.disconnect();
  loggerService.cleanup();
  process.exit(0);
});

// Start server
app.listen(PORT, '0.0.0.0', async () => {
  loggerService.info('Server started', {
    port: PORT,
    environment: configService.get('NODE_ENV'),
    database: 'configured',
    timestamp: new Date().toISOString()
  });

  // Test database connection on startup
  try {
    await databaseService.connect();
    loggerService.info('Database connection established successfully');
  } catch (error) {
    loggerService.error('Database connection failed on startup', error);
  }
});
module.exports = {
  app
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImNvcnMiLCJoZWxtZXQiLCJtb3JnYW4iLCJjb25maWciLCJkYXRhYmFzZVNlcnZpY2UiLCJjb25maWdTZXJ2aWNlIiwibG9nZ2VyU2VydmljZSIsImF1dGhNaWRkbGV3YXJlIiwic3dhZ2dlclNlcnZpY2UiLCJhdXRoUm91dGVzIiwidXNlclJvdXRlcyIsInByb2R1Y3RSb3V0ZXMiLCJjYXRlZ29yeVJvdXRlcyIsImJyYW5kUm91dGVzIiwib3JkZXJSb3V0ZXMiLCJjYXJ0Um91dGVzIiwid2lzaGxpc3RSb3V0ZXMiLCJyZXZpZXdSb3V0ZXMiLCJjb3Vwb25Sb3V0ZXMiLCJyb3V0ZUluZGV4IiwiYXBwIiwiUE9SVCIsImdldCIsInVzZSIsImNvcnNDb25maWciLCJnZXRDT1JTQ29uZmlnIiwiYWxsb3dlZE9yaWdpbnMiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJvcmlnaW4iLCJjYWxsYmFjayIsImluZGV4T2YiLCJFcnJvciIsImNyZWRlbnRpYWxzIiwibWV0aG9kcyIsImFsbG93ZWRIZWFkZXJzIiwiZXhwb3NlZEhlYWRlcnMiLCJvcHRpb25zU3VjY2Vzc1N0YXR1cyIsInN0cmVhbSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJyZXF1ZXN0SWQiLCJvcHRpb25hbCIsInJhdGVMaW1pdCIsInJlcSIsInJlcyIsIm1lc3NhZ2UiLCJ2ZXJzaW9uIiwic3RhdHVzIiwiZGF0YWJhc2UiLCJzZXJ2aWNlcyIsImdldENsaWVudCIsImxvZ2dlciIsImhlYWx0aFN0YXR1cyIsImhlYWx0aENoZWNrIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZW52aXJvbm1lbnQiLCJlcnJvciIsInN0YXRzIiwiZ2V0U3RhdHMiLCJzdGF0aXN0aWNzIiwic3dhZ2dlclNwZWMiLCJnZW5lcmF0ZVN3YWdnZXJTcGVjIiwic2V0SGVhZGVyIiwic2VuZCIsImVycm9yTG9nZ2VyIiwicGF0aCIsIm9yaWdpbmFsVXJsIiwib24iLCJpbmZvIiwic2lnbmFsIiwiZGlzY29ubmVjdCIsImNsZWFudXAiLCJleGl0IiwibGlzdGVuIiwicG9ydCIsImNvbm5lY3QiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3QgY29ycyA9IHJlcXVpcmUoJ2NvcnMnKTtcclxuY29uc3QgaGVsbWV0ID0gcmVxdWlyZSgnaGVsbWV0Jyk7XHJcbmNvbnN0IG1vcmdhbiA9IHJlcXVpcmUoJ21vcmdhbicpO1xyXG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKTtcclxuXHJcbi8vIEltcG9ydCBzZXJ2aWNlc1xyXG5jb25zdCB7IGRhdGFiYXNlU2VydmljZSB9ID0gcmVxdWlyZSgnLi9zZXJ2aWNlcy9kYXRhYmFzZScpO1xyXG5jb25zdCB7IGNvbmZpZ1NlcnZpY2UgfSA9IHJlcXVpcmUoJy4vc2VydmljZXMvY29uZmlnJyk7XHJcbmNvbnN0IHsgbG9nZ2VyU2VydmljZSB9ID0gcmVxdWlyZSgnLi9zZXJ2aWNlcy9sb2dnZXInKTtcclxuY29uc3QgeyBhdXRoTWlkZGxld2FyZSB9ID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlL2F1dGgnKTtcclxuY29uc3QgeyBzd2FnZ2VyU2VydmljZSB9ID0gcmVxdWlyZSgnLi9zd2FnZ2VyJyk7XHJcblxyXG4vLyBJbXBvcnQgcm91dGVzXHJcbmNvbnN0IGF1dGhSb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9hdXRoJyk7XHJcbmNvbnN0IHVzZXJSb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy91c2VycycpO1xyXG5jb25zdCBwcm9kdWN0Um91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvcHJvZHVjdHMnKTtcclxuY29uc3QgY2F0ZWdvcnlSb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9jYXRlZ29yaWVzJyk7XHJcbmNvbnN0IGJyYW5kUm91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvYnJhbmRzJyk7XHJcbmNvbnN0IG9yZGVyUm91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvb3JkZXJzJyk7XHJcbmNvbnN0IGNhcnRSb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9jYXJ0Jyk7XHJcbmNvbnN0IHdpc2hsaXN0Um91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvd2lzaGxpc3QnKTtcclxuY29uc3QgcmV2aWV3Um91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvcmV2aWV3cycpO1xyXG5jb25zdCBjb3Vwb25Sb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9jb3Vwb25zJyk7XHJcbmNvbnN0IHJvdXRlSW5kZXggPSByZXF1aXJlKCcuL3JvdXRlcy9pbmRleCcpO1xyXG5cclxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xyXG5jb25zdCBQT1JUID0gY29uZmlnU2VydmljZS5nZXQoJ1BPUlQnKTtcclxuXHJcbi8vIE1pZGRsZXdhcmVcclxuYXBwLnVzZShoZWxtZXQoKSk7XHJcblxyXG4vLyBFbmhhbmNlZCBDT1JTIGNvbmZpZ3VyYXRpb24gd2l0aCBzdHJpY3Qgb3JpZ2luIHZhbGlkYXRpb25cclxuY29uc3QgY29yc0NvbmZpZyA9IGNvbmZpZ1NlcnZpY2UuZ2V0Q09SU0NvbmZpZygpO1xyXG5jb25zdCBhbGxvd2VkT3JpZ2lucyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbidcclxuICA/IFtcclxuICAgICAgJ2h0dHBzOi8vc21hcnR0ZWNobm9sb2dpZXMtYmQuY29tJyxcclxuICAgICAgJ2h0dHBzOi8vd3d3LnNtYXJ0dGVjaG5vbG9naWVzLWJkLmNvbScsXHJcbiAgICAgICdodHRwczovL2FkbWluLnNtYXJ0dGVjaG5vbG9naWVzLWJkLmNvbSdcclxuICAgIF1cclxuICA6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnc3RhZ2luZydcclxuICA/IFtcclxuICAgICAgJ2h0dHBzOi8vc3RhZ2luZy5zbWFydHRlY2hub2xvZ2llcy1iZC5jb20nLFxyXG4gICAgICAnaHR0cHM6Ly9hZG1pbi1zdGFnaW5nLnNtYXJ0dGVjaG5vbG9naWVzLWJkLmNvbSdcclxuICAgIF1cclxuICA6IFtcclxuICAgICAgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcsXHJcbiAgICAgICdodHRwOi8vbG9jYWxob3N0OjMwMDEnLFxyXG4gICAgICAnaHR0cDovLzEyNy4wLjAuMTozMDAwJyxcclxuICAgICAgJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMSdcclxuICAgIF07XHJcblxyXG5hcHAudXNlKGNvcnMoe1xyXG4gIG9yaWdpbjogZnVuY3Rpb24gKG9yaWdpbiwgY2FsbGJhY2spIHtcclxuICAgIC8vIEFsbG93IHJlcXVlc3RzIHdpdGggbm8gb3JpZ2luIChsaWtlIG1vYmlsZSBhcHBzIG9yIGN1cmwgcmVxdWVzdHMpXHJcbiAgICBpZiAoIW9yaWdpbikgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHRydWUpO1xyXG4gICAgXHJcbiAgICBpZiAoYWxsb3dlZE9yaWdpbnMuaW5kZXhPZihvcmlnaW4pICE9PSAtMSkge1xyXG4gICAgICBjYWxsYmFjayhudWxsLCB0cnVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcignTm90IGFsbG93ZWQgYnkgQ09SUycpKTtcclxuICAgIH1cclxuICB9LFxyXG4gIGNyZWRlbnRpYWxzOiBjb3JzQ29uZmlnLmNyZWRlbnRpYWxzLFxyXG4gIG1ldGhvZHM6IGNvcnNDb25maWcubWV0aG9kcyxcclxuICBhbGxvd2VkSGVhZGVyczogY29yc0NvbmZpZy5hbGxvd2VkSGVhZGVycyxcclxuICBleHBvc2VkSGVhZGVyczogY29yc0NvbmZpZy5leHBvc2VkSGVhZGVycyxcclxuICBvcHRpb25zU3VjY2Vzc1N0YXR1czogMjAwXHJcbn0pKTtcclxuXHJcbmFwcC51c2UobW9yZ2FuKCdjb21iaW5lZCcsIHsgc3RyZWFtOiBsb2dnZXJTZXJ2aWNlLnN0cmVhbSgpIH0pKTtcclxuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XHJcbmFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpO1xyXG5cclxuLy8gUmVxdWVzdCBJRCBtaWRkbGV3YXJlXHJcbmFwcC51c2UoYXV0aE1pZGRsZXdhcmUucmVxdWVzdElkKCkpO1xyXG5cclxuLy8gQXV0aGVudGljYXRpb24gbWlkZGxld2FyZSAob3B0aW9uYWwpXHJcbmFwcC51c2UoJy9hcGkvdjEvYXV0aCcsIGF1dGhNaWRkbGV3YXJlLm9wdGlvbmFsKCkpO1xyXG5cclxuLy8gUmF0ZSBsaW1pdGluZ1xyXG5hcHAudXNlKGF1dGhNaWRkbGV3YXJlLnJhdGVMaW1pdCgpKTtcclxuXHJcbi8vIEFQSSByb3V0ZXNcclxuYXBwLnVzZSgnL2FwaScsIHJvdXRlSW5kZXgpO1xyXG5cclxuLy8gQmFzaWMgcm91dGVcclxuYXBwLmdldCgnLycsIChyZXEsIHJlcykgPT4ge1xyXG4gIHJlcy5qc29uKHtcclxuICAgIG1lc3NhZ2U6ICdTbWFydCBUZWNobm9sb2dpZXMgQmFuZ2xhZGVzaCBCMkMgV2Vic2l0ZSBCYWNrZW5kIEFQSScsXHJcbiAgICB2ZXJzaW9uOiAnMS4wLjAnLFxyXG4gICAgc3RhdHVzOiAncnVubmluZycsXHJcbiAgICBkYXRhYmFzZTogJ2Nvbm5lY3RlZCcsXHJcbiAgICBzZXJ2aWNlczoge1xyXG4gICAgICBkYXRhYmFzZTogZGF0YWJhc2VTZXJ2aWNlLmdldENsaWVudCgpID8gJ2Nvbm5lY3RlZCcgOiAnZGlzY29ubmVjdGVkJyxcclxuICAgICAgY29uZmlnOiAnbG9hZGVkJyxcclxuICAgICAgbG9nZ2VyOiAnYWN0aXZlJ1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8vIEhlYWx0aCBjaGVjayBlbmRwb2ludCB3aXRoIGRhdGFiYXNlIGNvbm5lY3Rpb25cclxuYXBwLmdldCgnL2hlYWx0aCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBoZWFsdGhTdGF0dXMgPSBhd2FpdCBkYXRhYmFzZVNlcnZpY2UuaGVhbHRoQ2hlY2soKTtcclxuICAgIFxyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICBzdGF0dXM6ICdPSycsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICBkYXRhYmFzZTogaGVhbHRoU3RhdHVzLmRhdGFiYXNlLFxyXG4gICAgICBlbnZpcm9ubWVudDogY29uZmlnU2VydmljZS5nZXQoJ05PREVfRU5WJylcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXJTZXJ2aWNlLmVycm9yKCdIZWFsdGggY2hlY2sgZmFpbGVkJywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDMpLmpzb24oe1xyXG4gICAgICBzdGF0dXM6ICdFUlJPUicsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICBkYXRhYmFzZTogJ2Rpc2Nvbm5lY3RlZCcsXHJcbiAgICAgIGVycm9yOiAnRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gRGF0YWJhc2Ugc3RhdHVzIGVuZHBvaW50XHJcbmFwcC5nZXQoJy9hcGkvZGItc3RhdHVzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgZGF0YWJhc2VTZXJ2aWNlLmdldFN0YXRzKCk7XHJcbiAgICBcclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgc3RhdHVzOiAnY29ubmVjdGVkJyxcclxuICAgICAgc3RhdGlzdGljczogc3RhdHMsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgbG9nZ2VyU2VydmljZS5lcnJvcignRGF0YWJhc2Ugc3RhdHVzIGNoZWNrIGZhaWxlZCcsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3RhdHVzOiAnZXJyb3InLFxyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byByZXRyaWV2ZSBkYXRhYmFzZSBzdGF0aXN0aWNzJyxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBTd2FnZ2VyIGRvY3VtZW50YXRpb24gZW5kcG9pbnRcclxuYXBwLmdldCgnL2FwaS1kb2NzJywgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN3YWdnZXJTcGVjID0gc3dhZ2dlclNlcnZpY2UuZ2VuZXJhdGVTd2FnZ2VyU3BlYygpO1xyXG4gICAgXHJcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgcmVzLnNlbmQoc3dhZ2dlclNwZWMpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXJTZXJ2aWNlLmVycm9yKCdGYWlsZWQgdG8gZ2VuZXJhdGUgU3dhZ2dlciBkb2NzJywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBnZW5lcmF0ZSBBUEkgZG9jdW1lbnRhdGlvbicsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gRXJyb3IgaGFuZGxpbmcgbWlkZGxld2FyZVxyXG5jb25zdCB7IGVycm9yTG9nZ2VyIH0gPSByZXF1aXJlKCcuL21pZGRsZXdhcmUvYXV0aCcpO1xyXG5hcHAudXNlKGVycm9yTG9nZ2VyKCkpO1xyXG5cclxuLy8gNDA0IGhhbmRsZXJcclxuYXBwLnVzZSgocmVxLCByZXMpID0+IHtcclxuICByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICBlcnJvcjogJ1JvdXRlIG5vdCBmb3VuZCcsXHJcbiAgICBwYXRoOiByZXEub3JpZ2luYWxVcmwsXHJcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8vIEdyYWNlZnVsIHNodXRkb3duXHJcbnByb2Nlc3Mub24oJ1NJR0lOVCcsIGFzeW5jICgpID0+IHtcclxuICBsb2dnZXJTZXJ2aWNlLmluZm8oJ1NlcnZlciBzaHV0ZG93biBpbml0aWF0ZWQnLCB7IHNpZ25hbDogJ1NJR0lOVCcgfSk7XHJcbiAgYXdhaXQgZGF0YWJhc2VTZXJ2aWNlLmRpc2Nvbm5lY3QoKTtcclxuICBsb2dnZXJTZXJ2aWNlLmNsZWFudXAoKTtcclxuICBwcm9jZXNzLmV4aXQoMCk7XHJcbn0pO1xyXG5cclxucHJvY2Vzcy5vbignU0lHVEVSTScsIGFzeW5jICgpID0+IHtcclxuICBsb2dnZXJTZXJ2aWNlLmluZm8oJ1NlcnZlciBzaHV0ZG93biBpbml0aWF0ZWQnLCB7IHNpZ25hbDogJ1NJR1RFUk0nIH0pO1xyXG4gIGF3YWl0IGRhdGFiYXNlU2VydmljZS5kaXNjb25uZWN0KCk7XHJcbiAgbG9nZ2VyU2VydmljZS5jbGVhbnVwKCk7XHJcbiAgcHJvY2Vzcy5leGl0KDApO1xyXG59KTtcclxuXHJcbi8vIFN0YXJ0IHNlcnZlclxyXG5hcHAubGlzdGVuKFBPUlQsICcwLjAuMC4wJywgYXN5bmMgKCkgPT4ge1xyXG4gIGxvZ2dlclNlcnZpY2UuaW5mbygnU2VydmVyIHN0YXJ0ZWQnLCB7XHJcbiAgICBwb3J0OiBQT1JULFxyXG4gICAgZW52aXJvbm1lbnQ6IGNvbmZpZ1NlcnZpY2UuZ2V0KCdOT0RFX0VOVicpLFxyXG4gICAgZGF0YWJhc2U6ICdjb25maWd1cmVkJyxcclxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgfSk7XHJcbiAgXHJcbiAgLy8gVGVzdCBkYXRhYmFzZSBjb25uZWN0aW9uIG9uIHN0YXJ0dXBcclxuICB0cnkge1xyXG4gICAgYXdhaXQgZGF0YWJhc2VTZXJ2aWNlLmNvbm5lY3QoKTtcclxuICAgIGxvZ2dlclNlcnZpY2UuaW5mbygnRGF0YWJhc2UgY29ubmVjdGlvbiBlc3RhYmxpc2hlZCBzdWNjZXNzZnVsbHknKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgbG9nZ2VyU2VydmljZS5lcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQgb24gc3RhcnR1cCcsIGVycm9yKTtcclxuICB9XHJcbn0pO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7IGFwcCB9OyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLElBQUksR0FBR0QsT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUM1QixNQUFNRSxNQUFNLEdBQUdGLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsTUFBTUcsTUFBTSxHQUFHSCxPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDQSxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUNJLE1BQU0sQ0FBQyxDQUFDOztBQUUxQjtBQUNBLE1BQU07RUFBRUM7QUFBZ0IsQ0FBQyxHQUFHTCxPQUFPLENBQUMscUJBQXFCLENBQUM7QUFDMUQsTUFBTTtFQUFFTTtBQUFjLENBQUMsR0FBR04sT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQ3RELE1BQU07RUFBRU87QUFBYyxDQUFDLEdBQUdQLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUN0RCxNQUFNO0VBQUVRO0FBQWUsQ0FBQyxHQUFHUixPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDdkQsTUFBTTtFQUFFUztBQUFlLENBQUMsR0FBR1QsT0FBTyxDQUFDLFdBQVcsQ0FBQzs7QUFFL0M7QUFDQSxNQUFNVSxVQUFVLEdBQUdWLE9BQU8sQ0FBQyxlQUFlLENBQUM7QUFDM0MsTUFBTVcsVUFBVSxHQUFHWCxPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDNUMsTUFBTVksYUFBYSxHQUFHWixPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDbEQsTUFBTWEsY0FBYyxHQUFHYixPQUFPLENBQUMscUJBQXFCLENBQUM7QUFDckQsTUFBTWMsV0FBVyxHQUFHZCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDOUMsTUFBTWUsV0FBVyxHQUFHZixPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDOUMsTUFBTWdCLFVBQVUsR0FBR2hCLE9BQU8sQ0FBQyxlQUFlLENBQUM7QUFDM0MsTUFBTWlCLGNBQWMsR0FBR2pCLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUNuRCxNQUFNa0IsWUFBWSxHQUFHbEIsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBQ2hELE1BQU1tQixZQUFZLEdBQUduQixPQUFPLENBQUMsa0JBQWtCLENBQUM7QUFDaEQsTUFBTW9CLFVBQVUsR0FBR3BCLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUU1QyxNQUFNcUIsR0FBRyxHQUFHdEIsT0FBTyxDQUFDLENBQUM7QUFDckIsTUFBTXVCLElBQUksR0FBR2hCLGFBQWEsQ0FBQ2lCLEdBQUcsQ0FBQyxNQUFNLENBQUM7O0FBRXRDO0FBQ0FGLEdBQUcsQ0FBQ0csR0FBRyxDQUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQzs7QUFFakI7QUFDQSxNQUFNdUIsVUFBVSxHQUFHbkIsYUFBYSxDQUFDb0IsYUFBYSxDQUFDLENBQUM7QUFDaEQsTUFBTUMsY0FBYyxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLLFlBQVksR0FDeEQsQ0FDRSxrQ0FBa0MsRUFDbEMsc0NBQXNDLEVBQ3RDLHdDQUF3QyxDQUN6QyxHQUNERixPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLLFNBQVMsR0FDbEMsQ0FDRSwwQ0FBMEMsRUFDMUMsZ0RBQWdELENBQ2pELEdBQ0QsQ0FDRSx1QkFBdUIsRUFDdkIsdUJBQXVCLEVBQ3ZCLHVCQUF1QixFQUN2Qix1QkFBdUIsQ0FDeEI7QUFFTFQsR0FBRyxDQUFDRyxHQUFHLENBQUN2QixJQUFJLENBQUM7RUFDWDhCLE1BQU0sRUFBRSxTQUFBQSxDQUFVQSxNQUFNLEVBQUVDLFFBQVEsRUFBRTtJQUNsQztJQUNBLElBQUksQ0FBQ0QsTUFBTSxFQUFFLE9BQU9DLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDO0lBRXhDLElBQUlMLGNBQWMsQ0FBQ00sT0FBTyxDQUFDRixNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtNQUN6Q0MsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7SUFDdEIsQ0FBQyxNQUFNO01BQ0xBLFFBQVEsQ0FBQyxJQUFJRSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUM1QztFQUNGLENBQUM7RUFDREMsV0FBVyxFQUFFVixVQUFVLENBQUNVLFdBQVc7RUFDbkNDLE9BQU8sRUFBRVgsVUFBVSxDQUFDVyxPQUFPO0VBQzNCQyxjQUFjLEVBQUVaLFVBQVUsQ0FBQ1ksY0FBYztFQUN6Q0MsY0FBYyxFQUFFYixVQUFVLENBQUNhLGNBQWM7RUFDekNDLG9CQUFvQixFQUFFO0FBQ3hCLENBQUMsQ0FBQyxDQUFDO0FBRUhsQixHQUFHLENBQUNHLEdBQUcsQ0FBQ3JCLE1BQU0sQ0FBQyxVQUFVLEVBQUU7RUFBRXFDLE1BQU0sRUFBRWpDLGFBQWEsQ0FBQ2lDLE1BQU0sQ0FBQztBQUFFLENBQUMsQ0FBQyxDQUFDO0FBQy9EbkIsR0FBRyxDQUFDRyxHQUFHLENBQUN6QixPQUFPLENBQUMwQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ3ZCcEIsR0FBRyxDQUFDRyxHQUFHLENBQUN6QixPQUFPLENBQUMyQyxVQUFVLENBQUM7RUFBRUMsUUFBUSxFQUFFO0FBQUssQ0FBQyxDQUFDLENBQUM7O0FBRS9DO0FBQ0F0QixHQUFHLENBQUNHLEdBQUcsQ0FBQ2hCLGNBQWMsQ0FBQ29DLFNBQVMsQ0FBQyxDQUFDLENBQUM7O0FBRW5DO0FBQ0F2QixHQUFHLENBQUNHLEdBQUcsQ0FBQyxjQUFjLEVBQUVoQixjQUFjLENBQUNxQyxRQUFRLENBQUMsQ0FBQyxDQUFDOztBQUVsRDtBQUNBeEIsR0FBRyxDQUFDRyxHQUFHLENBQUNoQixjQUFjLENBQUNzQyxTQUFTLENBQUMsQ0FBQyxDQUFDOztBQUVuQztBQUNBekIsR0FBRyxDQUFDRyxHQUFHLENBQUMsTUFBTSxFQUFFSixVQUFVLENBQUM7O0FBRTNCO0FBQ0FDLEdBQUcsQ0FBQ0UsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDd0IsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDekJBLEdBQUcsQ0FBQ1AsSUFBSSxDQUFDO0lBQ1BRLE9BQU8sRUFBRSx1REFBdUQ7SUFDaEVDLE9BQU8sRUFBRSxPQUFPO0lBQ2hCQyxNQUFNLEVBQUUsU0FBUztJQUNqQkMsUUFBUSxFQUFFLFdBQVc7SUFDckJDLFFBQVEsRUFBRTtNQUNSRCxRQUFRLEVBQUUvQyxlQUFlLENBQUNpRCxTQUFTLENBQUMsQ0FBQyxHQUFHLFdBQVcsR0FBRyxjQUFjO01BQ3BFbEQsTUFBTSxFQUFFLFFBQVE7TUFDaEJtRCxNQUFNLEVBQUU7SUFDVjtFQUNGLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQzs7QUFFRjtBQUNBbEMsR0FBRyxDQUFDRSxHQUFHLENBQUMsU0FBUyxFQUFFLE9BQU93QixHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNyQyxJQUFJO0lBQ0YsTUFBTVEsWUFBWSxHQUFHLE1BQU1uRCxlQUFlLENBQUNvRCxXQUFXLENBQUMsQ0FBQztJQUV4RFQsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNWLElBQUksQ0FBQztNQUNuQlUsTUFBTSxFQUFFLElBQUk7TUFDWk8sU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQyxDQUFDO01BQ25DUixRQUFRLEVBQUVJLFlBQVksQ0FBQ0osUUFBUTtNQUMvQlMsV0FBVyxFQUFFdkQsYUFBYSxDQUFDaUIsR0FBRyxDQUFDLFVBQVU7SUFDM0MsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDLE9BQU91QyxLQUFLLEVBQUU7SUFDZHZELGFBQWEsQ0FBQ3VELEtBQUssQ0FBQyxxQkFBcUIsRUFBRUEsS0FBSyxDQUFDO0lBQ2pEZCxHQUFHLENBQUNHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ1YsSUFBSSxDQUFDO01BQ25CVSxNQUFNLEVBQUUsT0FBTztNQUNmTyxTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7TUFDbkNSLFFBQVEsRUFBRSxjQUFjO01BQ3hCVSxLQUFLLEVBQUU7SUFDVCxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBekMsR0FBRyxDQUFDRSxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsT0FBT3dCLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQzVDLElBQUk7SUFDRixNQUFNZSxLQUFLLEdBQUcsTUFBTTFELGVBQWUsQ0FBQzJELFFBQVEsQ0FBQyxDQUFDO0lBRTlDaEIsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNWLElBQUksQ0FBQztNQUNuQlUsTUFBTSxFQUFFLFdBQVc7TUFDbkJjLFVBQVUsRUFBRUYsS0FBSztNQUNqQkwsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUMsT0FBT0UsS0FBSyxFQUFFO0lBQ2R2RCxhQUFhLENBQUN1RCxLQUFLLENBQUMsOEJBQThCLEVBQUVBLEtBQUssQ0FBQztJQUMxRGQsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNWLElBQUksQ0FBQztNQUNuQlUsTUFBTSxFQUFFLE9BQU87TUFDZlcsS0FBSyxFQUFFLHdDQUF3QztNQUMvQ0osU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBdkMsR0FBRyxDQUFDRSxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUN3QixHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNqQyxJQUFJO0lBQ0YsTUFBTWtCLFdBQVcsR0FBR3pELGNBQWMsQ0FBQzBELG1CQUFtQixDQUFDLENBQUM7SUFFeERuQixHQUFHLENBQUNvQixTQUFTLENBQUMsY0FBYyxFQUFFLGtCQUFrQixDQUFDO0lBQ2pEcEIsR0FBRyxDQUFDcUIsSUFBSSxDQUFDSCxXQUFXLENBQUM7RUFDdkIsQ0FBQyxDQUFDLE9BQU9KLEtBQUssRUFBRTtJQUNkdkQsYUFBYSxDQUFDdUQsS0FBSyxDQUFDLGlDQUFpQyxFQUFFQSxLQUFLLENBQUM7SUFDN0RkLEdBQUcsQ0FBQ0csTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDVixJQUFJLENBQUM7TUFDbkJxQixLQUFLLEVBQUUsc0NBQXNDO01BQzdDSixTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztFQUNKO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0EsTUFBTTtFQUFFVTtBQUFZLENBQUMsR0FBR3RFLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUNwRHFCLEdBQUcsQ0FBQ0csR0FBRyxDQUFDOEMsV0FBVyxDQUFDLENBQUMsQ0FBQzs7QUFFdEI7QUFDQWpELEdBQUcsQ0FBQ0csR0FBRyxDQUFDLENBQUN1QixHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNwQkEsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNWLElBQUksQ0FBQztJQUNuQnFCLEtBQUssRUFBRSxpQkFBaUI7SUFDeEJTLElBQUksRUFBRXhCLEdBQUcsQ0FBQ3lCLFdBQVc7SUFDckJkLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUM7RUFDcEMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDOztBQUVGO0FBQ0FoQyxPQUFPLENBQUM2QyxFQUFFLENBQUMsUUFBUSxFQUFFLFlBQVk7RUFDL0JsRSxhQUFhLENBQUNtRSxJQUFJLENBQUMsMkJBQTJCLEVBQUU7SUFBRUMsTUFBTSxFQUFFO0VBQVMsQ0FBQyxDQUFDO0VBQ3JFLE1BQU10RSxlQUFlLENBQUN1RSxVQUFVLENBQUMsQ0FBQztFQUNsQ3JFLGFBQWEsQ0FBQ3NFLE9BQU8sQ0FBQyxDQUFDO0VBQ3ZCakQsT0FBTyxDQUFDa0QsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNqQixDQUFDLENBQUM7QUFFRmxELE9BQU8sQ0FBQzZDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsWUFBWTtFQUNoQ2xFLGFBQWEsQ0FBQ21FLElBQUksQ0FBQywyQkFBMkIsRUFBRTtJQUFFQyxNQUFNLEVBQUU7RUFBVSxDQUFDLENBQUM7RUFDdEUsTUFBTXRFLGVBQWUsQ0FBQ3VFLFVBQVUsQ0FBQyxDQUFDO0VBQ2xDckUsYUFBYSxDQUFDc0UsT0FBTyxDQUFDLENBQUM7RUFDdkJqRCxPQUFPLENBQUNrRCxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ2pCLENBQUMsQ0FBQzs7QUFFRjtBQUNBekQsR0FBRyxDQUFDMEQsTUFBTSxDQUFDekQsSUFBSSxFQUFFLFNBQVMsRUFBRSxZQUFZO0VBQ3RDZixhQUFhLENBQUNtRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7SUFDbkNNLElBQUksRUFBRTFELElBQUk7SUFDVnVDLFdBQVcsRUFBRXZELGFBQWEsQ0FBQ2lCLEdBQUcsQ0FBQyxVQUFVLENBQUM7SUFDMUM2QixRQUFRLEVBQUUsWUFBWTtJQUN0Qk0sU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztFQUNwQyxDQUFDLENBQUM7O0VBRUY7RUFDQSxJQUFJO0lBQ0YsTUFBTXZELGVBQWUsQ0FBQzRFLE9BQU8sQ0FBQyxDQUFDO0lBQy9CMUUsYUFBYSxDQUFDbUUsSUFBSSxDQUFDLDhDQUE4QyxDQUFDO0VBQ3BFLENBQUMsQ0FBQyxPQUFPWixLQUFLLEVBQUU7SUFDZHZELGFBQWEsQ0FBQ3VELEtBQUssQ0FBQyx1Q0FBdUMsRUFBRUEsS0FBSyxDQUFDO0VBQ3JFO0FBQ0YsQ0FBQyxDQUFDO0FBRUZvQixNQUFNLENBQUNDLE9BQU8sR0FBRztFQUFFOUQ7QUFBSSxDQUFDIiwiaWdub3JlTGlzdCI6W119