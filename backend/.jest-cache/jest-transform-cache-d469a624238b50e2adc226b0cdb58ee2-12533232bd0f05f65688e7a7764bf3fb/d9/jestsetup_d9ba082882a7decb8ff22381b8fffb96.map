{"version":3,"names":["_getJestObj","mock","loggerService","info","jest","fn","warn","error","debug","logAuth","logSecurity","logPerformance","configService","get","key","defaults","getJWTConfig","secret","algorithm","issuer","expiresIn","getCORSConfig","origin","methods","allowedHeaders","exposedHeaders","isProduction","validateConfig","createClient","connect","mockResolvedValue","on","set","setEx","del","hGetAll","hIncrBy","hSet","expire","multi","zRemRangeByScore","mockReturnThis","zAdd","zCard","exec","reply","sign","verify","userId","email","role","iat","Date","now","exp","decode","PrismaClient","$connect","$disconnect","$use","$on","$transaction","cart","findMany","findUnique","findFirst","create","update","delete","upsert","cartItem","product","user","require","process","env","NODE_ENV","originalConsole","console","beforeAll","log","afterAll","Object","assign","setTimeout","global","testUtils","createMockRequest","overrides","body","params","query","headers","ip","createMockResponse","res","status","json","send","header","end","createMockNext","waitFor","ms","Promise","resolve","generateTestToken","payload","jwt","afterEach","clearAllMocks"],"sources":["jest.setup.js"],"sourcesContent":["\r\n/**\r\n * Jest Setup File\r\n * \r\n * This file sets up the test environment for all Jest tests\r\n * including global mocks, test utilities, and configuration\r\n */\r\n\r\n// Set test environment\r\nprocess.env.NODE_ENV = 'test';\r\n\r\n// Mock console methods to reduce noise in tests\r\nconst originalConsole = { ...console };\r\nbeforeAll(() => {\r\n  console.log = jest.fn();\r\n  console.info = jest.fn();\r\n  console.warn = jest.fn();\r\n  console.error = jest.fn();\r\n});\r\n\r\nafterAll(() => {\r\n  // Restore original console methods\r\n  Object.assign(console, originalConsole);\r\n});\r\n\r\n// Global test timeout\r\njest.setTimeout(30000);\r\n\r\n// Mock modules that cause issues in tests\r\njest.mock('../services/logger', () => ({\r\n  loggerService: {\r\n    info: jest.fn(),\r\n    warn: jest.fn(),\r\n    error: jest.fn(),\r\n    debug: jest.fn(),\r\n    logAuth: jest.fn(),\r\n    logSecurity: jest.fn(),\r\n    logPerformance: jest.fn()\r\n  }\r\n}));\r\n\r\njest.mock('../services/config', () => ({\r\n  configService: {\r\n    get: jest.fn((key) => {\r\n      const defaults = {\r\n        'JWT_SECRET': 'test-jwt-secret-key',\r\n        'DATABASE_URL': 'postgresql://test:test@localhost:5432/test_db',\r\n        'REDIS_URL': 'redis://localhost:6379',\r\n        'NODE_ENV': 'test'\r\n      };\r\n      return defaults[key] || null;\r\n    }),\r\n    getJWTConfig: jest.fn(() => ({\r\n      secret: 'test-jwt-secret-key',\r\n      algorithm: 'HS256',\r\n      issuer: 'smart-technologies-bd',\r\n      expiresIn: '1h'\r\n    })),\r\n    getCORSConfig: jest.fn(() => ({\r\n      origin: '*',\r\n      methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\r\n      allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],\r\n      exposedHeaders: ['X-Total-Count', 'X-Request-ID']\r\n    })),\r\n    isProduction: jest.fn(() => false),\r\n    validateConfig: jest.fn()\r\n  }\r\n}));\r\n\r\n// Mock Redis\r\njest.mock('redis', () => ({\r\n  createClient: jest.fn(() => ({\r\n    connect: jest.fn().mockResolvedValue(),\r\n    on: jest.fn(),\r\n    get: jest.fn().mockResolvedValue(null),\r\n    set: jest.fn().mockResolvedValue(),\r\n    setEx: jest.fn().mockResolvedValue(),\r\n    del: jest.fn().mockResolvedValue(),\r\n    hGetAll: jest.fn().mockResolvedValue({}),\r\n    hIncrBy: jest.fn().mockResolvedValue(),\r\n    hSet: jest.fn().mockResolvedValue(),\r\n    expire: jest.fn().mockResolvedValue(),\r\n    multi: jest.fn(() => ({\r\n      zRemRangeByScore: jest.fn().mockReturnThis(),\r\n      zAdd: jest.fn().mockReturnThis(),\r\n      zCard: jest.fn().mockReturnThis(),\r\n      exec: jest.fn().mockResolvedValue([{ reply: 0 }, { reply: 0 }, { reply: 0 }])\r\n    }))\r\n  }))\r\n}));\r\n\r\n// Mock JWT\r\njest.mock('jsonwebtoken', () => ({\r\n  sign: jest.fn(() => 'mock-jwt-token'),\r\n  verify: jest.fn(() => ({\r\n    userId: 'test-user-id',\r\n    email: 'test@example.com',\r\n    role: 'CUSTOMER',\r\n    iat: Date.now() / 1000,\r\n    exp: (Date.now() / 1000) + 3600\r\n  })),\r\n  decode: jest.fn(() => ({\r\n    userId: 'test-user-id',\r\n    exp: (Date.now() / 1000) + 3600\r\n  }))\r\n}));\r\n\r\n// Mock Prisma\r\njest.mock('@prisma/client', () => ({\r\n  PrismaClient: jest.fn(() => ({\r\n    $connect: jest.fn().mockResolvedValue(),\r\n    $disconnect: jest.fn().mockResolvedValue(),\r\n    $use: jest.fn(),\r\n    $on: jest.fn(),\r\n    $transaction: jest.fn(),\r\n    cart: {\r\n      findMany: jest.fn(),\r\n      findUnique: jest.fn(),\r\n      findFirst: jest.fn(),\r\n      create: jest.fn(),\r\n      update: jest.fn(),\r\n      delete: jest.fn(),\r\n      upsert: jest.fn()\r\n    },\r\n    cartItem: {\r\n      findMany: jest.fn(),\r\n      findUnique: jest.fn(),\r\n      findFirst: jest.fn(),\r\n      create: jest.fn(),\r\n      update: jest.fn(),\r\n      delete: jest.fn(),\r\n      upsert: jest.fn()\r\n    },\r\n    product: {\r\n      findMany: jest.fn(),\r\n      findUnique: jest.fn(),\r\n      findFirst: jest.fn(),\r\n      create: jest.fn(),\r\n      update: jest.fn(),\r\n      delete: jest.fn()\r\n    },\r\n    user: {\r\n      findMany: jest.fn(),\r\n      findUnique: jest.fn(),\r\n      findFirst: jest.fn(),\r\n      create: jest.fn(),\r\n      update: jest.fn(),\r\n      delete: jest.fn()\r\n    }\r\n  }))\r\n}));\r\n\r\n// Global test utilities\r\nglobal.testUtils = {\r\n  /**\r\n   * Create a mock request object\r\n   */\r\n  createMockRequest: (overrides = {}) => ({\r\n    body: {},\r\n    params: {},\r\n    query: {},\r\n    headers: {},\r\n    ip: '127.0.0.1',\r\n    get: jest.fn(),\r\n    ...overrides\r\n  }),\r\n\r\n  /**\r\n   * Create a mock response object\r\n   */\r\n  createMockResponse: () => {\r\n    const res = {\r\n      status: jest.fn().mockReturnThis(),\r\n      json: jest.fn().mockReturnThis(),\r\n      send: jest.fn().mockReturnThis(),\r\n      set: jest.fn().mockReturnThis(),\r\n      header: jest.fn().mockReturnThis(),\r\n      end: jest.fn().mockReturnThis()\r\n    };\r\n    return res;\r\n  },\r\n\r\n  /**\r\n   * Create a mock next function\r\n   */\r\n  createMockNext: () => jest.fn(),\r\n\r\n  /**\r\n   * Wait for async operations\r\n   */\r\n  waitFor: (ms = 0) => new Promise(resolve => setTimeout(resolve, ms)),\r\n\r\n  /**\r\n   * Generate test JWT token\r\n   */\r\n  generateTestToken: (payload = {}) => {\r\n    const jwt = require('jsonwebtoken');\r\n    return jwt.sign({\r\n      userId: 'test-user-id',\r\n      email: 'test@example.com',\r\n      role: 'CUSTOMER',\r\n      ...payload\r\n    }, 'test-jwt-secret-key', { expiresIn: '1h' });\r\n  }\r\n};\r\n\r\n// Clean up after each test\r\nafterEach(() => {\r\n  jest.clearAllMocks();\r\n});\r\n\r\n"],"mappings":"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","ignoreList":[]}