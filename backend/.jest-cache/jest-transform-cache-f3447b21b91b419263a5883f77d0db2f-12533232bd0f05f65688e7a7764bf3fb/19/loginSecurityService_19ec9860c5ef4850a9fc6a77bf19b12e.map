{"version":3,"names":["crypto","require","PrismaClient","configService","loggerService","LoginSecurityService","constructor","prisma","redis","config","logger","initializeRedis","Redis","redisUrl","get","warn","createClient","url","retry_delay_on_failover","max_retries_per_request","connectTimeout","lazyConnect","socket","keepAlive","reconnectStrategy","retries","error","Math","min","pipeline","multi","exec","on","err","message","info","connect","getSecurityConfig","maxAttempts","attemptWindow","lockoutDuration","maxLockouts","ipMaxAttempts","ipBlockDuration","delayEnabled","baseDelay","maxDelay","captchaThreshold","captchaEnabled","recordFailedAttempt","identifier","ip","userAgent","reason","securityConfig","now","Date","isEmail","includes","identifierType","recordFailedAttemptInRedis","recordFailedAttemptInDatabase","logSecurity","timestamp","toISOString","userKey","zAdd","score","value","randomBytes","toString","expire","ceil","ipKey","suspiciousKey","hIncrBy","checkAndApplyUserLockout","checkAndApplyIPBlock","attempts","zRange","recentAttempts","filter","attempt","parseInt","split","length","lockoutKey","lockoutExpiry","setEx","JSON","stringify","lockedAt","expiresAt","blockKey","blockExpiry","blockedAt","isUserLockedOut","lockoutData","lockout","parse","isLocked","remainingTime","max","getTime","isIPBlocked","blockData","block","isBlocked","calculateProgressiveDelay","attemptCount","delay","pow","isCaptchaRequired","clearFailedAttempts","del","zRemRangeByScore","getLoginAttemptStats","stats","userAttempts","ipAttempts","isUserLocked","captchaRequired","progressiveDelay","zCard","lockoutStatus","blockStatus","generateDeviceFingerprint","req","acceptLanguage","acceptEncoding","accept","fingerprint","createHash","update","digest","substring","checkSuspiciousPatterns","suspicious","isSuspicious","reasons","riskScore","suspiciousData","hGetAll","count","push","maliciousPatterns","some","pattern","test","automatedPatterns","cleanupExpiredData","cleanedCount","patterns","keys","key","ttl","success","loginSecurityService","module","exports"],"sources":["loginSecurityService.js"],"sourcesContent":["const crypto = require('crypto');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst { configService } = require('./config');\r\nconst { loggerService } = require('./logger');\r\n\r\nclass LoginSecurityService {\r\n  constructor() {\r\n    this.prisma = new PrismaClient();\r\n    this.redis = null;\r\n    this.config = configService;\r\n    this.logger = loggerService;\r\n    this.initializeRedis();\r\n  }\r\n\r\n  async initializeRedis() {\r\n    try {\r\n      const Redis = require('redis');\r\n      const redisUrl = this.config.get('REDIS_URL');\r\n      \r\n      if (!redisUrl) {\r\n        this.logger.warn('REDIS_URL not configured, login security will use database only');\r\n        return;\r\n      }\r\n\r\n      this.redis = Redis.createClient({\r\n        url: redisUrl,\r\n        retry_delay_on_failover: 100,\r\n        max_retries_per_request: 3,\r\n        connectTimeout: 10000,\r\n        lazyConnect: false,\r\n        socket: {\r\n          keepAlive: true,\r\n          reconnectStrategy: (retries) => {\r\n            if (retries > 10) {\r\n              this.logger.error('Redis reconnection failed after 10 attempts');\r\n              return false;\r\n            }\r\n            return Math.min(retries * 100, 3000);\r\n          }\r\n        }\r\n      });\r\n\r\n      // Add pipeline method support\r\n      this.redis.pipeline = () => {\r\n        const pipeline = this.redis.multi();\r\n        pipeline.exec = () => this.redis.exec(pipeline);\r\n        return pipeline;\r\n      };\r\n\r\n      this.redis.on('error', (err) => {\r\n        this.logger.error('Redis connection error in login security service', err.message);\r\n        // Don't set redis to null, allow reconnection\r\n      });\r\n\r\n      this.redis.on('connect', () => {\r\n        this.logger.info('Redis connected for login security service');\r\n      });\r\n\r\n      this.redis.on('ready', () => {\r\n        this.logger.info('Redis ready for login security service');\r\n      });\r\n\r\n      this.redis.on('reconnecting', () => {\r\n        this.logger.info('Redis reconnecting for login security service');\r\n      });\r\n\r\n      await this.redis.connect();\r\n    } catch (error) {\r\n      this.logger.error('Failed to initialize Redis for login security service', error.message);\r\n      this.redis = null;\r\n    }\r\n  }\r\n\r\n  // Get security configuration\r\n  getSecurityConfig() {\r\n    return {\r\n      // Login attempt limits\r\n      maxAttempts: this.config.get('MAX_LOGIN_ATTEMPTS') || 5,\r\n      attemptWindow: this.config.get('LOGIN_ATTEMPT_WINDOW') || 15 * 60 * 1000, // 15 minutes\r\n      \r\n      // Account lockout settings\r\n      lockoutDuration: this.config.get('ACCOUNT_LOCKOUT_DURATION') || 30 * 60 * 1000, // 30 minutes\r\n      maxLockouts: this.config.get('MAX_ACCOUNT_LOCKOUTS') || 3,\r\n      \r\n      // IP blocking settings\r\n      ipMaxAttempts: this.config.get('IP_MAX_ATTEMPTS') || 20,\r\n      ipBlockDuration: this.config.get('IP_BLOCK_DURATION') || 60 * 60 * 1000, // 1 hour\r\n      \r\n      // Progressive delay settings\r\n      delayEnabled: this.config.get('LOGIN_DELAY_ENABLED') !== 'false',\r\n      baseDelay: this.config.get('LOGIN_BASE_DELAY') || 1000, // 1 second\r\n      maxDelay: this.config.get('LOGIN_MAX_DELAY') || 10000, // 10 seconds\r\n      \r\n      // Captcha settings\r\n      captchaThreshold: this.config.get('CAPTCHA_THRESHOLD') || 3,\r\n      captchaEnabled: this.config.get('CAPTCHA_ENABLED') === 'true'\r\n    };\r\n  }\r\n\r\n  // Record failed login attempt\r\n  async recordFailedAttempt(identifier, ip, userAgent, reason = 'invalid_credentials') {\r\n    try {\r\n      const securityConfig = this.getSecurityConfig();\r\n      const now = Date.now();\r\n      \r\n      // Determine if identifier is email or phone\r\n      const isEmail = identifier.includes('@');\r\n      const identifierType = isEmail ? 'email' : 'phone';\r\n      \r\n      // Record attempt in Redis if available\r\n      if (this.redis) {\r\n        await this.recordFailedAttemptInRedis(identifier, ip, userAgent, reason, now, securityConfig);\r\n      } else {\r\n        await this.recordFailedAttemptInDatabase(identifier, ip, userAgent, reason, now, securityConfig);\r\n      }\r\n\r\n      // Log security event\r\n      this.logger.logSecurity('Failed Login Attempt', null, {\r\n        identifier,\r\n        identifierType,\r\n        ip,\r\n        userAgent,\r\n        reason,\r\n        timestamp: new Date(now).toISOString()\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to record failed login attempt', error.message);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Record failed attempt in Redis\r\n  async recordFailedAttemptInRedis(identifier, ip, userAgent, reason, now, config) {\r\n    const pipeline = this.redis.pipeline();\r\n    \r\n    // Record user-specific attempts\r\n    const userKey = `login_attempts:${identifier}`;\r\n    pipeline.zAdd(userKey, [{ score: now, value: `${now}-${crypto.randomBytes(8).toString('hex')}` }]);\r\n    pipeline.expire(userKey, Math.ceil(config.attemptWindow / 1000));\r\n    \r\n    // Record IP-specific attempts\r\n    const ipKey = `ip_attempts:${ip}`;\r\n    pipeline.zAdd(ipKey, [{ score: now, value: `${now}-${crypto.randomBytes(8).toString('hex')}` }]);\r\n    pipeline.expire(ipKey, Math.ceil(config.attemptWindow / 1000));\r\n    \r\n    // Record global suspicious activity\r\n    const suspiciousKey = `suspicious_activity:${ip}`;\r\n    pipeline.hIncrBy(suspiciousKey, 'count', 1);\r\n    pipeline.expire(suspiciousKey, 24 * 60 * 60); // 24 hours\r\n    \r\n    await pipeline.exec();\r\n    \r\n    // Check if user should be locked out\r\n    await this.checkAndApplyUserLockout(identifier, config);\r\n    \r\n    // Check if IP should be blocked\r\n    await this.checkAndApplyIPBlock(ip, config);\r\n  }\r\n\r\n  // Record failed attempt in database (fallback)\r\n  async recordFailedAttemptInDatabase(identifier, ip, userAgent, reason, now, config) {\r\n    // This would require creating loginAttempt and loginLockout tables\r\n    // For now, we'll implement a basic version using existing structures\r\n    this.logger.warn('Using database fallback for login attempt recording - consider implementing dedicated tables');\r\n  }\r\n\r\n  // Check and apply user lockout\r\n  async checkAndApplyUserLockout(identifier, config) {\r\n    if (!this.redis) return;\r\n    \r\n    const userKey = `login_attempts:${identifier}`;\r\n    const attempts = await this.redis.zRange(userKey, 0, -1);\r\n    \r\n    const recentAttempts = attempts.filter(attempt => {\r\n      const score = parseInt(attempt.split('-')[0]);\r\n      return (Date.now() - score) < config.attemptWindow;\r\n    });\r\n    \r\n    if (recentAttempts.length >= config.maxAttempts) {\r\n      const lockoutKey = `user_lockout:${identifier}`;\r\n      const lockoutExpiry = Date.now() + config.lockoutDuration;\r\n      \r\n      await this.redis.setEx(lockoutKey, Math.ceil(config.lockoutDuration / 1000), JSON.stringify({\r\n        reason: 'too_many_attempts',\r\n        attempts: recentAttempts.length,\r\n        lockedAt: new Date().toISOString(),\r\n        expiresAt: new Date(lockoutExpiry).toISOString()\r\n      }));\r\n      \r\n      this.logger.logSecurity('User Locked Out', null, {\r\n        identifier,\r\n        reason: 'too_many_attempts',\r\n        attempts: recentAttempts.length,\r\n        lockedAt: new Date().toISOString(),\r\n        expiresAt: new Date(lockoutExpiry).toISOString()\r\n      });\r\n    }\r\n  }\r\n\r\n  // Check and apply IP block\r\n  async checkAndApplyIPBlock(ip, config) {\r\n    if (!this.redis) return;\r\n    \r\n    const ipKey = `ip_attempts:${ip}`;\r\n    const attempts = await this.redis.zRange(ipKey, 0, -1);\r\n    \r\n    const recentAttempts = attempts.filter(attempt => {\r\n      const score = parseInt(attempt.split('-')[0]);\r\n      return (Date.now() - score) < config.attemptWindow;\r\n    });\r\n    \r\n    if (recentAttempts.length >= config.ipMaxAttempts) {\r\n      const blockKey = `ip_block:${ip}`;\r\n      const blockExpiry = Date.now() + config.ipBlockDuration;\r\n      \r\n      await this.redis.setEx(blockKey, Math.ceil(config.ipBlockDuration / 1000), JSON.stringify({\r\n        reason: 'too_many_attempts',\r\n        attempts: recentAttempts.length,\r\n        blockedAt: new Date().toISOString(),\r\n        expiresAt: new Date(blockExpiry).toISOString()\r\n      }));\r\n      \r\n      this.logger.logSecurity('IP Blocked', null, {\r\n        ip,\r\n        reason: 'too_many_attempts',\r\n        attempts: recentAttempts.length,\r\n        blockedAt: new Date().toISOString(),\r\n        expiresAt: new Date(blockExpiry).toISOString()\r\n      });\r\n    }\r\n  }\r\n\r\n  // Check if user is locked out\r\n  async isUserLockedOut(identifier) {\r\n    try {\r\n      if (!this.redis) return false;\r\n      \r\n      const lockoutKey = `user_lockout:${identifier}`;\r\n      const lockoutData = await this.redis.get(lockoutKey);\r\n      \r\n      if (!lockoutData) return false;\r\n      \r\n      const lockout = JSON.parse(lockoutData);\r\n      return {\r\n        isLocked: true,\r\n        reason: lockout.reason,\r\n        lockedAt: lockout.lockedAt,\r\n        expiresAt: lockout.expiresAt,\r\n        remainingTime: Math.max(0, new Date(lockout.expiresAt).getTime() - Date.now())\r\n      };\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error checking user lockout status', error.message);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Check if IP is blocked\r\n  async isIPBlocked(ip) {\r\n    try {\r\n      if (!this.redis) return false;\r\n      \r\n      const blockKey = `ip_block:${ip}`;\r\n      const blockData = await this.redis.get(blockKey);\r\n      \r\n      if (!blockData) return false;\r\n      \r\n      const block = JSON.parse(blockData);\r\n      return {\r\n        isBlocked: true,\r\n        reason: block.reason,\r\n        blockedAt: block.blockedAt,\r\n        expiresAt: block.expiresAt,\r\n        remainingTime: Math.max(0, new Date(block.expiresAt).getTime() - Date.now())\r\n      };\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error checking IP block status', error.message);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Calculate progressive delay for failed attempts\r\n  async calculateProgressiveDelay(identifier, ip) {\r\n    try {\r\n      const config = this.getSecurityConfig();\r\n      if (!config.delayEnabled) return 0;\r\n      \r\n      let attemptCount = 0;\r\n      \r\n      if (this.redis) {\r\n        const userKey = `login_attempts:${identifier}`;\r\n        const attempts = await this.redis.zRange(userKey, 0, -1);\r\n        \r\n        attemptCount = attempts.filter(attempt => {\r\n          const score = parseInt(attempt.split('-')[0]);\r\n          return (Date.now() - score) < config.attemptWindow;\r\n        }).length;\r\n      }\r\n      \r\n      // Calculate exponential delay: baseDelay * (2 ^ (attempts - 1))\r\n      const delay = Math.min(\r\n        config.baseDelay * Math.pow(2, Math.max(0, attemptCount - 1)),\r\n        config.maxDelay\r\n      );\r\n      \r\n      return delay;\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error calculating progressive delay', error.message);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  // Check if captcha is required\r\n  async isCaptchaRequired(identifier, ip) {\r\n    try {\r\n      const config = this.getSecurityConfig();\r\n      if (!config.captchaEnabled) return false;\r\n      \r\n      if (!this.redis) return false;\r\n      \r\n      const userKey = `login_attempts:${identifier}`;\r\n      const attempts = await this.redis.zRange(userKey, 0, -1);\r\n      \r\n      const recentAttempts = attempts.filter(attempt => {\r\n        const score = parseInt(attempt.split('-')[0]);\r\n        return (Date.now() - score) < config.attemptWindow;\r\n      });\r\n      \r\n      return recentAttempts.length >= config.captchaThreshold;\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error checking captcha requirement', error.message);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Clear failed attempts after successful login\r\n  async clearFailedAttempts(identifier, ip) {\r\n    try {\r\n      if (this.redis) {\r\n        const pipeline = this.redis.pipeline();\r\n        \r\n        // Clear user attempts\r\n        const userKey = `login_attempts:${identifier}`;\r\n        pipeline.del(userKey);\r\n        \r\n        // Clear user lockout if exists\r\n        const lockoutKey = `user_lockout:${identifier}`;\r\n        pipeline.del(lockoutKey);\r\n        \r\n        // Reduce IP attempt count (but don't clear completely)\r\n        const ipKey = `ip_attempts:${ip}`;\r\n        pipeline.zRemRangeByScore(ipKey, 0, Date.now() - (15 * 60 * 1000));\r\n        \r\n        await pipeline.exec();\r\n        \r\n        this.logger.logSecurity('Login Attempts Cleared', null, {\r\n          identifier,\r\n          ip,\r\n          reason: 'successful_login',\r\n          timestamp: new Date().toISOString()\r\n        });\r\n      }\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error clearing failed attempts', error.message);\r\n    }\r\n  }\r\n\r\n  // Get login attempt statistics\r\n  async getLoginAttemptStats(identifier = null, ip = null) {\r\n    try {\r\n      const stats = {\r\n        userAttempts: 0,\r\n        ipAttempts: 0,\r\n        isUserLocked: false,\r\n        isIPBlocked: false,\r\n        captchaRequired: false,\r\n        progressiveDelay: 0\r\n      };\r\n      \r\n      if (this.redis) {\r\n        if (identifier) {\r\n          const userKey = `login_attempts:${identifier}`;\r\n          const userAttempts = await this.redis.zCard(userKey);\r\n          stats.userAttempts = userAttempts || 0;\r\n          \r\n          const lockoutStatus = await this.isUserLockedOut(identifier);\r\n          stats.isUserLocked = lockoutStatus.isLocked || false;\r\n          \r\n          const captchaRequired = await this.isCaptchaRequired(identifier, ip);\r\n          stats.captchaRequired = captchaRequired;\r\n          \r\n          const delay = await this.calculateProgressiveDelay(identifier, ip);\r\n          stats.progressiveDelay = delay;\r\n        }\r\n        \r\n        if (ip) {\r\n          const ipKey = `ip_attempts:${ip}`;\r\n          const ipAttempts = await this.redis.zCard(ipKey);\r\n          stats.ipAttempts = ipAttempts || 0;\r\n          \r\n          const blockStatus = await this.isIPBlocked(ip);\r\n          stats.isIPBlocked = blockStatus.isBlocked || false;\r\n        }\r\n      }\r\n      \r\n      return stats;\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error getting login attempt stats', error.message);\r\n      return {\r\n        userAttempts: 0,\r\n        ipAttempts: 0,\r\n        isUserLocked: false,\r\n        isIPBlocked: false,\r\n        captchaRequired: false,\r\n        progressiveDelay: 0\r\n      };\r\n    }\r\n  }\r\n\r\n  // Generate device fingerprint for enhanced security\r\n  generateDeviceFingerprint(req) {\r\n    const userAgent = req.get('User-Agent') || '';\r\n    const acceptLanguage = req.get('Accept-Language') || '';\r\n    const acceptEncoding = req.get('Accept-Encoding') || '';\r\n    const accept = req.get('Accept') || '';\r\n    \r\n    const fingerprint = crypto\r\n      .createHash('sha256')\r\n      .update(`${userAgent}|${acceptLanguage}|${acceptEncoding}|${accept}`)\r\n      .digest('hex');\r\n    \r\n    return fingerprint.substring(0, 32);\r\n  }\r\n\r\n  // Check for suspicious login patterns\r\n  async checkSuspiciousPatterns(identifier, ip, userAgent) {\r\n    try {\r\n      const suspicious = {\r\n        isSuspicious: false,\r\n        reasons: [],\r\n        riskScore: 0\r\n      };\r\n      \r\n      if (!this.redis) return suspicious;\r\n      \r\n      const now = Date.now();\r\n      const suspiciousKey = `suspicious_activity:${ip}`;\r\n      const suspiciousData = await this.redis.hGetAll(suspiciousKey);\r\n      \r\n      if (suspiciousData && suspiciousData.count) {\r\n        const attemptCount = parseInt(suspiciousData.count);\r\n        \r\n        // High number of attempts from same IP\r\n        if (attemptCount > 10) {\r\n          suspicious.isSuspicious = true;\r\n          suspicious.reasons.push('high_attempt_volume');\r\n          suspicious.riskScore += 3;\r\n        }\r\n        \r\n        // Rapid successive attempts\r\n        if (attemptCount > 5) {\r\n          suspicious.isSuspicious = true;\r\n          suspicious.reasons.push('rapid_attempts');\r\n          suspicious.riskScore += 2;\r\n        }\r\n      }\r\n      \r\n      // Check for known malicious user agents\r\n      const maliciousPatterns = [\r\n        /bot/i,\r\n        /crawler/i,\r\n        /scanner/i,\r\n        /sqlmap/i,\r\n        /nikto/i,\r\n        /nmap/i\r\n      ];\r\n      \r\n      if (maliciousPatterns.some(pattern => pattern.test(userAgent))) {\r\n        suspicious.isSuspicious = true;\r\n        suspicious.reasons.push('malicious_user_agent');\r\n        suspicious.riskScore += 5;\r\n      }\r\n      \r\n      // Check for automated tools\r\n      const automatedPatterns = [\r\n        /curl/i,\r\n        /wget/i,\r\n        /python/i,\r\n        /java/i,\r\n        /node/i\r\n      ];\r\n      \r\n      if (automatedPatterns.some(pattern => pattern.test(userAgent)) && suspicious.riskScore > 0) {\r\n        suspicious.isSuspicious = true;\r\n        suspicious.reasons.push('automated_tool');\r\n        suspicious.riskScore += 2;\r\n      }\r\n      \r\n      if (suspicious.isSuspicious) {\r\n        this.logger.logSecurity('Suspicious Login Pattern Detected', null, {\r\n          identifier,\r\n          ip,\r\n          userAgent,\r\n          reasons: suspicious.reasons,\r\n          riskScore: suspicious.riskScore,\r\n          timestamp: new Date(now).toISOString()\r\n        });\r\n      }\r\n      \r\n      return suspicious;\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error checking suspicious patterns', error.message);\r\n      return {\r\n        isSuspicious: false,\r\n        reasons: [],\r\n        riskScore: 0\r\n      };\r\n    }\r\n  }\r\n\r\n  // Cleanup expired security data\r\n  async cleanupExpiredData() {\r\n    try {\r\n      let cleanedCount = 0;\r\n      \r\n      if (this.redis) {\r\n        // Redis handles expiration automatically, but we can clean up any orphaned keys\r\n        const patterns = [\r\n          'login_attempts:*',\r\n          'ip_attempts:*',\r\n          'user_lockout:*',\r\n          'ip_block:*',\r\n          'suspicious_activity:*'\r\n        ];\r\n        \r\n        for (const pattern of patterns) {\r\n          const keys = await this.redis.keys(pattern);\r\n          for (const key of keys) {\r\n            const ttl = await this.redis.ttl(key);\r\n            if (ttl === -1) { // No expiration set\r\n              await this.redis.expire(key, 24 * 60 * 60); // Set 24 hour expiration\r\n              cleanedCount++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      \r\n      this.logger.info('Login security cleanup completed', {\r\n        cleanedCount,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      \r\n      return { success: true, cleanedCount };\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Login security cleanup error', error.message);\r\n      return { success: false, reason: 'Cleanup failed' };\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst loginSecurityService = new LoginSecurityService();\r\n\r\nmodule.exports = {\r\n  LoginSecurityService,\r\n  loginSecurityService\r\n};"],"mappings":"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","ignoreList":[]}