6394480c1658bb45f72356566b357fe2
const express = require('express');
const {
  body,
  param,
  validationResult
} = require('express-validator');
const {
  PrismaClient
} = require('@prisma/client');
const {
  authMiddleware
} = require('../middleware/auth');
const router = express.Router();
const prisma = new PrismaClient();

// Validation middleware
const handleValidationErrors = (req, res, next) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({
      error: 'Validation failed',
      details: errors.array()
    });
  }
  next();
};

// Get user's wishlists
router.get('/user/:userId', [param('userId').isUUID()], handleValidationErrors, (req, res, next) => {
  // Extract userId from params and use it for selfOrAdmin middleware
  const userId = req.params.userId;
  return authMiddleware.selfOrAdmin(userId)(req, res, next);
}, async (req, res) => {
  try {
    const {
      userId
    } = req.params;
    const wishlists = await prisma.wishlist.findMany({
      where: {
        userId
      },
      include: {
        _count: {
          items: true
        },
        items: {
          take: 5,
          include: {
            product: {
              include: {
                images: {
                  where: {
                    sortOrder: 0
                  },
                  take: 1,
                  select: {
                    id: true,
                    url: true,
                    alt: true
                  }
                }
              }
            }
          },
          orderBy: {
            addedAt: 'desc'
          }
        }
      },
      orderBy: {
        createdAt: 'desc'
      }
    });
    res.json({
      wishlists
    });
  } catch (error) {
    console.error('Get wishlists error:', error);
    res.status(500).json({
      error: 'Failed to fetch wishlists',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Get wishlist by ID
router.get('/:id', [param('id').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  // Get wishlist first to check ownership
  const wishlist = await prisma.wishlist.findUnique({
    where: {
      id: req.params.id
    },
    select: {
      userId: true
    }
  });
  if (!wishlist) {
    return res.status(404).json({
      error: 'Wishlist not found'
    });
  }

  // Check if user is admin or wishlist owner
  if (req.userRole !== 'ADMIN' && wishlist.userId !== req.userId) {
    return res.status(403).json({
      error: 'Access denied',
      message: 'You can only access your own wishlists'
    });
  }
  try {
    const {
      id
    } = req.params;
    const wishlist = await prisma.wishlist.findUnique({
      where: {
        id
      },
      include: {
        user: {
          select: {
            id: true,
            firstName: true,
            lastName: true
          }
        },
        items: {
          include: {
            product: {
              include: {
                images: {
                  where: {
                    sortOrder: 0
                  },
                  take: 1,
                  select: {
                    id: true,
                    url: true,
                    alt: true
                  }
                }
              }
            }
          },
          orderBy: {
            addedAt: 'desc'
          }
        },
        _count: {
          items: true
        }
      }
    });
    if (!wishlist) {
      return res.status(404).json({
        error: 'Wishlist not found'
      });
    }
    res.json({
      wishlist
    });
  } catch (error) {
    console.error('Get wishlist error:', error);
    res.status(500).json({
      error: 'Failed to fetch wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Create wishlist
router.post('/', [body('name').optional().isString().trim(), body('isPrivate').optional().isBoolean()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  // Use authenticated user's ID
  req.body.userId = req.userId;
  try {
    const {
      userId,
      name,
      isPrivate
    } = req.body;

    // Validate user exists
    const user = await prisma.user.findUnique({
      where: {
        id: userId
      }
    });
    if (!user) {
      return res.status(404).json({
        error: 'User not found'
      });
    }
    const wishlist = await prisma.wishlist.create({
      data: {
        userId,
        name: name || 'My Wishlist',
        isPrivate: isPrivate !== undefined ? isPrivate : false
      }
    });
    res.status(201).json({
      message: 'Wishlist created successfully',
      wishlist
    });
  } catch (error) {
    console.error('Create wishlist error:', error);
    res.status(500).json({
      error: 'Failed to create wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Add item to wishlist
router.post('/:id/items', [param('id').isUUID(), body('productId').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      id
    } = req.params;
    const {
      productId
    } = req.body;

    // Validate wishlist exists
    const wishlist = await prisma.wishlist.findUnique({
      where: {
        id
      }
    });
    if (!wishlist) {
      return res.status(404).json({
        error: 'Wishlist not found'
      });
    }

    // Validate product exists
    const product = await prisma.product.findUnique({
      where: {
        id: productId
      }
    });
    if (!product) {
      return res.status(404).json({
        error: 'Product not found'
      });
    }

    // Check if item already exists
    const existingItem = await prisma.wishlistItem.findFirst({
      where: {
        wishlistId: id,
        productId
      }
    });
    if (existingItem) {
      return res.status(409).json({
        error: 'Product already in wishlist'
      });
    }
    const wishlistItem = await prisma.wishlistItem.create({
      data: {
        wishlistId: id,
        productId
      },
      include: {
        product: true
      }
    });
    res.status(201).json({
      message: 'Item added to wishlist',
      item: wishlistItem
    });
  } catch (error) {
    console.error('Add to wishlist error:', error);
    res.status(500).json({
      error: 'Failed to add item to wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Remove item from wishlist
router.delete('/:wishlistId/items/:itemId', [param('wishlistId').isUUID(), param('itemId').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      wishlistId,
      itemId
    } = req.params;

    // Check if item exists
    const wishlistItem = await prisma.wishlistItem.findFirst({
      where: {
        id: itemId,
        wishlistId
      }
    });
    if (!wishlistItem) {
      return res.status(404).json({
        error: 'Wishlist item not found'
      });
    }
    await prisma.wishlistItem.delete({
      where: {
        id: itemId
      }
    });
    res.json({
      message: 'Item removed from wishlist'
    });
  } catch (error) {
    console.error('Remove wishlist item error:', error);
    res.status(500).json({
      error: 'Failed to remove item from wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});

// Delete wishlist
router.delete('/:id', [param('id').isUUID()], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {
  try {
    const {
      id
    } = req.params;

    // Check if wishlist exists
    const wishlist = await prisma.wishlist.findUnique({
      where: {
        id
      }
    });
    if (!wishlist) {
      return res.status(404).json({
        error: 'Wishlist not found'
      });
    }
    await prisma.wishlist.delete({
      where: {
        id
      }
    });
    res.json({
      message: 'Wishlist deleted successfully'
    });
  } catch (error) {
    console.error('Delete wishlist error:', error);
    res.status(500).json({
      error: 'Failed to delete wishlist',
      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'
    });
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImJvZHkiLCJwYXJhbSIsInZhbGlkYXRpb25SZXN1bHQiLCJQcmlzbWFDbGllbnQiLCJhdXRoTWlkZGxld2FyZSIsInJvdXRlciIsIlJvdXRlciIsInByaXNtYSIsImhhbmRsZVZhbGlkYXRpb25FcnJvcnMiLCJyZXEiLCJyZXMiLCJuZXh0IiwiZXJyb3JzIiwiaXNFbXB0eSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImRldGFpbHMiLCJhcnJheSIsImdldCIsImlzVVVJRCIsInVzZXJJZCIsInBhcmFtcyIsInNlbGZPckFkbWluIiwid2lzaGxpc3RzIiwid2lzaGxpc3QiLCJmaW5kTWFueSIsIndoZXJlIiwiaW5jbHVkZSIsIl9jb3VudCIsIml0ZW1zIiwidGFrZSIsInByb2R1Y3QiLCJpbWFnZXMiLCJzb3J0T3JkZXIiLCJzZWxlY3QiLCJpZCIsInVybCIsImFsdCIsIm9yZGVyQnkiLCJhZGRlZEF0IiwiY3JlYXRlZEF0IiwiY29uc29sZSIsIm1lc3NhZ2UiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJhdXRoZW50aWNhdGUiLCJmaW5kVW5pcXVlIiwidXNlclJvbGUiLCJ1c2VyIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJwb3N0Iiwib3B0aW9uYWwiLCJpc1N0cmluZyIsInRyaW0iLCJpc0Jvb2xlYW4iLCJuYW1lIiwiaXNQcml2YXRlIiwiY3JlYXRlIiwiZGF0YSIsInVuZGVmaW5lZCIsInByb2R1Y3RJZCIsImV4aXN0aW5nSXRlbSIsIndpc2hsaXN0SXRlbSIsImZpbmRGaXJzdCIsIndpc2hsaXN0SWQiLCJpdGVtIiwiZGVsZXRlIiwiaXRlbUlkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIndpc2hsaXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHsgYm9keSwgcGFyYW0sIHZhbGlkYXRpb25SZXN1bHQgfSA9IHJlcXVpcmUoJ2V4cHJlc3MtdmFsaWRhdG9yJyk7XHJcbmNvbnN0IHsgUHJpc21hQ2xpZW50IH0gPSByZXF1aXJlKCdAcHJpc21hL2NsaWVudCcpO1xyXG5jb25zdCB7IGF1dGhNaWRkbGV3YXJlIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcclxuXHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcclxuXHJcbi8vIFZhbGlkYXRpb24gbWlkZGxld2FyZVxyXG5jb25zdCBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xyXG4gIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXHJcbiAgICAgIGRldGFpbHM6IGVycm9ycy5hcnJheSgpXHJcbiAgICB9KTtcclxuICB9XHJcbiAgbmV4dCgpO1xyXG59O1xyXG5cclxuLy8gR2V0IHVzZXIncyB3aXNobGlzdHNcclxucm91dGVyLmdldCgnL3VzZXIvOnVzZXJJZCcsIFtcclxuICBwYXJhbSgndXNlcklkJykuaXNVVUlEKClcclxuXSwgaGFuZGxlVmFsaWRhdGlvbkVycm9ycywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgLy8gRXh0cmFjdCB1c2VySWQgZnJvbSBwYXJhbXMgYW5kIHVzZSBpdCBmb3Igc2VsZk9yQWRtaW4gbWlkZGxld2FyZVxyXG4gIGNvbnN0IHVzZXJJZCA9IHJlcS5wYXJhbXMudXNlcklkO1xyXG4gIHJldHVybiBhdXRoTWlkZGxld2FyZS5zZWxmT3JBZG1pbih1c2VySWQpKHJlcSwgcmVzLCBuZXh0KTtcclxufSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdXNlcklkIH0gPSByZXEucGFyYW1zO1xyXG5cclxuICAgIGNvbnN0IHdpc2hsaXN0cyA9IGF3YWl0IHByaXNtYS53aXNobGlzdC5maW5kTWFueSh7XHJcbiAgICAgIHdoZXJlOiB7IHVzZXJJZCB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgX2NvdW50OiB7XHJcbiAgICAgICAgICBpdGVtczogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXRlbXM6IHtcclxuICAgICAgICAgIHRha2U6IDUsXHJcbiAgICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICAgIHByb2R1Y3Q6IHtcclxuICAgICAgICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICAgICAgICBpbWFnZXM6IHtcclxuICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgc29ydE9yZGVyOiAwIH0sXHJcbiAgICAgICAgICAgICAgICAgIHRha2U6IDEsXHJcbiAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgdXJsOiB0cnVlLCBhbHQ6IHRydWUgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG9yZGVyQnk6IHsgYWRkZWRBdDogJ2Rlc2MnIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmVzLmpzb24oeyB3aXNobGlzdHMgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdHZXQgd2lzaGxpc3RzIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggd2lzaGxpc3RzJyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBHZXQgd2lzaGxpc3QgYnkgSURcclxucm91dGVyLmdldCgnLzppZCcsIFtcclxuICBwYXJhbSgnaWQnKS5pc1VVSUQoKVxyXG5dLCBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzLCBhdXRoTWlkZGxld2FyZS5hdXRoZW50aWNhdGUoKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgLy8gR2V0IHdpc2hsaXN0IGZpcnN0IHRvIGNoZWNrIG93bmVyc2hpcFxyXG4gIGNvbnN0IHdpc2hsaXN0ID0gYXdhaXQgcHJpc21hLndpc2hsaXN0LmZpbmRVbmlxdWUoe1xyXG4gICAgd2hlcmU6IHsgaWQ6IHJlcS5wYXJhbXMuaWQgfSxcclxuICAgIHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfVxyXG4gIH0pO1xyXG4gIFxyXG4gIGlmICghd2lzaGxpc3QpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnV2lzaGxpc3Qgbm90IGZvdW5kJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIENoZWNrIGlmIHVzZXIgaXMgYWRtaW4gb3Igd2lzaGxpc3Qgb3duZXJcclxuICBpZiAocmVxLnVzZXJSb2xlICE9PSAnQURNSU4nICYmIHdpc2hsaXN0LnVzZXJJZCAhPT0gcmVxLnVzZXJJZCkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdBY2Nlc3MgZGVuaWVkJyxcclxuICAgICAgbWVzc2FnZTogJ1lvdSBjYW4gb25seSBhY2Nlc3MgeW91ciBvd24gd2lzaGxpc3RzJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG5cclxuICAgIGNvbnN0IHdpc2hsaXN0ID0gYXdhaXQgcHJpc21hLndpc2hsaXN0LmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZCB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBmaXJzdE5hbWU6IHRydWUsIGxhc3ROYW1lOiB0cnVlIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGl0ZW1zOiB7XHJcbiAgICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICAgIHByb2R1Y3Q6IHtcclxuICAgICAgICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICAgICAgICBpbWFnZXM6IHtcclxuICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgc29ydE9yZGVyOiAwIH0sXHJcbiAgICAgICAgICAgICAgICAgIHRha2U6IDEsXHJcbiAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgdXJsOiB0cnVlLCBhbHQ6IHRydWUgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG9yZGVyQnk6IHsgYWRkZWRBdDogJ2Rlc2MnIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIF9jb3VudDoge1xyXG4gICAgICAgICAgaXRlbXM6IHRydWVcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghd2lzaGxpc3QpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ1dpc2hsaXN0IG5vdCBmb3VuZCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzLmpzb24oeyB3aXNobGlzdCB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCB3aXNobGlzdCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIHdpc2hsaXN0JyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBDcmVhdGUgd2lzaGxpc3Rcclxucm91dGVyLnBvc3QoJy8nLCBbXHJcbiAgYm9keSgnbmFtZScpLm9wdGlvbmFsKCkuaXNTdHJpbmcoKS50cmltKCksXHJcbiAgYm9keSgnaXNQcml2YXRlJykub3B0aW9uYWwoKS5pc0Jvb2xlYW4oKVxyXG5dLCBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzLCBhdXRoTWlkZGxld2FyZS5hdXRoZW50aWNhdGUoKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgLy8gVXNlIGF1dGhlbnRpY2F0ZWQgdXNlcidzIElEXHJcbiAgcmVxLmJvZHkudXNlcklkID0gcmVxLnVzZXJJZDtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB1c2VySWQsIG5hbWUsIGlzUHJpdmF0ZSB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgdXNlciBleGlzdHNcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ1VzZXIgbm90IGZvdW5kJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB3aXNobGlzdCA9IGF3YWl0IHByaXNtYS53aXNobGlzdC5jcmVhdGUoe1xyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIG5hbWU6IG5hbWUgfHwgJ015IFdpc2hsaXN0JyxcclxuICAgICAgICBpc1ByaXZhdGU6IGlzUHJpdmF0ZSAhPT0gdW5kZWZpbmVkID8gaXNQcml2YXRlIDogZmFsc2VcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xyXG4gICAgICBtZXNzYWdlOiAnV2lzaGxpc3QgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICB3aXNobGlzdFxyXG4gICAgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdDcmVhdGUgd2lzaGxpc3QgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgd2lzaGxpc3QnLFxyXG4gICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIEFkZCBpdGVtIHRvIHdpc2hsaXN0XHJcbnJvdXRlci5wb3N0KCcvOmlkL2l0ZW1zJywgW1xyXG4gIHBhcmFtKCdpZCcpLmlzVVVJRCgpLFxyXG4gIGJvZHkoJ3Byb2R1Y3RJZCcpLmlzVVVJRCgpXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIGNvbnN0IHsgcHJvZHVjdElkIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSB3aXNobGlzdCBleGlzdHNcclxuICAgIGNvbnN0IHdpc2hsaXN0ID0gYXdhaXQgcHJpc21hLndpc2hsaXN0LmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXdpc2hsaXN0KSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgZXJyb3I6ICdXaXNobGlzdCBub3QgZm91bmQnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZhbGlkYXRlIHByb2R1Y3QgZXhpc3RzXHJcbiAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgcHJpc21hLnByb2R1Y3QuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiBwcm9kdWN0SWQgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFwcm9kdWN0KSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgZXJyb3I6ICdQcm9kdWN0IG5vdCBmb3VuZCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgaXRlbSBhbHJlYWR5IGV4aXN0c1xyXG4gICAgY29uc3QgZXhpc3RpbmdJdGVtID0gYXdhaXQgcHJpc21hLndpc2hsaXN0SXRlbS5maW5kRmlyc3Qoe1xyXG4gICAgICB3aGVyZToge1xyXG4gICAgICAgIHdpc2hsaXN0SWQ6IGlkLFxyXG4gICAgICAgIHByb2R1Y3RJZFxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZXhpc3RpbmdJdGVtKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwOSkuanNvbih7XHJcbiAgICAgICAgZXJyb3I6ICdQcm9kdWN0IGFscmVhZHkgaW4gd2lzaGxpc3QnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHdpc2hsaXN0SXRlbSA9IGF3YWl0IHByaXNtYS53aXNobGlzdEl0ZW0uY3JlYXRlKHtcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHdpc2hsaXN0SWQ6IGlkLFxyXG4gICAgICAgIHByb2R1Y3RJZFxyXG4gICAgICB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgcHJvZHVjdDogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgIG1lc3NhZ2U6ICdJdGVtIGFkZGVkIHRvIHdpc2hsaXN0JyxcclxuICAgICAgaXRlbTogd2lzaGxpc3RJdGVtXHJcbiAgICB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0FkZCB0byB3aXNobGlzdCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGFkZCBpdGVtIHRvIHdpc2hsaXN0JyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBSZW1vdmUgaXRlbSBmcm9tIHdpc2hsaXN0XHJcbnJvdXRlci5kZWxldGUoJy86d2lzaGxpc3RJZC9pdGVtcy86aXRlbUlkJywgW1xyXG4gIHBhcmFtKCd3aXNobGlzdElkJykuaXNVVUlEKCksXHJcbiAgcGFyYW0oJ2l0ZW1JZCcpLmlzVVVJRCgpXHJcbl0sIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsIGF1dGhNaWRkbGV3YXJlLmF1dGhlbnRpY2F0ZSgpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB3aXNobGlzdElkLCBpdGVtSWQgfSA9IHJlcS5wYXJhbXM7XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgaXRlbSBleGlzdHNcclxuICAgIGNvbnN0IHdpc2hsaXN0SXRlbSA9IGF3YWl0IHByaXNtYS53aXNobGlzdEl0ZW0uZmluZEZpcnN0KHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IGl0ZW1JZCwgd2lzaGxpc3RJZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXdpc2hsaXN0SXRlbSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnV2lzaGxpc3QgaXRlbSBub3QgZm91bmQnXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHByaXNtYS53aXNobGlzdEl0ZW0uZGVsZXRlKHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IGl0ZW1JZCB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXMuanNvbih7XHJcbiAgICAgIG1lc3NhZ2U6ICdJdGVtIHJlbW92ZWQgZnJvbSB3aXNobGlzdCdcclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignUmVtb3ZlIHdpc2hsaXN0IGl0ZW0gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byByZW1vdmUgaXRlbSBmcm9tIHdpc2hsaXN0JyxcclxuICAgICAgbWVzc2FnZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBEZWxldGUgd2lzaGxpc3Rcclxucm91dGVyLmRlbGV0ZSgnLzppZCcsIFtcclxuICBwYXJhbSgnaWQnKS5pc1VVSUQoKVxyXG5dLCBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzLCBhdXRoTWlkZGxld2FyZS5hdXRoZW50aWNhdGUoKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgd2lzaGxpc3QgZXhpc3RzXHJcbiAgICBjb25zdCB3aXNobGlzdCA9IGF3YWl0IHByaXNtYS53aXNobGlzdC5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmU6IHsgaWQgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCF3aXNobGlzdCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnV2lzaGxpc3Qgbm90IGZvdW5kJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhd2FpdCBwcmlzbWEud2lzaGxpc3QuZGVsZXRlKHtcclxuICAgICAgd2hlcmU6IHsgaWQgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmVzLmpzb24oe1xyXG4gICAgICBtZXNzYWdlOiAnV2lzaGxpc3QgZGVsZXRlZCBzdWNjZXNzZnVsbHknXHJcbiAgICB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0RlbGV0ZSB3aXNobGlzdCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGRlbGV0ZSB3aXNobGlzdCcsXHJcbiAgICAgIG1lc3NhZ2U6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyb3IubWVzc2FnZSA6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTTtFQUFFQyxJQUFJO0VBQUVDLEtBQUs7RUFBRUM7QUFBaUIsQ0FBQyxHQUFHSCxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDdEUsTUFBTTtFQUFFSTtBQUFhLENBQUMsR0FBR0osT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ2xELE1BQU07RUFBRUs7QUFBZSxDQUFDLEdBQUdM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