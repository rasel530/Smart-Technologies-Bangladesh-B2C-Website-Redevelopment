73903dd816fec2c9a71898e2437d978d
const {
  PrismaClient
} = require('@prisma/client');
class DatabaseService {
  constructor() {
    this.connectionPool = {
      activeConnections: 0,
      idleConnections: 0,
      totalConnections: 0,
      maxConnections: 10,
      connectionTimeout: 30000,
      idleTimeout: 10000,
      acquireTimeoutMillis: 30000,
      createTimeoutMillis: 30000,
      destroyTimeoutMillis: 5000,
      reapIntervalMillis: 1000,
      createRetryIntervalMillis: 200,
      connectionStartTime: null,
      queryCount: 0,
      errorCount: 0
    };
    this.prisma = new PrismaClient({
      log: [{
        emit: 'event',
        level: 'query'
      }, {
        emit: 'event',
        level: 'error'
      }, {
        emit: 'event',
        level: 'info'
      }, {
        emit: 'event',
        level: 'warn'
      }],
      // Enhanced connection configuration
      datasources: {
        db: {
          url: process.env.DATABASE_URL
        }
      },
      // Connection pool settings
      __internal: {
        engine: {
          connectionLimit: this.connectionPool.maxConnections,
          poolTimeout: this.connectionPool.acquireTimeoutMillis,
          idleTimeout: this.connectionPool.idleTimeout,
          connectionTimeout: this.connectionPool.connectionTimeout
        }
      }
    });

    // Set up event listeners for connection monitoring
    this.setupEventListeners();
  }
  async connect() {
    const startTime = Date.now();
    const maxRetries = 3;
    const retryDelay = 1000; // 1 second

    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        await this.prisma.$connect();
        const connectionTime = Date.now() - startTime;
        console.log(`‚úÖ Database connected successfully (attempt ${attempt}, ${connectionTime}ms)`);

        // Log connection pool status
        const poolStats = this.getConnectionPoolStats();
        console.log('üîç Database connection pool stats:', poolStats);
        return true;
      } catch (error) {
        console.error(`‚ùå Database connection attempt ${attempt} failed:`, {
          error: error.message,
          code: error.code,
          attempt,
          maxRetries,
          timestamp: new Date().toISOString()
        });
        if (attempt < maxRetries) {
          console.log(`üîÑ Retrying database connection in ${retryDelay}ms...`);
          await new Promise(resolve => setTimeout(resolve, retryDelay));
        } else {
          // Log final failure with diagnostic info
          console.error('üí• All database connection attempts failed:', {
            totalAttempts: maxRetries,
            totalDuration: Date.now() - startTime,
            databaseUrl: this.config?.DATABASE_URL ? 'CONFIGURED' : 'MISSING',
            environment: process.env.NODE_ENV || 'unknown'
          });
          throw error;
        }
      }
    }
  }
  async disconnect() {
    try {
      await this.prisma.$disconnect();
      console.log('‚úÖ Database disconnected successfully');
    } catch (error) {
      console.error('‚ùå Database disconnection failed:', error);
      throw error;
    }
  }
  async healthCheck() {
    const startTime = Date.now();
    try {
      // Enhanced query with NOW() for better timing measurement
      const result = await this.prisma.$queryRaw`SELECT 1 as status, NOW() as server_time`;
      const responseTime = Date.now() - startTime;
      const poolStats = this.getConnectionPoolStats();
      return {
        status: 'healthy',
        database: 'connected',
        responseTime: `${responseTime}ms`,
        connectionPool: poolStats,
        timestamp: new Date().toISOString()
      };
    } catch (error) {
      const responseTime = Date.now() - startTime;
      return {
        status: 'unhealthy',
        database: 'disconnected',
        responseTime: `${responseTime}ms`,
        error: error.message,
        connectionPool: this.getConnectionPoolStats(),
        timestamp: new Date().toISOString()
      };
    }
  }
  async getStats() {
    try {
      const [userCount, productCount, categoryCount, brandCount, orderCount, reviewCount, couponCount] = await Promise.all([this.prisma.user.count(), this.prisma.product.count(), this.prisma.category.count(), this.prisma.brand.count(), this.prisma.order.count(), this.prisma.review.count(), this.prisma.coupon.count()]);
      return {
        users: userCount,
        products: productCount,
        categories: categoryCount,
        brands: brandCount,
        orders: orderCount,
        reviews: reviewCount,
        coupons: couponCount,
        timestamp: new Date().toISOString()
      };
    } catch (error) {
      console.error('Error getting database stats:', error);
      throw error;
    }
  }

  // Transaction helper
  async transaction(callback) {
    return await this.prisma.$transaction(callback);
  }

  // Get client instance
  getClient() {
    return this.prisma;
  }

  // Raw query helper
  async query(sql, params = []) {
    try {
      return await this.prisma.$queryRaw`${sql}`;
    } catch (error) {
      console.error('Raw query error:', error);
      throw error;
    }
  }

  // Bangladesh-specific helpers
  async getDivisions() {
    try {
      const divisions = await this.prisma.$queryRaw`
        SELECT DISTINCT division FROM addresses 
        WHERE division IS NOT NULL 
        ORDER BY division
      `;
      return divisions.map(row => row.division);
    } catch (error) {
      console.error('Error getting divisions:', error);
      throw error;
    }
  }
  async getPaymentMethods() {
    try {
      const paymentMethods = await this.prisma.$queryRaw`
        SELECT DISTINCT paymentMethod FROM orders 
        WHERE paymentMethod IS NOT NULL 
        ORDER BY paymentMethod
      `;
      return paymentMethods.map(row => row.paymentMethod);
    } catch (error) {
      console.error('Error getting payment methods:', error);
      throw error;
    }
  }
  // Get connection pool statistics for diagnostics
  getConnectionPoolStats() {
    try {
      const utilizationRate = this.connectionPool.maxConnections > 0 ? (this.connectionPool.activeConnections / this.connectionPool.maxConnections * 100).toFixed(2) : 0;
      return {
        activeConnections: this.connectionPool.activeConnections,
        idleConnections: this.connectionPool.idleConnections,
        totalConnections: this.connectionPool.totalConnections,
        maxConnections: this.connectionPool.maxConnections,
        utilizationRate: `${utilizationRate}%`,
        timeouts: {
          connection: this.connectionPool.connectionTimeout,
          idle: this.connectionPool.idleTimeout,
          acquire: this.connectionPool.acquireTimeoutMillis
        },
        queryCount: this.connectionPool.queryCount,
        errorCount: this.connectionPool.errorCount,
        timestamp: new Date().toISOString()
      };
    } catch (error) {
      console.error('‚ùå Failed to get connection pool stats:', error);
      return null;
    }
  }

  // Setup event listeners for Prisma events
  setupEventListeners() {
    try {
      // Monitor query events
      this.prisma.$on('query', event => {
        this.connectionPool.queryCount++;
        console.log('üîç Query:', {
          query: event.query,
          params: event.params,
          duration: `${event.duration}ms`,
          timestamp: event.timestamp
        });
      });

      // Monitor error events
      this.prisma.$on('error', event => {
        this.connectionPool.errorCount++;
        console.error('‚ùå Database Error:', {
          target: event.target,
          message: event.message,
          timestamp: event.timestamp
        });
      });

      // Monitor info events
      this.prisma.$on('info', event => {
        console.log('‚ÑπÔ∏è Database Info:', {
          target: event.target,
          message: event.message,
          timestamp: event.timestamp
        });
      });

      // Monitor warning events
      this.prisma.$on('warn', event => {
        console.warn('‚ö†Ô∏è Database Warning:', {
          target: event.target,
          message: event.message,
          timestamp: event.timestamp
        });
      });

      // Handle process exit for graceful cleanup
      process.on('beforeExit', async () => {
        console.log('üîÑ Process exiting, cleaning up database connections...');
        await this.cleanupConnections();
      });
      console.log('‚úÖ Database event listeners setup completed');
    } catch (error) {
      console.error('‚ùå Failed to setup event listeners:', error);
    }
  }

  // Cleanup connections gracefully
  async cleanupConnections() {
    try {
      console.log('üßπ Starting connection cleanup...');

      // Reset connection tracking
      this.connectionPool.activeConnections = 0;
      this.connectionPool.idleConnections = 0;
      this.connectionPool.totalConnections = 0;

      // Disconnect from database
      await this.prisma.$disconnect();
      console.log('‚úÖ Database connections cleaned up successfully');
    } catch (error) {
      console.error('‚ùå Failed to cleanup connections:', error);
      throw error;
    }
  }
}

// Singleton instance
const databaseService = new DatabaseService();
module.exports = {
  DatabaseService,
  databaseService
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJyZXF1aXJlIiwiRGF0YWJhc2VTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjb25uZWN0aW9uUG9vbCIsImFjdGl2ZUNvbm5lY3Rpb25zIiwiaWRsZUNvbm5lY3Rpb25zIiwidG90YWxDb25uZWN0aW9ucyIsIm1heENvbm5lY3Rpb25zIiwiY29ubmVjdGlvblRpbWVvdXQiLCJpZGxlVGltZW91dCIsImFjcXVpcmVUaW1lb3V0TWlsbGlzIiwiY3JlYXRlVGltZW91dE1pbGxpcyIsImRlc3Ryb3lUaW1lb3V0TWlsbGlzIiwicmVhcEludGVydmFsTWlsbGlzIiwiY3JlYXRlUmV0cnlJbnRlcnZhbE1pbGxpcyIsImNvbm5lY3Rpb25TdGFydFRpbWUiLCJxdWVyeUNvdW50IiwiZXJyb3JDb3VudCIsInByaXNtYSIsImxvZyIsImVtaXQiLCJsZXZlbCIsImRhdGFzb3VyY2VzIiwiZGIiLCJ1cmwiLCJwcm9jZXNzIiwiZW52IiwiREFUQUJBU0VfVVJMIiwiX19pbnRlcm5hbCIsImVuZ2luZSIsImNvbm5lY3Rpb25MaW1pdCIsInBvb2xUaW1lb3V0Iiwic2V0dXBFdmVudExpc3RlbmVycyIsImNvbm5lY3QiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwibWF4UmV0cmllcyIsInJldHJ5RGVsYXkiLCJhdHRlbXB0IiwiJGNvbm5lY3QiLCJjb25uZWN0aW9uVGltZSIsImNvbnNvbGUiLCJwb29sU3RhdHMiLCJnZXRDb25uZWN0aW9uUG9vbFN0YXRzIiwiZXJyb3IiLCJtZXNzYWdlIiwiY29kZSIsInRpbWVzdGFtcCIsInRvSVNPU3RyaW5nIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwidG90YWxBdHRlbXB0cyIsInRvdGFsRHVyYXRpb24iLCJkYXRhYmFzZVVybCIsImNvbmZpZyIsImVudmlyb25tZW50IiwiTk9ERV9FTlYiLCJkaXNjb25uZWN0IiwiJGRpc2Nvbm5lY3QiLCJoZWFsdGhDaGVjayIsInJlc3VsdCIsIiRxdWVyeVJhdyIsInJlc3BvbnNlVGltZSIsInN0YXR1cyIsImRhdGFiYXNlIiwiZ2V0U3RhdHMiLCJ1c2VyQ291bnQiLCJwcm9kdWN0Q291bnQiLCJjYXRlZ29yeUNvdW50IiwiYnJhbmRDb3VudCIsIm9yZGVyQ291bnQiLCJyZXZpZXdDb3VudCIsImNvdXBvbkNvdW50IiwiYWxsIiwidXNlciIsImNvdW50IiwicHJvZHVjdCIsImNhdGVnb3J5IiwiYnJhbmQiLCJvcmRlciIsInJldmlldyIsImNvdXBvbiIsInVzZXJzIiwicHJvZHVjdHMiLCJjYXRlZ29yaWVzIiwiYnJhbmRzIiwib3JkZXJzIiwicmV2aWV3cyIsImNvdXBvbnMiLCJ0cmFuc2FjdGlvbiIsImNhbGxiYWNrIiwiJHRyYW5zYWN0aW9uIiwiZ2V0Q2xpZW50IiwicXVlcnkiLCJzcWwiLCJwYXJhbXMiLCJnZXREaXZpc2lvbnMiLCJkaXZpc2lvbnMiLCJtYXAiLCJyb3ciLCJkaXZpc2lvbiIsImdldFBheW1lbnRNZXRob2RzIiwicGF5bWVudE1ldGhvZHMiLCJwYXltZW50TWV0aG9kIiwidXRpbGl6YXRpb25SYXRlIiwidG9GaXhlZCIsInRpbWVvdXRzIiwiY29ubmVjdGlvbiIsImlkbGUiLCJhY3F1aXJlIiwiJG9uIiwiZXZlbnQiLCJkdXJhdGlvbiIsInRhcmdldCIsIndhcm4iLCJvbiIsImNsZWFudXBDb25uZWN0aW9ucyIsImRhdGFiYXNlU2VydmljZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJkYXRhYmFzZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IFByaXNtYUNsaWVudCB9ID0gcmVxdWlyZSgnQHByaXNtYS9jbGllbnQnKTtcclxuXHJcbmNsYXNzIERhdGFiYXNlU2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmNvbm5lY3Rpb25Qb29sID0ge1xyXG4gICAgICBhY3RpdmVDb25uZWN0aW9uczogMCxcclxuICAgICAgaWRsZUNvbm5lY3Rpb25zOiAwLFxyXG4gICAgICB0b3RhbENvbm5lY3Rpb25zOiAwLFxyXG4gICAgICBtYXhDb25uZWN0aW9uczogMTAsXHJcbiAgICAgIGNvbm5lY3Rpb25UaW1lb3V0OiAzMDAwMCxcclxuICAgICAgaWRsZVRpbWVvdXQ6IDEwMDAwLFxyXG4gICAgICBhY3F1aXJlVGltZW91dE1pbGxpczogMzAwMDAsXHJcbiAgICAgIGNyZWF0ZVRpbWVvdXRNaWxsaXM6IDMwMDAwLFxyXG4gICAgICBkZXN0cm95VGltZW91dE1pbGxpczogNTAwMCxcclxuICAgICAgcmVhcEludGVydmFsTWlsbGlzOiAxMDAwLFxyXG4gICAgICBjcmVhdGVSZXRyeUludGVydmFsTWlsbGlzOiAyMDAsXHJcbiAgICAgIGNvbm5lY3Rpb25TdGFydFRpbWU6IG51bGwsXHJcbiAgICAgIHF1ZXJ5Q291bnQ6IDAsXHJcbiAgICAgIGVycm9yQ291bnQ6IDBcclxuICAgIH07XHJcbiAgICBcclxuICAgIHRoaXMucHJpc21hID0gbmV3IFByaXNtYUNsaWVudCh7XHJcbiAgICAgIGxvZzogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGVtaXQ6ICdldmVudCcsXHJcbiAgICAgICAgICBsZXZlbDogJ3F1ZXJ5JyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGVtaXQ6ICdldmVudCcsXHJcbiAgICAgICAgICBsZXZlbDogJ2Vycm9yJyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGVtaXQ6ICdldmVudCcsXHJcbiAgICAgICAgICBsZXZlbDogJ2luZm8nLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZW1pdDogJ2V2ZW50JyxcclxuICAgICAgICAgIGxldmVsOiAnd2FybicsXHJcbiAgICAgICAgfVxyXG4gICAgICBdLFxyXG4gICAgICAvLyBFbmhhbmNlZCBjb25uZWN0aW9uIGNvbmZpZ3VyYXRpb25cclxuICAgICAgZGF0YXNvdXJjZXM6IHtcclxuICAgICAgICBkYjoge1xyXG4gICAgICAgICAgdXJsOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwsXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICAvLyBDb25uZWN0aW9uIHBvb2wgc2V0dGluZ3NcclxuICAgICAgX19pbnRlcm5hbDoge1xyXG4gICAgICAgIGVuZ2luZToge1xyXG4gICAgICAgICAgY29ubmVjdGlvbkxpbWl0OiB0aGlzLmNvbm5lY3Rpb25Qb29sLm1heENvbm5lY3Rpb25zLFxyXG4gICAgICAgICAgcG9vbFRpbWVvdXQ6IHRoaXMuY29ubmVjdGlvblBvb2wuYWNxdWlyZVRpbWVvdXRNaWxsaXMsXHJcbiAgICAgICAgICBpZGxlVGltZW91dDogdGhpcy5jb25uZWN0aW9uUG9vbC5pZGxlVGltZW91dCxcclxuICAgICAgICAgIGNvbm5lY3Rpb25UaW1lb3V0OiB0aGlzLmNvbm5lY3Rpb25Qb29sLmNvbm5lY3Rpb25UaW1lb3V0XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLy8gU2V0IHVwIGV2ZW50IGxpc3RlbmVycyBmb3IgY29ubmVjdGlvbiBtb25pdG9yaW5nXHJcbiAgICB0aGlzLnNldHVwRXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGNvbm5lY3QoKSB7XHJcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgY29uc3QgbWF4UmV0cmllcyA9IDM7XHJcbiAgICBjb25zdCByZXRyeURlbGF5ID0gMTAwMDsgLy8gMSBzZWNvbmRcclxuICAgIFxyXG4gICAgZm9yIChsZXQgYXR0ZW1wdCA9IDE7IGF0dGVtcHQgPD0gbWF4UmV0cmllczsgYXR0ZW1wdCsrKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuJGNvbm5lY3QoKTtcclxuICAgICAgICBjb25zdCBjb25uZWN0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBEYXRhYmFzZSBjb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5IChhdHRlbXB0ICR7YXR0ZW1wdH0sICR7Y29ubmVjdGlvblRpbWV9bXMpYCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gTG9nIGNvbm5lY3Rpb24gcG9vbCBzdGF0dXNcclxuICAgICAgICBjb25zdCBwb29sU3RhdHMgPSB0aGlzLmdldENvbm5lY3Rpb25Qb29sU3RhdHMoKTtcclxuICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBEYXRhYmFzZSBjb25uZWN0aW9uIHBvb2wgc3RhdHM6JywgcG9vbFN0YXRzKTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGDinYwgRGF0YWJhc2UgY29ubmVjdGlvbiBhdHRlbXB0ICR7YXR0ZW1wdH0gZmFpbGVkOmAsIHtcclxuICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICAgICAgY29kZTogZXJyb3IuY29kZSxcclxuICAgICAgICAgIGF0dGVtcHQsXHJcbiAgICAgICAgICBtYXhSZXRyaWVzLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoYXR0ZW1wdCA8IG1heFJldHJpZXMpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5SEIFJldHJ5aW5nIGRhdGFiYXNlIGNvbm5lY3Rpb24gaW4gJHtyZXRyeURlbGF5fW1zLi4uYCk7XHJcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgcmV0cnlEZWxheSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBMb2cgZmluYWwgZmFpbHVyZSB3aXRoIGRpYWdub3N0aWMgaW5mb1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcign8J+SpSBBbGwgZGF0YWJhc2UgY29ubmVjdGlvbiBhdHRlbXB0cyBmYWlsZWQ6Jywge1xyXG4gICAgICAgICAgICB0b3RhbEF0dGVtcHRzOiBtYXhSZXRyaWVzLFxyXG4gICAgICAgICAgICB0b3RhbER1cmF0aW9uOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxyXG4gICAgICAgICAgICBkYXRhYmFzZVVybDogdGhpcy5jb25maWc/LkRBVEFCQVNFX1VSTCA/ICdDT05GSUdVUkVEJyA6ICdNSVNTSU5HJyxcclxuICAgICAgICAgICAgZW52aXJvbm1lbnQ6IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICd1bmtub3duJ1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGRpc2Nvbm5lY3QoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS4kZGlzY29ubmVjdCgpO1xyXG4gICAgICBjb25zb2xlLmxvZygn4pyFIERhdGFiYXNlIGRpc2Nvbm5lY3RlZCBzdWNjZXNzZnVsbHknKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBEYXRhYmFzZSBkaXNjb25uZWN0aW9uIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGVhbHRoQ2hlY2soKSB7XHJcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gRW5oYW5jZWQgcXVlcnkgd2l0aCBOT1coKSBmb3IgYmV0dGVyIHRpbWluZyBtZWFzdXJlbWVudFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnByaXNtYS4kcXVlcnlSYXdgU0VMRUNUIDEgYXMgc3RhdHVzLCBOT1coKSBhcyBzZXJ2ZXJfdGltZWA7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgIGNvbnN0IHBvb2xTdGF0cyA9IHRoaXMuZ2V0Q29ubmVjdGlvblBvb2xTdGF0cygpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdGF0dXM6ICdoZWFsdGh5JyxcclxuICAgICAgICBkYXRhYmFzZTogJ2Nvbm5lY3RlZCcsXHJcbiAgICAgICAgcmVzcG9uc2VUaW1lOiBgJHtyZXNwb25zZVRpbWV9bXNgLFxyXG4gICAgICAgIGNvbm5lY3Rpb25Qb29sOiBwb29sU3RhdHMsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3RhdHVzOiAndW5oZWFsdGh5JyxcclxuICAgICAgICBkYXRhYmFzZTogJ2Rpc2Nvbm5lY3RlZCcsXHJcbiAgICAgICAgcmVzcG9uc2VUaW1lOiBgJHtyZXNwb25zZVRpbWV9bXNgLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICAgIGNvbm5lY3Rpb25Qb29sOiB0aGlzLmdldENvbm5lY3Rpb25Qb29sU3RhdHMoKSxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0U3RhdHMoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBbXHJcbiAgICAgICAgdXNlckNvdW50LFxyXG4gICAgICAgIHByb2R1Y3RDb3VudCxcclxuICAgICAgICBjYXRlZ29yeUNvdW50LFxyXG4gICAgICAgIGJyYW5kQ291bnQsXHJcbiAgICAgICAgb3JkZXJDb3VudCxcclxuICAgICAgICByZXZpZXdDb3VudCxcclxuICAgICAgICBjb3Vwb25Db3VudFxyXG4gICAgICBdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgIHRoaXMucHJpc21hLnVzZXIuY291bnQoKSxcclxuICAgICAgICB0aGlzLnByaXNtYS5wcm9kdWN0LmNvdW50KCksXHJcbiAgICAgICAgdGhpcy5wcmlzbWEuY2F0ZWdvcnkuY291bnQoKSxcclxuICAgICAgICB0aGlzLnByaXNtYS5icmFuZC5jb3VudCgpLFxyXG4gICAgICAgIHRoaXMucHJpc21hLm9yZGVyLmNvdW50KCksXHJcbiAgICAgICAgdGhpcy5wcmlzbWEucmV2aWV3LmNvdW50KCksXHJcbiAgICAgICAgdGhpcy5wcmlzbWEuY291cG9uLmNvdW50KClcclxuICAgICAgXSk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHVzZXJzOiB1c2VyQ291bnQsXHJcbiAgICAgICAgcHJvZHVjdHM6IHByb2R1Y3RDb3VudCxcclxuICAgICAgICBjYXRlZ29yaWVzOiBjYXRlZ29yeUNvdW50LFxyXG4gICAgICAgIGJyYW5kczogYnJhbmRDb3VudCxcclxuICAgICAgICBvcmRlcnM6IG9yZGVyQ291bnQsXHJcbiAgICAgICAgcmV2aWV3czogcmV2aWV3Q291bnQsXHJcbiAgICAgICAgY291cG9uczogY291cG9uQ291bnQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgZGF0YWJhc2Ugc3RhdHM6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFRyYW5zYWN0aW9uIGhlbHBlclxyXG4gIGFzeW5jIHRyYW5zYWN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcmlzbWEuJHRyYW5zYWN0aW9uKGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIC8vIEdldCBjbGllbnQgaW5zdGFuY2VcclxuICBnZXRDbGllbnQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wcmlzbWE7XHJcbiAgfVxyXG5cclxuICAvLyBSYXcgcXVlcnkgaGVscGVyXHJcbiAgYXN5bmMgcXVlcnkoc3FsLCBwYXJhbXMgPSBbXSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucHJpc21hLiRxdWVyeVJhd2Ake3NxbH1gO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignUmF3IHF1ZXJ5IGVycm9yOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBCYW5nbGFkZXNoLXNwZWNpZmljIGhlbHBlcnNcclxuICBhc3luYyBnZXREaXZpc2lvbnMoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkaXZpc2lvbnMgPSBhd2FpdCB0aGlzLnByaXNtYS4kcXVlcnlSYXdgXHJcbiAgICAgICAgU0VMRUNUIERJU1RJTkNUIGRpdmlzaW9uIEZST00gYWRkcmVzc2VzIFxyXG4gICAgICAgIFdIRVJFIGRpdmlzaW9uIElTIE5PVCBOVUxMIFxyXG4gICAgICAgIE9SREVSIEJZIGRpdmlzaW9uXHJcbiAgICAgIGA7XHJcbiAgICAgIHJldHVybiBkaXZpc2lvbnMubWFwKHJvdyA9PiByb3cuZGl2aXNpb24pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBkaXZpc2lvbnM6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldFBheW1lbnRNZXRob2RzKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcGF5bWVudE1ldGhvZHMgPSBhd2FpdCB0aGlzLnByaXNtYS4kcXVlcnlSYXdgXHJcbiAgICAgICAgU0VMRUNUIERJU1RJTkNUIHBheW1lbnRNZXRob2QgRlJPTSBvcmRlcnMgXHJcbiAgICAgICAgV0hFUkUgcGF5bWVudE1ldGhvZCBJUyBOT1QgTlVMTCBcclxuICAgICAgICBPUkRFUiBCWSBwYXltZW50TWV0aG9kXHJcbiAgICAgIGA7XHJcbiAgICAgIHJldHVybiBwYXltZW50TWV0aG9kcy5tYXAocm93ID0+IHJvdy5wYXltZW50TWV0aG9kKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgcGF5bWVudCBtZXRob2RzOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIEdldCBjb25uZWN0aW9uIHBvb2wgc3RhdGlzdGljcyBmb3IgZGlhZ25vc3RpY3NcclxuICBnZXRDb25uZWN0aW9uUG9vbFN0YXRzKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdXRpbGl6YXRpb25SYXRlID0gdGhpcy5jb25uZWN0aW9uUG9vbC5tYXhDb25uZWN0aW9ucyA+IDBcclxuICAgICAgICA/ICh0aGlzLmNvbm5lY3Rpb25Qb29sLmFjdGl2ZUNvbm5lY3Rpb25zIC8gdGhpcy5jb25uZWN0aW9uUG9vbC5tYXhDb25uZWN0aW9ucyAqIDEwMCkudG9GaXhlZCgyKVxyXG4gICAgICAgIDogMDtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgYWN0aXZlQ29ubmVjdGlvbnM6IHRoaXMuY29ubmVjdGlvblBvb2wuYWN0aXZlQ29ubmVjdGlvbnMsXHJcbiAgICAgICAgaWRsZUNvbm5lY3Rpb25zOiB0aGlzLmNvbm5lY3Rpb25Qb29sLmlkbGVDb25uZWN0aW9ucyxcclxuICAgICAgICB0b3RhbENvbm5lY3Rpb25zOiB0aGlzLmNvbm5lY3Rpb25Qb29sLnRvdGFsQ29ubmVjdGlvbnMsXHJcbiAgICAgICAgbWF4Q29ubmVjdGlvbnM6IHRoaXMuY29ubmVjdGlvblBvb2wubWF4Q29ubmVjdGlvbnMsXHJcbiAgICAgICAgdXRpbGl6YXRpb25SYXRlOiBgJHt1dGlsaXphdGlvblJhdGV9JWAsXHJcbiAgICAgICAgdGltZW91dHM6IHtcclxuICAgICAgICAgIGNvbm5lY3Rpb246IHRoaXMuY29ubmVjdGlvblBvb2wuY29ubmVjdGlvblRpbWVvdXQsXHJcbiAgICAgICAgICBpZGxlOiB0aGlzLmNvbm5lY3Rpb25Qb29sLmlkbGVUaW1lb3V0LFxyXG4gICAgICAgICAgYWNxdWlyZTogdGhpcy5jb25uZWN0aW9uUG9vbC5hY3F1aXJlVGltZW91dE1pbGxpc1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcXVlcnlDb3VudDogdGhpcy5jb25uZWN0aW9uUG9vbC5xdWVyeUNvdW50LFxyXG4gICAgICAgIGVycm9yQ291bnQ6IHRoaXMuY29ubmVjdGlvblBvb2wuZXJyb3JDb3VudCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byBnZXQgY29ubmVjdGlvbiBwb29sIHN0YXRzOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBTZXR1cCBldmVudCBsaXN0ZW5lcnMgZm9yIFByaXNtYSBldmVudHNcclxuICBzZXR1cEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gTW9uaXRvciBxdWVyeSBldmVudHNcclxuICAgICAgdGhpcy5wcmlzbWEuJG9uKCdxdWVyeScsIChldmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvblBvb2wucXVlcnlDb3VudCsrO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFF1ZXJ5OicsIHtcclxuICAgICAgICAgIHF1ZXJ5OiBldmVudC5xdWVyeSxcclxuICAgICAgICAgIHBhcmFtczogZXZlbnQucGFyYW1zLFxyXG4gICAgICAgICAgZHVyYXRpb246IGAke2V2ZW50LmR1cmF0aW9ufW1zYCxcclxuICAgICAgICAgIHRpbWVzdGFtcDogZXZlbnQudGltZXN0YW1wXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gTW9uaXRvciBlcnJvciBldmVudHNcclxuICAgICAgdGhpcy5wcmlzbWEuJG9uKCdlcnJvcicsIChldmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvblBvb2wuZXJyb3JDb3VudCsrO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBEYXRhYmFzZSBFcnJvcjonLCB7XHJcbiAgICAgICAgICB0YXJnZXQ6IGV2ZW50LnRhcmdldCxcclxuICAgICAgICAgIG1lc3NhZ2U6IGV2ZW50Lm1lc3NhZ2UsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IGV2ZW50LnRpbWVzdGFtcFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIE1vbml0b3IgaW5mbyBldmVudHNcclxuICAgICAgdGhpcy5wcmlzbWEuJG9uKCdpbmZvJywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ+KEue+4jyBEYXRhYmFzZSBJbmZvOicsIHtcclxuICAgICAgICAgIHRhcmdldDogZXZlbnQudGFyZ2V0LFxyXG4gICAgICAgICAgbWVzc2FnZTogZXZlbnQubWVzc2FnZSxcclxuICAgICAgICAgIHRpbWVzdGFtcDogZXZlbnQudGltZXN0YW1wXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gTW9uaXRvciB3YXJuaW5nIGV2ZW50c1xyXG4gICAgICB0aGlzLnByaXNtYS4kb24oJ3dhcm4nLCAoZXZlbnQpID0+IHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBEYXRhYmFzZSBXYXJuaW5nOicsIHtcclxuICAgICAgICAgIHRhcmdldDogZXZlbnQudGFyZ2V0LFxyXG4gICAgICAgICAgbWVzc2FnZTogZXZlbnQubWVzc2FnZSxcclxuICAgICAgICAgIHRpbWVzdGFtcDogZXZlbnQudGltZXN0YW1wXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gSGFuZGxlIHByb2Nlc3MgZXhpdCBmb3IgZ3JhY2VmdWwgY2xlYW51cFxyXG4gICAgICBwcm9jZXNzLm9uKCdiZWZvcmVFeGl0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SEIFByb2Nlc3MgZXhpdGluZywgY2xlYW5pbmcgdXAgZGF0YWJhc2UgY29ubmVjdGlvbnMuLi4nKTtcclxuICAgICAgICBhd2FpdCB0aGlzLmNsZWFudXBDb25uZWN0aW9ucygpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgRGF0YWJhc2UgZXZlbnQgbGlzdGVuZXJzIHNldHVwIGNvbXBsZXRlZCcpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byBzZXR1cCBldmVudCBsaXN0ZW5lcnM6JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQ2xlYW51cCBjb25uZWN0aW9ucyBncmFjZWZ1bGx5XHJcbiAgYXN5bmMgY2xlYW51cENvbm5lY3Rpb25zKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc29sZS5sb2coJ/Cfp7kgU3RhcnRpbmcgY29ubmVjdGlvbiBjbGVhbnVwLi4uJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZXNldCBjb25uZWN0aW9uIHRyYWNraW5nXHJcbiAgICAgIHRoaXMuY29ubmVjdGlvblBvb2wuYWN0aXZlQ29ubmVjdGlvbnMgPSAwO1xyXG4gICAgICB0aGlzLmNvbm5lY3Rpb25Qb29sLmlkbGVDb25uZWN0aW9ucyA9IDA7XHJcbiAgICAgIHRoaXMuY29ubmVjdGlvblBvb2wudG90YWxDb25uZWN0aW9ucyA9IDA7XHJcbiAgICAgIFxyXG4gICAgICAvLyBEaXNjb25uZWN0IGZyb20gZGF0YWJhc2VcclxuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuJGRpc2Nvbm5lY3QoKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgRGF0YWJhc2UgY29ubmVjdGlvbnMgY2xlYW5lZCB1cCBzdWNjZXNzZnVsbHknKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gY2xlYW51cCBjb25uZWN0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLy8gU2luZ2xldG9uIGluc3RhbmNlXHJcbmNvbnN0IGRhdGFiYXNlU2VydmljZSA9IG5ldyBEYXRhYmFzZVNlcnZpY2UoKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIERhdGFiYXNlU2VydmljZSxcclxuICBkYXRhYmFzZVNlcnZpY2VcclxufTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU07RUFBRUE7QUFBYSxDQUFDLEdBQUdDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUVsRCxNQUFNQyxlQUFlLENBQUM7RUFDcEJDLFdBQVdBLENBQUEsRUFBRztJQUNaLElBQUksQ0FBQ0MsY0FBYyxHQUFHO01BQ3BCQyxpQkFBaUIsRUFBRSxDQUFDO01BQ3BCQyxlQUFlLEVBQUUsQ0FBQztNQUNsQkMsZ0JBQWdCLEVBQUUsQ0FBQztNQUNuQkMsY0FBYyxFQUFFLEVBQUU7TUFDbEJDLGlCQUFpQixFQUFFLEtBQUs7TUFDeEJDLFdBQVcsRUFBRSxLQUFLO01BQ2xCQyxvQkFBb0IsRUFBRSxLQUFLO01BQzNCQyxtQkFBbUIsRUFBRSxLQUFLO01BQzFCQyxvQkFBb0IsRUFBRSxJQUFJO01BQzFCQyxrQkFBa0IsRUFBRSxJQUFJO01BQ3hCQyx5QkFBeUIsRUFBRSxHQUFHO01BQzlCQyxtQkFBbUIsRUFBRSxJQUFJO01BQ3pCQyxVQUFVLEVB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