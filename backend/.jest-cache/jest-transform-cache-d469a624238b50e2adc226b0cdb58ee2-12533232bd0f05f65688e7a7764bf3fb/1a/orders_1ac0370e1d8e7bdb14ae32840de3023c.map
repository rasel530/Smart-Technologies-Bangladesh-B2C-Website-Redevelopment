{"version":3,"names":["cov_oclef61ts","actualCoverage","express","s","require","body","param","query","validationResult","PrismaClient","authMiddleware","router","Router","prisma","handleValidationErrors","req","res","next","f","errors","isEmpty","b","status","json","error","details","array","get","optional","isInt","min","max","isUUID","isIn","authenticate","userRole","userId","page","limit","skip","where","orders","total","Promise","all","order","findMany","parseInt","take","include","user","select","id","firstName","lastName","email","address","items","product","name","sku","transactions","orderBy","createdAt","count","pagination","pages","Math","ceil","console","message","process","env","NODE_ENV","findUnique","params","phone","images","sortOrder","url","alt","variant","post","isArray","isString","addressId","paymentMethod","notes","subtotal","orderItems","item","productId","stockQuantity","quantity","itemTotal","parseFloat","regularPrice","push","variantId","unitPrice","totalPrice","tax","shippingCost","discount","orderNumber","Date","now","floor","random","create","data","update","decrement","put","managerOrAdmin","updateData","confirmedAt","shippedAt","deliveredAt","updatedOrder","module","exports"],"sources":["orders.js"],"sourcesContent":["const express = require('express');\r\nconst { body, param, query, validationResult } = require('express-validator');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst { authMiddleware } = require('../middleware/auth');\r\n\r\nconst router = express.Router();\r\nconst prisma = new PrismaClient();\r\n\r\n// Validation middleware\r\nconst handleValidationErrors = (req, res, next) => {\r\n  const errors = validationResult(req);\r\n  if (!errors.isEmpty()) {\r\n    return res.status(400).json({\r\n      error: 'Validation failed',\r\n      details: errors.array()\r\n    });\r\n  }\r\n  next();\r\n};\r\n\r\n// Get all orders (admin or user-specific)\r\nrouter.get('/', [\r\n  query('page').optional().isInt({ min: 1 }),\r\n  query('limit').optional().isInt({ min: 1, max: 100 }),\r\n  query('userId').optional().isUUID(),\r\n  query('status').optional().isIn(['PENDING', 'CONFIRMED', 'SHIPPED', 'DELIVERED', 'CANCELLED'])\r\n], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {\r\n  // If user is not admin, only allow access to their own orders\r\n  if (req.userRole !== 'ADMIN') {\r\n    req.query.userId = req.userId;\r\n  }\r\n  try {\r\n    const { page = 1, limit = 20, userId, status } = req.query;\r\n    const skip = (page - 1) * limit;\r\n\r\n    const where = {};\r\n    if (userId) where.userId = userId;\r\n    if (status) where.status = status;\r\n\r\n    const [orders, total] = await Promise.all([\r\n      prisma.order.findMany({\r\n        where,\r\n        skip: parseInt(skip),\r\n        take: parseInt(limit),\r\n        include: {\r\n          user: {\r\n            select: { id: true, firstName: true, lastName: true, email: true }\r\n          },\r\n          address: true,\r\n          items: {\r\n            include: {\r\n              product: {\r\n                select: { id: true, name: true, sku: true }\r\n              }\r\n            }\r\n          },\r\n          transactions: true\r\n        },\r\n        orderBy: { createdAt: 'desc' }\r\n      }),\r\n      prisma.order.count({ where })\r\n    ]);\r\n\r\n    res.json({\r\n      orders,\r\n      pagination: {\r\n        page: parseInt(page),\r\n        limit: parseInt(limit),\r\n        total,\r\n        pages: Math.ceil(total / limit)\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Get orders error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to fetch orders',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\n// Get order by ID\r\nrouter.get('/:id', [\r\n  param('id').isUUID()\r\n], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {\r\n  // Get order first to check ownership\r\n  const order = await prisma.order.findUnique({\r\n    where: { id: req.params.id },\r\n    select: { userId: true }\r\n  });\r\n  \r\n  if (!order) {\r\n    return res.status(404).json({\r\n      error: 'Order not found'\r\n    });\r\n  }\r\n  \r\n  // Check if user is admin or order owner\r\n  if (req.userRole !== 'ADMIN' && order.userId !== req.userId) {\r\n    return res.status(403).json({\r\n      error: 'Access denied',\r\n      message: 'You can only access your own orders'\r\n    });\r\n  }\r\n  try {\r\n    const { id } = req.params;\r\n\r\n    const order = await prisma.order.findUnique({\r\n      where: { id },\r\n      include: {\r\n        user: {\r\n          select: { id: true, firstName: true, lastName: true, email: true, phone: true }\r\n        },\r\n        address: true,\r\n        items: {\r\n          include: {\r\n            product: {\r\n              include: {\r\n                images: {\r\n                  where: { sortOrder: 0 },\r\n                  take: 1,\r\n                  select: { id: true, url: true, alt: true }\r\n                }\r\n              }\r\n            },\r\n            variant: true\r\n          }\r\n        },\r\n        transactions: true\r\n      }\r\n    });\r\n\r\n    if (!order) {\r\n      return res.status(404).json({\r\n        error: 'Order not found'\r\n      });\r\n    }\r\n\r\n    res.json({ order });\r\n\r\n  } catch (error) {\r\n    console.error('Get order error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to fetch order',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\n// Create order\r\nrouter.post('/', [\r\n  body('addressId').isUUID(),\r\n  body('items').isArray({ min: 1 }),\r\n  body('paymentMethod').isIn(['CREDIT_CARD', 'BANK_TRANSFER', 'CASH_ON_DELIVERY', 'BKASH', 'NAGAD', 'ROCKET']),\r\n  body('notes').optional().isString()\r\n], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {\r\n  // Use authenticated user's ID\r\n  req.body.userId = req.userId;\r\n  try {\r\n    const { userId, addressId, items, paymentMethod, notes } = req.body;\r\n\r\n    // Validate user and address\r\n    const [user, address] = await Promise.all([\r\n      prisma.user.findUnique({ where: { id: userId } }),\r\n      prisma.address.findUnique({ where: { id: addressId } })\r\n    ]);\r\n\r\n    if (!user) {\r\n      return res.status(404).json({\r\n        error: 'User not found'\r\n      });\r\n    }\r\n\r\n    if (!address) {\r\n      return res.status(404).json({\r\n        error: 'Address not found'\r\n      });\r\n    }\r\n\r\n    // Validate items and calculate totals\r\n    let subtotal = 0;\r\n    const orderItems = [];\r\n\r\n    for (const item of items) {\r\n      const product = await prisma.product.findUnique({\r\n        where: { id: item.productId }\r\n      });\r\n\r\n      if (!product) {\r\n        return res.status(400).json({\r\n          error: `Product ${item.productId} not found`\r\n        });\r\n      }\r\n\r\n      if (product.stockQuantity < item.quantity) {\r\n        return res.status(400).json({\r\n          error: `Insufficient stock for product ${product.name}`\r\n        });\r\n      }\r\n\r\n      const itemTotal = parseFloat(product.regularPrice) * item.quantity;\r\n      subtotal += itemTotal;\r\n\r\n      orderItems.push({\r\n        productId: item.productId,\r\n        variantId: item.variantId || null,\r\n        quantity: item.quantity,\r\n        unitPrice: parseFloat(product.regularPrice),\r\n        totalPrice: itemTotal\r\n      });\r\n    }\r\n\r\n    // Calculate totals\r\n    const tax = subtotal * 0.15; // 15% tax\r\n    const shippingCost = 100; // Fixed shipping cost\r\n    const discount = 0; // Can be calculated based on coupons\r\n    const total = subtotal + tax + shippingCost - discount;\r\n\r\n    // Generate order number\r\n    const orderNumber = 'ORD' + Date.now() + Math.floor(Math.random() * 1000);\r\n\r\n    // Create order\r\n    const order = await prisma.order.create({\r\n      data: {\r\n        orderNumber,\r\n        userId,\r\n        addressId,\r\n        subtotal,\r\n        tax,\r\n        shippingCost,\r\n        discount,\r\n        total,\r\n        paymentMethod,\r\n        notes,\r\n        status: 'PENDING',\r\n        items: {\r\n          create: orderItems\r\n        }\r\n      },\r\n      include: {\r\n        items: {\r\n          include: {\r\n            product: true\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    // Update product stock\r\n    for (const item of items) {\r\n      await prisma.product.update({\r\n        where: { id: item.productId },\r\n        data: {\r\n          stockQuantity: {\r\n            decrement: item.quantity\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    res.status(201).json({\r\n      message: 'Order created successfully',\r\n      order\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Create order error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to create order',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\n// Update order status\r\nrouter.put('/:id/status', [\r\n  param('id').isUUID(),\r\n  body('status').isIn(['PENDING', 'CONFIRMED', 'SHIPPED', 'DELIVERED', 'CANCELLED']),\r\n  body('notes').optional().isString()\r\n], handleValidationErrors, authMiddleware.managerOrAdmin(), async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { status, notes } = req.body;\r\n\r\n    // Check if order exists\r\n    const order = await prisma.order.findUnique({\r\n      where: { id }\r\n    });\r\n\r\n    if (!order) {\r\n      return res.status(404).json({\r\n        error: 'Order not found'\r\n      });\r\n    }\r\n\r\n    const updateData = { status };\r\n    \r\n    // Add timestamp based on status\r\n    if (status === 'CONFIRMED') updateData.confirmedAt = new Date();\r\n    if (status === 'SHIPPED') updateData.shippedAt = new Date();\r\n    if (status === 'DELIVERED') updateData.deliveredAt = new Date();\r\n    \r\n    if (notes) updateData.notes = notes;\r\n\r\n    const updatedOrder = await prisma.order.update({\r\n      where: { id },\r\n      data: updateData\r\n    });\r\n\r\n    res.json({\r\n      message: 'Order status updated successfully',\r\n      order: updatedOrder\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Update order status error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to update order status',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AAfZ,MAAME,OAAO;AAAA;AAAA,CAAAF,aAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAM;EAAEC,IAAI;EAAEC,KAAK;EAAEC,KAAK;EAAEC;AAAiB,CAAC;AAAA;AAAA,CAAAR,aAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,mBAAmB,CAAC;AAC7E,MAAM;EAAEK;AAAa,CAAC;AAAA;AAAA,CAAAT,aAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,gBAAgB,CAAC;AAClD,MAAM;EAAEM;AAAe,CAAC;AAAA;AAAA,CAAAV,aAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,oBAAoB,CAAC;AAExD,MAAMO,MAAM;AAAA;AAAA,CAAAX,aAAA,GAAAG,CAAA,OAAGD,OAAO,CAACU,MAAM,CAAC,CAAC;AAC/B,MAAMC,MAAM;AAAA;AAAA,CAAAb,aAAA,GAAAG,CAAA,OAAG,IAAIM,YAAY,CAAC,CAAC;;AAEjC;AAAA;AAAAT,aAAA,GAAAG,CAAA;AACA,MAAMW,sBAAsB,GAAGA,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EAAA;EAAAjB,aAAA,GAAAkB,CAAA;EACjD,MAAMC,MAAM;EAAA;EAAA,CAAAnB,aAAA,GAAAG,CAAA,OAAGK,gBAAgB,CAACO,GAAG,CAAC;EAAC;EAAAf,aAAA,GAAAG,CAAA;EACrC,IAAI,CAACgB,MAAM,CAACC,OAAO,CAAC,CAAC,EAAE;IAAA;IAAApB,aAAA,GAAAqB,CAAA;IAAArB,aAAA,GAAAG,CAAA;IACrB,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAC1BC,KAAK,EAAE,mBAAmB;MAC1BC,OAAO,EAAEN,MAAM,CAACO,KAAK,CAAC;IACxB,CAAC,CAAC;EACJ,CAAC;EAAA;EAAA;IAAA1B,aAAA,GAAAqB,CAAA;EAAA;EAAArB,aAAA,GAAAG,CAAA;EACDc,IAAI,CAAC,CAAC;AACR,CAAC;;AAED;AAAA;AAAAjB,aAAA,GAAAG,CAAA;AACAQ,MAAM,CAACgB,GAAG,CAAC,GAAG,EAAE,CACdpB,KAAK,CAAC,MAAM,CAAC,CAACqB,QAAQ,CAAC,CAAC,CAACC,KAAK,CAAC;EAAEC,GAAG,EAAE;AAAE,CAAC,CAAC,EAC1CvB,KAAK,CAAC,OAAO,CAAC,CAACqB,QAAQ,CAAC,CAAC,CAACC,KAAK,CAAC;EAAEC,GAAG,EAAE,CAAC;EAAEC,GAAG,EAAE;AAAI,CAAC,CAAC,EACrDxB,KAAK,CAAC,QAAQ,CAAC,CAACqB,QAAQ,CAAC,CAAC,CAACI,MAAM,CAAC,CAAC,EACnCzB,KAAK,CAAC,QAAQ,CAAC,CAACqB,QAAQ,CAAC,CAAC,CAACK,IAAI,CAAC,CAAC,SAAS,EAAE,WAAW,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC,CAC/F,EAAEnB,sBAAsB,EAAEJ,cAAc,CAACwB,YAAY,CAAC,CAAC,EAAE,OAAOnB,GAAG,EAAEC,GAAG,KAAK;EAAA;EAAAhB,aAAA,GAAAkB,CAAA;EAAAlB,aAAA,GAAAG,CAAA;EAC5E;EACA,IAAIY,GAAG,CAACoB,QAAQ,KAAK,OAAO,EAAE;IAAA;IAAAnC,aAAA,GAAAqB,CAAA;IAAArB,aAAA,GAAAG,CAAA;IAC5BY,GAAG,CAACR,KAAK,CAAC6B,MAAM,GAAGrB,GAAG,CAACqB,MAAM;EAC/B,CAAC;EAAA;EAAA;IAAApC,aAAA,GAAAqB,CAAA;EAAA;EAAArB,aAAA,GAAAG,CAAA;EACD,IAAI;IACF,MAAM;MAAEkC,IAAI;MAAA;MAAA,CAAArC,aAAA,GAAAqB,CAAA,UAAG,CAAC;MAAEiB,KAAK;MAAA;MAAA,CAAAtC,aAAA,GAAAqB,CAAA,UAAG,EAAE;MAAEe,MAAM;MAAEd;IAAO,CAAC;IAAA;IAAA,CAAAtB,aAAA,GAAAG,CAAA,QAAGY,GAAG,CAACR,KAAK;IAC1D,MAAMgC,IAAI;IAAA;IAAA,CAAAvC,aAAA,GAAAG,CAAA,QAAG,CAACkC,IAAI,GAAG,CAAC,IAAIC,KAAK;IAE/B,MAAME,KAAK;IAAA;IAAA,CAAAxC,aAAA,GAAAG,CAAA,QAAG,CAAC,CAAC;IAAC;IAAAH,aAAA,GAAAG,CAAA;IACjB,IAAIiC,MAAM,EAAE;MAAA;MAAApC,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MAAAqC,KAAK,CAACJ,MAAM,GAAGA,MAAM;IAAA,CAAC;IAAA;IAAA;MAAApC,aAAA,GAAAqB,CAAA;IAAA;IAAArB,aAAA,GAAAG,CAAA;IAClC,IAAImB,MAAM,EAAE;MAAA;MAAAtB,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MAAAqC,KAAK,CAAClB,MAAM,GAAGA,MAAM;IAAA,CAAC;IAAA;IAAA;MAAAtB,aAAA,GAAAqB,CAAA;IAAA;IAElC,MAAM,CAACoB,MAAM,EAAEC,KAAK,CAAC;IAAA;IAAA,CAAA1C,aAAA,GAAAG,CAAA,QAAG,MAAMwC,OAAO,CAACC,GAAG,CAAC,CACxC/B,MAAM,CAACgC,KAAK,CAACC,QAAQ,CAAC;MACpBN,KAAK;MACLD,IAAI,EAAEQ,QAAQ,CAACR,IAAI,CAAC;MACpBS,IAAI,EAAED,QAAQ,CAACT,KAAK,CAAC;MACrBW,OAAO,EAAE;QACPC,IAAI,EAAE;UACJC,MAAM,EAAE;YAAEC,EAAE,EAAE,IAAI;YAAEC,SAAS,EAAE,IAAI;YAAEC,QAAQ,EAAE,IAAI;YAAEC,KAAK,EAAE;UAAK;QACnE,CAAC;QACDC,OAAO,EAAE,IAAI;QACbC,KAAK,EAAE;UACLR,OAAO,EAAE;YACPS,OAAO,EAAE;cACPP,MAAM,EAAE;gBAAEC,EAAE,EAAE,IAAI;gBAAEO,IAAI,EAAE,IAAI;gBAAEC,GAAG,EAAE;cAAK;YAC5C;UACF;QACF,CAAC;QACDC,YAAY,EAAE;MAChB,CAAC;MACDC,OAAO,EAAE;QAAEC,SAAS,EAAE;MAAO;IAC/B,CAAC,CAAC,EACFlD,MAAM,CAACgC,KAAK,CAACmB,KAAK,CAAC;MAAExB;IAAM,CAAC,CAAC,CAC9B,CAAC;IAAC;IAAAxC,aAAA,GAAAG,CAAA;IAEHa,GAAG,CAACO,IAAI,CAAC;MACPkB,MAAM;MACNwB,UAAU,EAAE;QACV5B,IAAI,EAAEU,QAAQ,CAACV,IAAI,CAAC;QACpBC,KAAK,EAAES,QAAQ,CAACT,KAAK,CAAC;QACtBI,KAAK;QACLwB,KAAK,EAAEC,IAAI,CAACC,IAAI,CAAC1B,KAAK,GAAGJ,KAAK;MAChC;IACF,CAAC,CAAC;EAEJ,CAAC,CAAC,OAAOd,KAAK,EAAE;IAAA;IAAAxB,aAAA,GAAAG,CAAA;IACdkE,OAAO,CAAC7C,KAAK,CAAC,mBAAmB,EAAEA,KAAK,CAAC;IAAC;IAAAxB,aAAA,GAAAG,CAAA;IAC1Ca,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,KAAK,EAAE,wBAAwB;MAC/B8C,OAAO,EAAEC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa;MAAA;MAAA,CAAAzE,aAAA,GAAAqB,CAAA,UAAGG,KAAK,CAAC8C,OAAO;MAAA;MAAA,CAAAtE,aAAA,GAAAqB,CAAA,UAAG,uBAAuB;IAC3F,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AAAA;AAAArB,aAAA,GAAAG,CAAA;AACAQ,MAAM,CAACgB,GAAG,CAAC,MAAM,EAAE,CACjBrB,KAAK,CAAC,IAAI,CAAC,CAAC0B,MAAM,CAAC,CAAC,CACrB,EAAElB,sBAAsB,EAAEJ,cAAc,CAACwB,YAAY,CAAC,CAAC,EAAE,OAAOnB,GAAG,EAAEC,GAAG,KAAK;EAAA;EAAAhB,aAAA,GAAAkB,CAAA;EAC5E;EACA,MAAM2B,KAAK;EAAA;EAAA,CAAA7C,aAAA,GAAAG,CAAA,QAAG,MAAMU,MAAM,CAACgC,KAAK,CAAC6B,UAAU,CAAC;IAC1ClC,KAAK,EAAE;MAAEY,EAAE,EAAErC,GAAG,CAAC4D,MAAM,CAACvB;IAAG,CAAC;IAC5BD,MAAM,EAAE;MAAEf,MAAM,EAAE;IAAK;EACzB,CAAC,CAAC;EAAC;EAAApC,aAAA,GAAAG,CAAA;EAEH,IAAI,CAAC0C,KAAK,EAAE;IAAA;IAAA7C,aAAA,GAAAqB,CAAA;IAAArB,aAAA,GAAAG,CAAA;IACV,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAC1BC,KAAK,EAAE;IACT,CAAC,CAAC;EACJ,CAAC;EAAA;EAAA;IAAAxB,aAAA,GAAAqB,CAAA;EAAA;;EAED;EAAArB,aAAA,GAAAG,CAAA;EACA;EAAI;EAAA,CAAAH,aAAA,GAAAqB,CAAA,UAAAN,GAAG,CAACoB,QAAQ,KAAK,OAAO;EAAA;EAAA,CAAAnC,aAAA,GAAAqB,CAAA,UAAIwB,KAAK,CAACT,MAAM,KAAKrB,GAAG,CAACqB,MAAM,GAAE;IAAA;IAAApC,aAAA,GAAAqB,CAAA;IAAArB,aAAA,GAAAG,CAAA;IAC3D,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAC1BC,KAAK,EAAE,eAAe;MACtB8C,OAAO,EAAE;IACX,CAAC,CAAC;EACJ,CAAC;EAAA;EAAA;IAAAtE,aAAA,GAAAqB,CAAA;EAAA;EAAArB,aAAA,GAAAG,CAAA;EACD,IAAI;IACF,MAAM;MAAEiD;IAAG,CAAC;IAAA;IAAA,CAAApD,aAAA,GAAAG,CAAA,QAAGY,GAAG,CAAC4D,MAAM;IAEzB,MAAM9B,KAAK;IAAA;IAAA,CAAA7C,aAAA,GAAAG,CAAA,QAAG,MAAMU,MAAM,CAACgC,KAAK,CAAC6B,UAAU,CAAC;MAC1ClC,KAAK,EAAE;QAAEY;MAAG,CAAC;MACbH,OAAO,EAAE;QACPC,IAAI,EAAE;UACJC,MAAM,EAAE;YAAEC,EAAE,EAAE,IAAI;YAAEC,SAAS,EAAE,IAAI;YAAEC,QAAQ,EAAE,IAAI;YAAEC,KAAK,EAAE,IAAI;YAAEqB,KAAK,EAAE;UAAK;QAChF,CAAC;QACDpB,OAAO,EAAE,IAAI;QACbC,KAAK,EAAE;UACLR,OAAO,EAAE;YACPS,OAAO,EAAE;cACPT,OAAO,EAAE;gBACP4B,MAAM,EAAE;kBACNrC,KAAK,EAAE;oBAAEsC,SAAS,EAAE;kBAAE,CAAC;kBACvB9B,IAAI,EAAE,CAAC;kBACPG,MAAM,EAAE;oBAAEC,EAAE,EAAE,IAAI;oBAAE2B,GAAG,EAAE,IAAI;oBAAEC,GAAG,EAAE;kBAAK;gBAC3C;cACF;YACF,CAAC;YACDC,OAAO,EAAE;UACX;QACF,CAAC;QACDpB,YAAY,EAAE;MAChB;IACF,CAAC,CAAC;IAAC;IAAA7D,aAAA,GAAAG,CAAA;IAEH,IAAI,CAAC0C,KAAK,EAAE;MAAA;MAAA7C,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MACV,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,KAAK,EAAE;MACT,CAAC,CAAC;IACJ,CAAC;IAAA;IAAA;MAAAxB,aAAA,GAAAqB,CAAA;IAAA;IAAArB,aAAA,GAAAG,CAAA;IAEDa,GAAG,CAACO,IAAI,CAAC;MAAEsB;IAAM,CAAC,CAAC;EAErB,CAAC,CAAC,OAAOrB,KAAK,EAAE;IAAA;IAAAxB,aAAA,GAAAG,CAAA;IACdkE,OAAO,CAAC7C,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;IAAC;IAAAxB,aAAA,GAAAG,CAAA;IACzCa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,KAAK,EAAE,uBAAuB;MAC9B8C,OAAO,EAAEC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa;MAAA;MAAA,CAAAzE,aAAA,GAAAqB,CAAA,WAAGG,KAAK,CAAC8C,OAAO;MAAA;MAAA,CAAAtE,aAAA,GAAAqB,CAAA,WAAG,uBAAuB;IAC3F,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AAAA;AAAArB,aAAA,GAAAG,CAAA;AACAQ,MAAM,CAACuE,IAAI,CAAC,GAAG,EAAE,CACf7E,IAAI,CAAC,WAAW,CAAC,CAAC2B,MAAM,CAAC,CAAC,EAC1B3B,IAAI,CAAC,OAAO,CAAC,CAAC8E,OAAO,CAAC;EAAErD,GAAG,EAAE;AAAE,CAAC,CAAC,EACjCzB,IAAI,CAAC,eAAe,CAAC,CAAC4B,IAAI,CAAC,CAAC,aAAa,EAAE,eAAe,EAAE,kBAAkB,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC,EAC5G5B,IAAI,CAAC,OAAO,CAAC,CAACuB,QAAQ,CAAC,CAAC,CAACwD,QAAQ,CAAC,CAAC,CACpC,EAAEtE,sBAAsB,EAAEJ,cAAc,CAACwB,YAAY,CAAC,CAAC,EAAE,OAAOnB,GAAG,EAAEC,GAAG,KAAK;EAAA;EAAAhB,aAAA,GAAAkB,CAAA;EAAAlB,aAAA,GAAAG,CAAA;EAC5E;EACAY,GAAG,CAACV,IAAI,CAAC+B,MAAM,GAAGrB,GAAG,CAACqB,MAAM;EAAC;EAAApC,aAAA,GAAAG,CAAA;EAC7B,IAAI;IACF,MAAM;MAAEiC,MAAM;MAAEiD,SAAS;MAAE5B,KAAK;MAAE6B,aAAa;MAAEC;IAAM,CAAC;IAAA;IAAA,CAAAvF,aAAA,GAAAG,CAAA,QAAGY,GAAG,CAACV,IAAI;;IAEnE;IACA,MAAM,CAAC6C,IAAI,EAAEM,OAAO,CAAC;IAAA;IAAA,CAAAxD,aAAA,GAAAG,CAAA,QAAG,MAAMwC,OAAO,CAACC,GAAG,CAAC,CACxC/B,MAAM,CAACqC,IAAI,CAACwB,UAAU,CAAC;MAAElC,KAAK,EAAE;QAAEY,EAAE,EAAEhB;MAAO;IAAE,CAAC,CAAC,EACjDvB,MAAM,CAAC2C,OAAO,CAACkB,UAAU,CAAC;MAAElC,KAAK,EAAE;QAAEY,EAAE,EAAEiC;MAAU;IAAE,CAAC,CAAC,CACxD,CAAC;IAAC;IAAArF,aAAA,GAAAG,CAAA;IAEH,IAAI,CAAC+C,IAAI,EAAE;MAAA;MAAAlD,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MACT,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,KAAK,EAAE;MACT,CAAC,CAAC;IACJ,CAAC;IAAA;IAAA;MAAAxB,aAAA,GAAAqB,CAAA;IAAA;IAAArB,aAAA,GAAAG,CAAA;IAED,IAAI,CAACqD,OAAO,EAAE;MAAA;MAAAxD,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MACZ,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,KAAK,EAAE;MACT,CAAC,CAAC;IACJ,CAAC;IAAA;IAAA;MAAAxB,aAAA,GAAAqB,CAAA;IAAA;;IAED;IACA,IAAImE,QAAQ;IAAA;IAAA,CAAAxF,aAAA,GAAAG,CAAA,QAAG,CAAC;IAChB,MAAMsF,UAAU;IAAA;IAAA,CAAAzF,aAAA,GAAAG,CAAA,QAAG,EAAE;IAAC;IAAAH,aAAA,GAAAG,CAAA;IAEtB,KAAK,MAAMuF,IAAI,IAAIjC,KAAK,EAAE;MACxB,MAAMC,OAAO;MAAA;MAAA,CAAA1D,aAAA,GAAAG,CAAA,QAAG,MAAMU,MAAM,CAAC6C,OAAO,CAACgB,UAAU,CAAC;QAC9ClC,KAAK,EAAE;UAAEY,EAAE,EAAEsC,IAAI,CAACC;QAAU;MAC9B,CAAC,CAAC;MAAC;MAAA3F,aAAA,GAAAG,CAAA;MAEH,IAAI,CAACuD,OAAO,EAAE;QAAA;QAAA1D,aAAA,GAAAqB,CAAA;QAAArB,aAAA,GAAAG,CAAA;QACZ,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,KAAK,EAAE,WAAWkE,IAAI,CAACC,SAAS;QAClC,CAAC,CAAC;MACJ,CAAC;MAAA;MAAA;QAAA3F,aAAA,GAAAqB,CAAA;MAAA;MAAArB,aAAA,GAAAG,CAAA;MAED,IAAIuD,OAAO,CAACkC,aAAa,GAAGF,IAAI,CAACG,QAAQ,EAAE;QAAA;QAAA7F,aAAA,GAAAqB,CAAA;QAAArB,aAAA,GAAAG,CAAA;QACzC,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,KAAK,EAAE,kCAAkCkC,OAAO,CAACC,IAAI;QACvD,CAAC,CAAC;MACJ,CAAC;MAAA;MAAA;QAAA3D,aAAA,GAAAqB,CAAA;MAAA;MAED,MAAMyE,SAAS;MAAA;MAAA,CAAA9F,aAAA,GAAAG,CAAA,QAAG4F,UAAU,CAACrC,OAAO,CAACsC,YAAY,CAAC,GAAGN,IAAI,CAACG,QAAQ;MAAC;MAAA7F,aAAA,GAAAG,CAAA;MACnEqF,QAAQ,IAAIM,SAAS;MAAC;MAAA9F,aAAA,GAAAG,CAAA;MAEtBsF,UAAU,CAACQ,IAAI,CAAC;QACdN,SAAS,EAAED,IAAI,CAACC,SAAS;QACzBO,SAAS;QAAE;QAAA,CAAAlG,aAAA,GAAAqB,CAAA,WAAAqE,IAAI,CAACQ,SAAS;QAAA;QAAA,CAAAlG,aAAA,GAAAqB,CAAA,WAAI,IAAI;QACjCwE,QAAQ,EAAEH,IAAI,CAACG,QAAQ;QACvBM,SAAS,EAAEJ,UAAU,CAACrC,OAAO,CAACsC,YAAY,CAAC;QAC3CI,UAAU,EAAEN;MACd,CAAC,CAAC;IACJ;;IAEA;IACA,MAAMO,GAAG;IAAA;IAAA,CAAArG,aAAA,GAAAG,CAAA,QAAGqF,QAAQ,GAAG,IAAI,EAAC,CAAC;IAC7B,MAAMc,YAAY;IAAA;IAAA,CAAAtG,aAAA,GAAAG,CAAA,QAAG,GAAG,EAAC,CAAC;IAC1B,MAAMoG,QAAQ;IAAA;IAAA,CAAAvG,aAAA,GAAAG,CAAA,QAAG,CAAC,EAAC,CAAC;IACpB,MAAMuC,KAAK;IAAA;IAAA,CAAA1C,aAAA,GAAAG,CAAA,QAAGqF,QAAQ,GAAGa,GAAG,GAAGC,YAAY,GAAGC,QAAQ;;IAEtD;IACA,MAAMC,WAAW;IAAA;IAAA,CAAAxG,aAAA,GAAAG,CAAA,QAAG,KAAK,GAAGsG,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGvC,IAAI,CAACwC,KAAK,CAACxC,IAAI,CAACyC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC;;IAEzE;IACA,MAAM/D,KAAK;IAAA;IAAA,CAAA7C,aAAA,GAAAG,CAAA,QAAG,MAAMU,MAAM,CAACgC,KAAK,CAACgE,MAAM,CAAC;MACtCC,IAAI,EAAE;QACJN,WAAW;QACXpE,MAAM;QACNiD,SAAS;QACTG,QAAQ;QACRa,GAAG;QACHC,YAAY;QACZC,QAAQ;QACR7D,KAAK;QACL4C,aAAa;QACbC,KAAK;QACLjE,MAAM,EAAE,SAAS;QACjBmC,KAAK,EAAE;UACLoD,MAAM,EAAEpB;QACV;MACF,CAAC;MACDxC,OAAO,EAAE;QACPQ,KAAK,EAAE;UACLR,OAAO,EAAE;YACPS,OAAO,EAAE;UACX;QACF;MACF;IACF,CAAC,CAAC;;IAEF;IAAA;IAAA1D,aAAA,GAAAG,CAAA;IACA,KAAK,MAAMuF,IAAI,IAAIjC,KAAK,EAAE;MAAA;MAAAzD,aAAA,GAAAG,CAAA;MACxB,MAAMU,MAAM,CAAC6C,OAAO,CAACqD,MAAM,CAAC;QAC1BvE,KAAK,EAAE;UAAEY,EAAE,EAAEsC,IAAI,CAACC;QAAU,CAAC;QAC7BmB,IAAI,EAAE;UACJlB,aAAa,EAAE;YACboB,SAAS,EAAEtB,IAAI,CAACG;UAClB;QACF;MACF,CAAC,CAAC;IACJ;IAAC;IAAA7F,aAAA,GAAAG,CAAA;IAEDa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnB+C,OAAO,EAAE,4BAA4B;MACrCzB;IACF,CAAC,CAAC;EAEJ,CAAC,CAAC,OAAOrB,KAAK,EAAE;IAAA;IAAAxB,aAAA,GAAAG,CAAA;IACdkE,OAAO,CAAC7C,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;IAAC;IAAAxB,aAAA,GAAAG,CAAA;IAC5Ca,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,KAAK,EAAE,wBAAwB;MAC/B8C,OAAO,EAAEC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa;MAAA;MAAA,CAAAzE,aAAA,GAAAqB,CAAA,WAAGG,KAAK,CAAC8C,OAAO;MAAA;MAAA,CAAAtE,aAAA,GAAAqB,CAAA,WAAG,uBAAuB;IAC3F,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AAAA;AAAArB,aAAA,GAAAG,CAAA;AACAQ,MAAM,CAACsG,GAAG,CAAC,aAAa,EAAE,CACxB3G,KAAK,CAAC,IAAI,CAAC,CAAC0B,MAAM,CAAC,CAAC,EACpB3B,IAAI,CAAC,QAAQ,CAAC,CAAC4B,IAAI,CAAC,CAAC,SAAS,EAAE,WAAW,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC,EAClF5B,IAAI,CAAC,OAAO,CAAC,CAACuB,QAAQ,CAAC,CAAC,CAACwD,QAAQ,CAAC,CAAC,CACpC,EAAEtE,sBAAsB,EAAEJ,cAAc,CAACwG,cAAc,CAAC,CAAC,EAAE,OAAOnG,GAAG,EAAEC,GAAG,KAAK;EAAA;EAAAhB,aAAA,GAAAkB,CAAA;EAAAlB,aAAA,GAAAG,CAAA;EAC9E,IAAI;IACF,MAAM;MAAEiD;IAAG,CAAC;IAAA;IAAA,CAAApD,aAAA,GAAAG,CAAA,QAAGY,GAAG,CAAC4D,MAAM;IACzB,MAAM;MAAErD,MAAM;MAAEiE;IAAM,CAAC;IAAA;IAAA,CAAAvF,aAAA,GAAAG,CAAA,QAAGY,GAAG,CAACV,IAAI;;IAElC;IACA,MAAMwC,KAAK;IAAA;IAAA,CAAA7C,aAAA,GAAAG,CAAA,QAAG,MAAMU,MAAM,CAACgC,KAAK,CAAC6B,UAAU,CAAC;MAC1ClC,KAAK,EAAE;QAAEY;MAAG;IACd,CAAC,CAAC;IAAC;IAAApD,aAAA,GAAAG,CAAA;IAEH,IAAI,CAAC0C,KAAK,EAAE;MAAA;MAAA7C,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MACV,OAAOa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,KAAK,EAAE;MACT,CAAC,CAAC;IACJ,CAAC;IAAA;IAAA;MAAAxB,aAAA,GAAAqB,CAAA;IAAA;IAED,MAAM8F,UAAU;IAAA;IAAA,CAAAnH,aAAA,GAAAG,CAAA,QAAG;MAAEmB;IAAO,CAAC;;IAE7B;IAAA;IAAAtB,aAAA,GAAAG,CAAA;IACA,IAAImB,MAAM,KAAK,WAAW,EAAE;MAAA;MAAAtB,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MAAAgH,UAAU,CAACC,WAAW,GAAG,IAAIX,IAAI,CAAC,CAAC;IAAA,CAAC;IAAA;IAAA;MAAAzG,aAAA,GAAAqB,CAAA;IAAA;IAAArB,aAAA,GAAAG,CAAA;IAChE,IAAImB,MAAM,KAAK,SAAS,EAAE;MAAA;MAAAtB,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MAAAgH,UAAU,CAACE,SAAS,GAAG,IAAIZ,IAAI,CAAC,CAAC;IAAA,CAAC;IAAA;IAAA;MAAAzG,aAAA,GAAAqB,CAAA;IAAA;IAAArB,aAAA,GAAAG,CAAA;IAC5D,IAAImB,MAAM,KAAK,WAAW,EAAE;MAAA;MAAAtB,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MAAAgH,UAAU,CAACG,WAAW,GAAG,IAAIb,IAAI,CAAC,CAAC;IAAA,CAAC;IAAA;IAAA;MAAAzG,aAAA,GAAAqB,CAAA;IAAA;IAAArB,aAAA,GAAAG,CAAA;IAEhE,IAAIoF,KAAK,EAAE;MAAA;MAAAvF,aAAA,GAAAqB,CAAA;MAAArB,aAAA,GAAAG,CAAA;MAAAgH,UAAU,CAAC5B,KAAK,GAAGA,KAAK;IAAA,CAAC;IAAA;IAAA;MAAAvF,aAAA,GAAAqB,CAAA;IAAA;IAEpC,MAAMkG,YAAY;IAAA;IAAA,CAAAvH,aAAA,GAAAG,CAAA,QAAG,MAAMU,MAAM,CAACgC,KAAK,CAACkE,MAAM,CAAC;MAC7CvE,KAAK,EAAE;QAAEY;MAAG,CAAC;MACb0D,IAAI,EAAEK;IACR,CAAC,CAAC;IAAC;IAAAnH,aAAA,GAAAG,CAAA;IAEHa,GAAG,CAACO,IAAI,CAAC;MACP+C,OAAO,EAAE,mCAAmC;MAC5CzB,KAAK,EAAE0E;IACT,CAAC,CAAC;EAEJ,CAAC,CAAC,OAAO/F,KAAK,EAAE;IAAA;IAAAxB,aAAA,GAAAG,CAAA;IACdkE,OAAO,CAAC7C,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IAAC;IAAAxB,aAAA,GAAAG,CAAA;IACnDa,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,KAAK,EAAE,+BAA+B;MACtC8C,OAAO,EAAEC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa;MAAA;MAAA,CAAAzE,aAAA,GAAAqB,CAAA,WAAGG,KAAK,CAAC8C,OAAO;MAAA;MAAA,CAAAtE,aAAA,GAAAqB,CAAA,WAAG,uBAAuB;IAC3F,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;AAAC;AAAArB,aAAA,GAAAG,CAAA;AAEHqH,MAAM,CAACC,OAAO,GAAG9G,MAAM","ignoreList":[]}