{"version":3,"names":["express","require","body","param","query","validationResult","PrismaClient","authMiddleware","router","Router","prisma","handleValidationErrors","req","res","next","errors","isEmpty","status","json","error","details","array","get","optional","isInt","min","max","isUUID","isIn","authenticate","userRole","userId","page","limit","skip","where","orders","total","Promise","all","order","findMany","parseInt","take","include","user","select","id","firstName","lastName","email","address","items","product","name","sku","transactions","orderBy","createdAt","count","pagination","pages","Math","ceil","console","message","process","env","NODE_ENV","findUnique","params","phone","images","sortOrder","url","alt","variant","post","isArray","isString","addressId","paymentMethod","notes","subtotal","orderItems","item","productId","stockQuantity","quantity","itemTotal","parseFloat","regularPrice","push","variantId","unitPrice","totalPrice","tax","shippingCost","discount","orderNumber","Date","now","floor","random","create","data","update","decrement","put","managerOrAdmin","updateData","confirmedAt","shippedAt","deliveredAt","updatedOrder","module","exports"],"sources":["orders.js"],"sourcesContent":["const express = require('express');\r\nconst { body, param, query, validationResult } = require('express-validator');\r\nconst { PrismaClient } = require('@prisma/client');\r\nconst { authMiddleware } = require('../middleware/auth');\r\n\r\nconst router = express.Router();\r\nconst prisma = new PrismaClient();\r\n\r\n// Validation middleware\r\nconst handleValidationErrors = (req, res, next) => {\r\n  const errors = validationResult(req);\r\n  if (!errors.isEmpty()) {\r\n    return res.status(400).json({\r\n      error: 'Validation failed',\r\n      details: errors.array()\r\n    });\r\n  }\r\n  next();\r\n};\r\n\r\n// Get all orders (admin or user-specific)\r\nrouter.get('/', [\r\n  query('page').optional().isInt({ min: 1 }),\r\n  query('limit').optional().isInt({ min: 1, max: 100 }),\r\n  query('userId').optional().isUUID(),\r\n  query('status').optional().isIn(['PENDING', 'CONFIRMED', 'SHIPPED', 'DELIVERED', 'CANCELLED'])\r\n], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {\r\n  // If user is not admin, only allow access to their own orders\r\n  if (req.userRole !== 'ADMIN') {\r\n    req.query.userId = req.userId;\r\n  }\r\n  try {\r\n    const { page = 1, limit = 20, userId, status } = req.query;\r\n    const skip = (page - 1) * limit;\r\n\r\n    const where = {};\r\n    if (userId) where.userId = userId;\r\n    if (status) where.status = status;\r\n\r\n    const [orders, total] = await Promise.all([\r\n      prisma.order.findMany({\r\n        where,\r\n        skip: parseInt(skip),\r\n        take: parseInt(limit),\r\n        include: {\r\n          user: {\r\n            select: { id: true, firstName: true, lastName: true, email: true }\r\n          },\r\n          address: true,\r\n          items: {\r\n            include: {\r\n              product: {\r\n                select: { id: true, name: true, sku: true }\r\n              }\r\n            }\r\n          },\r\n          transactions: true\r\n        },\r\n        orderBy: { createdAt: 'desc' }\r\n      }),\r\n      prisma.order.count({ where })\r\n    ]);\r\n\r\n    res.json({\r\n      orders,\r\n      pagination: {\r\n        page: parseInt(page),\r\n        limit: parseInt(limit),\r\n        total,\r\n        pages: Math.ceil(total / limit)\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Get orders error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to fetch orders',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\n// Get order by ID\r\nrouter.get('/:id', [\r\n  param('id').isUUID()\r\n], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {\r\n  // Get order first to check ownership\r\n  const order = await prisma.order.findUnique({\r\n    where: { id: req.params.id },\r\n    select: { userId: true }\r\n  });\r\n  \r\n  if (!order) {\r\n    return res.status(404).json({\r\n      error: 'Order not found'\r\n    });\r\n  }\r\n  \r\n  // Check if user is admin or order owner\r\n  if (req.userRole !== 'ADMIN' && order.userId !== req.userId) {\r\n    return res.status(403).json({\r\n      error: 'Access denied',\r\n      message: 'You can only access your own orders'\r\n    });\r\n  }\r\n  try {\r\n    const { id } = req.params;\r\n\r\n    const order = await prisma.order.findUnique({\r\n      where: { id },\r\n      include: {\r\n        user: {\r\n          select: { id: true, firstName: true, lastName: true, email: true, phone: true }\r\n        },\r\n        address: true,\r\n        items: {\r\n          include: {\r\n            product: {\r\n              include: {\r\n                images: {\r\n                  where: { sortOrder: 0 },\r\n                  take: 1,\r\n                  select: { id: true, url: true, alt: true }\r\n                }\r\n              }\r\n            },\r\n            variant: true\r\n          }\r\n        },\r\n        transactions: true\r\n      }\r\n    });\r\n\r\n    if (!order) {\r\n      return res.status(404).json({\r\n        error: 'Order not found'\r\n      });\r\n    }\r\n\r\n    res.json({ order });\r\n\r\n  } catch (error) {\r\n    console.error('Get order error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to fetch order',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\n// Create order\r\nrouter.post('/', [\r\n  body('addressId').isUUID(),\r\n  body('items').isArray({ min: 1 }),\r\n  body('paymentMethod').isIn(['CREDIT_CARD', 'BANK_TRANSFER', 'CASH_ON_DELIVERY', 'BKASH', 'NAGAD', 'ROCKET']),\r\n  body('notes').optional().isString()\r\n], handleValidationErrors, authMiddleware.authenticate(), async (req, res) => {\r\n  // Use authenticated user's ID\r\n  req.body.userId = req.userId;\r\n  try {\r\n    const { userId, addressId, items, paymentMethod, notes } = req.body;\r\n\r\n    // Validate user and address\r\n    const [user, address] = await Promise.all([\r\n      prisma.user.findUnique({ where: { id: userId } }),\r\n      prisma.address.findUnique({ where: { id: addressId } })\r\n    ]);\r\n\r\n    if (!user) {\r\n      return res.status(404).json({\r\n        error: 'User not found'\r\n      });\r\n    }\r\n\r\n    if (!address) {\r\n      return res.status(404).json({\r\n        error: 'Address not found'\r\n      });\r\n    }\r\n\r\n    // Validate items and calculate totals\r\n    let subtotal = 0;\r\n    const orderItems = [];\r\n\r\n    for (const item of items) {\r\n      const product = await prisma.product.findUnique({\r\n        where: { id: item.productId }\r\n      });\r\n\r\n      if (!product) {\r\n        return res.status(400).json({\r\n          error: `Product ${item.productId} not found`\r\n        });\r\n      }\r\n\r\n      if (product.stockQuantity < item.quantity) {\r\n        return res.status(400).json({\r\n          error: `Insufficient stock for product ${product.name}`\r\n        });\r\n      }\r\n\r\n      const itemTotal = parseFloat(product.regularPrice) * item.quantity;\r\n      subtotal += itemTotal;\r\n\r\n      orderItems.push({\r\n        productId: item.productId,\r\n        variantId: item.variantId || null,\r\n        quantity: item.quantity,\r\n        unitPrice: parseFloat(product.regularPrice),\r\n        totalPrice: itemTotal\r\n      });\r\n    }\r\n\r\n    // Calculate totals\r\n    const tax = subtotal * 0.15; // 15% tax\r\n    const shippingCost = 100; // Fixed shipping cost\r\n    const discount = 0; // Can be calculated based on coupons\r\n    const total = subtotal + tax + shippingCost - discount;\r\n\r\n    // Generate order number\r\n    const orderNumber = 'ORD' + Date.now() + Math.floor(Math.random() * 1000);\r\n\r\n    // Create order\r\n    const order = await prisma.order.create({\r\n      data: {\r\n        orderNumber,\r\n        userId,\r\n        addressId,\r\n        subtotal,\r\n        tax,\r\n        shippingCost,\r\n        discount,\r\n        total,\r\n        paymentMethod,\r\n        notes,\r\n        status: 'PENDING',\r\n        items: {\r\n          create: orderItems\r\n        }\r\n      },\r\n      include: {\r\n        items: {\r\n          include: {\r\n            product: true\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    // Update product stock\r\n    for (const item of items) {\r\n      await prisma.product.update({\r\n        where: { id: item.productId },\r\n        data: {\r\n          stockQuantity: {\r\n            decrement: item.quantity\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    res.status(201).json({\r\n      message: 'Order created successfully',\r\n      order\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Create order error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to create order',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\n// Update order status\r\nrouter.put('/:id/status', [\r\n  param('id').isUUID(),\r\n  body('status').isIn(['PENDING', 'CONFIRMED', 'SHIPPED', 'DELIVERED', 'CANCELLED']),\r\n  body('notes').optional().isString()\r\n], handleValidationErrors, authMiddleware.managerOrAdmin(), async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { status, notes } = req.body;\r\n\r\n    // Check if order exists\r\n    const order = await prisma.order.findUnique({\r\n      where: { id }\r\n    });\r\n\r\n    if (!order) {\r\n      return res.status(404).json({\r\n        error: 'Order not found'\r\n      });\r\n    }\r\n\r\n    const updateData = { status };\r\n    \r\n    // Add timestamp based on status\r\n    if (status === 'CONFIRMED') updateData.confirmedAt = new Date();\r\n    if (status === 'SHIPPED') updateData.shippedAt = new Date();\r\n    if (status === 'DELIVERED') updateData.deliveredAt = new Date();\r\n    \r\n    if (notes) updateData.notes = notes;\r\n\r\n    const updatedOrder = await prisma.order.update({\r\n      where: { id },\r\n      data: updateData\r\n    });\r\n\r\n    res.json({\r\n      message: 'Order status updated successfully',\r\n      order: updatedOrder\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Update order status error:', error);\r\n    res.status(500).json({\r\n      error: 'Failed to update order status',\r\n      message: process.env.NODE_ENV === 'development' ? error.message : 'Internal server error'\r\n    });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}